
SELECT * FROM GL_JE_BATCHES_HEADERS_V where period_name= 'Jul-21' and LEDGER_ID = '2021' AND  HEADER_NAME = 'Jul-21 Bank Transfers(1) BDT'


select * from gl_je_batches

select * from gl_je_headers






--PO AND LC QUERY FOR MAMUN BOS
--==========================

--=========================================================
--TO GET PO, GRN, LC AND GRN VALUS in ONE LINE AS SUMMARY
--=========================================================

SELECT  ORG_ID,GET_OU_NAME_FROM_ID( ORG_ID),
 SUPPLIER_NAME,PO_NUMBER,LC_NUMBER,CURRENCY_CODE,GRN_NO,GRN_DATE ,GRN_VALUE,BILL_OF_ENTRY_NO , BILL_OF_ENTRY_DATE
FROM XX_LC_DETAILS LC, XX_LC_DETAILS_DT LCD
WHERE LC.LC_ID= LCD.LC_ID 
--AND LC.LC_NUMBER IN(
--'1472-22-02-0018',
--'0731-22-02-0013',
--'0204-22-02-0002',
--'0204-22-02-0003',
--'1336-22-02-0015',
--'2083-22-02-0005',
--'1404-22-02-0004',
--'3086-22-02-0039',
--'0866-22-02-0001',
--'1404-22-02-0010',
--'DPCCHG111114'
--)-- '2355-18-02-0065' 
AND TO_DATE(GRN_DATE)  between '01-MAY-2021' and '31-MAY-2022'
--and PO_NUMBER='40008494'
ORDER BY PO_NUMBER

--============================================================
--TO GET PO, GRN, LC AND GRN VALUS  AS DETAILS
--============================================================

SELECT LC.LC_NUMBER, POH.SEGMENT1 PO_NUMBER,RSH.RECEIPT_NUM GRN_NUMBER,RT.TRANSACTION_DATE ,POH.CURRENCY_CODE,POL.ITEM_DESCRIPTION ,POH.RATE,
-- POL.QUANTITY PO_QUANTITY,
-- RSH.ATTRIBUTE11 BL_NO,
-- RSH.ATTRIBUTE12 BL_DT,
 RT.QUANTITY GRN_QTY,POL.UNIT_PRICE UNIT_PRICE,
RT.QUANTITY*POL.UNIT_PRICE AMOUNT ,RT.QUANTITY*POL.UNIT_PRICE*POH.RATE BDT_AMOUNT
 FROM PO_HEADERS_ALL POH, PO_LINES_ALL POL,XX_LC_DETAILS LC, RCV_SHIPMENT_HEADERS RSH,RCV_SHIPMENT_LINES RSL,RCV_TRANSACTIONS RT
WHERE POH.PO_HEADER_ID = POL.PO_HEADER_ID
AND POH.PO_HEADER_ID(+)= LC.PO_HEADER_ID
AND POH.PO_HEADER_ID= RSL.PO_HEADER_ID
AND RSL.SHIPMENT_HEADER_ID = RT.SHIPMENT_HEADER_ID
AND RSH.SHIPMENT_HEADER_ID = RSL.SHIPMENT_HEADER_ID
AND RSH.SHIPMENT_HEADER_ID = RT.SHIPMENT_HEADER_ID
AND RSL.SHIPMENT_LINE_ID= RT.SHIPMENT_LINE_ID
AND RT.TRANSACTION_TYPE = 'DELIVER'
AND TRUNC(TRANSACTION_DATE) between '01-MAY-2021' and '31-MAR-2022'
AND RT.ORGANIZATION_ID= 166
AND POH.currency_code <> 'BDT'
--AND POH.SEGMENT1= 40000023
ORDER BY POH.SEGMENT1  

SELECT DISTINCT RECEIPT_NO,RECEIPT_DATE,SUM(RECEIPT_QTY) RECEIPT_QTY,RATE*SUM(RECEIPT_QTY) RATE,SHIPMENT_HEADER_ID
FROM WBI_INV_RCV_TRANSACTIONS_F
WHERE TRANSACTION_TYPE='RECEIVE'
AND PO_HEADER_ID=:XX_LC_DETAILS.PO_HEADER_ID
GROUP BY RECEIPT_NO,RECEIPT_DATE,RECEIPT_QTY,RATE,SHIPMENT_HEADER_ID


select * from WBI_INV_RCV_TRANSACTIONS_F WHERE PO_NO = 40000023 and ORGANIZATION_NAME = 'KBIL Deep Sea' and TRANSACTION_TYPE = 'DELIVER'



--- KOL DATA ANALYSIS  V1
--==============

SELECT * FROM PO_LINES_ALL WHERE ITEM_DESCRIPTION LIKE '%MEDICAL%'

SELECT * FROM RCV_SHIPMENT_HEADERS WHERE SHIPMENT_HEADER_ID = 1009241

SELECT * FROM RCV_SHIPMENT_LINES WHERE PO_HEADER_ID=852931

select * from mtl_transaction_types 

select * from mtl_material_transactions where INVENTORY_ITEM_ID = 428 AND TRANSACTION_TYPE_ID = 32

SELECT * FROM RCV_SHIPMENT_LINES WHERE SHIPMENT_HEADER_ID IN()

SELECT * FROM MTL_TRANSACTION_types -- WHERE TRANSACTION_ID IN ()

--====================================
--ONHAND QUantity QUERY ()
--====================================

SELECT ORGANIZATION_ID,INVENTORY_ITEM_ID,GET_ORG_CODE_FROM_ID( ORGANIZATION_ID) ORG_CODE,XXGET_ITEM_DESCRIPTION(INVENTORY_ITEM_ID, ORGANIZATION_ID) ITEM_NAME,
-- DATE_RECEIVED,
 NVL(SUM(TRANSACTION_QUANTITY),0) ONHAND_QUANTITY
FROM MTL_ONHAND_QUANTITIES 
WHERE 1=1
AND INVENTORY_ITEM_ID IN (
 428,
447,
448,
774911,
796661,
386,
787861,
76,
102,
66,
118,
774910,
796566,
806756,
75,
787867,
796568,
77,
796567,
796569,
359106
)
-- and INVENTORY_ITEM_ID =428
 --AND TRUNC(DATE_RECEIVED) between '01-AUG-2018' and '05-MAY-2022'
 GROUP BY ORGANIZATION_ID,INVENTORY_ITEM_ID

--=======================================
-- ITEM STOCK SUMMARY DATE : 21-MAY-2022
--=======================================

SELECT  ORGANIZATION_ID,TRANSACTION_TYPE_NAME,INVENTORY_ITEM_ID,ITEM_NAME, GET_ORG_CODE_FROM_ID( ORGANIZATION_ID) ORG_CODE,SUM(TRANSACTION_QUANTITY) TRANSACTION_QUANTITY FROM 
(
SELECT A.TRANSACTION_ID,A.RCV_TRANSACTION_ID, A.TRANSACTION_DATE, A.ORGANIZATION_ID,GET_ORG_CODE_FROM_ID( A.ORGANIZATION_ID) ORG_CODE, GET_ORG_CODE_FROM_ID( A.TRANSFER_ORGANIZATION_ID) TRANSFER_ORG_CODE , 
 XXGET_ITEM_DESCRIPTION(A.INVENTORY_ITEM_ID, A.ORGANIZATION_ID) ITEM_NAME,A.INVENTORY_ITEM_ID,
B.TRANSACTION_TYPE_NAME, A.TRANSACTION_QUANTITY, 
--A.TRANSACTION_SOURCE_ID, A.TRX_SOURCE_LINE_ID, 
 A.ATTRIBUTE1 VEHICLE_NUMBER,
-- (SELECT DISTINCT CUSTOMER_NAME  FROM XX_CHALLAN_MO_TEMP WHERE CUSTOMER_ID=A.ATTRIBUTE10 ) RECEIPT_FROM_CUSTOMER, 
--(CASE WHEN B.TRANSACTION_TYPE_NAME = 'Int Order Intr Ship' THEN (SELECT  ORDER_NUMBER FROM OE_ORDER_HEADERS_ALL C WHERE C.HEADER_ID= NVL(TO_NUMBER(A.TRANSACTION_REFERENCE),0)) 
--ELSE 0 END) OD_NUMBER,
--SELECT  ORDER_NUMBER FROM OE_ORDER_HEADERS_ALL C WHERE C.HEADER_ID= NVL(A.TRANSACTION_REFERENCE,0)) OD_NUMBER,
 --A.SOURCE_LINE_ID, A.TRX_SOURCE_DELIVERY_ID,
  A.SHIPMENT_NUMBER CHALLAN_NUMBER,A.ATTRIBUTE3 EMPTY_CEREIVING_CHALLAN_DFF
 FROM MTL_MATERIAL_TRANSACTIONS A  , MTL_TRANSACTION_TYPES B 
 WHERE  A.TRANSACTION_TYPE_ID= B.TRANSACTION_TYPE_ID
AND A.INVENTORY_ITEM_ID IN (
 428,
447,
448,
774911,
796661,
386,
787861,
76,
102,
66,
118,
774910,
796566,
806756,
75,
787867,
796568,
77,
796567,
796569,
359106
)
-- AND A.TRANSACTION_ID = 1785120  
 AND TRANSACTION_TYPE_NAME   IN (
'Opening Stock Receipts','PO Receipt', 'Miscellaneous receipt','Miscellaneous issue' ,'Opening Stock Correction'
)
-- AND TRANSACTION_TYPE_NAME   IN (
--'Opening Stock Receipts','PO Receipt', 'Miscellaneous receipt','Miscellaneous issue' ,'Sales order issue', 'RMA Receipt','Empty Cylinder Receive' , 'Move Order Issue' , 'Empty Cylinder Receive' , 'Issue Return', 
-- 'Move Order Issue To Project', 'Opening Stock Correction','WIP Issue','WIP Return','WIP Completion','WIP Completion Return'
--)
  AND  A.ORGANIZATION_ID IN(
 173,
121,
141,
148,
163,
142,
147,
158,
160,
165,
170,
171,
176,
177,
179,
222,
223,
261,
201,
175
)
 --AND A.INVENTORY_ITEM_ID in ()
  )
  where 1=1
  and INVENTORY_ITEM_ID = nvl(:p_item_id,INVENTORY_ITEM_ID)
  and ORGANIZATION_ID =NVL(:P_INV_ORG,ORGANIZATION_ID)
GROUP BY TRANSACTION_TYPE_NAME,INVENTORY_ITEM_ID,ITEM_NAME,ORGANIZATION_ID
ORDER BY TRANSACTION_TYPE_NAME



--- KOL DATA ANALYSIS 
--==============

SELECT * FROM MTL_MATERIAL_TRANSACTIONS WHERE TRANSACTION_ID =  1785127

SELECT A.TRANSACTION_ID,A.TRANSACTION_DATE, A.ORGANIZATION_ID,GET_ORG_CODE_FROM_ID( A.ORGANIZATION_ID) ORG_CODE, GET_ORG_CODE_FROM_ID( A.TRANSFER_ORGANIZATION_ID) TRANSFER_ORG_CODE , 
 XXGET_ITEM_DESCRIPTION(A.INVENTORY_ITEM_ID, A.ORGANIZATION_ID) ITEM_NAME,A.INVENTORY_ITEM_ID,
B.TRANSACTION_TYPE_NAME, A.TRANSACTION_QUANTITY, 
--A.TRANSACTION_SOURCE_ID, A.TRX_SOURCE_LINE_ID, 
 A.ATTRIBUTE1 VEHICLE_NUMBER,
-- (SELECT DISTINCT CUSTOMER_NAME  FROM XX_CHALLAN_MO_TEMP WHERE CUSTOMER_ID=A.ATTRIBUTE10 ) RECEIPT_FROM_CUSTOMER, 
--(CASE WHEN B.TRANSACTION_TYPE_NAME = 'Int Order Intr Ship' THEN (SELECT  ORDER_NUMBER FROM OE_ORDER_HEADERS_ALL C WHERE C.HEADER_ID= NVL(TO_NUMBER(A.TRANSACTION_REFERENCE),0)) 
--ELSE 0 END) OD_NUMBER,
--SELECT  ORDER_NUMBER FROM OE_ORDER_HEADERS_ALL C WHERE C.HEADER_ID= NVL(A.TRANSACTION_REFERENCE,0)) OD_NUMBER,
 --A.SOURCE_LINE_ID, A.TRX_SOURCE_DELIVERY_ID,
  A.SHIPMENT_NUMBER CHALLAN_NUMBER,A.ATTRIBUTE3 EMPTY_CEREIVING_CHALLAN_DFF
 FROM MTL_MATERIAL_TRANSACTIONS A  , MTL_TRANSACTION_TYPES B 
 WHERE  A.TRANSACTION_TYPE_ID= B.TRANSACTION_TYPE_ID
AND A.INVENTORY_ITEM_ID IN (
 428,
447,
448,
774911,
796661,
386,
787861,
76,
102,
66,
118,
774910,
796566,
806756,
75,
787867,
796568,
77,
796567,
796569
)
-- AND A.TRANSACTION_ID = 1785120  
 AND TRANSACTION_TYPE_NAME   IN (
 'Opening Stock Receipts','PO Receipt' --, 'RMA Receipt','Empty Cylinder Receive' -- 'Move Order Issue' ,'Sales order issue', 'Empty Cylinder Receive' 
 )
  AND  A.ORGANIZATION_ID = 173
--AND TRANSACTION_TYPE_NAME = 'Empty Cylinder Receive'



SELECT * FROM MTL_TRANSACTION_TYPES -- WHERE 

SELECT A.TRANSACTION_ID,A.TRANSACTION_DATE, A.ORGANIZATION_ID,GET_ORG_CODE_FROM_ID( A.ORGANIZATION_ID) ORG_CODE, GET_ORG_CODE_FROM_ID( A.TRANSFER_ORGANIZATION_ID) TRANSFER_ORG_CODE , 
 XXGET_ITEM_DESCRIPTION(A.INVENTORY_ITEM_ID, A.ORGANIZATION_ID) ITEM_NAME,A.INVENTORY_ITEM_ID,
B.TRANSACTION_TYPE_NAME, A.TRANSACTION_QUANTITY, 
--A.TRANSACTION_SOURCE_ID, A.TRX_SOURCE_LINE_ID, 
A.ATTRIBUTE3 EMPTY_CEREIVING_CHALLAN, A.ATTRIBUTE1 VEHICLE_NUMBER,
-- (SELECT DISTINCT CUSTOMER_NAME  FROM XX_CHALLAN_MO_TEMP WHERE CUSTOMER_ID=A.ATTRIBUTE10 ) RECEIPT_FROM_CUSTOMER, 
(CASE WHEN B.TRANSACTION_TYPE_NAME = 'Int Order Intr Ship' THEN (SELECT  ORDER_NUMBER FROM OE_ORDER_HEADERS_ALL C WHERE C.HEADER_ID= NVL(TO_NUMBER(A.TRANSACTION_REFERENCE),0)) 
ELSE 0 END) OD_NUMBER,
--SELECT  ORDER_NUMBER FROM OE_ORDER_HEADERS_ALL C WHERE C.HEADER_ID= NVL(A.TRANSACTION_REFERENCE,0)) OD_NUMBER,
 A.SOURCE_LINE_ID, A.TRX_SOURCE_DELIVERY_ID, A.SHIPMENT_NUMBER CHALLAN_NUMBER
 FROM MTL_MATERIAL_TRANSACTIONS A  , MTL_TRANSACTION_TYPES B WHERE  A.TRANSACTION_TYPE_ID= B.TRANSACTION_TYPE_ID
 AND A.INVENTORY_ITEM_ID IN (
 428,
447,
448,
774911,
796661,
386,
787861,
76,
102,
66,
118,
774910,
796566,
806756,
75,
787867,
796568,
77,
796567,
796569)
-- AND A.TRANSACTION_ID = 1785120  
 AND TRANSACTION_TYPE_NAME  NOT IN (
'COGS Recognition', 'Internal Order Pick','Sales Order Pick'
 )
 AND  A.ORGANIZATION_ID = 173
--AND TRANSACTION_TYPE_NAME = 'Empty Cylinder Receive'


GET_ORG_CODE_FROM_ID(P_ID IN NUMBER)

SELECT * FROM OE_ORDER_HEADERS_ALL WHERE HEADER_ID=538199

SELECT * FROM OE_ORDER_LINES_ALL WHERE LINE_ID= 527508

WBI_INV_RCV_TRANSACTIONS_NTK







-- XXKSRM Item Stock IO Wise


SELECT DISTINCT
WXMD.ITEM_TYPE,
WXMD.ITEM_GROUP,
WXMD.ITEM_SUB_GROUP,
WXMD.FINANCE_CATEGORY,
NVL((SELECT OPERATING_UNIT_NAME FROM WBI_INV_ORG_DETAIL WHERE INV_ORGANIZATION_ID=:P_ORG_ID),'KABIR GROUP') ORGANIZATION_NAME,
NVL((SELECT OPERATING_UNIT_ADDRESS FROM WBI_INV_ORG_DETAIL WHERE INV_ORGANIZATION_ID= :P_ORG_ID),'Kabir Manzil,SK, Mujib Road,Agrabad,Chittagong,BD') ORG_ADD,
---WXMD.ORGANIZATION_NAME,
---(SELECT address_line_1||','|| address_line_2||','|| address_line_3||','|| town_or_city||','|| country  FROM hr_locations  HL ,hr_all_organization_units HOU
----WHERE HL.location_id = HOU.location_id AND HOU.organization_id =MOQ.ORGANIZATION_ID) ORG_ADD,
WXMD.ORGANIZATION_code,
MOQ.ORGANIZATION_ID,
WXMD.ITEM_CODE,
WXMD.ITEM_DESC,
WXMD.UOM1 UOM,
NVL (XX_INV_PKG.XXGET_INV_OPENING_STOCK (MOQ.INVENTORY_ITEM_ID,NVL(:P_ORG_ID,MOQ.ORGANIZATION_ID), NULL, NULL, :P_DATE),0) OPENING_QTY ,
---NVL (XXGET_INV_OPENING_STOCK (MOQ.INVENTORY_ITEM_ID,MOQ.ORGANIZATION_ID,NULL, NULL, :P_DATE),0) GLOBAL_STOCK,
NVL (XX_INV_PKG.XXGET_INV_OPENING_STOCK (MOQ.INVENTORY_ITEM_ID,NULL,NULL, NULL, :P_DATE),0) GLOBAL_STOCK,
:P_ITEM_TYPE  PITEM_TYPE,
:P_ITEM_GROU PITEM_GROUP,
:P_ITEM_SUB_GROUP PITEM_SUB_GROUP,
:P_FINANCE_CATEGORY PFINANCE_CATEGORY
FROM WBI_XXKBGITEM_MT_D WXMD,
MTL_ONHAND_QUANTITIES MOQ
WHERE     WXMD.INVENTORY_ITEM_ID= MOQ.INVENTORY_ITEM_ID(+) 
AND WXMD.ORGANIZATION_ID= MOQ.ORGANIZATION_ID (+)     
---AND   WXMD.ORGANIZATION_ID=:P_ORG_ID 
AND   WXMD.ORGANIZATION_ID=NVL(:P_ORG_ID,WXMD.ORGANIZATION_ID)
AND WXMD.ITEM_TYPE=NVL(:P_ITEM_TYPE,WXMD.ITEM_TYPE)
AND  WXMD.ITEM_GROUP=NVL(:P_ITEM_GROU,WXMD.ITEM_GROUP)
AND  WXMD.ITEM_SUB_GROUP=NVL(:P_ITEM_SUB_GROUP,WXMD.ITEM_SUB_GROUP)
AND  WXMD.INVENTORY_ITEM_ID NOT IN(19851,19536,2479,17544)
AND NVL(WXMD.FINANCE_CATEGORY,'XX')=NVL(:P_FINANCE_CATEGORY,NVL(WXMD.FINANCE_CATEGORY,'XX'))
AND WXMD.ITEM_CODE=NVL(:P_ITEM_CODE,WXMD.ITEM_CODE)









--CLOSE STATUS MO:
MO-KBM-0018312
MO-KSM-0024570
MO-KSH-0018714
1096361
MO-KSH-0027125
============================

MO-TRM-0087531

SELECT *   FROM  MFG_LOOKUPS MFG2
WHERE MFG2.LOOKUP_TYPE = 'MTL_TXN_REQUEST_STATUS'


SELECT *   FROM   MFG_LOOKUPS ML where LOOKUP_TYPE = 'MTL_TXN_REQUEST_STATUS'

SELECT DISTINCT MEANING   FROM   MFG_LOOKUPS ML where LOOKUP_TYPE = 'MTL_TXN_REQUEST_STATUS'


SELECT * FROM MTL_TXN_REQUEST_HEADERS WHERE HEADE

SELECT DISTINCT HEADER_STATUS_NAME  MO_STATUS FROM MTL_TXN_REQUEST_HEADERS_V where HEADER_STATUS_NAME = 'Closed' and ORGANIZATION_ID =  261 --and  INVENTORY_ITEM_ID = 180  

SELECT * FROM  MTL_TXN_REQUEST_HEADERS_V where request_number IN('121050', '1959985' ,
  'MO-TRA-0049296', 'MO-TRM-0087531')



SELECT *  FROM MTL_TXN_REQUEST_LINES_V where  INVENTORY_ITEM_ID = 180  --and ORGANIZATION_ID =  261
 and request_number IN('121051','1959985' ,
  'MO-TRA-0049296',  'MO-TRM-0087531')
  

--======================================
-- XXKSRM Monthly DIESEL Movement Report Details ---- Final
--======================================   

SELECT
(SELECT  DISTINCT MEANING   FROM   MFG_LOOKUPS ML where LOOKUP_CODE= B.HEADER_STATUS AND  LOOKUP_TYPE = 'MTL_TXN_REQUEST_STATUS') MO_STATUS,
B.HEADER_STATUS_NAME  MO_STATUS,
A.STATUS_DATE TRANSACT_DATE,
(SELECT DISTINCT OPERATING_UNIT_NAME FROM WBI_INV_ORG_DETAIL  IOD WHERE IOD.INV_ORGANIZATION_ID=A.ORGANIZATION_ID) ORG_NAME,
(SELECT  DISTINCT INV_ORG_ADDRESS FROM WBI_INV_ORG_DETAIL IOD WHERE IOD.INV_ORGANIZATION_ID=A.ORGANIZATION_ID) ORG_ADDRESS,
GET_ORG_CODE_FROM_ID(A.ORGANIZATION_ID) ORG_CODE,
XXGET_ITEM_DESCRIPTION(INVENTORY_ITEM_ID, A.ORGANIZATION_ID) ITEM_DESC,
A.REQUEST_NUMBER MO_NUMBER,
--WIRTF.ORGANIZATION_NAME,
A.ORGANIZATION_ID, INVENTORY_ITEM_ID,A.MOVE_ORDER_TYPE_NAME,A.TRANSACTION_TYPE_NAME,  REFERENCE TRIP_NUMBER, 
A.QUANTITY REQUESTED_QTY,
 QUANTITY_DELIVERED,
(SELECT DISTINCT  USE_AREA FROM XXKSRM_INV_USE_AREA_V WHERE USE_AREA_ID= A.ATTRIBUTE2 ) USEOFAREA 
FROM MTL_TXN_REQUEST_LINES_V A,  MTL_TXN_REQUEST_HEADERS_V  B
WHERE A.HEADER_ID=B.HEADER_ID
and A.TRANSACTION_TYPE_NAME not in ('Sales Order Pick', 'Internal Order Pick')
--AND INVENTORY_ITEM_ID = 180
AND (SELECT DISTINCT OPERATING_UNIT_NAME FROM WBI_INV_ORG_DETAIL  IOD WHERE IOD.INV_ORGANIZATION_ID=A.ORGANIZATION_ID) = NVL(:P_OU,(SELECT DISTINCT OPERATING_UNIT_NAME FROM WBI_INV_ORG_DETAIL  IOD WHERE IOD.INV_ORGANIZATION_ID=A.ORGANIZATION_ID) )
AND TRUNC(A.STATUS_DATE) BETWEEN NVL(:P_TRANSACT_DT_FROM, A.STATUS_DATE) and   NVL(:P_TRANSACT_DT_TO, A.STATUS_DATE)
AND A.ORGANIZATION_ID = NVL(:P_ORG_ID,A.ORGANIZATION_ID)
AND HEADER_STATUS_NAME NOT IN  'Incomplete'
and A.REQUEST_NUMBER =NVL(:P_MO_NUMBER, A.REQUEST_NUMBER)
-- and request_number= '1312225' -- 'MO-TRA-0049296'


--=========================================================================
SELECT * FROM HR_OPERATING_UNITS
-- XXKSRM Monthly DIESEL Movement Report Details  -- Here added Trip creation Date for giving data from backenmd , but it makes the report slow 
--========================================================================================

SELECT
(SELECT DISTINCT OPERATING_UNIT_NAME FROM WBI_INV_ORG_DETAIL  IOD WHERE IOD.INV_ORGANIZATION_ID=A.ORGANIZATION_ID) ORG_NAME,
(SELECT  DISTINCT INV_ORG_ADDRESS FROM WBI_INV_ORG_DETAIL IOD WHERE IOD.INV_ORGANIZATION_ID=A.ORGANIZATION_ID) ORG_ADDRESS,
GET_ORG_CODE_FROM_ID(A.ORGANIZATION_ID) ORG_CODE,
XXGET_ITEM_DESCRIPTION(INVENTORY_ITEM_ID, A.ORGANIZATION_ID) ITEM_DESC,
A.REQUEST_NUMBER MO_NUMBER,
--WIRTF.ORGANIZATION_NAME,
A.ORGANIZATION_ID, INVENTORY_ITEM_ID,A.MOVE_ORDER_TYPE_NAME,A.TRANSACTION_TYPE_NAME,  REFERENCE TRIP_NUMBER, 
A.QUANTITY REQUESTED_QTY,
 QUANTITY_DELIVERED,
(SELECT DISTINCT  USE_AREA FROM XXKSRM_INV_USE_AREA_V WHERE USE_AREA_ID= A.ATTRIBUTE2 ) USEOFAREA ,
  (SELECT DISTINCT DECODE(OTM.EMPLOYEE_ID,NULL,UNLISTED_DRIVER,(SELECT DISTINCT VENDOR_NAME  FROM AP_SUPPLIERS  WHERE VENDOR_ID = OTM.EMPLOYEE_ID)) DRIVER_NAME FROM  XX_ONT_TRIP_MT OTM WHERE TO_CHAR(OTM.MOVE_ORDER_NUMBER)=TO_CHAR(A.REQUEST_NUMBER) AND OTM.MOVE_ORDER_NUMBER IS NOT NULL) DRIVER_NAME,
  (select CREATION_DATE from XX_ONT_TRIP_MT WHERE TO_CHAR(MOVE_ORDER_NUMBER) = TO_CHAR(B.REQUEST_NUMBER)  ) TRIP_CREATION_DATE,
    (select TRIP_DATE from XX_ONT_TRIP_MT WHERE TO_CHAR(MOVE_ORDER_NUMBER) = TO_CHAR(B.REQUEST_NUMBER)  )  TRIP_DATE,
  A.STATUS_DATE TRANSACT_DATE,
  (case when A.LINE_STATUS =3 then 'Approved'
when A.LINE_STATUS =5 then 'Closed' 
when A.LINE_STATUS =6 then 'Canceled' 
 when A.LINE_STATUS =7 then 'Pre Approved'
  when A.LINE_STATUS =8 then 'Partially Approved'
end) MO_STATUS,
:P_TRANSACT_DT_FROM,
:P_TRANSACT_DT_TO
FROM MTL_TXN_REQUEST_LINES_V A,  MTL_TXN_REQUEST_HEADERS_V  B
WHERE A.HEADER_ID=B.HEADER_ID
and A.TRANSACTION_TYPE_NAME not in ('Sales Order Pick', 'Internal Order Pick') 
AND INVENTORY_ITEM_ID = 180
AND (SELECT DISTINCT OPERATING_UNIT_NAME FROM WBI_INV_ORG_DETAIL  IOD WHERE IOD.INV_ORGANIZATION_ID=A.ORGANIZATION_ID) = NVL(:P_OU,(SELECT DISTINCT OPERATING_UNIT_NAME FROM WBI_INV_ORG_DETAIL  IOD WHERE IOD.INV_ORGANIZATION_ID=A.ORGANIZATION_ID) )
AND TRUNC(A.STATUS_DATE) BETWEEN NVL(:P_TRANSACT_DT_FROM, A.STATUS_DATE) and   NVL(:P_TRANSACT_DT_TO, A.STATUS_DATE)
AND A.ORGANIZATION_ID = NVL(:P_ORG_ID,A.ORGANIZATION_ID)
AND HEADER_STATUS_NAME NOT IN  'Incomplete'
and A.REQUEST_NUMBER =NVL(:P_MO_NUMBER, A.REQUEST_NUMBER)
-- and request_number= '1312225' -- 'MO-TRA-0049296'



SELECT * FROM MTL_TXN_REQUEST_HEADERS WHERE REQUEST_NUMBER IN ( '1961719', 'MO-TRA-0049296')

SELECT * FROM MTL_TXN_REQUEST_LINES where  INVENTORY_ITEM_ID = 180 and HEADER_id=1933553 

ORGANIZATION_ID, INVENTORY_ITEM_ID,


/*XXKSRM Trip Wise Diesel Report*/  -- NEW REPORT

SELECT OPERATING_UNIT_ID,OU_NAME, OU_ADD,IO_NAME,DEPARTMENT,TRANSACTION_TYPE_NAME,ITEM_CODE,ITEM_DESC,UOM,SUM(ISSUE_QTY) ISSUE_QTY,SUM(MO_QTY) MO_QUANTITY,
ITEM_TYPE,ITEM_GROUP,ITEM_SUB_GROUP,USER_NAME,DEPT_USER,MO_NUMBER,MO_DATE,REFERENCE REMARKS,PDATE_FROM,PDATE_TO,
 XX_GET_USE_AREA (USE_OF_AREA) USE_OFAREA,ITEM_COST,  SUM(ISSUE_QTY)* ITEM_COST AMOUNT
FROM 
(
SELECT
WIOD.OPERATING_UNIT_ID,
WIOD.OPERATING_UNIT_NAME OU_NAME,
WIOD.INV_ORG_ADDRESS OU_ADD,
WIOD.INV_ORGANIZATION_ID,
WIOD.INV_ORGANIZATION_CODE,
WIOD.INVENTORY_ORGANIZATION_NAME IO_NAME,
 MTRL.TRANSACTION_TYPE_NAME,
--(SELECT DISTINCT ATTRIBUTE5 FROM MTL_TXN_REQUEST_LINES_V WHERE REQUEST_NUMBER=MTRL.REQUEST_NUMBER AND  ATTRIBUTE5 IS NOT NULL) DEPARTMENT,
(SELECT DISTINCT ATTRIBUTE5 FROM MTL_TXN_REQUEST_LINES_V WHERE REQUEST_NUMBER=MTRL.REQUEST_NUMBER and (ATTRIBUTE5=:P_DEPT or :P_DEPT is null) AND  ATTRIBUTE5 IS NOT NULL) DEPARTMENT,
---ATTRIBUTE5 DEPT,
---(SELECT DISTINCT  USE_AREA FROM XXKSRM_INV_USE_AREA_V WHERE USE_AREA_ID= MTRL.ATTRIBUTE2 AND OU_ID=(SELECT OPERATING_UNIT_ID FROM WBI_INV_ORG_DETAIL WHERE INV_ORGANIZATION_ID=MTRL.ORGANIZATION_ID)) USE_OF_AREA,
--(SELECT DISTINCT  USE_AREA FROM XXKSRM_INV_USE_AREA_V WHERE USE_AREA_ID= MTRL.ATTRIBUTE2 ) USE_OF_AREA,
---MTRL.ATTRIBUTE2 USE_OF_AREA,
WXMD.ITEM_CODE,
WXMD.ITEM_DESC,
MTRL.UOM_CODE UOM,
MTRL.QUANTITY_DELIVERED ISSUE_QTY,
MTRL.QUANTITY MO_QTY,
 NVL(xx_inv_pkg.GET_MFG_ORG_ITEM_COST(MTRL.ORGANIZATION_ID,WXMD.ITEM_ID, MTRL.CREATION_DATE),XX_GET_LIST_PRICE (WXMD.ITEM_ID)) ITEM_COST,
WXMD.ITEM_TYPE,
WXMD.ITEM_GROUP,
WXMD.ITEM_SUB_GROUP,
XX_INV_PKG.XXGET_ENAME (TO_CHAR (:P_USER)) USER_NAME,
XXGET_ENAME_WITH_KG(MTRL.CREATED_BY)   DEPT_USER, 
MTRL.REFERENCE REFERENCE,
MTRL.REQUEST_NUMBER MO_NUMBER,
MTRL.CREATION_DATE MO_DATE,
MTRL.ATTRIBUTE2 USE_OF_AREA,
:P_TRANSACTION_DATE_FROM PDATE_FROM,
:P_TRANSACTION_DATE_TO  PDATE_TO
FROM 
MTL_TXN_REQUEST_LINES_V  MTRL,
WBI_XXKBGITEM_MT_D WXMD,
WBI_INV_ORG_DETAIL WIOD
WHERE 
 WXMD.ORGANIZATION_ID=MTRL.ORGANIZATION_ID
AND WXMD.INVENTORY_ITEM_ID=MTRL.INVENTORY_ITEM_ID
AND WIOD.INV_ORGANIZATION_ID=WXMD.ORGANIZATION_ID
AND WIOD.INV_ORGANIZATION_ID=MTRL.ORGANIZATION_ID 
AND REQUEST_NUMBER  LIKE '%-%'
AND MTRL.QUANTITY_DELIVERED IS NOT NULL
--AND MTRL.ORGANIZATION_ID=:P_ORGANIZATION_ID
AND (MTRL.ORGANIZATION_ID = :P_ORGANIZATION_ID OR :P_ORGANIZATION_ID IS NULL)
AND WXMD.INVENTORY_ITEM_ID=NVL(:P_ITEM_CODE,WXMD.INVENTORY_ITEM_ID)
AND WXMD.ITEM_TYPE=NVL(:P_ITEM_TYPE,WXMD.ITEM_TYPE)
AND WXMD.ITEM_GROUP=NVL(:P_ITEM_GROUP,WXMD.ITEM_GROUP)
AND WXMD.ITEM_SUB_GROUP=NVL(:P_ITEM_SUB_GROUP,WXMD.ITEM_SUB_GROUP)
)
WHERE 
--DEPARTMENT IS NOT NULL
OPERATING_UNIT_ID = NVL(:P_OU,OPERATING_UNIT_ID )
  AND (XX_GET_USE_AREA (USE_OF_AREA) =:P_U_AREA OR :P_U_AREA IS NULL)
--and department = NVL(:P_DEPT,department)
--AND MO_DATE BETWEEN NVL(:P_TRANSACTION_DATE_FROM, MO_DATE)   AND NVL(:P_TRANSACTION_DATE_TO,MO_DATE) 
AND (:P_TRANSACTION_DATE_FROM IS null OR trunc(MO_DATE) BETWEEN :P_TRANSACTION_DATE_FROM  AND :P_TRANSACTION_DATE_TO)
AND  MO_NUMBER = NVL(:P_MO_NUMBER, MO_NUMBER)
GROUP BY OPERATING_UNIT_ID,OU_NAME, OU_ADD,IO_NAME,DEPARTMENT,USE_OF_AREA,ITEM_CODE,ITEM_DESC,UOM,ITEM_TYPE,ITEM_GROUP,ITEM_SUB_GROUP,
USER_NAME,PDATE_FROM,PDATE_TO,DEPT_USER,MO_NUMBER,MO_DATE,REFERENCE, MO_NUMBER,INV_ORGANIZATION_ID,INV_ORGANIZATION_CODE,TRANSACTION_TYPE_NAME,ITEM_COST
ORDER BY MO_NUMBER









---->    21001    CP|500W|16MM|000004    KSRM B 500 CWR 16 MM SHORT BAR


Report rtf condition for unit price
--=======================

<?xdofx: if RCV_QTY>0  then RCV_VAL div RCV_QTY else 0 end if?>

<?xdofx: if ISU_QTY<0  then ISU_VAL div ISU_QTY else 0 end if?>

<?xdofx: if CLS_QTY>0  then CLS_VAL div CLS_QTY else 0 end if?>


--  =====================TO GET ALL TYPE OF TRANSACTION OF AN ITEM BETWEEN A MONTH DETAILS ======================================================

SELECT * FROM MTL_MATERIAL_TRANSACTIONS WHERE INVENTORY_ITEM_ID=21001 and TRUNC(transaction_date)  between '01-OCT-2021' and  '31-OCT-2021'  

--  =====================TO GET ALL TYPE OF TRANSACTION OF AN ITEM BETWEEN A MONTH SUMMARY =====================================================

SELECT SUM(TRANSACTION_QUANTITY) , A.TRANSACTION_TYPE_ID, B.TRANSACTION_TYPE_NAME 
FROM MTL_MATERIAL_TRANSACTIONS A, MTL_TRANSACTION_TYPES B 
WHERE A.TRANSACTION_TYPE_ID = B.TRANSACTION_TYPE_ID
and  INVENTORY_ITEM_ID=21001 and TRUNC(transaction_date) between '01-OCT-2021' and  '31-OCT-2021' 
GROUP BY A.TRANSACTION_TYPE_ID, B.TRANSACTION_TYPE_NAME 


--=======================================
--POWER PEAK OFF PEAK ISSUE 

--ISO- 2200000000233
--IR- 10002175
--Challan no- 4201010011080
--
--Transaction ID- 
--Peak- 6778081
--
--OFPK- 6778077
--=======================================



SELECT * FROM MTL_MATERIAL_TRANSACTIONS WHERE TRANSACTION_ID  IN  (6778081, 6778077,6027805,6027804)

SELECT * FROM MTL_MATERIAL_TRANSACTIONS WHERE TRANSACTION_ID  IN  (6027805,6027804)


SELECT * FROM MTL_TXN_REQUEST_HEADERS WHERE HEADER_ID IN (1282549,
1282549)


SELECT * FROM MTL_TXN_REQUEST_LINES WHERE HEADER_ID IN (1282549,
1282549)




SELECT * FROM RCV_SHIPMENT_HEADERS WHERE SHIPMENT_NUM= '4201010011080'

SELECT * FROM RCV_SHIPMENT_LINES WHERE SHIPMENT_HEADER_ID=996784

SELECT * FROM RCV_TRANSACTIONS WHERE SHIPMENT_HEADER_ID=996784









--==============================================================================================
--WE HAVE FOUND A INVENTORY TRANSACTION WITH TXN TYPE "OPENING STOCK CORRECTION" IN LE 102 OU 03 IN DEC-2019.
-- PROVIDE ME A LIST OF TXN DATA WITH THIS TXN TYPE (IF ANY) IN EVERY LE TILL TODATE.
--==============================================================================================

SELECT OOD.ORGANIZATION_NAME,MMT.* FROM MTL_MATERIAL_TRANSACTIONS MMT, ORG_ORGANIZATION_DEFINITIONS OOD
 WHERE TRANSACTION_TYPE_ID = 180
 AND OOD.ORGANIZATION_ID= MMT.ORGANIZATION_ID




--QUANTITY MISMATCH:
--==========================

/*
 MTL_MATERIAL_TRANSACTIONS.TRANSACTION_SOURCE_ID =  GME_BATCH_HEADER.BATCH_ID 
 
 GME_MATERIAL_DETAILS.MOVE_ORDER_LINE_ID = MTL_TXN_REQUEST_LINES.LINE_ID

*/

select TRANSACTION_SOURCE_ID from MTL_MATERIAL_TRANSACTIONS WHERE TRANSACTION_ID IN (
10830089,
10830031,
11079429,
10830026,
11096700
)




SELECT * FROM gme_material_details where BATCH_ID= 729068

select  * from   MTL_TXN_REQUEST_LINES WHERE LINE_ID = 2098434 


select * from GME_BATCH_HEADER where BATCH_ID= 729068 


SELECT * FROM MTL_TXN_REQUEST_HEADERS WHERE HEADER_ID = 1771322



-- linE_id = 2098434















10830013
10830013
10830035
11079390
11096641



select * from  ic_tran_pnd


select * from 
MTL_ITEM_CATEGORIES_V where segment1 <> 'DEFAULT' and INVENTORY_ITEM_ID= 92  

select * from MTL_TRANSACTION_TYPES WHERE TRANSACTION_TYPE_NAME = 'Sales order issue'





SELECT  DISTINCT WXMD.ITEM_TYPE FROM WBI_XXKBGITEM_MT_D WXMD

SELECT  DISTINCT ITEM_GROUP,ITEM_TYPE FROM WBI_XXKBGITEM_MT_D 

SELECT  DISTINCT ITEM_SUB_GROUP,ITEM_GROUP,ITEM_TYPE FROM WBI_XXKBGITEM_MT_D

SELECT  DISTINCT  FINANCE_CATEGORY ,ITEM_SUB_GROUP,ITEM_GROUP,ITEM_TYPE  FROM WBI_XXKBGITEM_MT_D where STATUS = 'Active' and INVENTORY_ITEM_ID= 9

SELECT  DISTINCT  FINANCE_CATEGORY ,ORGANIZATION_CODE,ITEM_SUB_GROUP,ITEM_GROUP,ITEM_TYPE  FROM WBI_XXKBGITEM_MT_D where STATUS = 'Active' and INVENTORY_ITEM_ID= 9 --and ORGANIZATION_CODE = 'KBM'

select * from WBI_XXKBGITEM_MT_D where STATUS = 'Active' and ORGANIZATION_CODE <> 'KIM' and INVENTORY_ITEM_ID= 9 

 E.ITEM_TYPE , E.ITEM_GROUP , E.ITEM_SUB_GROUP
 
 select * from ORG_ORGANIZATION_DEFINITIONS where organization_code= 'KS2'
 
 
 SELECT DISTINCT (MSI.SEGMENT1 || '|'||MSI.SEGMENT2 || '|'||MSI.SEGMENT3 || '|'||MSI.SEGMENT4) ITEMCODE, DESCRIPTION FROM MTL_SYSTEM_ITEMS MSI
where DESCRIPTION is not null
 
 where MSI.SEGMENT1 || '|'||MSI.SEGMENT2 || '|'||MSI.SEGMENT3 || '|'||MSI.SEGMENT4  = 'FG|500W|20MM|000006'
 
 SELECT ORGANIZATION_ID , ORGANIZATION_NAME  FROM ORG_ORGANIZATION_DEFINITIONS
 
 --===========================================
 --PROCURE TO PAY DATA READY FOR KBIL . HERE Pament done data will not come as : and ACA.DOC_SEQUENCE_VALUE IS NULL
 --DATE: 12-MAY-2021
 --===========================================
 
 SELECT 
distinct aia.org_id,
SUBSTR(XX_GET_HR_OPERATING_UNIT (AIA.ORG_ID),5) OPERATING_UNIT,
XX_INV_PKG.XXGET_ORG_LOCATION (AIA.ORG_ID) ORG_ADDRESS,
RT.ORGANIZATION_ID INV_ORG,
TO_CHAR(TRUNC(RT.TRANSACTION_DATE),'DD-MON-RRRR') TRANSACTION_DATE,
INVORG_NAME_FROM_ID (RT.ORGANIZATION_ID) INV_ORG_NAME,
 APS.VENDOR_NAME,
 APS.SEGMENT1 VENDOR_NO,
 POH.SEGMENT1 PO_NUMBER,
 TO_CHAR(TRUNC(POH.APPROVED_DATE),'DD-MON-RRRR') PO_APPROVED_DATE,
   (
 SELECT DESCRIPTION
 FROM MTL_SYSTEM_ITEMS_B
 WHERE INVENTORY_ITEM_ID = POL.ITEM_ID
 AND ORGANIZATION_ID = PLL.SHIP_TO_ORGANIZATION_ID
 ) ITEM_DESCRIPTION,
    (
 SELECT SEGMENT1||'|'||SEGMENT2||'|'|| SEGMENT3||'|'|| SEGMENT4
 FROM MTL_SYSTEM_ITEMS_B
 WHERE INVENTORY_ITEM_ID = POL.ITEM_ID
 AND ORGANIZATION_ID = PLL.SHIP_TO_ORGANIZATION_ID
 ) ITEM_CODE,
 -- XXGET_ITEM_CODE(ITEM_ID) ITEM_CODE,
  POL.QUANTITY* POL.UNIT_PRICE PO_AMOUNT,
--  (
--  SELECT SUM ( (PLA.UNIT_PRICE * PLA.QUANTITY)) PRICE
--   FROM PO_LINES_ALL PLA, PO_HEADERS_ALL PHA
--   WHERE PLA.PO_HEADER_ID = PHA.PO_HEADER_ID
--   AND PHA.ORG_ID = AIA.ORG_ID
--   AND PHA.SEGMENT1 =POH.SEGMENT1
--         ) PO_AMOUNT,
 RSH.RECEIPT_NUM GRN_NUMBER, 
 TO_CHAR(TRUNC(RT.CREATION_DATE ),'DD-MON-RRRR') GRN_DATE,
--RL.QUANTITY_RECEIVED,
--RT.QUANTITY QUANTITY_DELIVERED,
 AIA.INVOICE_NUM,
  TO_CHAR(TRUNC(AIA.INVOICE_DATE),'DD-MON-RRRR') INVOICE_DATE,
  TO_CHAR(TRUNC( AIA.GL_DATE),'DD-MON-RRRR') GL_DATE ,
AIA.INVOICE_AMOUNT, 
 AIA.DOC_SEQUENCE_VALUE INV_VOUCHER_NO,
 XX_GET_EMP_NAME_FROM_USER_ID (AIA.CREATED_BY) INV_CREATED_BY,
 ( SELECT CONCATENATED_SEGMENTS
 FROM GL_CODE_COMBINATIONS_KFV
 WHERE CODE_COMBINATION_ID = AIDA.DIST_CODE_COMBINATION_ID
 ) DIST_GL_CODE,
ACA.DOC_SEQUENCE_VALUE PAYMENT_VOUCHER,
ACA.CREATION_DATE PAY_CREATE_DATE
,ACA.DOC_CATEGORY_CODE PAYMENT_TYPE
,ACA.STATUS_LOOKUP_CODE PAYMENT_STATUS
,ACA.AMOUNT PAY_AMOUNT
,XX_ONT_GET_ENAME(:P_USER) PRINTED_BY 
FROM AP_INVOICES_ALL AIA,
 AP_INVOICE_LINES_ALL AILA,
 AP_SUPPLIERS APS,
 AP_SUPPLIER_SITES_ALL APSS,
 AP_INVOICE_DISTRIBUTIONS_ALL AIDA,
 PO_HEADERS_ALL POH,
 PO_LINES_ALL POL,
 PO_LINE_LOCATIONS_ALL PLL,
 PO_DISTRIBUTIONS_ALL PDA,
 RCV_SHIPMENT_HEADERS RSH,
 RCV_SHIPMENT_LINES RL,
  RCV_TRANSACTIONS RT,
AP_INVOICE_PAYMENTS_ALL AIPA, 
AP_CHECKS_ALL ACA
WHERE AIA.INVOICE_ID = AILA.INVOICE_ID
AND AILA.ORG_ID = AIA.ORG_ID
AND AILA.PO_HEADER_ID = POH.PO_HEADER_ID
AND AILA.PO_LINE_ID = POL.PO_LINE_ID
AND AILA.INVOICE_ID =AIDA.INVOICE_ID
AND AIA.VENDOR_ID = APS.VENDOR_ID
AND AIA.VENDOR_SITE_ID = APSS.VENDOR_SITE_ID
AND AIA.VENDOR_ID = APSS.VENDOR_ID
AND APSS.ORG_ID = AIA.ORG_ID
AND AIDA.INVOICE_LINE_NUMBER = AILA.LINE_NUMBER
AND AIDA.ORG_ID= AILA.ORG_ID
AND POH.PO_HEADER_ID = POL.PO_HEADER_ID
AND PLL.PO_HEADER_ID = POH.PO_HEADER_ID
AND PLL.PO_LINE_ID = POL.PO_LINE_ID
AND PLL.LINE_LOCATION_ID = PDA.LINE_LOCATION_ID
AND PLL.PO_HEADER_ID = PDA.PO_HEADER_ID
AND PLL.PO_LINE_ID = PDA.PO_LINE_ID
AND POL.ORG_ID = PDA.ORG_ID
AND POH.ORG_ID = PLL.ORG_ID
AND AILA.RCV_TRANSACTION_ID = RT.TRANSACTION_ID
AND RT.SHIPMENT_HEADER_ID = RSH.SHIPMENT_HEADER_ID
AND RSH.SHIPMENT_HEADER_ID =RL.SHIPMENT_HEADER_ID 
AND RL.SHIPMENT_LINE_ID= RT.SHIPMENT_LINE_ID
AND AIA.INVOICE_ID=AIPA.INVOICE_ID(+)
AND AIPA.CHECK_ID=ACA.CHECK_ID(+)
AND PDA.GL_CANCELLED_DATE is NULL
and ACA.DOC_SEQUENCE_VALUE IS NULL
AND (:P_ORG_ID IS NULL OR AIA.ORG_ID = :P_ORG_ID) --AP org id
--AND (:P_VENDOR_NO IS NULL OR aps.segment1 = :P_VENDOR_NO) --aps.segment1 for supplier/vendor name
AND (:P_GRN_FROM_DT IS NULL OR TRUNC(RT.TRANSACTION_DATE) BETWEEN :P_GRN_FROM_DT AND :P_GRN_TO_DT) 
AND (:P_PO_NO IS NULL OR poh.segment1 = :P_PO_NO) 
AND (:P_GRN_NO IS NULL OR rsh.receipt_num = :P_GRN_NO)
and RT.ORGANIZATION_ID = NVL(:P_INV_ORG, RT.ORGANIZATION_ID ) 
 and AIA.VENDOR_ID = NVL(:P_VENDOR_ID, AIA.VENDOR_ID)
union all
SELECT 
distinct PHA.org_id,
SUBSTR(XX_GET_HR_OPERATING_UNIT (PHA.ORG_ID),5) OPERATING_UNIT,
XX_INV_PKG.XXGET_ORG_LOCATION (PHA.ORG_ID) ORG_ADDRESS,
RT.ORGANIZATION_ID INV_ORG,
TO_CHAR(TRUNC(RT.TRANSACTION_DATE),'DD-MON-RRRR') TRANSACTION_DATE,
INVORG_NAME_FROM_ID (RT.ORGANIZATION_ID) INV_ORG_NAME,
       ASP.VENDOR_NAME,
       ASP.SEGMENT1 VENDOR_NO,
      PHA.SEGMENT1 PO_NUMBER,
 TO_CHAR(TRUNC(PHA.APPROVED_DATE),'DD-MON-RRRR') PO_APPROVED_DATE,
           PLA.ITEM_DESCRIPTION,
            XXGET_ITEM_CODE(PLA.ITEM_ID) ITEM_CODE,
     (PLA.UNIT_PRICE* PLA.QUANTITY) PO_AMOUNT,
          RH.RECEIPT_NUM GRN_NUMBER, 
           TO_CHAR(TRUNC(RT.CREATION_DATE ),'DD-MON-RRRR') GRN_DATE,
--          RL.QUANTITY_RECEIVED,
--         RT.QUANTITY QUANTITY_DELIVERED,
            NULL INVOICE_NUM,
            NULL INVOICE_DATE,
            NULL GL_DATE,
            NULL INVOICE_AMOUNT,
            NULL INV_VOUCHER_NO,
            NULL INV_CREATED_BY,
          NULL DIST_GL_CODE,
          NULL PAYMENT_VOUCHER,
          NULL PAY_CREATE_DATE,
          NULL PAYMENT_TYPE,
          NULL PAYMENT_STATUS,
          NULL PAY_AMOUNT,
         XX_ONT_GET_ENAME(:P_USER) PRINTED_BY 
 from PO_HEADERS_ALL PHA, PO_LINES_ALL PLA, PO_LINE_LOCATIONS_ALL PLL,PO_DISTRIBUTIONS_ALL PDA, AP_SUPPLIERS ASP,
 RCV_TRANSACTIONS RT,RCV_SHIPMENT_LINES RL, RCV_SHIPMENT_HEADERS RH
 WHERE PHA.PO_HEADER_ID =PLA.PO_HEADER_ID
 and PHA.po_header_id = PLA.po_header_id
 and PLA.po_line_id= pll.po_line_id
 and PHA.po_header_id= pll.po_header_id
 and PHA.PO_HEADER_ID= PLA.PO_HEADER_ID
 AND PLA.PO_LINE_ID= PDA.PO_LINE_ID
 AND PLA.QUANTITY <> 0
 AND PHA.PO_HEADER_ID= RT.PO_HEADER_ID
 AND PLA.PO_LINE_ID= RT.PO_LINE_ID
 AND PDA.GL_CANCELLED_DATE is NULL
 AND RT.TRANSACTION_TYPE= 'DELIVER'
    AND PDA.PO_DISTRIBUTION_ID NOT IN
      (SELECT PO_DISTRIBUTION_ID FROM PO_DISTRIBUTIONS_ALL PDA
       WHERE PO_DISTRIBUTION_ID IN (SELECT DISTINCT  PO_DISTRIBUTION_ID FROM AP_INVOICE_DISTRIBUTIONS_ALL))
 AND RH.SHIPMENT_HEADER_ID= RT.SHIPMENT_HEADER_ID
 AND RH.SHIPMENT_HEADER_ID= RL.SHIPMENT_HEADER_ID
 AND RL.SHIPMENT_LINE_ID= RT.SHIPMENT_LINE_ID
 AND ASP.VENDOR_ID= PHA.VENDOR_ID
   AND (:P_ORG_ID IS NULL OR PHA.ORG_ID = :P_ORG_ID)
  AND (:P_GRN_FROM_DT IS NULL OR TRUNC(RT.TRANSACTION_DATE) BETWEEN :P_GRN_FROM_DT AND :P_GRN_TO_DT) 
  AND (:P_PO_NO IS NULL OR PHA.segment1 = :P_PO_NO) 
  AND (:P_GRN_NO IS NULL OR rh.receipt_num = :P_GRN_NO) 
  and RT.ORGANIZATION_ID = NVL(:P_INV_ORG, RT.ORGANIZATION_ID ) 
   and PHA.VENDOR_ID = NVL(:P_VENDOR_ID, PHA.VENDOR_ID)
  
  

 
 
 
 
 
--===============================
-- EBS Item Stock ( For Reconciliation)  DATE : 8-APR-2021
--===============================

                         SELECT LEGAL_ENTITY_ID,BAL_SEG_NAME,OPERATING_UNIT,OU,ORGANIZATION_ID,ORGANIZATION_CODE, FIN_CAT, INVENTORY_TYPE, ITEM_GROUP, ITEM_SUB_GROUP,INVENTORY_ITEM_ID,ITEM_CODE,ITEM_DESCRIPTION,UOM1,
                        -- TRANSACTION_TYPE_NAME,
                         --TRANSACTION_QUANTITY,
                        -- NVL(GET_ONHAND_QTY_FROM_ITEM(:P_DATE_FROM,  ORGANIZATION_ID, INVENTORY_ITEM_ID),0) OPEN_QTY, 
                         XX_INV_PKG.XX_INV_OPEN_QTY(ORGANIZATION_ID,NULL, INVENTORY_ITEM_ID,:P_DATE_FROM) OPENING_STOCK,
                        NVL(SUM(Move_Order_Issue), 0) Move_Order_Issue,
                         NVL(SUM(Opening_Stock_Receipts), 0) Opening_Stock_Receipts,
                         NVL(SUM(PO_Receipt), 0) PO_Receipt,
                         NVL(SUM(Miscellaneous_receipt), 0) Miscellaneous_receipt,
                         NVL(SUM(Subinventory_Transfer), 0) Subinventory_Transfer,
                         NVL(SUM(Move_Order_Issue_of_FL), 0) Move_Order_Issue_of_FL,
                         NVL(SUM(Move_Order_Issue_HO_Veh), 0) Move_Order_Issue_HO_Veh,
                         NVL(SUM(Intransit_Receipt), 0) Intransit_Receipt,
                         NVL(SUM(Intransit_Shipment), 0) Intransit_Shipment,
                         NVL(SUM(Int_Req_Intr_Rcpt), 0) Int_Req_Intr_Rcpt,
                         NVL(SUM(Return_to_Vendor), 0) Return_to_Vendor,
                         NVL(SUM(Int_Order_Intr_Ship), 0) Int_Order_Intr_Ship,
                          NVL(SUM(WIP_Issue), 0) WIP_Issue,
                         NVL(SUM(Opening_Stock_Correction), 0) Opening_Stock_Correction,
                         NVL(SUM(Sales_order_issue),0) Sales_order_issue,
                         NVL(SUM(Sales_Order_Pick),0) Sales_Order_Pick,
                         NVL(SUM(Miscellaneous_issue), 0) Miscellaneous_issue,
                         NVL(SUM(Residual_Qty_Receipt), 0) Residual_Qty_Receipt,
                         NVL(SUM(Residual_Qty_Issue), 0) Residual_Qty_Issue,
                         NVL(SUM(WIP_Completion), 0) WIP_Completion,
                         NVL(SUM(WIP_Completion_Return), 0) WIP_Completion_Return,
                        -- NVL(SUM(COGS_Recognition), 0) COGS_Recognition,
                         NVL(SUM(RMA_Receipt), 0) RMA_Receipt,
                         NVL(SUM(Move_Order_Issue_from_HO_Store), 0) Move_Order_Issue_from_HO_Store,
                         NVL(SUM(Move_Order_Issue_To_Project), 0) Move_Order_Issue_To_Project,
                         NVL(SUM(Move_Order_Issue_from_HO_Brand), 0) Move_Order_Issue_from_HO_Brand,
                         NVL(SUM(Move_Order_Transfer), 0) Move_Order_Transfer,
                         --NVL(SUM(Move_Order_Issue), 0) Move_Order_Issue,
                         NVL(SUM(Material_Issue_to_Employee), 0) Material_Issue_to_Employee,
                         NVL(SUM(Move_Order_FG_Issue), 0) Move_Order_FG_Issue,
                         NVL(SUM(Stock_Adjust_for_Audit_rcpt), 0) Stock_Adjust_for_Audit_rcpt,
                         NVL(SUM(Stock_Adjust_for_Audit_Issue), 0) Stock_Adjust_for_Audit_Issue,
                         NVL(SUM(WIP_Return), 0) WIP_Return,
                         NVL(SUM(WIP_Byproduct_Return), 0) WIP_Byproduct_Return,
                         NVL(SUM(Gain_In_Transit), 0) Gain_In_Transit,
                         NVL(SUM(WIP_Byproduct_Completion), 0) WIP_Byproduct_Completion,
                         NVL(SUM(PO_Rcpt_Adjust), 0) PO_Rcpt_Adjust,
                         NVL(SUM(Internal_Order_Xfer), 0) Internal_Order_Xfer,
                         NVL(SUM(Int_Req_Sub_Xfer), 0) Int_Req_Sub_Xfer,
                         ------ CLOSING PART
                         (  XX_INV_PKG.XX_INV_OPEN_QTY(ORGANIZATION_ID,NULL, INVENTORY_ITEM_ID,:P_DATE_FROM) + 
                        NVL(SUM(Move_Order_Issue), 0) +
                         NVL(SUM(Opening_Stock_Receipts), 0) +
                         NVL(SUM(PO_Receipt), 0) +
                         NVL(SUM(Miscellaneous_receipt), 0) +
                         NVL(SUM(Subinventory_Transfer), 0) +
                         NVL(SUM(Move_Order_Issue_of_FL), 0) +
                         NVL(SUM(Move_Order_Issue_HO_Veh), 0) +
                         NVL(SUM(Intransit_Receipt), 0) +
                         NVL(SUM(Intransit_Shipment), 0) +
                         NVL(SUM(Int_Req_Intr_Rcpt), 0) +
                         NVL(SUM(Return_to_Vendor), 0) +
                         NVL(SUM(Int_Order_Intr_Ship), 0) +
                          NVL(SUM(WIP_Issue), 0) +
                         NVL(SUM(Opening_Stock_Correction), 0) +
                          NVL(SUM(Sales_order_issue),0) +
                          NVL(SUM(Sales_Order_Pick),0)+
                         NVL(SUM(Miscellaneous_issue), 0) +
                         NVL(SUM(Residual_Qty_Receipt), 0) +
                         NVL(SUM(Residual_Qty_Issue), 0) +
                         NVL(SUM(WIP_Completion), 0) +
                         NVL(SUM(WIP_Completion_Return), 0) +
                        -- NVL(SUM(COGS_Recognition), 0) +
                         NVL(SUM(RMA_Receipt), 0) +
                         NVL(SUM(Move_Order_Issue_from_HO_Store), 0) +
                         NVL(SUM(Move_Order_Issue_To_Project), 0) +
                         NVL(SUM(Move_Order_Issue_from_HO_Brand), 0) +
                         NVL(SUM(Move_Order_Transfer), 0) +
                         --NVL(SUM(Move_Order_Issue), 0) Move_Order_Issue,
                         NVL(SUM(Material_Issue_to_Employee), 0) +
                         NVL(SUM(Move_Order_FG_Issue), 0) +
                         NVL(SUM(Stock_Adjust_for_Audit_rcpt), 0) +
                         NVL(SUM(Stock_Adjust_for_Audit_Issue), 0) +
                         NVL(SUM(WIP_Return), 0) +
                         NVL(SUM(WIP_Byproduct_Return), 0) +
                         NVL(SUM(Gain_In_Transit), 0) +
                         NVL(SUM(WIP_Byproduct_Completion), 0) +
                         NVL(SUM(PO_Rcpt_Adjust), 0) +
                         NVL(SUM(Internal_Order_Xfer), 0) +
                         NVL(SUM(Int_Req_Sub_Xfer), 0)  
                         )
                           CLOSING_QTY    ,
                           :P_DATE_FROM , :P_DATE_TO              
                        FROM (
                        SELECT B.LEGAL_ENTITY LEGAL_ENTITY_ID, E.BAL_SEG_NAME, b.OPERATING_UNIT,APPS.XX_GET_OU_NAME ( B.ORGANIZATION_ID) OU,
                         B.ORGANIZATION_ID ORGANIZATION_ID, B.ORGANIZATION_CODE ORGANIZATION_CODE ,
                        D.FIN_CAT ,D.INVENTORY_TYPE , D.ITEM_GROUP , D.ITEM_SUB_GROUP,
                        -- A.TRANSACTION_ID, 
                         A.INVENTORY_ITEM_ID, d.ITEM_CODE, d.ITEM_DESCRIPTION , d.UOM1,
                         --C.TRANSACTION_TYPE_NAME,
                            (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Move Order Issue'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Move_Order_Issue,
                             (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Opening Stock Receipts'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Opening_Stock_Receipts,
                              (CASE WHEN  C.TRANSACTION_TYPE_NAME ='PO Receipt'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) PO_Receipt,
                               (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Miscellaneous receipt'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Miscellaneous_receipt,
                                (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Subinventory Transfer'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Subinventory_Transfer,
                                 (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Move Order Issue of FL'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Move_Order_Issue_of_FL,
                                 (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Move Order Issue from HO Vehicle Repair'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Move_Order_Issue_HO_Veh,
                                  (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Intransit Receipt'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Intransit_Receipt,
                                   (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Intransit Shipment'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Intransit_Shipment,
                                    (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Int Req Intr Rcpt'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Int_Req_Intr_Rcpt,
                                     (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Return to Vendor'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Return_to_Vendor,
                                      (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Int Order Intr Ship'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Int_Order_Intr_Ship,
                                        (CASE WHEN  C.TRANSACTION_TYPE_NAME ='WIP Issue'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) WIP_Issue,
                                       (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Opening Stock Correction'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Opening_Stock_Correction,
                                         (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Sales order issue'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Sales_order_issue,
                                           (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Sales Order Pick'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Sales_Order_Pick,
                                          (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Miscellaneous issue'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Miscellaneous_issue,
                                           (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Residual Qty Receipt'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Residual_Qty_Receipt,
                                           (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Residual Qty Issue'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Residual_Qty_Issue,
                                            (CASE WHEN  C.TRANSACTION_TYPE_NAME ='WIP Completion'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) WIP_Completion,
                                             (CASE WHEN  C.TRANSACTION_TYPE_NAME ='WIP Completion Return'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) WIP_Completion_Return,
                                             -- (CASE WHEN  C.TRANSACTION_TYPE_NAME ='COGS Recognition'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) COGS_Recognition,
                                               (CASE WHEN  C.TRANSACTION_TYPE_NAME ='RMA Receipt'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) RMA_Receipt,                                                
                                                 (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Move Order Issue from HO Store Stationary'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Move_Order_Issue_from_HO_Store,
                                                  (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Move Order Issue To Project'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Move_Order_Issue_To_Project,
                                                   (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Move Order Issue from HO Store Branding'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Move_Order_Issue_from_HO_Brand,
                                                    (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Move Order Transfer'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Move_Order_Transfer,
                                                     (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Returnable Item Issue'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Returnable_Item_Issue,
                                                      (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Material Issue to Employee'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Material_Issue_to_Employee,
                                                       (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Move Order FG Issue'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Move_Order_FG_Issue,
                                                        (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Stock Adjustment for Audit Receipt'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Stock_Adjust_for_Audit_rcpt,
                                                         (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Stock Adjustment for Audit Issue'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Stock_Adjust_for_Audit_Issue,
                                                          (CASE WHEN  C.TRANSACTION_TYPE_NAME ='WIP Return'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) WIP_Return,
                                                            (CASE WHEN  C.TRANSACTION_TYPE_NAME ='WIP Byproduct Return'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) WIP_Byproduct_Return,
                                                             (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Gain In Transit'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Gain_In_Transit,
                                                              (CASE WHEN  C.TRANSACTION_TYPE_NAME ='WIP Byproduct Completion'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) WIP_Byproduct_Completion,
                                                               (CASE WHEN  C.TRANSACTION_TYPE_NAME ='PO Rcpt Adjust'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) PO_Rcpt_Adjust,
                                                                (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Internal Order Xfer'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Internal_Order_Xfer,
                                                                 (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Int Req Sub Xfer'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Int_Req_Sub_Xfer                       
                          FROM ORG_ORGANIZATION_DEFINITIONS B, MTL_MATERIAL_TRANSACTIONS  A, MTL_TRANSACTION_TYPES C, WBI_XXKBGITEM_MT_DMN D , XX_BAL_SEG_INFO E --, hr_operating_units F
                        WHERE A.ORGANIZATION_ID= B.ORGANIZATION_ID
                        AND A.TRANSACTION_TYPE_ID= C.TRANSACTION_TYPE_ID
                        and A.ORGANIZATION_ID = D.ORGANIZATION_ID
                        and A.INVENTORY_ITEM_ID = D.INVENTORY_ITEM_ID
                        and TRANSACTION_TYPE_NAME NOT LIKE '%Pick%'
                        and e.LEGAL_ENTITY_ID = b.LEGAL_ENTITY
                        and B.LEGAL_ENTITY =  NVL(:P_LEGAL_ENTITY, B.LEGAL_ENTITY) 
                        and b.OPERATING_UNIT = NVL(:P_OU_ID, b.OPERATING_UNIT)
                        and  B.ORGANIZATION_ID = NVL(:P_INV_ORG_ID, B.ORGANIZATION_ID)
                        and D.INVENTORY_TYPE  =  NVL(:P_ITEM_TYPE, D.INVENTORY_TYPE)
                        and D.ITEM_GROUP  = NVL(:P_ITEM_GROUP, D.ITEM_GROUP )
                        and D.ITEM_SUB_GROUP = NVL(:P_ITEM_SUB_GROUP, D.ITEM_SUB_GROUP)
                        AND d.ITEM_CODE = NVL(:P_ITEM_CODE, d.ITEM_CODE)
                        and D.FIN_CAT  = NVL(:P_FINANCE_CATEGORY, D.FIN_CAT)
                        AND  TRUNC(TRANSACTION_DATE)  BETWEEN  TO_DATE(:P_DATE_FROM) AND  TO_DATE(:P_DATE_TO)  
                        --:p_from_date 2/1/2021 :p_to_date 2/1/2021 i:p_tem_code 'SF|BILT|500|000011'  
                     --  and  d.ITEM_CODE ='SF|BILT|500|000011'  
                        GROUP BY 
                        B.LEGAL_ENTITY , E.BAL_SEG_NAME, b.OPERATING_UNIT,APPS.XX_GET_OU_NAME ( B.ORGANIZATION_ID),
                         B.ORGANIZATION_ID , B.ORGANIZATION_CODE  ,
                        D.FIN_CAT ,D.INVENTORY_TYPE,D.ITEM_TYPE , D.ITEM_GROUP , D.ITEM_SUB_GROUP,
                        -- A.TRANSACTION_ID, 
                         A.INVENTORY_ITEM_ID, d.ITEM_CODE, d.ITEM_DESCRIPTION , d.UOM1,
                          C.TRANSACTION_TYPE_NAME    
                          )
                          WHERE 1=1 
                          GROUP BY   LEGAL_ENTITY_ID,BAL_SEG_NAME,OPERATING_UNIT,OU,ORGANIZATION_ID, ORGANIZATION_CODE,FIN_CAT, INVENTORY_TYPE, ITEM_GROUP, ITEM_SUB_GROUP,INVENTORY_ITEM_ID,ITEM_CODE,ITEM_DESCRIPTION,UOM1
                          --TRANSACTION_TYPE_NAME
 
  

 
  --================================
-- XXKSRM ITEM Transaction Report V2 TESTING 
--===============================

                        SELECT LEGAL_ENTITY_ID,BAL_SEG_NAME,OPERATING_UNIT,OU,ORGANIZATION_ID, FIN_CAT, INVENTORY_TYPE, ITEM_GROUP, ITEM_SUB_GROUP,INVENTORY_ITEM_ID,ITEM_CODE,ITEM_DESCRIPTION,UOM1,
                         NVL(GET_ONHAND_QTY_FROM_ITEM(:P_DATE_FROM,  ORGANIZATION_ID, INVENTORY_ITEM_ID),0) OPEN_QTY, 
                        -- TRANSACTION_TYPE_NAME,
                         --TRANSACTION_QUANTITY,
                        SUM(INT_REQ_INT_RECPT) INT_REQ_INT_RECPT,
                        SUM(WIP_ISSUE) WIP_ISSUE,
                        NVL(SUM(Move_Order_Issue), 0) Move_Order_Issue
                        FROM (
                        SELECT B.LEGAL_ENTITY LEGAL_ENTITY_ID, E.BAL_SEG_NAME, b.OPERATING_UNIT,APPS.XX_GET_OU_NAME ( B.ORGANIZATION_ID) OU,
                         B.ORGANIZATION_ID ORGANIZATION_ID, B.ORGANIZATION_CODE ORGANIZATION_CODE ,
                        D.FIN_CAT ,D.INVENTORY_TYPE , D.ITEM_GROUP , D.ITEM_SUB_GROUP,
                        -- A.TRANSACTION_ID, 
                         A.INVENTORY_ITEM_ID, d.ITEM_CODE, d.ITEM_DESCRIPTION , d.UOM1,
                         --C.TRANSACTION_TYPE_NAME,
                         (CASE WHEN  C.TRANSACTION_TYPE_NAME = 'Int Req Intr Rcpt'  THEN   NVL(SUM(A.TRANSACTION_QUANTITY),0) END  ) INT_REQ_INT_RECPT,
                          (CASE WHEN  C.TRANSACTION_TYPE_NAME ='WIP Issue'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) WIP_ISSUE,
                            (CASE WHEN  C.TRANSACTION_TYPE_NAME ='Move Order Issue'  THEN    NVL(SUM(A.TRANSACTION_QUANTITY),0) END ) Move_Order_Issue
                          --NVL(SUM(A.TRANSACTION_QUANTITY),0) TRANSACTION_QUANTITY,
                         --  (CASE WHEN  C.TRANSACTION_TYPE_NAME  = 'Int Req Intr Rcpt'  THEN   SUM((CASE WHEN A.TRANSACTION_QUANTITY > 0 THEN A.TRANSACTION_QUANTITY END )) ELSE 0 END) INT_REQ_INT_RECPT,
                         --   (CASE WHEN  C.TRANSACTION_TYPE_NAME  = 'WIP Issue'  THEN    SUM((CASE WHEN A.TRANSACTION_QUANTITY < 0 THEN A.TRANSACTION_QUANTITY END )) ELSE 0 END) WIP_ISSUE
                          FROM ORG_ORGANIZATION_DEFINITIONS B, MTL_MATERIAL_TRANSACTIONS  A, MTL_TRANSACTION_TYPES C, WBI_XXKBGITEM_MT_DMN D , XX_BAL_SEG_INFO E --, hr_operating_units F
                        WHERE A.ORGANIZATION_ID= B.ORGANIZATION_ID
                        AND A.TRANSACTION_TYPE_ID= C.TRANSACTION_TYPE_ID
                        and A.ORGANIZATION_ID = D.ORGANIZATION_ID
                        and A.INVENTORY_ITEM_ID = D.INVENTORY_ITEM_ID
                        and TRANSACTION_TYPE_NAME NOT LIKE '%Pick%'
                        and e.LEGAL_ENTITY_ID = b.LEGAL_ENTITY
                        and B.LEGAL_ENTITY =  NVL(:P_LEGAL_ENTITY, B.LEGAL_ENTITY) 
                        and b.OPERATING_UNIT = NVL(:P_OU_ID, b.OPERATING_UNIT)
                        and  B.ORGANIZATION_ID = NVL(:P_INV_ORG_ID, B.ORGANIZATION_ID)
                        and D.ITEM_TYPE  =  NVL(:P_ITEM_TYPE, D.ITEM_TYPE)
                        and D.ITEM_GROUP  = NVL(:P_ITEM_GROUP, D.ITEM_GROUP )
                        and D.ITEM_SUB_GROUP = NVL(:P_ITEM_SUB_GROUP, D.ITEM_SUB_GROUP)
                        AND d.ITEM_CODE = NVL(:P_ITEM_CODE, d.ITEM_CODE)
                        and D.FINANCE_CATEGORY  = NVL(:P_FINANCE_CATEGORY, D.FINANCE_CATEGORY)
                        AND  TRUNC(TRANSACTION_DATE)  BETWEEN  TO_DATE(:P_DATE_FROM) AND  TO_DATE(:P_DATE_TO) 
                       -- and  d.ITEM_CODE ='SF|BILT|500|000011'  
                        GROUP BY 
                        B.LEGAL_ENTITY , E.BAL_SEG_NAME, b.OPERATING_UNIT,APPS.XX_GET_OU_NAME ( B.ORGANIZATION_ID),
                         B.ORGANIZATION_ID , B.ORGANIZATION_CODE  ,
                        D.FIN_CAT ,D.INVENTORY_TYPE,D.ITEM_TYPE , D.ITEM_GROUP , D.ITEM_SUB_GROUP,
                        -- A.TRANSACTION_ID, 
                         A.INVENTORY_ITEM_ID, d.ITEM_CODE, d.ITEM_DESCRIPTION , d.UOM1,
                          C.TRANSACTION_TYPE_NAME    
                          )
                          WHERE 1=1 
                          GROUP BY   LEGAL_ENTITY_ID,BAL_SEG_NAME,OPERATING_UNIT,OU,ORGANIZATION_ID, FIN_CAT, INVENTORY_TYPE, ITEM_GROUP, ITEM_SUB_GROUP,INVENTORY_ITEM_ID,ITEM_CODE,ITEM_DESCRIPTION,UOM1
                          --TRANSACTION_TYPE_NAME
 
 --================================
-- XXKSRM ITEM Transaction Report V2
--===============================


SELECT  LEGAL_ENTITY_ID, BAL_SEG_NAME,OPERATING_UNIT,OU,ORGANIZATION_ID,ORGANIZATION_CODE,FIN_CAT,INVENTORY_TYPE,ITEM_TYPE,ITEM_GROUP,ITEM_SUB_GROUP,
INVENTORY_ITEM_ID,
ITEM_CODE,ITEM_DESCRIPTION,TRANSACTION_TYPE_NAME,
 NVL(GET_ONHAND_QTY_FROM_ITEM(:P_DATE_FROM,  ORGANIZATION_ID, INVENTORY_ITEM_ID),0) OPEN_QTY, 
NVL(SUM(RECEIVE_QTY),0) RECEIVE_QTY, 
ABS(NVL(SUM(ISSUE_QTY),0)) ISSUE_QTY ,
 NVL(GET_ONHAND_QTY_FROM_ITEM(:P_DATE_FROM,  ORGANIZATION_ID, INVENTORY_ITEM_ID),0) +  NVL(SUM(RECEIVE_QTY),0) - ABS(NVL(SUM(ISSUE_QTY),0)) CLOSING,
 :P_DATE_FROM, :P_DATE_TO
FROM (
SELECT B.LEGAL_ENTITY LEGAL_ENTITY_ID, E.BAL_SEG_NAME, b.OPERATING_UNIT,APPS.XX_GET_OU_NAME ( B.ORGANIZATION_ID) OU,
 B.ORGANIZATION_ID ORGANIZATION_ID, B.ORGANIZATION_CODE ORGANIZATION_CODE ,
D.FIN_CAT ,D.INVENTORY_TYPE,D.ITEM_TYPE , D.ITEM_GROUP , D.ITEM_SUB_GROUP,
 A.TRANSACTION_ID, 
 A.INVENTORY_ITEM_ID, d.ITEM_CODE, d.ITEM_DESCRIPTION , d.UOM1,
  C.TRANSACTION_TYPE_NAME TRANSACTION_TYPE_NAME ,
--(CASE WHEN TRANSACTION_TYPE_NAME = 'WIP Issue' THEN (CASE WHEN A.TRANSACTION_QUANTITY < 0 THEN A.TRANSACTION_QUANTITY END ) ELSE  (CASE WHEN A.TRANSACTION_QUANTITY > 0 THEN A.TRANSACTION_QUANTITY END )END ) TRANSACTION_TYPE_NAME,
  -- A.TRANSACTION_QUANTITY TRANSACTION_QUANTITY,
   (CASE WHEN A.TRANSACTION_QUANTITY > 0 THEN A.TRANSACTION_QUANTITY END ) RECEIVE_QTY,
     (CASE WHEN A.TRANSACTION_QUANTITY < 0 THEN A.TRANSACTION_QUANTITY END ) ISSUE_QTY
 --    (GET_ONHAND_QTY_FROM_ITEM(SYSDATE,  b.ORGANIZATION_ID, a.INVENTORY_ITEM_ID) + (CASE WHEN A.TRANSACTION_QUANTITY > 0 THEN A.TRANSACTION_QUANTITY END ))   CLOSE
  FROM ORG_ORGANIZATION_DEFINITIONS B, MTL_MATERIAL_TRANSACTIONS  A, MTL_TRANSACTION_TYPES C, WBI_XXKBGITEM_MT_DMN D , XX_BAL_SEG_INFO E --, hr_operating_units F
WHERE A.ORGANIZATION_ID= B.ORGANIZATION_ID
AND A.TRANSACTION_TYPE_ID= C.TRANSACTION_TYPE_ID
and A.ORGANIZATION_ID = D.ORGANIZATION_ID
and A.INVENTORY_ITEM_ID = D.INVENTORY_ITEM_ID
--AND  A.INVENTORY_ITEM_ID= 9 -- 180  -- DIESEL
and TRANSACTION_TYPE_NAME NOT LIKE '%Pick%'
and e.LEGAL_ENTITY_ID = b.LEGAL_ENTITY
--AND e.LEGAL_ENTITY_ID = f.DEFAULT_LEGAL_CONTEXT_ID
--and  TRANSACTION_QUANTITY <>0'
and B.LEGAL_ENTITY =  NVL(:P_LEGAL_ENTITY, B.LEGAL_ENTITY) 
and b.OPERATING_UNIT = NVL(:P_OU_ID, b.OPERATING_UNIT)
and  B.ORGANIZATION_ID = NVL(:P_INV_ORG_ID, B.ORGANIZATION_ID)
and D.ITEM_TYPE  =  NVL(:P_ITEM_TYPE, D.ITEM_TYPE)
and D.ITEM_GROUP  = NVL(:P_ITEM_GROUP, D.ITEM_GROUP )
and D.ITEM_SUB_GROUP = NVL(:P_ITEM_SUB_GROUP, D.ITEM_SUB_GROUP)
AND d.ITEM_CODE = NVL(:P_ITEM_CODE, d.ITEM_CODE)
and D.FINANCE_CATEGORY  = NVL(:P_FINANCE_CATEGORY, D.FINANCE_CATEGORY)
AND  TRUNC(TRANSACTION_DATE)  BETWEEN  TO_DATE(:P_DATE_FROM) AND  TO_DATE(:P_DATE_TO) 
and  d.ITEM_CODE ='SF|BILT|500|000011'  
--and TRANSACTION_ID IN(9553930,9528083)
)
GROUP BY LEGAL_ENTITY_ID, BAL_SEG_NAME,OPERATING_UNIT,OU,ORGANIZATION_ID,ORGANIZATION_CODE,FIN_CAT,INVENTORY_TYPE,ITEM_TYPE,ITEM_GROUP,ITEM_SUB_GROUP,INVENTORY_ITEM_ID,
ITEM_CODE,ITEM_DESCRIPTION,TRANSACTION_TYPE_NAME

--================================
-- XXKSRM ITEM Transaction Report V1
--===============================

SELECT  LEGAL_ENTITY_ID, BAL_SEG_NAME,OPERATING_UNIT,OU,ORGANIZATION_ID,ORGANIZATION_CODE,FIN_CAT,INVENTORY_TYPE,ITEM_TYPE,ITEM_GROUP,ITEM_SUB_GROUP,
INVENTORY_ITEM_ID,
ITEM_CODE,ITEM_DESCRIPTION,TRANSACTION_TYPE_NAME,
 NVL(GET_ONHAND_QTY_FROM_ITEM(:P_DATE_FROM,  ORGANIZATION_ID, INVENTORY_ITEM_ID),0) OPEN_QTY, 
NVL(SUM(RECEIVE_QTY),0) RECEIVE_QTY, 
ABS(NVL(SUM(ISSUE_QTY),0)) ISSUE_QTY ,
 NVL(GET_ONHAND_QTY_FROM_ITEM(:P_DATE_FROM,  ORGANIZATION_ID, INVENTORY_ITEM_ID),0) +  NVL(SUM(RECEIVE_QTY),0) - ABS(NVL(SUM(ISSUE_QTY),0)) CLOSING,
 :P_DATE_FROM, :P_DATE_TO
FROM (
SELECT B.LEGAL_ENTITY LEGAL_ENTITY_ID, E.BAL_SEG_NAME, b.OPERATING_UNIT,APPS.XX_GET_OU_NAME ( B.ORGANIZATION_ID) OU,
 B.ORGANIZATION_ID ORGANIZATION_ID, B.ORGANIZATION_CODE ORGANIZATION_CODE ,
D.FIN_CAT ,D.INVENTORY_TYPE,D.ITEM_TYPE , D.ITEM_GROUP , D.ITEM_SUB_GROUP,
 A.TRANSACTION_ID, 
 A.INVENTORY_ITEM_ID, d.ITEM_CODE, d.ITEM_DESCRIPTION , d.UOM1,
 C.TRANSACTION_TYPE_NAME TRANSACTION_TYPE_NAME ,
   A.TRANSACTION_QUANTITY TRANSACTION_QUANTITY,
   (CASE WHEN A.TRANSACTION_QUANTITY > 0 THEN A.TRANSACTION_QUANTITY END ) RECEIVE_QTY,
     (CASE WHEN A.TRANSACTION_QUANTITY < 0 THEN A.TRANSACTION_QUANTITY END ) ISSUE_QTY
 --    (GET_ONHAND_QTY_FROM_ITEM(SYSDATE,  b.ORGANIZATION_ID, a.INVENTORY_ITEM_ID) + (CASE WHEN A.TRANSACTION_QUANTITY > 0 THEN A.TRANSACTION_QUANTITY END ))   CLOSE
  FROM ORG_ORGANIZATION_DEFINITIONS B, MTL_MATERIAL_TRANSACTIONS  A, MTL_TRANSACTION_TYPES C, WBI_XXKBGITEM_MT_DMN D , XX_BAL_SEG_INFO E --, hr_operating_units F
WHERE A.ORGANIZATION_ID= B.ORGANIZATION_ID
AND A.TRANSACTION_TYPE_ID= C.TRANSACTION_TYPE_ID
and A.ORGANIZATION_ID = D.ORGANIZATION_ID
and A.INVENTORY_ITEM_ID = D.INVENTORY_ITEM_ID
--AND  A.INVENTORY_ITEM_ID= 9 -- 180  -- DIESEL
and TRANSACTION_TYPE_NAME NOT LIKE '%Pick%'
and e.LEGAL_ENTITY_ID = b.LEGAL_ENTITY
--AND e.LEGAL_ENTITY_ID = f.DEFAULT_LEGAL_CONTEXT_ID
--and  TRANSACTION_QUANTITY <>0'
and B.LEGAL_ENTITY =  NVL(:P_LEGAL_ENTITY, B.LEGAL_ENTITY) 
and b.OPERATING_UNIT = NVL(:P_OU_ID, b.OPERATING_UNIT)
and  B.ORGANIZATION_ID = NVL(:P_INV_ORG_ID, B.ORGANIZATION_ID)
and D.ITEM_TYPE  =  NVL(:P_ITEM_TYPE, D.ITEM_TYPE)
and D.ITEM_GROUP  = NVL(:P_ITEM_GROUP, D.ITEM_GROUP )
and D.ITEM_SUB_GROUP = NVL(:P_ITEM_SUB_GROUP, D.ITEM_SUB_GROUP)
AND d.ITEM_CODE = NVL(:P_ITEM_CODE, d.ITEM_CODE)
and D.FINANCE_CATEGORY  = NVL(:P_FINANCE_CATEGORY, D.FINANCE_CATEGORY)
AND  TRUNC(TRANSACTION_DATE)  BETWEEN  TO_DATE(:P_DATE_FROM) AND  TO_DATE(:P_DATE_TO) 
--and  d.ITEM_CODE ='SF|BILT|500|000011'
)
GROUP BY LEGAL_ENTITY_ID, BAL_SEG_NAME,OPERATING_UNIT,OU,ORGANIZATION_ID,ORGANIZATION_CODE,FIN_CAT,INVENTORY_TYPE,ITEM_TYPE,ITEM_GROUP,ITEM_SUB_GROUP,INVENTORY_ITEM_ID,
ITEM_CODE,ITEM_DESCRIPTION,TRANSACTION_TYPE_NAME
 


--====================================================
-- XXKSRM ITEM Transaction Report
--====================================================

SELECT LEGAL_ENTITY, INVENTORY_ITEM_ID,
ITEM_GROUP,
ITEM_CATEGORY,
 ITEM_SUB_GROUP,
 FIN_CATEGORY,
ORGANIZATION_ID,ORGANIZATION_CODE,
TRANSACTION_TYPE_NAME, OPEN_QTY,SUM(TRANSACTION_QUANTITY) TRANSACTION_QUANTITY FROM (
SELECT B.LEGAL_ENTITY, A.TRANSACTION_ID, SEGMENT1 ITEM_GROUP, SEGMENT2 ITEM_CATEGORY,SEGMENT3 ITEM_SUB_GROUP, CATEGORY_CONCAT_SEGS FIN_CATEGORY,
 -- (SELECT DISTINCT SEGMENT1 FROM MTL_ITEM_CATEGORIES_V WHERE     INVENTORY_ITEM_ID = a.INVENTORY_ITEM_ID AND CATEGORY_SET_ID = 1100000041 AND ORGANIZATION_ID = b.ORGANIZATION_ID) ITEM_GROUP,
--    (SELECT DISTINCT SEGMENT2 FROM MTL_ITEM_CATEGORIES_V WHERE     INVENTORY_ITEM_ID = a.ITEM_ID AND CATEGORY_SET_ID = 1100000041 AND ORGANIZATION_ID = b.ORGANIZATION_ID) ITEM_CATEGORY,
--      --  (SELECT DISTINCT SEGMENT3 FROM MTL_ITEM_CATEGORIES_V WHERE     INVENTORY_ITEM_ID = a.ITEM_ID AND CATEGORY_SET_ID = 1100000041 AND ORGANIZATION_ID = b.ORGANIZATION_ID) ITEM_SUB_CATEGORY,
-- (SELECT DISTINCT CATEGORY_CONCAT_SEGS FROM MTL_ITEM_CATEGORIES_V WHERE     INVENTORY_ITEM_ID = a.ITEM_ID AND CATEGORY_SET_ID = 1100000041 AND ORGANIZATION_ID = b.ORGANIZATION_ID) FINANCE_CATEGORY,
A.INVENTORY_ITEM_ID,
GET_ONHAND_QTY_FROM_ITEM(SYSDATE,  b.ORGANIZATION_ID, a.INVENTORY_ITEM_ID) OPEN_QTY,
 B.ORGANIZATION_ID ORGANIZATION_ID, B.ORGANIZATION_CODE ORGANIZATION_CODE , C.TRANSACTION_TYPE_NAME TRANSACTION_TYPE_NAME ,A.TRANSACTION_QUANTITY TRANSACTION_QUANTITY
  FROM ORG_ORGANIZATION_DEFINITIONS B, MTL_MATERIAL_TRANSACTIONS  A, MTL_TRANSACTION_TYPES C, MTL_ITEM_CATEGORIES_V D
WHERE A.ORGANIZATION_ID= B.ORGANIZATION_ID
and A.ORGANIZATION_ID= D.ORGANIZATION_ID
AND A.INVENTORY_ITEM_ID = d.INVENTORY_ITEM_ID
AND A.TRANSACTION_TYPE_ID= C.TRANSACTION_TYPE_ID
AND  A.INVENTORY_ITEM_ID= 9-- 180  -- DIESEL
and TRANSACTION_TYPE_NAME NOT LIKE '%Pick%'
--and  TRANSACTION_QUANTITY <>0
and  SEGMENT1 <> 'DEFAULT'
and SEGMENT2 <> 'FINISHED GOODS'
AND  TRUNC(TRANSACTION_DATE)  BETWEEN  TO_DATE(:P_DATE_FROM) AND  TO_DATE(:P_DATE_TO) 
and B.LEGAL_ENTITY =  NVL(:P_LEGAL_ENTITY, B.LEGAL_ENTITY) 
)
GROUP BY LEGAL_ENTITY, INVENTORY_ITEM_ID,ITEM_GROUP,ITEM_CATEGORY,ITEM_SUB_GROUP,FIN_CATEGORY,
ORGANIZATION_ID,ORGANIZATION_CODE,TRANSACTION_TYPE_NAME 

--SELECT A.TRANSACTION_ID,
-- B.ORGANIZATION_ID ORGANIZATION_ID, B.ORGANIZATION_CODE ORGANIZATION_CODE , C.TRANSACTION_TYPE_NAME TRANSACTION_TYPE_NAME ,A.TRANSACTION_QUANTITY TRANSACTION_QUANTITY
--  FROM ORG_ORGANIZATION_DEFINITIONS B, MTL_MATERIAL_TRANSACTIONS  A, MTL_TRANSACTION_TYPES C
--WHERE A.ORGANIZATION_ID= B.ORGANIZATION_ID
--AND A.TRANSACTION_TYPE_ID= C.TRANSACTION_TYPE_ID
--AND  INVENTORY_ITEM_ID= 180  -- DIESEL
--AND  TRUNC(TRANSACTION_DATE)  BETWEEN  TO_DATE(:P_DATE_FROM) AND  TO_DATE(:P_DATE_TO) 
--and B.LEGAL_ENTITY =  NVL(:P_LEGAL_ENTITY, B.LEGAL_ENTITY) 






-- XXKSRM Monthly DIESEL Movement Report
--==============================

SELECT  -- OPENING PART 
 'OPENING'  TRANSACTION_TYPE_NAME   , SUM(KRM) KRM, SUM(TRM) TRM , SUM(TRO) TRO , SUM(TRN) TRN , SUM(TRH) TRH , SUM(TRK) TRK, SUM(TRB) TRB , SUM(TRJ) TRJ , SUM(TRD) TRD, SUM(PWM) PWM, SUM(PWH) PWH ,
 SUM(PWD) PWD , SUM(KRA) KRA , SUM(TRA) TRA , SUM(KRD) KRD , SUM(KRO) KRO , SUM(KHO) KHO ,
 ----------------SUM--------------------
 (SUM(KRM) + SUM(TRM) + SUM(TRO) +SUM(TRN) + SUM(TRH) + SUM(TRK) + SUM(TRB) + SUM(TRJ) + SUM(TRD) + SUM(PWM) + SUM(PWH) + SUM(PWD) +SUM(KRA) + SUM(TRA) + SUM(KRD) + SUM(KRO) + SUM(KHO) ) TOTAL,
  :P_DATE_FROM , :P_DATE_TO
  FROM (
SELECT  NVL(SUM(PRIMARY_QUANTITY),0) OPEN_QTY,
(CASE WHEN b.ORGANIZATION_ID = 151  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  KRM,
(CASE WHEN b.ORGANIZATION_ID = 152  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  TRM,
(CASE WHEN b.ORGANIZATION_ID = 153   THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRO,
(CASE WHEN b.ORGANIZATION_ID = 154   THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRN,
(CASE WHEN b.ORGANIZATION_ID = 155   THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRH,
(CASE WHEN b.ORGANIZATION_ID = 156   THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRK,
(CASE WHEN b.ORGANIZATION_ID = 157  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  TRB,
(CASE WHEN b.ORGANIZATION_ID = 158  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  TRJ,
(CASE WHEN b.ORGANIZATION_ID = 159  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  TRD,
(CASE WHEN b.ORGANIZATION_ID = 160  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  PWM,
(CASE WHEN b.ORGANIZATION_ID = 161  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  PWH, 
(CASE WHEN b.ORGANIZATION_ID = 162  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  PWD,
(CASE WHEN b.ORGANIZATION_ID = 246  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  KRA,
(CASE WHEN b.ORGANIZATION_ID = 261   THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRA,
(CASE WHEN b.ORGANIZATION_ID = 281  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  KRD,
(CASE WHEN b.ORGANIZATION_ID = 301  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  KRO,
(CASE WHEN b.ORGANIZATION_ID = 321   THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) KHO
FROM 
MTL_MATERIAL_TRANSACTIONS a, ORG_ORGANIZATION_DEFINITIONS b 
WHERE 1=1
and a.ORGANIZATION_ID = b.ORGANIZATION_ID
AND INVENTORY_ITEM_ID= 180  
AND  TRUNC(TRANSACTION_DATE) < TO_DATE(:P_DATE_FROM) 
and B.LEGAL_ENTITY =  NVL(:P_LEGAL_ENTITY, B.LEGAL_ENTITY) --26280
GROUP BY  b.organization_ID
)
UNION ALL 
SELECT --TRANSACTION PART
TRANSACTION_TYPE_NAME , SUM(KRM) KRM, SUM(TRM) TRM , SUM(TRO) TRO , SUM(TRN) TRN , SUM(TRH) TRH , SUM(TRK) TRK, SUM(TRB) TRB , SUM(TRJ) TRJ , SUM(TRD) TRD, SUM(PWM) PWM, SUM(PWH) PWH ,
 SUM(PWD) PWD , SUM(KRA) KRA , SUM(TRA) TRA , SUM(KRD) KRD , SUM(KRO) KRO , SUM(KHO) KHO ,
  ----------------SUM--------------------
 (SUM(KRM) + SUM(TRM) + SUM(TRO) +SUM(TRN) + SUM(TRH) + SUM(TRK) + SUM(TRB) + SUM(TRJ) + SUM(TRD) + SUM(PWM) + SUM(PWH) + SUM(PWD) +SUM(KRA) + SUM(TRA) + SUM(KRD) + SUM(KRO) + SUM(KHO) ) TOTAL, :P_DATE_FROM , :P_DATE_TO
 FROM (
SELECT ORGANIZATION_ID,  
(CASE WHEN ORGANIZATION_ID = 151  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  KRM,
(CASE WHEN ORGANIZATION_ID = 152  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  TRM,
(CASE WHEN ORGANIZATION_ID = 153   THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END) TRO,
(CASE WHEN ORGANIZATION_ID = 154   THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END) TRN,
(CASE WHEN ORGANIZATION_ID = 155   THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END) TRH,
(CASE WHEN ORGANIZATION_ID = 156   THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END) TRK,
(CASE WHEN ORGANIZATION_ID = 157  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  TRB,
(CASE WHEN ORGANIZATION_ID = 158  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  TRJ,
(CASE WHEN ORGANIZATION_ID = 159  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  TRD,
(CASE WHEN ORGANIZATION_ID = 160  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  PWM,
(CASE WHEN ORGANIZATION_ID = 161  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  PWH,
(CASE WHEN ORGANIZATION_ID = 162  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  PWD,
(CASE WHEN ORGANIZATION_ID = 246  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  KRA,
(CASE WHEN ORGANIZATION_ID = 261   THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END) TRA,
(CASE WHEN ORGANIZATION_ID = 281  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  KRD,
(CASE WHEN ORGANIZATION_ID = 301  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  KRO,
(CASE WHEN ORGANIZATION_ID = 321   THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END) KHO,
TRANSACTION_TYPE_NAME, SUM(TRANSACTION_QUANTITY) TRANSACTION_QUANTITY FROM (
SELECT A.TRANSACTION_ID,
 B.ORGANIZATION_ID ORGANIZATION_ID, B.ORGANIZATION_CODE ORGANIZATION_CODE , C.TRANSACTION_TYPE_NAME TRANSACTION_TYPE_NAME ,A.TRANSACTION_QUANTITY TRANSACTION_QUANTITY
  FROM ORG_ORGANIZATION_DEFINITIONS B, MTL_MATERIAL_TRANSACTIONS  A, MTL_TRANSACTION_TYPES C
WHERE A.ORGANIZATION_ID= B.ORGANIZATION_ID
AND A.TRANSACTION_TYPE_ID= C.TRANSACTION_TYPE_ID
AND  INVENTORY_ITEM_ID= 180  -- DIESEL
AND  TRUNC(TRANSACTION_DATE)  BETWEEN  TO_DATE(:P_DATE_FROM) AND  TO_DATE(:P_DATE_TO) 
and B.LEGAL_ENTITY =  NVL(:P_LEGAL_ENTITY, B.LEGAL_ENTITY) 
)
GROUP BY ORGANIZATION_CODE , TRANSACTION_TYPE_NAME, ORGANIZATION_ID --,TRANSACTION_ID
) GROUP BY TRANSACTION_TYPE_NAME
UNION ALL 
--FOR CLOSING : -- OPENING PART  + TRANSACTION PART = CLOSING PART
SELECT  'CLOSING'   TRANSACTION_TYPE_NAME   , SUM(KRM) KRM, SUM(TRM) TRM , SUM(TRO) TRO , SUM(TRN) TRN , SUM(TRH) TRH , SUM(TRK) TRK, SUM(TRB) TRB , SUM(TRJ) TRJ , SUM(TRD) TRD, SUM(PWM) PWM, SUM(PWH) PWH ,
 SUM(PWD) PWD , SUM(KRA) KRA , SUM(TRA) TRA , SUM(KRD) KRD , SUM(KRO) KRO , SUM(KHO) KHO ,
  ----------------SUM--------------------
  (SUM(KRM) + SUM(TRM) + SUM(TRO) +SUM(TRN) + SUM(TRH) + SUM(TRK) + SUM(TRB) + SUM(TRJ) + SUM(TRD) + SUM(PWM) + SUM(PWH) + SUM(PWD) +SUM(KRA) + SUM(TRA) + SUM(KRD) + SUM(KRO) + SUM(KHO) ) TOTAL,  :P_DATE_FROM , :P_DATE_TO
 FROM
 (
SELECT  
 'OPENING'  TRANSACTION_TYPE_NAME   , SUM(KRM) KRM, SUM(TRM) TRM , SUM(TRO) TRO , SUM(TRN) TRN , SUM(TRH) TRH , SUM(TRK) TRK, SUM(TRB) TRB , SUM(TRJ) TRJ , SUM(TRD) TRD, SUM(PWM) PWM, SUM(PWH) PWH ,
 SUM(PWD) PWD , SUM(KRA) KRA , SUM(TRA) TRA , SUM(KRD) KRD , SUM(KRO) KRO , SUM(KHO) KHO 
  FROM (
SELECT  NVL(SUM(PRIMARY_QUANTITY),0) OPEN_QTY,
(CASE WHEN b.ORGANIZATION_ID = 151  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  KRM,
(CASE WHEN b.ORGANIZATION_ID = 152  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  TRM,
(CASE WHEN b.ORGANIZATION_ID = 153   THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRO,
(CASE WHEN b.ORGANIZATION_ID = 154   THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRN,
(CASE WHEN b.ORGANIZATION_ID = 155   THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRH,
(CASE WHEN b.ORGANIZATION_ID = 156   THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRK,
(CASE WHEN b.ORGANIZATION_ID = 157  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  TRB,
(CASE WHEN b.ORGANIZATION_ID = 158  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  TRJ,
(CASE WHEN b.ORGANIZATION_ID = 159  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  TRD,
(CASE WHEN b.ORGANIZATION_ID = 160  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  PWM,
(CASE WHEN b.ORGANIZATION_ID = 161  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  PWH,
(CASE WHEN b.ORGANIZATION_ID = 162  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  PWD,
(CASE WHEN b.ORGANIZATION_ID = 246  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  KRA,
(CASE WHEN b.ORGANIZATION_ID = 261   THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRA,
(CASE WHEN b.ORGANIZATION_ID = 281  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  KRD,
(CASE WHEN b.ORGANIZATION_ID = 301  THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END)  KRO,
(CASE WHEN b.ORGANIZATION_ID = 321   THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) KHO
FROM 
MTL_MATERIAL_TRANSACTIONS a, ORG_ORGANIZATION_DEFINITIONS b 
WHERE 1=1
and a.ORGANIZATION_ID = b.ORGANIZATION_ID
AND INVENTORY_ITEM_ID= 180 
AND  TRUNC(TRANSACTION_DATE) < TO_DATE(:P_DATE_FROM) 
and B.LEGAL_ENTITY =  NVL(:P_LEGAL_ENTITY, B.LEGAL_ENTITY) 
GROUP BY  b.organization_ID
)
UNION ALL 
SELECT --TRANSACTION PART
TRANSACTION_TYPE_NAME , SUM(KRM) KRM, SUM(TRM) TRM , SUM(TRO) TRO , SUM(TRN) TRN , SUM(TRH) TRH , SUM(TRK) TRK, SUM(TRB) TRB , SUM(TRJ) TRJ , SUM(TRD) TRD, SUM(PWM) PWM, SUM(PWH) PWH ,
 SUM(PWD) PWD , SUM(KRA) KRA , SUM(TRA) TRA , SUM(KRD) KRD , SUM(KRO) KRO , SUM(KHO) KHO 
 FROM (
SELECT ORGANIZATION_ID,  
(CASE WHEN ORGANIZATION_ID = 151  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  KRM,
(CASE WHEN ORGANIZATION_ID = 152  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  TRM,
(CASE WHEN ORGANIZATION_ID = 153   THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END) TRO,
(CASE WHEN ORGANIZATION_ID = 154   THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END) TRN,
(CASE WHEN ORGANIZATION_ID = 155   THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END) TRH,
(CASE WHEN ORGANIZATION_ID = 156   THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END) TRK,
(CASE WHEN ORGANIZATION_ID = 157  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  TRB,
(CASE WHEN ORGANIZATION_ID = 158  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  TRJ,
(CASE WHEN ORGANIZATION_ID = 159  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  TRD,
(CASE WHEN ORGANIZATION_ID = 160  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  PWM,
(CASE WHEN ORGANIZATION_ID = 161  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  PWH,
(CASE WHEN ORGANIZATION_ID = 162  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  PWD,
(CASE WHEN ORGANIZATION_ID = 246  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  KRA,
(CASE WHEN ORGANIZATION_ID = 261   THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END) TRA,
(CASE WHEN ORGANIZATION_ID = 281  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  KRD,
(CASE WHEN ORGANIZATION_ID = 301  THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END)  KRO,
(CASE WHEN ORGANIZATION_ID = 321   THEN NVL(SUM(TRANSACTION_QUANTITY),0)   ELSE 0  END) KHO,
TRANSACTION_TYPE_NAME, SUM(TRANSACTION_QUANTITY) TRANSACTION_QUANTITY FROM (
SELECT A.TRANSACTION_ID,
 B.ORGANIZATION_ID ORGANIZATION_ID, B.ORGANIZATION_CODE ORGANIZATION_CODE , C.TRANSACTION_TYPE_NAME TRANSACTION_TYPE_NAME ,A.TRANSACTION_QUANTITY TRANSACTION_QUANTITY
  FROM ORG_ORGANIZATION_DEFINITIONS B, MTL_MATERIAL_TRANSACTIONS  A, MTL_TRANSACTION_TYPES C
WHERE A.ORGANIZATION_ID= B.ORGANIZATION_ID
AND A.TRANSACTION_TYPE_ID= C.TRANSACTION_TYPE_ID
AND  INVENTORY_ITEM_ID= 180  -- DIESEL
AND  TRUNC(TRANSACTION_DATE)  BETWEEN  TO_DATE(:P_DATE_FROM) AND  TO_DATE(:P_DATE_TO) 
and B.LEGAL_ENTITY =  NVL(:P_LEGAL_ENTITY, B.LEGAL_ENTITY) 
)GROUP BY ORGANIZATION_CODE , TRANSACTION_TYPE_NAME, ORGANIZATION_ID 
) GROUP BY TRANSACTION_TYPE_NAME
)



-- FOR DIESEL REPORT V2

SELECT  -- OPENING PART 
 'OPENING'  TRANSACTION_TYPE_NAME   , SUM(TRM) TRM, SUM(TRO) TRO , SUM(TRN) TRN , SUM(TRJ) TRJ , SUM(TRA)TRA , SUM(PWM) PWM  FROM (
SELECT  NVL(SUM(PRIMARY_QUANTITY),0) OPEN_QTY,
(CASE WHEN b.ORGANIZATION_ID = 152 THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRM,
(CASE WHEN b.ORGANIZATION_ID = 153 THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRO,
(CASE WHEN b.ORGANIZATION_ID = 154 THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRN,
(CASE WHEN b.ORGANIZATION_ID = 158 THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRJ,
(CASE WHEN b.ORGANIZATION_ID = 261 THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRA,
(CASE WHEN b.ORGANIZATION_ID = 160 THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) PWM
FROM 
MTL_MATERIAL_TRANSACTIONS a, ORG_ORGANIZATION_DEFINITIONS b 
WHERE 1=1
and a.ORGANIZATION_ID = b.ORGANIZATION_ID
--ORGANIZATION_ID= 152 -- NVL(P_ORG_ID,ORGANIZATION_ID) 
--AND SUBINVENTORY_CODE=NVL(P_SUBINVENTORY_CODE,SUBINVENTORY_CODE)
AND INVENTORY_ITEM_ID= 180 --P_INVENTORY_ITEM_ID  
and b.organization_ID in (152, 153, 154,158,261,160) 
--AND SUBINVENTORY_CODE<>'STAGIN'  ---- NEW ADD
AND  TRUNC(TRANSACTION_DATE) < TO_DATE(:P_DATE_FROM) 
and B.LEGAL_ENTITY = 26280
GROUP BY  b.organization_ID
)
UNION ALL 
SELECT --TRANSACTION PART
TRANSACTION_TYPE_NAME ,SUM(TRM) TRM, SUM(TRO) TRO,SUM(TRN) TRN ,SUM(TRJ) TRJ,SUM(TRA) TRA,SUM(PWM) PWM FROM (
SELECT ORGANIZATION_ID,  
(CASE WHEN ORGANIZATION_ID = 152 THEN SUM(TRANSACTION_QUANTITY)  ELSE 0  END) TRM,  
(CASE WHEN ORGANIZATION_ID = 153 THEN SUM(TRANSACTION_QUANTITY)  ELSE 0  END) TRO,
(CASE WHEN ORGANIZATION_ID = 154 THEN SUM(TRANSACTION_QUANTITY)  ELSE 0  END) TRN,
(CASE WHEN ORGANIZATION_ID = 158 THEN SUM(TRANSACTION_QUANTITY)  ELSE 0  END) TRJ,
(CASE WHEN ORGANIZATION_ID = 261 THEN SUM(TRANSACTION_QUANTITY)  ELSE 0  END) TRA,
(CASE WHEN ORGANIZATION_ID = 160 THEN SUM(TRANSACTION_QUANTITY) ELSE 0  END) PWM,
--TRANSACTION_ID , 
TRANSACTION_TYPE_NAME, SUM(TRANSACTION_QUANTITY) TRANSACTION_QUANTITY FROM (
SELECT A.TRANSACTION_ID,
--NVL (XX_INV_PKG.XXGET_INV_OPENING_STOCK (a.INVENTORY_ITEM_ID,a.organization_id,NULL, NULL, :P_DATE),0) GLOBAL_STOCK, 
--NVL (XX_INV_PKG.XXGET_INV_OPENING_STOCK (MOQ.INVENTORY_ITEM_ID,:P_ORG_ID,  NVL(:P_SUBINVENTORY_CODE,MOQ.SUBINVENTORY_CODE), NULL, :P_DATE),0) OPENING_QTY ,
 B.ORGANIZATION_ID ORGANIZATION_ID, B.ORGANIZATION_CODE ORGANIZATION_CODE , C.TRANSACTION_TYPE_NAME TRANSACTION_TYPE_NAME ,A.TRANSACTION_QUANTITY TRANSACTION_QUANTITY
  FROM ORG_ORGANIZATION_DEFINITIONS B, MTL_MATERIAL_TRANSACTIONS  A, MTL_TRANSACTION_TYPES C
WHERE A.ORGANIZATION_ID= B.ORGANIZATION_ID
AND A.TRANSACTION_TYPE_ID= C.TRANSACTION_TYPE_ID
AND  INVENTORY_ITEM_ID= 180  -- DIESEL
--AND  TRUNC(TRANSACTION_DATE)  BETWEEN '01-JAN-2021' AND '28-JAN-2021'   -- 2,353
AND  TRUNC(TRANSACTION_DATE)  BETWEEN  TO_DATE(:P_DATE_FROM) AND  TO_DATE(:P_DATE_TO) 
AND B.LEGAL_ENTITY = 26280
)
GROUP BY ORGANIZATION_CODE , TRANSACTION_TYPE_NAME, ORGANIZATION_ID --,TRANSACTION_ID
) GROUP BY TRANSACTION_TYPE_NAME
UNION ALL 
SELECT 'CLOSING' TRANSACTION_TYPE_NAME ,  SUM(TRM) TRM, SUM(TRO) TRO , SUM(TRN) TRN , SUM(TRJ) TRJ , SUM(TRA)TRA , SUM(PWM) PWM  FROM
 (
SELECT NULL   , SUM(TRM) TRM, SUM(TRO) TRO , SUM(TRN) TRN , SUM(TRJ) TRJ , SUM(TRA)TRA , SUM(PWM) PWM  FROM (
SELECT  NVL(SUM(PRIMARY_QUANTITY),0) OPEN_QTY,
(CASE WHEN b.ORGANIZATION_ID = 152 THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRM,
(CASE WHEN b.ORGANIZATION_ID = 153 THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRO,
(CASE WHEN b.ORGANIZATION_ID = 154 THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRN,
(CASE WHEN b.ORGANIZATION_ID = 158 THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRJ,
(CASE WHEN b.ORGANIZATION_ID = 261 THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRA,
(CASE WHEN b.ORGANIZATION_ID = 160 THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) PWM
FROM 
MTL_MATERIAL_TRANSACTIONS a, ORG_ORGANIZATION_DEFINITIONS b 
WHERE 1=1
and a.ORGANIZATION_ID = b.ORGANIZATION_ID
AND INVENTORY_ITEM_ID= 180 --P_INVENTORY_ITEM_ID  
and b.organization_ID in (152, 153, 154,158,261,160) 
--AND SUBINVENTORY_CODE<>'STAGIN'  ---- NEW ADD
AND  TRUNC(TRANSACTION_DATE) < TO_DATE(:P_DATE_FROM) 
and B.LEGAL_ENTITY = 26280
GROUP BY  b.organization_ID
)
UNION ALL
SELECT NULL , SUM(TRM) TRM, SUM(TRO) TRO,SUM(TRN) TRN ,SUM(TRJ) TRJ,SUM(TRA) TRA,SUM(PWM) PWM FROM (
SELECT TRANSACTION_TYPE_NAME ,SUM(TRM) TRM, SUM(TRO) TRO,SUM(TRN) TRN ,SUM(TRJ) TRJ,SUM(TRA) TRA,SUM(PWM) PWM FROM (
SELECT ORGANIZATION_ID,  
(CASE WHEN ORGANIZATION_ID = 152 THEN SUM(TRANSACTION_QUANTITY)  ELSE 0  END) TRM,  
(CASE WHEN ORGANIZATION_ID = 153 THEN SUM(TRANSACTION_QUANTITY)  ELSE 0  END) TRO,
(CASE WHEN ORGANIZATION_ID = 154 THEN SUM(TRANSACTION_QUANTITY)  ELSE 0  END) TRN,
(CASE WHEN ORGANIZATION_ID = 158 THEN SUM(TRANSACTION_QUANTITY)  ELSE 0  END) TRJ,
(CASE WHEN ORGANIZATION_ID = 261 THEN SUM(TRANSACTION_QUANTITY)  ELSE 0  END) TRA,
(CASE WHEN ORGANIZATION_ID = 160 THEN SUM(TRANSACTION_QUANTITY) ELSE 0  END) PWM,
--TRANSACTION_ID , 
TRANSACTION_TYPE_NAME, SUM(TRANSACTION_QUANTITY) TRANSACTION_QUANTITY FROM (
SELECT A.TRANSACTION_ID,
 B.ORGANIZATION_ID ORGANIZATION_ID, B.ORGANIZATION_CODE ORGANIZATION_CODE , C.TRANSACTION_TYPE_NAME TRANSACTION_TYPE_NAME ,A.TRANSACTION_QUANTITY TRANSACTION_QUANTITY
  FROM ORG_ORGANIZATION_DEFINITIONS B, MTL_MATERIAL_TRANSACTIONS  A, MTL_TRANSACTION_TYPES C
WHERE A.ORGANIZATION_ID= B.ORGANIZATION_ID
AND A.TRANSACTION_TYPE_ID= C.TRANSACTION_TYPE_ID
AND  INVENTORY_ITEM_ID= 180  -- DIESEL
AND  TRUNC(TRANSACTION_DATE)  BETWEEN  TO_DATE(:P_DATE_FROM) AND  TO_DATE(:P_DATE_TO) 
AND B.LEGAL_ENTITY = 26280
)
GROUP BY ORGANIZATION_CODE , TRANSACTION_TYPE_NAME, ORGANIZATION_ID 
)
GROUP BY TRANSACTION_TYPE_NAME
))



-- FOR DIESEL REPORT
SELECT 
--NVL (XX_INV_PKG.XXGET_INV_OPENING_STOCK (a.INVENTORY_ITEM_ID,a.organization_id,NULL, NULL, :P_DATE),0) GLOBAL_STOCK, 
--NVL (XX_INV_PKG.XXGET_INV_OPENING_STOCK (MOQ.INVENTORY_ITEM_ID,:P_ORG_ID,  NVL(:P_SUBINVENTORY_CODE,MOQ.SUBINVENTORY_CODE), NULL, :P_DATE),0) OPENING_QTY ,
 b.ORGANIZATION_CODE, c.transaction_type_name,a.*
  FROM org_organization_definitions b, MTL_MATERIAL_TRANSACTIONS  a, MTL_TRANSACTION_TYPES c
where a.organization_id= b.organization_id
and a.transaction_TYPE_ID= c.transaction_TYPE_ID
--AND TO_CHAR(TRANSACTION_DATE,'MM-YYYY')='02-2021'
--AND TO_CHAR(TRANSACTION_DATE,'MON-YY')='FEB-21' 
and  inventory_item_id= 180  
and  trunc(transaction_date)  between '01-FEB-2021' and '28-FEB-2021'   -- 2,353
and b.legal_entity = 26280



--select * from MTL_ONHAND_QUANTITIES

-- FOR OPENING QTY V1
SELECT SUM(TRM) TRM, SUM(TRO) TRO , SUM(TRN) TRN , SUM(TRJ) TRJ , SUM(TRA)TRA , SUM(PWM) PWM  FROM (
SELECT NVL(SUM(PRIMARY_QUANTITY),0) OPEN_QTY,
(CASE WHEN b.ORGANIZATION_ID = 152 THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRM,
(CASE WHEN b.ORGANIZATION_ID = 153 THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRO,
(CASE WHEN b.ORGANIZATION_ID = 154 THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRN,
(CASE WHEN b.ORGANIZATION_ID = 158 THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRJ,
(CASE WHEN b.ORGANIZATION_ID = 261 THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) TRA,
(CASE WHEN b.ORGANIZATION_ID = 160 THEN NVL(SUM(PRIMARY_QUANTITY),0)   ELSE 0  END) PWM
FROM 
MTL_MATERIAL_TRANSACTIONS a, ORG_ORGANIZATION_DEFINITIONS b 
WHERE 1=1
and a.ORGANIZATION_ID = b.ORGANIZATION_ID
--ORGANIZATION_ID= 152 -- NVL(P_ORG_ID,ORGANIZATION_ID) 
--AND SUBINVENTORY_CODE=NVL(P_SUBINVENTORY_CODE,SUBINVENTORY_CODE)
AND INVENTORY_ITEM_ID= 180 --P_INVENTORY_ITEM_ID  
and b.organization_ID in (152, 153, 154,158,261,160) 
--AND SUBINVENTORY_CODE<>'STAGIN'  ---- NEW ADD
AND  TRUNC(TRANSACTION_DATE) <TO_DATE(:P_DATE_FROM) 
--and B.LEGAL_ENTITY = 26280
GROUP BY  b.organization_ID
)


select * from ORG_ORGANIZATION_DEFINITIONS WHERE LEGAL_ENTITY = 26280 and OPERATING_UNIT = 103


-- FOR OPENING QTY
SELECT b.organization_code,NVL(SUM(PRIMARY_QUANTITY),0) OPEN_QTY
FROM 
MTL_MATERIAL_TRANSACTIONS a, ORG_ORGANIZATION_DEFINITIONS b 
WHERE 1=1
and a.ORGANIZATION_ID = b.ORGANIZATION_ID
--ORGANIZATION_ID= 152 -- NVL(P_ORG_ID,ORGANIZATION_ID) 
--AND SUBINVENTORY_CODE=NVL(P_SUBINVENTORY_CODE,SUBINVENTORY_CODE)
AND INVENTORY_ITEM_ID= 180 --P_INVENTORY_ITEM_ID  
--and b.organization_ID in (152, 153, 154,158,161,160) 
--AND SUBINVENTORY_CODE<>'STAGIN'  ---- NEW ADD
AND  TRUNC( TRANSACTION_DATE) <TO_DATE(:P_DATE_FROM) 
and B.LEGAL_ENTITY = 26280
GROUP BY  b.organization_code

--FUNCTION XX_INV_OPEN_QTY(P_ORG_ID NUMBER,P_SUBINVENTORY_CODE VARCHAR2, P_INVENTORY_ITEM_ID NUMBER,P_DATE_FROM DATE)
--RETURN NUMBER IS
--OPEN_QTY NUMBER;
--BEGIN
--SELECT NVL(SUM(PRIMARY_QUANTITY),0) INTO OPEN_QTY
--FROM 
--MTL_MATERIAL_TRANSACTIONS
--WHERE 
--ORGANIZATION_ID=NVL(P_ORG_ID,ORGANIZATION_ID) 
--AND SUBINVENTORY_CODE=NVL(P_SUBINVENTORY_CODE,SUBINVENTORY_CODE)
--AND INVENTORY_ITEM_ID=P_INVENTORY_ITEM_ID  
-------AND SUBINVENTORY_CODE<>'STAGIN'  ---- NEW ADD
--AND  TRUNC( TRANSACTION_DATE) <TO_DATE(P_DATE_FROM);
--RETURN(OPEN_QTY);
--EXCEPTION 
--WHEN OTHERS THEN  
--RETURN(null);
--END;


select  SUM(TRANSACTION_QUANTITY)   from MTL_ONHAND_QUANTITIES where INVENTORY_ITEM_ID = 774051 
and TRUNC(DATE_RECEIVED) < =TRUNC(:P_TRANSACTION_DATE) 


-- OPENING QTY
SELECT OOD.ORGANIZATION_CODE, MQ.ORGANIZATION_ID ,SUM (MQ.TRANSACTION_QUANTITY)  ONHAND_QUANTITY     
FROM ORG_ORGANIZATION_DEFINITIONS OOD, 
 MTL_ONHAND_QUANTITIES MQ,
 MTL_SYSTEM_ITEMS_B MSI   
  WHERE 1 = 1      
  AND TRUNC(MQ.DATE_RECEIVED) < =TRUNC(:P_TRANSACTION_DATE)  -- 2/1/2021 10:57:21 AM
  AND MQ.ORGANIZATION_ID = MSI.ORGANIZATION_ID
  AND OOD.ORGANIZATION_ID = MSI.ORGANIZATION_ID     
  AND MQ.INVENTORY_ITEM_ID = MSI.INVENTORY_ITEM_ID
  and MQ.INVENTORY_ITEM_ID = 774051 --180   
 -- and OOD.ORGANIZATION_CODE = 'KSK'
  and MQ.ORGANIZATION_ID = 171
  GROUP BY MQ.ORGANIZATION_ID,OOD.ORGANIZATION_CODE
  
  
  
  --AND SUBINVENTORY_CODE<>'STAGIN'  ---- NEW ADD   
  AND MQ.INVENTORY_ITEM_ID = P_INVENTORY_ITEM_ID
  AND OOD.ORGANIZATION_ID = NVL(P_ORGANIZATION_ID,OOD.ORGANIZATION_ID)
  AND MQ.SUBINVENTORY_CODE = NVL(P_SUBINVENTORY_CODE,MQ.SUBINVENTORY_CODE)
  AND NVL(MQ.LOCATOR_ID,0)=NVL(NVL(P_LOCATOR_ID,MQ.LOCATOR_ID),0)


--===========================================================
--FUNCTION XXGET_INV_OPENING_STOCK (P_INVENTORY_ITEM_ID IN NUMBER,P_ORGANIZATION_ID IN VARCHAR2,P_SUBINVENTORY_CODE IN VARCHAR2,P_LOCATOR_ID IN NUMBER,P_TRANSACTION_DATE IN DATE)
--RETURN NUMBER
--IS
--V_OPENING_STOCK NUMBER;
--BEGIN
--SELECT SUM (MQ.TRANSACTION_QUANTITY) INTO V_OPENING_STOCK          
--FROM ORG_ORGANIZATION_DEFINITIONS OOD, 
-- MTL_ONHAND_QUANTITIES MQ,
-- MTL_SYSTEM_ITEMS_B MSI   
--  WHERE 1 = 1      
--  AND TRUNC(MQ.DATE_RECEIVED) < =TRUNC(P_TRANSACTION_DATE)
--  AND MQ.ORGANIZATION_ID = MSI.ORGANIZATION_ID
--  AND OOD.ORGANIZATION_ID = MSI.ORGANIZATION_ID      
--  AND MQ.INVENTORY_ITEM_ID = MSI.INVENTORY_ITEM_ID   
--  ----AND SUBINVENTORY_CODE<>'STAGIN'  ---- NEW ADD   
--  AND MQ.INVENTORY_ITEM_ID = P_INVENTORY_ITEM_ID
--  AND OOD.ORGANIZATION_ID = NVL(P_ORGANIZATION_ID,OOD.ORGANIZATION_ID)
--  AND MQ.SUBINVENTORY_CODE = NVL(P_SUBINVENTORY_CODE,MQ.SUBINVENTORY_CODE)
--  AND NVL(MQ.LOCATOR_ID,0)=NVL(NVL(P_LOCATOR_ID,MQ.LOCATOR_ID),0);
--  RETURN(V_OPENING_STOCK);
--EXCEPTION
-- WHEN OTHERS THEN
-- RETURN 0;
--END;



NVL (XX_INV_PKG.XXGET_INV_OPENING_STOCK (MOQ.INVENTORY_ITEM_ID,:P_ORG_ID,  NVL(:P_SUBINVENTORY_CODE,MOQ.SUBINVENTORY_CODE), NULL, :P_DATE),0) OPENING_QTY ,






-- TEST 

 SELECT SUM(TRANSACTION_VALUE) FROM (
 SELECT 1 UNION_PART,
          ORG.OPERATING_UNIT ORG_ID,
          OU.NAME OU_NAME,
          XAH.PERIOD_NAME,
          gxeh.LEGAL_ENTITY_ID,
          XAH.ACCOUNTING_ENTRY_STATUS_CODE,
          XAH.GL_TRANSFER_STATUS_CODE,
          XAH.APPLICATION_ID,
          'INV' JE_SOURCE,
          CAT.NAME JE_CATEGORY,
          CC.SEGMENT1 GL_LE,
          XAL.ACCOUNTING_CLASS_CODE,
          gxeh.EVENT_CLASS_CODE,
          gxeh.ENTITY_CODE,
          XAH.EVENT_TYPE_CODE,
          CC.SEGMENT2 GL_UNIT,
          CC.SEGMENT3 GL_CC,
          CC.SEGMENT4 GL_ACC,
          CC.SEGMENT5 GL_SL,
          EAM_FLEX_SL_DESC (CC.SEGMENT4, CC.SEGMENT5) GL_SL_DESC,
          CC.SEGMENT6 GL_PROJECT, 
          CC.SEGMENT7 GL_IC,
          FLEX.DESCRIPTION ACCTDESC,
          gxeh.source_line_ID VOUCHER_NUMBER,
          NULL GL_VOUCHER_NUMBER,
          XAH.AE_HEADER_ID,
          XAL.AE_LINE_NUM GL_JE_LINE_NUM,
          XAL.ACCOUNTING_DATE VOUCHER_DATE,
          NULL PARTICULARS,
          XAL.ENTERED_DR,
          XAL.ENTERED_CR,
          XAL.ACCOUNTED_DR,
          XAL.ACCOUNTED_CR,
          NULL CHEQUE_NUMBER,
          TRUNC (SYSDATE) CHEQUE_DATE,
          APS.SEGMENT1 PARTY_CODE,
          APS.VENDOR_NAME PARTY_NAME,
          --ENTITY_CODE TRANSACTION_TYPE,
          CC.CHART_OF_ACCOUNTS_ID,
          xah.LEDGER_ID,
          NULL DFF_CONTEXT,
          DECODE (GXEH.ENTITY_CODE, 'PURCHASING', PO.SEGMENT1, NULL) PO_NUM,
          PO.PO_HEADER_ID PO_HEADER_ID,
          (SELECT shipment_number
             FROM mtl_material_transactions
            WHERE transaction_id = gxeh.transaction_id
                  AND transaction_type_id IN (3, 12, 21))
             INTER_ORG_SHIPMENT_NUM,
          NULL ATTRIBUTE3,
          NULL ATTRIBUTE4,
          NULL ATTRIBUTE5,
          ORG.ORGANIZATION_ID,
          ORG.ORGANIZATION_CODE,
          ORG.ORGANIZATION_NAME,
          MST.INVENTORY_ITEM_ID,
          MST.SEGMENT1 ITEM_CODE_SEGMENT1,
          MST.SEGMENT2 ITEM_CODE_SEGMENT2,
          MST.SEGMENT3 ITEM_CODE_SEGMENT3,
          MST.SEGMENT4 ITEM_CODE_SEGMENT4,
          MST.SEGMENT5 ITEM_CODE_SEGMENT5,
          MST.SEGMENT6 ITEM_CODE_SEGMENT6,
          MST.CONCATENATED_SEGMENTS CONCAT_ITEM_CODE,
          MST.DESCRIPTION INVENTORY_ITEM_NAME,
          (SELECT MCB.SEGMENT1
             FROM MTL_ITEM_CATEGORIES MIC, MTL_CATEGORIES_B MCB
            WHERE     MIC.CATEGORY_ID = MCB.CATEGORY_ID
                  AND MCB.STRUCTURE_ID = 101
                  AND MIC.CATEGORY_SET_ID = 1
                  AND MIC.INVENTORY_ITEM_ID = MST.INVENTORY_ITEM_ID
                  AND MIC.ORGANIZATION_ID = MST.ORGANIZATION_ID)
             ITEM_CATEGORY_SEGMENT1,
          (SELECT MCB.SEGMENT2
             FROM MTL_ITEM_CATEGORIES MIC, MTL_CATEGORIES_B MCB
            WHERE     MIC.CATEGORY_ID = MCB.CATEGORY_ID
                  AND MCB.STRUCTURE_ID = 101
                  AND MIC.CATEGORY_SET_ID = 1
                  AND MIC.INVENTORY_ITEM_ID = MST.INVENTORY_ITEM_ID
                  AND MIC.ORGANIZATION_ID = MST.ORGANIZATION_ID)
             ITEM_CATEGORY_SEGMENT2,
          (SELECT MCB.SEGMENT3
             FROM MTL_ITEM_CATEGORIES MIC, MTL_CATEGORIES_B MCB
            WHERE     MIC.CATEGORY_ID = MCB.CATEGORY_ID
                  AND MCB.STRUCTURE_ID = 101
                  AND MIC.CATEGORY_SET_ID = 1
                  AND MIC.INVENTORY_ITEM_ID = MST.INVENTORY_ITEM_ID
                  AND MIC.ORGANIZATION_ID = MST.ORGANIZATION_ID)
             ITEM_CATEGORY_SEGMENT3,
          (SELECT MCB.SEGMENT1
             FROM MTL_ITEM_CATEGORIES MIC, MTL_CATEGORIES_B MCB
            WHERE     MIC.CATEGORY_ID = MCB.CATEGORY_ID
                  AND MCB.STRUCTURE_ID = 50408
                  AND MIC.CATEGORY_SET_ID = 1100000041
                  AND MIC.INVENTORY_ITEM_ID = MST.INVENTORY_ITEM_ID
                  AND MIC.ORGANIZATION_ID = MST.ORGANIZATION_ID)
             FIN_CAT1,
          (SELECT MCB.SEGMENT2
             FROM MTL_ITEM_CATEGORIES MIC, MTL_CATEGORIES_B MCB
            WHERE     MIC.CATEGORY_ID = MCB.CATEGORY_ID
                  AND MCB.STRUCTURE_ID = 50408
                  AND MIC.CATEGORY_SET_ID = 1100000041
                  AND MIC.INVENTORY_ITEM_ID = MST.INVENTORY_ITEM_ID
                  AND MIC.ORGANIZATION_ID = MST.ORGANIZATION_ID)
             FIN_CAT2,
          RCVH.RECEIPT_NUM GOODS_RECEIPT_NUM,
          gxeh.REFERENCE_NO,
          gxeh.EVENT_ID,
          gxeh.TRANSACTION_ID,
          gxeh.TRANSACTION_TYPE_ID,
          gxeh.TRANSACTION_UOM,
          gxeh.TXN_SOURCE,
          gxeh.LOT_NUMBER,
          gxeh.TRANSACTION_CURRENCY,
          gxeh.CURRENCY_CONVERSION_RATE,
          gxeh.TRANSACTION_DATE,
          gxeh.TRANSACTION_QUANTITY,
          gxeh.TRANSACTION_VALUE,
          gxeh.SOURCE_DOCUMENT_ID,
          gxeh.SOURCE_LINE_ID,
          0 FA_ASSET_ID,
          RCVT.SHIPMENT_HEADER_ID,
          RCVT.SHIPMENT_LINE_ID,
          RCVT.TRANSACTION_ID RCV_TRANSACTION_ID,
          RCVT.PO_LINE_ID,
          RCVT.PO_LINE_LOCATION_ID,
          (SELECT DISTINCT LC_ID           --, LC_NUMBER, ORG_ID, PO_HEADER_ID
             FROM XX_LC_DETAILS
            WHERE po_header_id = RCVT.PO_HEADER_ID)
             LC_ID,
          (SELECT DISTINCT LC_NUMBER                   -- ORG_ID, PO_HEADER_ID
             FROM XX_LC_DETAILS
            WHERE po_header_id = RCVT.PO_HEADER_ID)
             LC_NUM,
          (SELECT DISTINCT BILL_OF_ENTRY_NO        --, BILL_OF_ENTRY_DATE, A.*
             FROM XX_LC_DETAILS_DT
            WHERE SHIPMENT_HEADER_ID = RCVH.SHIPMENT_HEADER_ID)
             BL_NUM,
          (SELECT DISTINCT BILL_OF_ENTRY_DATE
             FROM XX_LC_DETAILS_DT
            WHERE SHIPMENT_HEADER_ID = RCVH.SHIPMENT_HEADER_ID)
             BL_DATE,
          CASE
             WHEN gxeh.EVENT_TYPE_CODE = 'STEP'
             THEN
                gxeh.SOURCE_DOCUMENT_ID
             ELSE
                DECODE (gxeh.TRANSACTION_TYPE_ID,
                        44, gxeh.SOURCE_DOCUMENT_ID,
                        17, gxeh.SOURCE_DOCUMENT_ID,
                        1002, gxeh.SOURCE_DOCUMENT_ID,
                        35, gxeh.SOURCE_DOCUMENT_ID,
                        1003, gxeh.SOURCE_DOCUMENT_ID,
                        43, gxeh.SOURCE_DOCUMENT_ID,
                        NULL)
          END
             PROD_BATCH_NO,
          gxeh.SOURCE_DOCUMENT_ID LCM_ADJ_NUM,
          gxeh.HEADER_ID GMF_HEADER_ID,
          (SELECT TRANSACTION_TYPE_NAME
             FROM MTL_TRANSACTION_TYPES
            WHERE TRANSACTION_TYPE_ID = gxeh.TRANSACTION_TYPE_ID)
             AS TRANSACTION_TYPE_NAME,
          gxeh.TRANSACTION_ACTION_ID
     FROM AP_SUPPLIERS APS,
          RCV_SHIPMENT_HEADERS RCVH,
          RCV_TRANSACTIONS RCVT,
          gmf_xla_extract_headers gxeh,
          XLA_AE_LINES XAL,
          XLA_AE_HEADERS XAH,
          GL_LEDGERS LED,
          FND_DOC_SEQUENCE_CATEGORIES CAT,
          gl_code_combinations cc,
          FND_FLEX_VALUES_VL FLEX,
          MTL_SYSTEM_ITEMS_B_KFV MST,
          ORG_ORGANIZATION_DEFINITIONS ORG,
          --  MTL_ITEM_CATEGORIES MIC,
          -- MTL_CATEGORIES_B MCB,
          PO_HEADERS_ALL PO,
          HR_OPERATING_UNITS OU
    WHERE     APS.VENDOR_ID(+) = RCVH.VENDOR_ID
          AND RCVH.SHIPMENT_HEADER_ID(+) = RCVT.SHIPMENT_HEADER_ID
          AND ORG.OPERATING_UNIT = OU.ORGANIZATION_ID(+)
          AND LED.LEDGER_ID = XAH.LEDGER_ID(+)
          AND LED.LEDGER_CATEGORY_CODE = 'PRIMARY'
          AND NVL (RCVT.PO_HEADER_ID, 1) = NVL (PO.PO_HEADER_ID(+), 1)
          AND gxeh.source_line_ID = RCVT.TRANSACTION_ID(+)
          AND gxeh.organization_id = rcvt.organization_id(+)
          AND XAH.event_id = gxeh.event_id(+)
          AND XAH.LEDGER_ID = gxeh.LEDGER_ID(+)
          AND XAL.AE_HEADER_ID = XAH.AE_HEADER_ID(+)
          AND xal.code_combination_id = cc.code_combination_id(+)
          AND XAH.JE_CATEGORY_NAME = CAT.CODE(+)
          AND CAT.APPLICATION_ID = 101
          --AND XAH.ledger_id = 2043
          AND CC.SEGMENT4 = FLEX.FLEX_VALUE_MEANING(+)
          AND GXEH.ORGANIZATION_ID = MST.ORGANIZATION_ID(+)
          AND GXEH.INVENTORY_ITEM_ID = MST.INVENTORY_ITEM_ID(+)
          AND GXEH.ORGANIZATION_ID(+)= ORG.ORGANIZATION_ID
          -- AND MIC.INVENTORY_ITEM_ID = MST.INVENTORY_ITEM_ID
          --AND MCB.STRUCTURE_ID = 101
          AND XAH.APPLICATION_ID = 555
          --AND ORG.OPERATING_UNIT IN (526,527)
          --AND MCB.CATEGORY_ID = MIC.CATEGORY_ID
          --AND (NVL (XAL.ACCOUNTED_DR, 0) <> 0
          --   OR NVL (XAL.ACCOUNTED_CR, 0) <> 0)
          AND FLEX.FLEX_VALUE_SET_ID = 1016490
   UNION ALL
   SELECT 2 UNION_PART,
          ORG.OPERATING_UNIT ORG_ID,
          OU.NAME OU_NAME,
          XAH.PERIOD_NAME,
          gxeh.LEGAL_ENTITY_ID,
          XAH.ACCOUNTING_ENTRY_STATUS_CODE,
          XAH.GL_TRANSFER_STATUS_CODE,
          XAH.APPLICATION_ID,
          'INV' JE_SOURCE,
          CAT.NAME JE_CATEGORY,
          CC.SEGMENT1 GL_LE,
          XAL.ACCOUNTING_CLASS_CODE,
          gxeh.EVENT_CLASS_CODE,
          gxeh.ENTITY_CODE,
          XAH.EVENT_TYPE_CODE,
          CC.SEGMENT2 GL_UNIT,
          CC.SEGMENT3 GL_CC,
          CC.SEGMENT4 GL_ACC,
          CC.SEGMENT5 GL_SL,
          EAM_FLEX_SL_DESC (CC.SEGMENT4, CC.SEGMENT5) GL_SL_DESC,
          CC.SEGMENT6 GL_PROJECT,
          CC.SEGMENT7 GL_IC,
          FLEX.DESCRIPTION ACCTDESC,
          gxeh.source_line_ID VOUCHER_NUMBER,
          NULL GL_VOUCHER_NUMBER,
          XAH.AE_HEADER_ID,
          XAL.AE_LINE_NUM GL_JE_LINE_NUM,
          XAL.ACCOUNTING_DATE VOUCHER_DATE,
          NULL PARTICULARS,
          XAL.ENTERED_DR,
          XAL.ENTERED_CR,
          XAL.ACCOUNTED_DR,
          XAL.ACCOUNTED_CR,
          NULL CHEQUE_NUMBER,
          TRUNC (SYSDATE) CHEQUE_DATE,
          TO_CHAR (NULL) PARTY_CODE,
          TO_CHAR (NULL) PARTY_NAME,
          --ENTITY_CODE TRANSACTION_TYPE,
          CC.CHART_OF_ACCOUNTS_ID,
          xah.LEDGER_ID,
          NULL DFF_CONTEXT,
          TO_CHAR (NULL) PO_NUM,
          TO_NUMBER (0) PO_HEADER_ID,                            --PO.SEGMENT1
          NULL INTER_ORG_SHIPMENT_NUM,
          NULL ATTRIBUTE3,
          NULL ATTRIBUTE4,
          NULL ATTRIBUTE5,
          ORG.ORGANIZATION_ID,
          ORG.ORGANIZATION_CODE,
          ORG.ORGANIZATION_NAME,
          TO_NUMBER (0) INVENTORY_ITEM_ID,
          TO_CHAR (NULL) ITEM_CODE_SEGMENT1,
          TO_CHAR (NULL) ITEM_CODE_SEGMENT2,
          TO_CHAR (NULL) ITEM_CODE_SEGMENT3,
          TO_CHAR (NULL) ITEM_CODE_SEGMENT4,
          TO_CHAR (NULL) ITEM_CODE_SEGMENT5,
          TO_CHAR (NULL) ITEM_CODE_SEGMENT6,
          TO_CHAR (NULL) CONCAT_ITEM_CODE,
          TO_CHAR (NULL) INVENTORY_ITEM_NAME,
          TO_CHAR (NULL) ITEM_CATEGORY_SEGMENT1,
          TO_CHAR (NULL) ITEM_CATEGORY_SEGMENT2,
          TO_CHAR (NULL) ITEM_CATEGORY_SEGMENT3,
          TO_CHAR (NULL) FIN_CAT1,
          TO_CHAR (NULL) FIN_CAT2,
          TO_CHAR (NULL) GOODS_RECEIPT_NUM,
          gxeh.REFERENCE_NO,
          gxeh.EVENT_ID,
          gxeh.TRANSACTION_ID,
          gxeh.TRANSACTION_TYPE_ID,
          gxeh.TRANSACTION_UOM,
          gxeh.TXN_SOURCE,
          gxeh.LOT_NUMBER,
          gxeh.TRANSACTION_CURRENCY,
          gxeh.CURRENCY_CONVERSION_RATE,
          gxeh.TRANSACTION_DATE,
          gxeh.TRANSACTION_QUANTITY,
          gxeh.TRANSACTION_VALUE,
          gxeh.SOURCE_DOCUMENT_ID,
          gxeh.SOURCE_LINE_ID,
          0 FA_ASSET_ID,
          0 SHIPMENT_HEADER_ID,
          0 SHIPMENT_LINE_ID,
          0 RCV_TRANSACTION_ID,
          0 PO_LINE_ID,
          0 PO_LINE_LOCATION_ID,
          0 LC_ID,
          TO_CHAR (NULL) LC_NUM,
          TO_CHAR (NULL) BL_NUM,
          TO_DATE (NULL) BL_DATE,
          gxeh.SOURCE_DOCUMENT_ID PROD_BATCH_NO,
          TO_NUMBER (NULL) LCM_ADJ_NUM,
          TO_NUMBER (NULL) GMF_HEADER_ID,
          (SELECT TRANSACTION_TYPE_NAME
             FROM MTL_TRANSACTION_TYPES
            WHERE TRANSACTION_TYPE_ID = gxeh.TRANSACTION_TYPE_ID)
             AS TRANSACTION_TYPE_NAME,
          gxeh.TRANSACTION_ACTION_ID
     FROM gmf_xla_extract_headers gxeh,
          XLA_AE_LINES XAL,
          XLA_AE_HEADERS XAH,
          GL_LEDGERS LED,
          FND_DOC_SEQUENCE_CATEGORIES CAT,
          gl_code_combinations cc,
          FND_FLEX_VALUES_VL FLEX,
          ORG_ORGANIZATION_DEFINITIONS ORG,
          HR_OPERATING_UNITS OU
    WHERE     XAH.event_id = gxeh.event_id
          --AND xah.ledger_id = 2043
          AND ORG.OPERATING_UNIT = OU.ORGANIZATION_ID
          AND EVENT_CLASS_CODE = 'BATCH_CLOSE'
          AND LED.LEDGER_ID = XAH.LEDGER_ID(+)
          AND LED.LEDGER_CATEGORY_CODE = 'PRIMARY'
          AND XAH.LEDGER_ID = gxeh.LEDGER_ID(+)
          AND XAL.AE_HEADER_ID = XAH.AE_HEADER_ID(+)
          AND ORG.ORGANIZATION_ID(+) = gxeh.ORGANIZATION_ID
          AND xal.code_combination_id = cc.code_combination_id(+)
          AND XAH.JE_CATEGORY_NAME = CAT.CODE(+)
          AND CAT.APPLICATION_ID = 101
          AND CC.SEGMENT4 = FLEX.FLEX_VALUE_MEANING
          AND XAH.APPLICATION_ID = 555
          --AND ORG.OPERATING_UNIT IN (526,527)
          --AND MCB.CATEGORY_ID = MIC.CATEGORY_ID
          --          AND (NVL (XAL.ACCOUNTED_DR, 0) <> 0
          --             OR NVL (XAL.ACCOUNTED_CR, 0) <> 0)
          AND FLEX.FLEX_VALUE_SET_ID = 1016490
)
 WHERE 1=1
  AND GL_LE = NVL(:P_LEGAL_ENTITY, GL_LE) --101
  AND GL_UNIT = NVL(:P_OPERATING_UNIT, GL_UNIT) --01
  AND ORGANIZATION_ID= NVL(:P_ORGANIZATION_ID, ORGANIZATION_ID)
   AND  TO_CHAR(TO_DATE(PERIOD_NAME,'MON-YY'),'MON-YY') = NVL(:P_PERIOD_CODE,  TO_CHAR(TO_DATE(PERIOD_NAME,'MON-YY'),'MON-YY') )
AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
--AND EVENT_TYPE_CODE IN ('CERT', 'GLCOSTALOC') 
--and TRANSACTION_UOM = 'MT'
AND ACCOUNTED_DR IS NOT NULL
--and TRANSACTION_VALUE <> 0
and TRANSACTION_TYPE_NAME  IN ( 'WIP Completion', 'WIP Completion Return', 'WIP Byproduct Return', 'WIP Byproduct Completion')  

GROUP BY GL_LE,GL_UNIT,GL_CC,GL_ACC, GL_SL,CONCAT_ITEM_CODE,TRANSACTION_TYPE_NAME,ACCOUNTING_CLASS_CODE,JE_CATEGORY,EVENT_TYPE_CODE,ORGANIZATION_ID,INVENTORY_ITEM_ID,TRANSACTION_UOM --, TRANSACTION_TYPE_NAME--,TRANSACTION_TYPE_NAME,EVENT_TYPE_CODE
ORDER BY CONCAT_ITEM_CODE



--=========================== INVOICE DATA FOR RAHAT SIR : AMOUNT TAKEN FROM AP_INVOICE_DISTRIBUTIONS====================================
SELECT SEGMENT1||'.'||SEGMENT2||'.'||SEGMENT3||'.'||SEGMENT4||'.'||SEGMENT5||'.'||SEGMENT6||'.'||SEGMENT7||'.'||SEGMENT8||'.'||SEGMENT9||'.'||SEGMENT10 
FROM GL_CODE_COMBINATIONS 

SELECT DESCRIPTION, BASE_AMOUNT

SELECT XEP.LEGAL_ENTITY_IDENTIFIER LE_ID,
A.ORG_ID , XX_GET_HR_OPERATING_UNIT (A.ORG_ID) UNIT,
XX_GET_EMP_NAME_FROM_USER_ID (A.CREATED_BY) CREATED_BY,
TO_CHAR(TRUNC(A.CREATION_DATE),'DD-MON-RRRR') CREATION_DATE ,
TO_CHAR(TRUNC(A.GL_DATE),'DD-MON-RRRR') GL_DATE ,
GC.SEGMENT1||'.'||GC.SEGMENT2||'.'||GC.SEGMENT3||'.'||GC.SEGMENT4||'.'||GC.SEGMENT5||'.'||GC.SEGMENT6||'.'||GC.SEGMENT7||'.'||GC.SEGMENT8||'.'||GC.SEGMENT9||'.'||GC.SEGMENT10 GL_CODE, 
XX_AP_PKG.GET_ACCOUNT_DESC_FROM_CCID (GC.CODE_COMBINATION_ID) ACCOUNT_NAME,
A.INVOICE_ID , 
A.DOC_SEQUENCE_VALUE VOUCHER_NUMBER,
B.DESCRIPTION, 
          GREATEST (NVL (B.BASE_AMOUNT, B.AMOUNT), 0) DR_AMOUNT,
          (0 - (LEAST (NVL (B.BASE_AMOUNT, B.AMOUNT), 0))) CR_AMOUNT
 FROM AP_INVOICES_ALL  A, AP_INVOICE_DISTRIBUTIONS_ALL B, GL_CODE_COMBINATIONS GC, xle_entity_profiles   xep
WHERE A.INVOICE_ID =  B.INVOICE_ID
 AND B.DIST_CODE_COMBINATION_ID = GC.CODE_COMBINATION_ID
AND  A.ORG_ID = B.ORG_ID
and A.LEGAL_ENTITY_ID = XEP.LEGAL_ENTITY_ID
and A.LEGAL_ENTITY_ID IN (26280,
26281)
--AND A.ORG_ID IN(102,103)
--and a.creation_date 
         AND (:P_FROM_DATE IS NULL OR TRUNC( A.CREATION_DATE ) BETWEEN :P_FROM_DATE AND :P_TO_DATE)
           AND NVL (B.REVERSAL_FLAG, 'N') <> 'Y'
          AND NVL (B.BASE_AMOUNT, B.AMOUNT) <> 0
          AND XX_GET_INVOICE_STATUS (A.INVOICE_ID) NOT IN
                 ('Needs Revalidation', 'Never Validated')
--AND A.invoice_id= 307033 


--=====================================================================================

-- query to add GRN NUMBER AGAINST XLA_AE_HEADERS TABLE''S AE_HEADER_ID

SELECT  DISTINCT  RH.RECEIPT_NUM, AE_HEADER_ID --, XX_GET_RECEIPT_NUMBER_FROM_INV (aia.invoice_id )
-- aia.INVOICE_ID , XAH.AE_HEADER_ID, RH.RECEIPT_NUM,
--(select DISTINCT RH.RECEIPT_NUM FROM RCV_SHIPMENT_HEADERS RH, RCV_SHIPMENT_LINES RL, AP_INVOICE_LINES_ALL AL
--WHERE RH.SHIPMENT_HEADER_ID = RL.SHIPMENT_HEADER_ID
--and AL.RCV_SHIPMENT_LINE_ID = RL.SHIPMENT_LINE_ID 
--and AIA.INVOICE_ID= AL.INVOICE_ID
--AND RL.SHIPMENT_LINE_ID = 19001),
--aia.INVOICE_NUM ,
--aia.INVOICE_DATE ,
--aia.INVOICE_AMOUNT ,
--aia.INVOICE_CURRENCY_CODE ,
--aia.PAYMENT_CURRENCY_CODE ,
--aia.GL_DATE ,
--xah.PERIOD_NAME ,
--aia.PAYMENT_METHOD_CODE ,
--xah.JE_CATEGORY_NAME
FROM ap.ap_invoices_all aia, AP_INVOICE_LINES_ALL AL, RCV_SHIPMENT_LINES RL, RCV_SHIPMENT_HEADERS RH,
xla.xla_transaction_entities XTE,
xla.xla_events xev,
xla.xla_ae_headers XAH
--xla.xla_ae_lines XAL,
--GL_IMPORT_REFERENCES gir,
--gl_je_headers gjh,
--gl_je_lines gjl,
--gl_code_combinations gcc
WHERE aia.INVOICE_ID = xte.source_id_int_1
and AIA.INVOICE_ID= AL.INVOICE_ID
and AL.RCV_SHIPMENT_LINE_ID = RL.SHIPMENT_LINE_ID 
and RH.SHIPMENT_HEADER_ID = RL.SHIPMENT_HEADER_ID
AND xev.entity_id = xte.entity_id
AND xah.entity_id = xte.entity_id
AND XAH.AE_HEADER_ID= 27181884 
--and aia.invoice_id= 1273132 --237080


select * from AP_INVOICES_ALL WHERE DOC_SEQUENCE_VALUE=180001924 and ORG_ID= 81

select * from AP_INVOICE_LINES_ALL WHERE INVOICE_ID=  373210

select * from AP_INVOICE_DISTRIBUTIONS_ALL WHERE INVOICE_ID=  373210

and AE_HEADER_ID IN
(27186252,
27181884,
27181885,
27181886,
24728299) --= 16199209


80000690
80000716
80000670

XX_OPOSITE_HEAD_FUNCTION

-- Query to Link AP Invoices, GL and SLA Tables: R12 AP GL XLA

SELECT   SUM (xal.accounted_cr), SUM (xal.accounted_dr), aia.invoice_amount,
         invoice_num
    FROM ap_invoices_all aia,
         xla.xla_transaction_entities xte,
         xla_ae_headers xah,
         xla_ae_lines xal,
         gl.gl_import_references gir,
         gl_je_lines gjl,
         gl_je_headers gjh
   WHERE 1 = 1
     AND aia.invoice_id = NVL ("SOURCE_ID_INT_1", (-99))
     AND xte.entity_code = 'AP_INVOICES'
     AND xte.application_id = 200
     AND xte.entity_id = xah.entity_id
     AND xah.ae_header_id = xal.ae_header_id
     AND xal.gl_sl_link_id = gir.gl_sl_link_id
     AND xal.gl_sl_link_table = gir.gl_sl_link_table
     AND gir.je_header_id = gjl.je_header_id
     AND gir.je_line_num = gjl.je_line_num
     AND gjl.je_header_id = gjh.je_header_id
  --   AND aia.invoice_num = INVNO4567   Invoice Num
GROUP BY aia.invoice_num, aia.invoice_amount







4181010014572

select * from  PO_REQUISITION_HEADERS_ALL WHERE SEGMENT1= 10000007 and ORG_ID= 81 

select * from PO_REQUISITION_LINES_ALL WHERE REQUISITION_HEADER_ID = 15001

select * from  RCV_SHIPMENT_HEADERS WHERE SHIPMENT_num= '4181010006610'

select * from RCV_SHIPMENT_LINES 
WHERE 1=1 --SHIPMENT_HEADER_ID= 336150 
--and FROM_ORGANIZATION_ID = 121
and PO_HEADER_ID is not null   

--=============================== AP ACCRUAL V4 : ADDED AP_INVOICE AND AR_INVOICE NUMBER IN QUERY===================

-- ACCOUNT WISE LEDGER FOR APP ACCRUAL  2,456 data
SELECT D.BAL_SEG,   GET_INV_NUM_FROM_AR_INVOICE(E.OPERATING_UNIT, GET_AR_INV_FROM_CHALLANNO( (CASE WHEN  RECEIPT_SOURCE_CODE ='INTERNAL ORDER' THEN SHIPMENT_NUM WHEN RECEIPT_SOURCE_CODE =  'INVENTORY' THEN SHIPMENT_NUM
WHEN RECEIPT_SOURCE_CODE ='VENDOR' THEN  'PO-'||''||GET_PO_NO_FROM_SHIPMNT_HDR_ID(f.shipment_header_id) 
else null  END))) INERNAL_INV_VOUCHER,
GET_AR_INV_FROM_CHALLANNO( (CASE WHEN  RECEIPT_SOURCE_CODE ='INTERNAL ORDER' THEN SHIPMENT_NUM WHEN RECEIPT_SOURCE_CODE =  'INVENTORY' THEN SHIPMENT_NUM
WHEN RECEIPT_SOURCE_CODE ='VENDOR' THEN  'PO-'||''||GET_PO_NO_FROM_SHIPMNT_HDR_ID(f.shipment_header_id) 
else null  END)) INTERNAL_AR_VOUCHER,
--GET_ORG_CODE_FROM_ID(F.ORGANIZATION_ID) "FROM ORG", 
--GET_ORG_CODE_FROM_ID(F.SHIP_TO_ORG_ID) "TO_ORG",
D.BAL_SEG_NAME,B.LEDGER_ID,A.ACCOUNTING_DATE, F.RECEIPT_SOURCE_CODE, --G.PO_HEADER_ID,
(CASE WHEN  RECEIPT_SOURCE_CODE ='INTERNAL ORDER' THEN SHIPMENT_NUM WHEN RECEIPT_SOURCE_CODE =  'INVENTORY' THEN SHIPMENT_NUM
WHEN RECEIPT_SOURCE_CODE ='VENDOR' THEN  'PO-'||''||GET_PO_NO_FROM_SHIPMNT_HDR_ID(f.shipment_header_id) 
else null  END) SHIPMENT_NUMBER,
--DECODE(A.APPLICATION_ID, 200,'AP-'||DOC_SEQUENCE_VALUE, 222,'AR-'||DOC_SEQUENCE_VALUE, DOC_SEQUENCE_VALUE) VOUCHER_NUMBER,
 DECODE(B.EVENT_TYPE_CODE, 'REFUND RECORDED','AP PAY','PAYMENT CREATED','AP PAY','PAYMENT CLEARED','AP PAY','PAYMENT CANCELLED','AP PAY','REFUND CANCELLED','AP PAY','PAYMENT UNCLEARED','AP PAY',
          'PREPAYMENT APPLIED','AP INV','PREPAYMENT CANCELLED','AP INV','CREDIT MEMO VALIDATED','AP INV','INVOICE CANCELLED','AP INV',
          'PREPAYMENT UNAPPLIED','AP INV','INVOICE VALIDATED','AP INV','PREPAYMENT VALIDATED','AP INV','CREDIT MEMO CANCELLED','AP INV',
          'CM_CREATE','AR INV','DM_CREATE','AR INV','INV_CREATE','AR INV','CM_UPDATE','AR INV','RECP_CREATE','AR RCV',
          'MISC_RECP_CREATE','AR RCV','MISC_RECP_REVERSE','AR RCV','RECP_REVERSE','AR RCV','RECP_UPDATE','AR RCV',NULL)
          ||DECODE(DOC_SEQUENCE_VALUE,NULL,NULL,'-'||DOC_SEQUENCE_VALUE)
          ||DECODE(B.EVENT_TYPE_CODE,'CE_BAT_CLEARED','CM'||'-'||SUBSTR(B.DESCRIPTION,62,5),NULL)  VOUCHER_NUMBER , F.receipt_num
           ,B.EVENT_TYPE_CODE,A.AE_HEADER_ID, A.APPLICATION_ID,
           ( CASE WHEN RECEIPT_SOURCE_CODE ='VENDOR' THEN TO_CHAR(GET_VENDOR_FROM_SHIPMNT_HDR_ID(f.shipment_header_id)) else  (SELECT OPERATING_UNIT_NAME FROM WBI_INV_ORG_DETAIL WHERE INV_ORGANIZATION_ID = F.ORGANIZATION_ID)  end) INTERNAL_SUPPLIER,
           ---- GET_VENDOR_FROM_SHIPMNT_HDR_ID(P_PO_HEADER_ID IN NUMBER)
           XX_PARTY_VENDOR_NAME_FUNCTION(A.APPLICATION_ID, PARTY_ID) PARTY_VENDOR_NAME,B.JE_CATEGORY_NAME,
           SEGMENT4,
XX_GET_ACCT_FLEX_SEG_DESC(4,SEGMENT4) ACCOUNT_DESC, 
XX_GET_ACCT_FLEX_SEG_DESC (5, SEGMENT5,SEGMENT4) SUB_ACCOUNT,
PARTY_ID,
           XX_OPOSITE_HEAD_FUNCTION(:P_ACCOUNT_CODE, A.AE_HEADER_ID) OPOSITE_HEAD,
     DECODE( XX_AP_DFF_FUNCTION(DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id) ,  NULL , NULL, XX_AP_DFF_FUNCTION(DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id)||'.')
    ||   DECODE(XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID) ,  NULL , NULL, XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID)||'.' )
    ||   DECODE(XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
     XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ) 
   ||   DECODE( XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
    XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ) DFF_INFO,
        NVL(SUM(ACCOUNTED_DR),0) DR_AMT,NVL(SUM(ACCOUNTED_CR),0) CR_AMT 
           FROM XLA_AE_LINES A, XLA_AE_HEADERS B, GL_CODE_COMBINATIONS C, XX_BAL_SEG_INFO D, GMF_XLA_EXTRACT_HEADERS E, RCV_SHIPMENT_HEADERS F --, RCV_SHIPMENT_LINES G
           WHERE  E.SOURCE_DOCUMENT_ID (+)= F.SHIPMENT_HEADER_ID
          -- AND F.SHIPMENT_HEADER_ID= G.SHIPMENT_HEADER_ID
           and B.EVENT_ID =E.EVENT_ID 
           AND C.CODE_COMBINATION_ID=A.CODE_COMBINATION_ID
           AND  A.AE_HEADER_ID=B.AE_HEADER_ID
           AND SEGMENT4=:P_ACCOUNT_CODE
           AND B.LEDGER_ID=D.LEDGER_ID
           AND A.ACCOUNTING_DATE BETWEEN :P_DATE_FROM AND :P_DATE_TO
           AND A.ACCOUNTING_DATE > '31-AUG-2018'
           AND BAL_SEG=:P_BAL_SEG
          -- and  B.JE_CATEGORY_NAME= 'INTE'
          -- and a.AE_HEADER_ID=31534900 
AND SEGMENT5=NVL(:P_SUB_ACC,SEGMENT5)
--and (CASE WHEN  RECEIPT_SOURCE_CODE ='INTERNAL ORDER' THEN SHIPMENT_NUM WHEN RECEIPT_SOURCE_CODE =  'INVENTORY' THEN SHIPMENT_NUM
--WHEN RECEIPT_SOURCE_CODE ='VENDOR' THEN  'PO-'||''||GET_PO_NO_FROM_SHIPMNT_HDR_ID(f.shipment_header_id) 
--else null  END) = '4191010042724'
           GROUP BY 
           D.BAL_SEG, D.BAL_SEG_NAME,B.LEDGER_ID,A.ACCOUNTING_DATE,
            DECODE(B.EVENT_TYPE_CODE, 'REFUND RECORDED','AP PAY','PAYMENT CREATED','AP PAY','PAYMENT CLEARED','AP PAY','PAYMENT CANCELLED','AP PAY','REFUND CANCELLED','AP PAY',
          'PREPAYMENT APPLIED','AP INV','PREPAYMENT CANCELLED','AP INV','CREDIT MEMO VALIDATED','AP INV','INVOICE CANCELLED','AP INV',
          'PREPAYMENT UNAPPLIED','AP INV','INVOICE VALIDATED','AP INV','PREPAYMENT VALIDATED','AP INV','CREDIT MEMO CANCELLED','AP INV',
          'CM_CREATE','AR INV','DM_CREATE','AR INV','INV_CREATE','AR INV','CM_UPDATE','AR INV','RECP_CREATE','AR RCV',
          'MISC_RECP_CREATE','AR RCV','MISC_RECP_REVERSE','AR RCV','RECP_REVERSE','AR RCV','RECP_UPDATE','AR RCV')||'-'|| DOC_SEQUENCE_VALUE,DOC_SEQUENCE_VALUE,B.DESCRIPTION
           ,B.EVENT_TYPE_CODE,A.AE_HEADER_ID, A.APPLICATION_ID,XX_PARTY_VENDOR_NAME_FUNCTION(A.APPLICATION_ID, PARTY_ID) ,
          B.JE_CATEGORY_NAME,
           SEGMENT4,XX_GET_ACCT_FLEX_SEG_DESC(4,SEGMENT4) , PARTY_ID,
          XX_OPOSITE_HEAD_FUNCTION(:P_ACCOUNT_CODE, A.AE_HEADER_ID),
        DECODE( XX_AP_DFF_FUNCTION(DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id) ,  NULL , NULL, XX_AP_DFF_FUNCTION(DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id)||'.')
     ||   DECODE( XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID) ,  NULL , NULL, XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID)||'.' )
     ||   DECODE( XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
    XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ) 
    ||   DECODE( XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
    XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ),
    XX_GET_ACCT_FLEX_SEG_DESC (5, SEGMENT5,SEGMENT4),F.receipt_num,RECEIPT_SOURCE_CODE,SHIPMENT_NUM,F.SHIP_TO_ORG_ID, f.shipment_header_id ,F.ORGANIZATION_ID,E.OPERATING_UNIT --,G.PO_HEADER_ID              
UNION ALL 
-- ACCOUNT WISE LEDGER FOR APP ACCRUAL  2,456 data
SELECT --AIL.BASE_AMOUNT,AIL.RCV_SHIPMENT_LINE_ID, 
--GET_GRN_FROM_SHIPMNT_LINE_ID(AIL.RCV_SHIPMENT_LINE_ID) GRN_NUMBER,
D.BAL_SEG, NULL INERNAL_INV_VOUCHER, NULL INTERNAL_AR_VOUCHER,D.BAL_SEG_NAME,B.LEDGER_ID,A.ACCOUNTING_DATE,NULL RECEIPT_SOURCE_CODE, NULL SHIPMENT_NUMBER,
--DECODE(A.APPLICATION_ID, 200,'AP-'||DOC_SEQUENCE_VALUE, 222,'AR-'||DOC_SEQUENCE_VALUE, DOC_SEQUENCE_VALUE) VOUCHER_NUMBER
 DECODE(B.EVENT_TYPE_CODE, 'REFUND RECORDED','AP PAY','PAYMENT CREATED','AP PAY','PAYMENT CLEARED','AP PAY','PAYMENT CANCELLED','AP PAY','REFUND CANCELLED','AP PAY','PAYMENT UNCLEARED','AP PAY',
          'PREPAYMENT APPLIED','AP INV','PREPAYMENT CANCELLED','AP INV','CREDIT MEMO VALIDATED','AP INV','INVOICE CANCELLED','AP INV',
          'PREPAYMENT UNAPPLIED','AP INV','INVOICE VALIDATED','AP INV','PREPAYMENT VALIDATED','AP INV','CREDIT MEMO CANCELLED','AP INV',
          'CM_CREATE','AR INV','DM_CREATE','AR INV','INV_CREATE','AR INV','CM_UPDATE','AR INV','RECP_CREATE','AR RCV',
          'MISC_RECP_CREATE','AR RCV','MISC_RECP_REVERSE','AR RCV','RECP_REVERSE','AR RCV','RECP_UPDATE','AR RCV',NULL)
          ||DECODE(B.DOC_SEQUENCE_VALUE,NULL,NULL,'-'||B.DOC_SEQUENCE_VALUE)
          ||DECODE(B.EVENT_TYPE_CODE,'CE_BAT_CLEARED','CM'||'-'||SUBSTR(B.DESCRIPTION,62,5),NULL)  VOUCHER_NUMBER , TO_CHAR(GET_GRN_FROM_SHIPMNT_LINE_ID(AIL.RCV_SHIPMENT_LINE_ID)) RECEIPT_NUM
          --GET_GRN_FROM_SHIPMNT_LINE_ID(AIL.RCV_SHIPMENT_LINE_ID) RECEIPT_NUM
           ,B.EVENT_TYPE_CODE,A.AE_HEADER_ID, A.APPLICATION_ID, NULL,
           XX_PARTY_VENDOR_NAME_FUNCTION(A.APPLICATION_ID, A.PARTY_ID) PARTY_VENDOR_NAME,B.JE_CATEGORY_NAME,
           SEGMENT4,
XX_GET_ACCT_FLEX_SEG_DESC(4,SEGMENT4) ACCOUNT_DESC, 
XX_GET_ACCT_FLEX_SEG_DESC (5, SEGMENT5,SEGMENT4) SUB_ACCOUNT,
A.PARTY_ID,
           XX_OPOSITE_HEAD_FUNCTION(:P_ACCOUNT_CODE, A.AE_HEADER_ID) OPOSITE_HEAD,
     DECODE( XX_AP_DFF_FUNCTION(B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id) ,  NULL , NULL, XX_AP_DFF_FUNCTION(B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id)||'.')
    ||   DECODE(XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID) ,  NULL , NULL, XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID)||'.' )
    ||   DECODE(XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
     XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ) 
   ||   DECODE( XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
    XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ) DFF_INFO,
    (CASE WHEN  DECODE(B.EVENT_TYPE_CODE, 'REFUND RECORDED','AP PAY','PAYMENT CREATED','AP PAY','PAYMENT CLEARED','AP PAY','PAYMENT CANCELLED','AP PAY','REFUND CANCELLED','AP PAY','PAYMENT UNCLEARED','AP PAY',
          'PREPAYMENT APPLIED','AP INV','PREPAYMENT CANCELLED','AP INV','CREDIT MEMO VALIDATED','AP INV','INVOICE CANCELLED','AP INV',
          'PREPAYMENT UNAPPLIED','AP INV','INVOICE VALIDATED','AP INV','PREPAYMENT VALIDATED','AP INV','CREDIT MEMO CANCELLED','AP INV',
          'CM_CREATE','AR INV','DM_CREATE','AR INV','INV_CREATE','AR INV','CM_UPDATE','AR INV','RECP_CREATE','AR RCV',
          'MISC_RECP_CREATE','AR RCV','MISC_RECP_REVERSE','AR RCV','RECP_REVERSE','AR RCV','RECP_UPDATE','AR RCV',NULL)
          ||DECODE(B.DOC_SEQUENCE_VALUE,NULL,NULL,'-'||B.DOC_SEQUENCE_VALUE)
          ||DECODE(B.EVENT_TYPE_CODE,'CE_BAT_CLEARED','CM'||'-'||SUBSTR(B.DESCRIPTION,62,5),NULL) IS NOT NULL THEN AIL.BASE_AMOUNT ELSE NVL(SUM(ACCOUNTED_DR),0) END ) DR_AMT,
       -- NVL(SUM(ACCOUNTED_DR),0) DR_AMT,
        NVL(SUM(ACCOUNTED_CR),0) CR_AMT 
 FROM XLA_AE_LINES A, XLA_AE_HEADERS B, GL_CODE_COMBINATIONS C, XX_BAL_SEG_INFO D, xla.xla_transaction_entities XTE,ap_invoices_all aia,AP_INVOICE_LINES_ALL AIL,
xla.xla_events xev
           WHERE C.CODE_COMBINATION_ID=A.CODE_COMBINATION_ID
           AND  A.AE_HEADER_ID=B.AE_HEADER_ID
           AND SEGMENT4=:P_ACCOUNT_CODE
           AND B.LEDGER_ID=D.LEDGER_ID
           AND A.ACCOUNTING_DATE BETWEEN :P_DATE_FROM AND :P_DATE_TO
           AND A.ACCOUNTING_DATE > '31-AUG-2018'
           AND BAL_SEG=:P_BAL_SEG
           and XX_PARTY_VENDOR_NAME_FUNCTION(A.APPLICATION_ID, A.PARTY_ID) is not null
--           and ( DECODE(B.EVENT_TYPE_CODE, 'REFUND RECORDED','AP PAY','PAYMENT CREATED','AP PAY','PAYMENT CLEARED','AP PAY','PAYMENT CANCELLED','AP PAY','REFUND CANCELLED','AP PAY','PAYMENT UNCLEARED','AP PAY',
--          'PREPAYMENT APPLIED','AP INV','PREPAYMENT CANCELLED','AP INV','CREDIT MEMO VALIDATED','AP INV','INVOICE CANCELLED','AP INV',
--          'PREPAYMENT UNAPPLIED','AP INV','INVOICE VALIDATED','AP INV','PREPAYMENT VALIDATED','AP INV','CREDIT MEMO CANCELLED','AP INV',
--          'CM_CREATE','AR INV','DM_CREATE','AR INV','INV_CREATE','AR INV','CM_UPDATE','AR INV','RECP_CREATE','AR RCV',
--          'MISC_RECP_CREATE','AR RCV','MISC_RECP_REVERSE','AR RCV','RECP_REVERSE','AR RCV','RECP_UPDATE','AR RCV',NULL)
--          ||DECODE(B.DOC_SEQUENCE_VALUE,NULL,NULL,'-'||B.DOC_SEQUENCE_VALUE)
--          ||DECODE(B.EVENT_TYPE_CODE,'CE_BAT_CLEARED','CM'||'-'||SUBSTR(B.DESCRIPTION,62,5),NULL) ) = 'AP INV-180002020'
AND SEGMENT5=NVL(:P_SUB_ACC,SEGMENT5) -- 31557546 31532083
and aia.INVOICE_ID = xte.source_id_int_1
and AIA.INVOICE_ID= AIL.INVOICE_ID
AND xev.entity_id = xte.entity_id
AND B.entity_id = xte.entity_id
and AIL.BASE_AMOUNT is not null
           GROUP BY 
           D.BAL_SEG, D.BAL_SEG_NAME,B.LEDGER_ID,A.ACCOUNTING_DATE,
            DECODE(B.EVENT_TYPE_CODE, 'REFUND RECORDED','AP PAY','PAYMENT CREATED','AP PAY','PAYMENT CLEARED','AP PAY','PAYMENT CANCELLED','AP PAY','REFUND CANCELLED','AP PAY',
          'PREPAYMENT APPLIED','AP INV','PREPAYMENT CANCELLED','AP INV','CREDIT MEMO VALIDATED','AP INV','INVOICE CANCELLED','AP INV',
          'PREPAYMENT UNAPPLIED','AP INV','INVOICE VALIDATED','AP INV','PREPAYMENT VALIDATED','AP INV','CREDIT MEMO CANCELLED','AP INV',
          'CM_CREATE','AR INV','DM_CREATE','AR INV','INV_CREATE','AR INV','CM_UPDATE','AR INV','RECP_CREATE','AR RCV',
          'MISC_RECP_CREATE','AR RCV','MISC_RECP_REVERSE','AR RCV','RECP_REVERSE','AR RCV','RECP_UPDATE','AR RCV')||'-'|| B.DOC_SEQUENCE_VALUE,B.DOC_SEQUENCE_VALUE,B.DESCRIPTION
           ,B.EVENT_TYPE_CODE,A.AE_HEADER_ID, A.APPLICATION_ID,XX_PARTY_VENDOR_NAME_FUNCTION(A.APPLICATION_ID, A.PARTY_ID) ,
          B.JE_CATEGORY_NAME,
           C.SEGMENT4,XX_GET_ACCT_FLEX_SEG_DESC(4,C.SEGMENT4) , A.PARTY_ID,
          XX_OPOSITE_HEAD_FUNCTION(:P_ACCOUNT_CODE, A.AE_HEADER_ID),
        DECODE( XX_AP_DFF_FUNCTION(B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id) ,  NULL , NULL, XX_AP_DFF_FUNCTION(B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id)||'.')
     ||   DECODE( XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID) ,  NULL , NULL, XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID)||'.' )
     ||   DECODE( XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
    XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ) 
    ||   DECODE( XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
    XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ),
    XX_GET_ACCT_FLEX_SEG_DESC (5, SEGMENT5,SEGMENT4),B.AE_HEADER_ID , AIL.BASE_AMOUNT, AIL.RCV_SHIPMENT_LINE_ID    
--   )
 --group by VOUCHER_NUMBER 

--===============================AP ACCRUAL V3 Final : HERE ADDED AP_INVOICELINES TO CAPTURE THE AMOUNT FROM LINE LEVEL=============


-- ACCOUNT WISE LEDGER FOR APP ACCRUAL  2,456 data
SELECT D.BAL_SEG,   
--GET_ORG_CODE_FROM_ID(F.ORGANIZATION_ID) "FROM ORG", 
--GET_ORG_CODE_FROM_ID(F.SHIP_TO_ORG_ID) "TO_ORG",
D.BAL_SEG_NAME,B.LEDGER_ID,A.ACCOUNTING_DATE, F.RECEIPT_SOURCE_CODE, --G.PO_HEADER_ID,
(CASE WHEN  RECEIPT_SOURCE_CODE ='INTERNAL ORDER' THEN SHIPMENT_NUM WHEN RECEIPT_SOURCE_CODE =  'INVENTORY' THEN SHIPMENT_NUM
WHEN RECEIPT_SOURCE_CODE ='VENDOR' THEN  'PO-'||''||GET_PO_NO_FROM_SHIPMNT_HDR_ID(f.shipment_header_id) 
else null  END) SHIPMENT_NUMBER,
--DECODE(A.APPLICATION_ID, 200,'AP-'||DOC_SEQUENCE_VALUE, 222,'AR-'||DOC_SEQUENCE_VALUE, DOC_SEQUENCE_VALUE) VOUCHER_NUMBER,
 DECODE(B.EVENT_TYPE_CODE, 'REFUND RECORDED','AP PAY','PAYMENT CREATED','AP PAY','PAYMENT CLEARED','AP PAY','PAYMENT CANCELLED','AP PAY','REFUND CANCELLED','AP PAY','PAYMENT UNCLEARED','AP PAY',
          'PREPAYMENT APPLIED','AP INV','PREPAYMENT CANCELLED','AP INV','CREDIT MEMO VALIDATED','AP INV','INVOICE CANCELLED','AP INV',
          'PREPAYMENT UNAPPLIED','AP INV','INVOICE VALIDATED','AP INV','PREPAYMENT VALIDATED','AP INV','CREDIT MEMO CANCELLED','AP INV',
          'CM_CREATE','AR INV','DM_CREATE','AR INV','INV_CREATE','AR INV','CM_UPDATE','AR INV','RECP_CREATE','AR RCV',
          'MISC_RECP_CREATE','AR RCV','MISC_RECP_REVERSE','AR RCV','RECP_REVERSE','AR RCV','RECP_UPDATE','AR RCV',NULL)
          ||DECODE(DOC_SEQUENCE_VALUE,NULL,NULL,'-'||DOC_SEQUENCE_VALUE)
          ||DECODE(B.EVENT_TYPE_CODE,'CE_BAT_CLEARED','CM'||'-'||SUBSTR(B.DESCRIPTION,62,5),NULL)  VOUCHER_NUMBER , F.receipt_num
           ,B.EVENT_TYPE_CODE,A.AE_HEADER_ID, A.APPLICATION_ID,
           ( CASE WHEN RECEIPT_SOURCE_CODE ='VENDOR' THEN TO_CHAR(GET_VENDOR_FROM_SHIPMNT_HDR_ID(f.shipment_header_id)) else  (SELECT OPERATING_UNIT_NAME FROM WBI_INV_ORG_DETAIL WHERE INV_ORGANIZATION_ID = F.ORGANIZATION_ID)  end) INTERNAL_SUPPLIER,
           ---- GET_VENDOR_FROM_SHIPMNT_HDR_ID(P_PO_HEADER_ID IN NUMBER)
           XX_PARTY_VENDOR_NAME_FUNCTION(A.APPLICATION_ID, PARTY_ID) PARTY_VENDOR_NAME,B.JE_CATEGORY_NAME,
           SEGMENT4,
XX_GET_ACCT_FLEX_SEG_DESC(4,SEGMENT4) ACCOUNT_DESC, 
XX_GET_ACCT_FLEX_SEG_DESC (5, SEGMENT5,SEGMENT4) SUB_ACCOUNT,
PARTY_ID,
           XX_OPOSITE_HEAD_FUNCTION(:P_ACCOUNT_CODE, A.AE_HEADER_ID) OPOSITE_HEAD,
     DECODE( XX_AP_DFF_FUNCTION(DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id) ,  NULL , NULL, XX_AP_DFF_FUNCTION(DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id)||'.')
    ||   DECODE(XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID) ,  NULL , NULL, XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID)||'.' )
    ||   DECODE(XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
     XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ) 
   ||   DECODE( XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
    XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ) DFF_INFO,
        NVL(SUM(ACCOUNTED_DR),0) DR_AMT,NVL(SUM(ACCOUNTED_CR),0) CR_AMT 
           FROM XLA_AE_LINES A, XLA_AE_HEADERS B, GL_CODE_COMBINATIONS C, XX_BAL_SEG_INFO D, GMF_XLA_EXTRACT_HEADERS E, RCV_SHIPMENT_HEADERS F --, RCV_SHIPMENT_LINES G
           WHERE  E.SOURCE_DOCUMENT_ID (+)= F.SHIPMENT_HEADER_ID
          -- AND F.SHIPMENT_HEADER_ID= G.SHIPMENT_HEADER_ID
           and B.EVENT_ID =E.EVENT_ID 
           AND C.CODE_COMBINATION_ID=A.CODE_COMBINATION_ID
           AND  A.AE_HEADER_ID=B.AE_HEADER_ID
           AND SEGMENT4=:P_ACCOUNT_CODE
           AND B.LEDGER_ID=D.LEDGER_ID
           AND A.ACCOUNTING_DATE BETWEEN :P_DATE_FROM AND :P_DATE_TO
           AND A.ACCOUNTING_DATE>'31-AUG-2018'
           AND BAL_SEG=:P_BAL_SEG
          -- and  B.JE_CATEGORY_NAME= 'INTE'
          -- and a.AE_HEADER_ID=31534900 
AND SEGMENT5=NVL(:P_SUB_ACC,SEGMENT5)
--and (CASE WHEN  RECEIPT_SOURCE_CODE ='INTERNAL ORDER' THEN SHIPMENT_NUM WHEN RECEIPT_SOURCE_CODE =  'INVENTORY' THEN SHIPMENT_NUM
--WHEN RECEIPT_SOURCE_CODE ='VENDOR' THEN  'PO-'||''||GET_PO_NO_FROM_SHIPMNT_HDR_ID(f.shipment_header_id) 
--else null  END) = '4191010042724'
           GROUP BY 
           D.BAL_SEG, D.BAL_SEG_NAME,B.LEDGER_ID,A.ACCOUNTING_DATE,
            DECODE(B.EVENT_TYPE_CODE, 'REFUND RECORDED','AP PAY','PAYMENT CREATED','AP PAY','PAYMENT CLEARED','AP PAY','PAYMENT CANCELLED','AP PAY','REFUND CANCELLED','AP PAY',
          'PREPAYMENT APPLIED','AP INV','PREPAYMENT CANCELLED','AP INV','CREDIT MEMO VALIDATED','AP INV','INVOICE CANCELLED','AP INV',
          'PREPAYMENT UNAPPLIED','AP INV','INVOICE VALIDATED','AP INV','PREPAYMENT VALIDATED','AP INV','CREDIT MEMO CANCELLED','AP INV',
          'CM_CREATE','AR INV','DM_CREATE','AR INV','INV_CREATE','AR INV','CM_UPDATE','AR INV','RECP_CREATE','AR RCV',
          'MISC_RECP_CREATE','AR RCV','MISC_RECP_REVERSE','AR RCV','RECP_REVERSE','AR RCV','RECP_UPDATE','AR RCV')||'-'|| DOC_SEQUENCE_VALUE,DOC_SEQUENCE_VALUE,B.DESCRIPTION
           ,B.EVENT_TYPE_CODE,A.AE_HEADER_ID, A.APPLICATION_ID,XX_PARTY_VENDOR_NAME_FUNCTION(A.APPLICATION_ID, PARTY_ID) ,
          B.JE_CATEGORY_NAME,
           SEGMENT4,XX_GET_ACCT_FLEX_SEG_DESC(4,SEGMENT4) , PARTY_ID,
          XX_OPOSITE_HEAD_FUNCTION(:P_ACCOUNT_CODE, A.AE_HEADER_ID),
        DECODE( XX_AP_DFF_FUNCTION(DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id) ,  NULL , NULL, XX_AP_DFF_FUNCTION(DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id)||'.')
     ||   DECODE( XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID) ,  NULL , NULL, XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID)||'.' )
     ||   DECODE( XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
    XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ) 
    ||   DECODE( XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
    XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ),
    XX_GET_ACCT_FLEX_SEG_DESC (5, SEGMENT5,SEGMENT4),F.receipt_num,RECEIPT_SOURCE_CODE,SHIPMENT_NUM,F.SHIP_TO_ORG_ID, f.shipment_header_id ,F.ORGANIZATION_ID --,G.PO_HEADER_ID              
UNION ALL 
-- ACCOUNT WISE LEDGER FOR APP ACCRUAL  2,456 data
SELECT --AIL.BASE_AMOUNT,AIL.RCV_SHIPMENT_LINE_ID, 
--GET_GRN_FROM_SHIPMNT_LINE_ID(AIL.RCV_SHIPMENT_LINE_ID) GRN_NUMBER,
D.BAL_SEG, D.BAL_SEG_NAME,B.LEDGER_ID,A.ACCOUNTING_DATE,NULL RECEIPT_SOURCE_CODE, NULL SHIPMENT_NUMBER,
--DECODE(A.APPLICATION_ID, 200,'AP-'||DOC_SEQUENCE_VALUE, 222,'AR-'||DOC_SEQUENCE_VALUE, DOC_SEQUENCE_VALUE) VOUCHER_NUMBER
 DECODE(B.EVENT_TYPE_CODE, 'REFUND RECORDED','AP PAY','PAYMENT CREATED','AP PAY','PAYMENT CLEARED','AP PAY','PAYMENT CANCELLED','AP PAY','REFUND CANCELLED','AP PAY','PAYMENT UNCLEARED','AP PAY',
          'PREPAYMENT APPLIED','AP INV','PREPAYMENT CANCELLED','AP INV','CREDIT MEMO VALIDATED','AP INV','INVOICE CANCELLED','AP INV',
          'PREPAYMENT UNAPPLIED','AP INV','INVOICE VALIDATED','AP INV','PREPAYMENT VALIDATED','AP INV','CREDIT MEMO CANCELLED','AP INV',
          'CM_CREATE','AR INV','DM_CREATE','AR INV','INV_CREATE','AR INV','CM_UPDATE','AR INV','RECP_CREATE','AR RCV',
          'MISC_RECP_CREATE','AR RCV','MISC_RECP_REVERSE','AR RCV','RECP_REVERSE','AR RCV','RECP_UPDATE','AR RCV',NULL)
          ||DECODE(B.DOC_SEQUENCE_VALUE,NULL,NULL,'-'||B.DOC_SEQUENCE_VALUE)
          ||DECODE(B.EVENT_TYPE_CODE,'CE_BAT_CLEARED','CM'||'-'||SUBSTR(B.DESCRIPTION,62,5),NULL)  VOUCHER_NUMBER , TO_CHAR(GET_GRN_FROM_SHIPMNT_LINE_ID(AIL.RCV_SHIPMENT_LINE_ID)) RECEIPT_NUM
          --GET_GRN_FROM_SHIPMNT_LINE_ID(AIL.RCV_SHIPMENT_LINE_ID) RECEIPT_NUM
           ,B.EVENT_TYPE_CODE,A.AE_HEADER_ID, A.APPLICATION_ID, NULL,
           XX_PARTY_VENDOR_NAME_FUNCTION(A.APPLICATION_ID, A.PARTY_ID) PARTY_VENDOR_NAME,B.JE_CATEGORY_NAME,
           SEGMENT4,
XX_GET_ACCT_FLEX_SEG_DESC(4,SEGMENT4) ACCOUNT_DESC, 
XX_GET_ACCT_FLEX_SEG_DESC (5, SEGMENT5,SEGMENT4) SUB_ACCOUNT,
A.PARTY_ID,
           XX_OPOSITE_HEAD_FUNCTION(:P_ACCOUNT_CODE, A.AE_HEADER_ID) OPOSITE_HEAD,
     DECODE( XX_AP_DFF_FUNCTION(B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id) ,  NULL , NULL, XX_AP_DFF_FUNCTION(B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id)||'.')
    ||   DECODE(XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID) ,  NULL , NULL, XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID)||'.' )
    ||   DECODE(XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
     XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ) 
   ||   DECODE( XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
    XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ) DFF_INFO,
    (CASE WHEN  DECODE(B.EVENT_TYPE_CODE, 'REFUND RECORDED','AP PAY','PAYMENT CREATED','AP PAY','PAYMENT CLEARED','AP PAY','PAYMENT CANCELLED','AP PAY','REFUND CANCELLED','AP PAY','PAYMENT UNCLEARED','AP PAY',
          'PREPAYMENT APPLIED','AP INV','PREPAYMENT CANCELLED','AP INV','CREDIT MEMO VALIDATED','AP INV','INVOICE CANCELLED','AP INV',
          'PREPAYMENT UNAPPLIED','AP INV','INVOICE VALIDATED','AP INV','PREPAYMENT VALIDATED','AP INV','CREDIT MEMO CANCELLED','AP INV',
          'CM_CREATE','AR INV','DM_CREATE','AR INV','INV_CREATE','AR INV','CM_UPDATE','AR INV','RECP_CREATE','AR RCV',
          'MISC_RECP_CREATE','AR RCV','MISC_RECP_REVERSE','AR RCV','RECP_REVERSE','AR RCV','RECP_UPDATE','AR RCV',NULL)
          ||DECODE(B.DOC_SEQUENCE_VALUE,NULL,NULL,'-'||B.DOC_SEQUENCE_VALUE)
          ||DECODE(B.EVENT_TYPE_CODE,'CE_BAT_CLEARED','CM'||'-'||SUBSTR(B.DESCRIPTION,62,5),NULL) IS NOT NULL THEN AIL.BASE_AMOUNT ELSE NVL(SUM(ACCOUNTED_DR),0) END ) DR_AMT,
       -- NVL(SUM(ACCOUNTED_DR),0) DR_AMT,
        NVL(SUM(ACCOUNTED_CR),0) CR_AMT 
 FROM XLA_AE_LINES A, XLA_AE_HEADERS B, GL_CODE_COMBINATIONS C, XX_BAL_SEG_INFO D, xla.xla_transaction_entities XTE,ap_invoices_all aia,AP_INVOICE_LINES_ALL AIL,
xla.xla_events xev
           WHERE C.CODE_COMBINATION_ID=A.CODE_COMBINATION_ID
           AND  A.AE_HEADER_ID=B.AE_HEADER_ID
           AND SEGMENT4=:P_ACCOUNT_CODE
           AND B.LEDGER_ID=D.LEDGER_ID
           AND A.ACCOUNTING_DATE BETWEEN :P_DATE_FROM AND :P_DATE_TO
           AND A.ACCOUNTING_DATE > '31-AUG-2018'
           AND BAL_SEG=:P_BAL_SEG
           and XX_PARTY_VENDOR_NAME_FUNCTION(A.APPLICATION_ID, A.PARTY_ID) is not null
--           and ( DECODE(B.EVENT_TYPE_CODE, 'REFUND RECORDED','AP PAY','PAYMENT CREATED','AP PAY','PAYMENT CLEARED','AP PAY','PAYMENT CANCELLED','AP PAY','REFUND CANCELLED','AP PAY','PAYMENT UNCLEARED','AP PAY',
--          'PREPAYMENT APPLIED','AP INV','PREPAYMENT CANCELLED','AP INV','CREDIT MEMO VALIDATED','AP INV','INVOICE CANCELLED','AP INV',
--          'PREPAYMENT UNAPPLIED','AP INV','INVOICE VALIDATED','AP INV','PREPAYMENT VALIDATED','AP INV','CREDIT MEMO CANCELLED','AP INV',
--          'CM_CREATE','AR INV','DM_CREATE','AR INV','INV_CREATE','AR INV','CM_UPDATE','AR INV','RECP_CREATE','AR RCV',
--          'MISC_RECP_CREATE','AR RCV','MISC_RECP_REVERSE','AR RCV','RECP_REVERSE','AR RCV','RECP_UPDATE','AR RCV',NULL)
--          ||DECODE(B.DOC_SEQUENCE_VALUE,NULL,NULL,'-'||B.DOC_SEQUENCE_VALUE)
--          ||DECODE(B.EVENT_TYPE_CODE,'CE_BAT_CLEARED','CM'||'-'||SUBSTR(B.DESCRIPTION,62,5),NULL) ) = 'AP INV-180002020'
AND SEGMENT5=NVL(:P_SUB_ACC,SEGMENT5) -- 31557546 31532083
and aia.INVOICE_ID = xte.source_id_int_1
and AIA.INVOICE_ID= AIL.INVOICE_ID
AND xev.entity_id = xte.entity_id
AND B.entity_id = xte.entity_id
and AIL.BASE_AMOUNT is not null
           GROUP BY 
           D.BAL_SEG, D.BAL_SEG_NAME,B.LEDGER_ID,A.ACCOUNTING_DATE,
            DECODE(B.EVENT_TYPE_CODE, 'REFUND RECORDED','AP PAY','PAYMENT CREATED','AP PAY','PAYMENT CLEARED','AP PAY','PAYMENT CANCELLED','AP PAY','REFUND CANCELLED','AP PAY',
          'PREPAYMENT APPLIED','AP INV','PREPAYMENT CANCELLED','AP INV','CREDIT MEMO VALIDATED','AP INV','INVOICE CANCELLED','AP INV',
          'PREPAYMENT UNAPPLIED','AP INV','INVOICE VALIDATED','AP INV','PREPAYMENT VALIDATED','AP INV','CREDIT MEMO CANCELLED','AP INV',
          'CM_CREATE','AR INV','DM_CREATE','AR INV','INV_CREATE','AR INV','CM_UPDATE','AR INV','RECP_CREATE','AR RCV',
          'MISC_RECP_CREATE','AR RCV','MISC_RECP_REVERSE','AR RCV','RECP_REVERSE','AR RCV','RECP_UPDATE','AR RCV')||'-'|| B.DOC_SEQUENCE_VALUE,B.DOC_SEQUENCE_VALUE,B.DESCRIPTION
           ,B.EVENT_TYPE_CODE,A.AE_HEADER_ID, A.APPLICATION_ID,XX_PARTY_VENDOR_NAME_FUNCTION(A.APPLICATION_ID, A.PARTY_ID) ,
          B.JE_CATEGORY_NAME,
           C.SEGMENT4,XX_GET_ACCT_FLEX_SEG_DESC(4,C.SEGMENT4) , A.PARTY_ID,
          XX_OPOSITE_HEAD_FUNCTION(:P_ACCOUNT_CODE, A.AE_HEADER_ID),
        DECODE( XX_AP_DFF_FUNCTION(B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id) ,  NULL , NULL, XX_AP_DFF_FUNCTION(B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id)||'.')
     ||   DECODE( XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID) ,  NULL , NULL, XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID)||'.' )
     ||   DECODE( XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
    XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ) 
    ||   DECODE( XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
    XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ),
    XX_GET_ACCT_FLEX_SEG_DESC (5, SEGMENT5,SEGMENT4),B.AE_HEADER_ID , AIL.BASE_AMOUNT, AIL.RCV_SHIPMENT_LINE_ID    
--   )
 --group by VOUCHER_NUMBER 

--===============================AP ACCRUAL V2 FINAL ==========================================

-- ACCOUNT WISE LEDGER FOR APP ACCRUAL  2,456 data
SELECT D.BAL_SEG,   
--GET_ORG_CODE_FROM_ID(F.ORGANIZATION_ID) "FROM ORG", 
--GET_ORG_CODE_FROM_ID(F.SHIP_TO_ORG_ID) "TO_ORG",
D.BAL_SEG_NAME,B.LEDGER_ID,A.ACCOUNTING_DATE, F.RECEIPT_SOURCE_CODE, --G.PO_HEADER_ID,
(CASE WHEN  RECEIPT_SOURCE_CODE ='INTERNAL ORDER' THEN SHIPMENT_NUM WHEN RECEIPT_SOURCE_CODE =  'INVENTORY' THEN SHIPMENT_NUM
WHEN RECEIPT_SOURCE_CODE ='VENDOR' THEN  'PO-'||''||GET_PO_NO_FROM_SHIPMNT_HDR_ID(f.shipment_header_id) 
else null  END) SHIPMENT_NUMBER,
--DECODE(A.APPLICATION_ID, 200,'AP-'||DOC_SEQUENCE_VALUE, 222,'AR-'||DOC_SEQUENCE_VALUE, DOC_SEQUENCE_VALUE) VOUCHER_NUMBER,
 DECODE(B.EVENT_TYPE_CODE, 'REFUND RECORDED','AP PAY','PAYMENT CREATED','AP PAY','PAYMENT CLEARED','AP PAY','PAYMENT CANCELLED','AP PAY','REFUND CANCELLED','AP PAY','PAYMENT UNCLEARED','AP PAY',
          'PREPAYMENT APPLIED','AP INV','PREPAYMENT CANCELLED','AP INV','CREDIT MEMO VALIDATED','AP INV','INVOICE CANCELLED','AP INV',
          'PREPAYMENT UNAPPLIED','AP INV','INVOICE VALIDATED','AP INV','PREPAYMENT VALIDATED','AP INV','CREDIT MEMO CANCELLED','AP INV',
          'CM_CREATE','AR INV','DM_CREATE','AR INV','INV_CREATE','AR INV','CM_UPDATE','AR INV','RECP_CREATE','AR RCV',
          'MISC_RECP_CREATE','AR RCV','MISC_RECP_REVERSE','AR RCV','RECP_REVERSE','AR RCV','RECP_UPDATE','AR RCV',NULL)
          ||DECODE(DOC_SEQUENCE_VALUE,NULL,NULL,'-'||DOC_SEQUENCE_VALUE)
          ||DECODE(B.EVENT_TYPE_CODE,'CE_BAT_CLEARED','CM'||'-'||SUBSTR(B.DESCRIPTION,62,5),NULL)  VOUCHER_NUMBER , F.receipt_num
           ,B.EVENT_TYPE_CODE,A.AE_HEADER_ID, A.APPLICATION_ID,
           ( CASE WHEN RECEIPT_SOURCE_CODE ='VENDOR' THEN TO_CHAR(GET_VENDOR_FROM_SHIPMNT_HDR_ID(f.shipment_header_id)) else  (SELECT OPERATING_UNIT_NAME FROM WBI_INV_ORG_DETAIL WHERE INV_ORGANIZATION_ID = F.ORGANIZATION_ID)  end) INTERNAL_SUPPLIER,
           ---- GET_VENDOR_FROM_SHIPMNT_HDR_ID(P_PO_HEADER_ID IN NUMBER)
           XX_PARTY_VENDOR_NAME_FUNCTION(A.APPLICATION_ID, PARTY_ID) PARTY_VENDOR_NAME,B.JE_CATEGORY_NAME,
           SEGMENT4,
XX_GET_ACCT_FLEX_SEG_DESC(4,SEGMENT4) ACCOUNT_DESC, 
XX_GET_ACCT_FLEX_SEG_DESC (5, SEGMENT5,SEGMENT4) SUB_ACCOUNT,
PARTY_ID,
           XX_OPOSITE_HEAD_FUNCTION(:P_ACCOUNT_CODE, A.AE_HEADER_ID) OPOSITE_HEAD,
     DECODE( XX_AP_DFF_FUNCTION(DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id) ,  NULL , NULL, XX_AP_DFF_FUNCTION(DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id)||'.')
    ||   DECODE(XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID) ,  NULL , NULL, XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID)||'.' )
    ||   DECODE(XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
     XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ) 
   ||   DECODE( XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
    XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ) DFF_INFO,
        NVL(SUM(ACCOUNTED_DR),0) DR_AMT,NVL(SUM(ACCOUNTED_CR),0) CR_AMT 
FROM XLA_AE_LINES A, XLA_AE_HEADERS B, GL_CODE_COMBINATIONS C, XX_BAL_SEG_INFO D, GMF_XLA_EXTRACT_HEADERS E, RCV_SHIPMENT_HEADERS F --, RCV_SHIPMENT_LINES G
           WHERE  E.SOURCE_DOCUMENT_ID (+)= F.SHIPMENT_HEADER_ID
          -- AND F.SHIPMENT_HEADER_ID= G.SHIPMENT_HEADER_ID
           and B.EVENT_ID =E.EVENT_ID 
           AND C.CODE_COMBINATION_ID=A.CODE_COMBINATION_ID
           AND  A.AE_HEADER_ID=B.AE_HEADER_ID
           AND SEGMENT4=:P_ACCOUNT_CODE
           AND B.LEDGER_ID=D.LEDGER_ID
           AND A.ACCOUNTING_DATE BETWEEN :P_DATE_FROM AND :P_DATE_TO
           AND A.ACCOUNTING_DATE>'31-AUG-2018'
           AND BAL_SEG=:P_BAL_SEG
          -- and  B.JE_CATEGORY_NAME= 'INTE'
          -- and a.AE_HEADER_ID=31534900 
AND SEGMENT5=NVL(:P_SUB_ACC,SEGMENT5)
           GROUP BY 
           D.BAL_SEG, D.BAL_SEG_NAME,B.LEDGER_ID,A.ACCOUNTING_DATE,
            DECODE(B.EVENT_TYPE_CODE, 'REFUND RECORDED','AP PAY','PAYMENT CREATED','AP PAY','PAYMENT CLEARED','AP PAY','PAYMENT CANCELLED','AP PAY','REFUND CANCELLED','AP PAY',
          'PREPAYMENT APPLIED','AP INV','PREPAYMENT CANCELLED','AP INV','CREDIT MEMO VALIDATED','AP INV','INVOICE CANCELLED','AP INV',
          'PREPAYMENT UNAPPLIED','AP INV','INVOICE VALIDATED','AP INV','PREPAYMENT VALIDATED','AP INV','CREDIT MEMO CANCELLED','AP INV',
          'CM_CREATE','AR INV','DM_CREATE','AR INV','INV_CREATE','AR INV','CM_UPDATE','AR INV','RECP_CREATE','AR RCV',
          'MISC_RECP_CREATE','AR RCV','MISC_RECP_REVERSE','AR RCV','RECP_REVERSE','AR RCV','RECP_UPDATE','AR RCV')||'-'|| DOC_SEQUENCE_VALUE,DOC_SEQUENCE_VALUE,B.DESCRIPTION
           ,B.EVENT_TYPE_CODE,A.AE_HEADER_ID, A.APPLICATION_ID,XX_PARTY_VENDOR_NAME_FUNCTION(A.APPLICATION_ID, PARTY_ID) ,
          B.JE_CATEGORY_NAME,
           SEGMENT4,XX_GET_ACCT_FLEX_SEG_DESC(4,SEGMENT4) , PARTY_ID,
          XX_OPOSITE_HEAD_FUNCTION(:P_ACCOUNT_CODE, A.AE_HEADER_ID),
        DECODE( XX_AP_DFF_FUNCTION(DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id) ,  NULL , NULL, XX_AP_DFF_FUNCTION(DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id)||'.')
     ||   DECODE( XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID) ,  NULL , NULL, XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID)||'.' )
     ||   DECODE( XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
    XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ) 
    ||   DECODE( XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
    XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ),
    XX_GET_ACCT_FLEX_SEG_DESC (5, SEGMENT5,SEGMENT4),F.receipt_num,RECEIPT_SOURCE_CODE,SHIPMENT_NUM,F.SHIP_TO_ORG_ID, f.shipment_header_id ,F.ORGANIZATION_ID --,G.PO_HEADER_ID          
UNION ALL 
-- ACCOUNT WISE LEDGER FOR APP ACCRUAL  2,456 data
SELECT D.BAL_SEG, D.BAL_SEG_NAME,B.LEDGER_ID,A.ACCOUNTING_DATE,NULL RECEIPT_SOURCE_CODE, NULL SHIPMENT_NUMBER,
--DECODE(A.APPLICATION_ID, 200,'AP-'||DOC_SEQUENCE_VALUE, 222,'AR-'||DOC_SEQUENCE_VALUE, DOC_SEQUENCE_VALUE) VOUCHER_NUMBER
 DECODE(EVENT_TYPE_CODE, 'REFUND RECORDED','AP PAY','PAYMENT CREATED','AP PAY','PAYMENT CLEARED','AP PAY','PAYMENT CANCELLED','AP PAY','REFUND CANCELLED','AP PAY','PAYMENT UNCLEARED','AP PAY',
          'PREPAYMENT APPLIED','AP INV','PREPAYMENT CANCELLED','AP INV','CREDIT MEMO VALIDATED','AP INV','INVOICE CANCELLED','AP INV',
          'PREPAYMENT UNAPPLIED','AP INV','INVOICE VALIDATED','AP INV','PREPAYMENT VALIDATED','AP INV','CREDIT MEMO CANCELLED','AP INV',
          'CM_CREATE','AR INV','DM_CREATE','AR INV','INV_CREATE','AR INV','CM_UPDATE','AR INV','RECP_CREATE','AR RCV',
          'MISC_RECP_CREATE','AR RCV','MISC_RECP_REVERSE','AR RCV','RECP_REVERSE','AR RCV','RECP_UPDATE','AR RCV',NULL)
          ||DECODE(DOC_SEQUENCE_VALUE,NULL,NULL,'-'||DOC_SEQUENCE_VALUE)
          ||DECODE(EVENT_TYPE_CODE,'CE_BAT_CLEARED','CM'||'-'||SUBSTR(B.DESCRIPTION,62,5),NULL)  VOUCHER_NUMBER ,XX_GET_GRN_FROM_AE_HEADERID(B.AE_HEADER_ID) RECEIPT_NUM
           ,EVENT_TYPE_CODE,A.AE_HEADER_ID, A.APPLICATION_ID, NULL,
           XX_PARTY_VENDOR_NAME_FUNCTION(A.APPLICATION_ID, PARTY_ID) PARTY_VENDOR_NAME,B.JE_CATEGORY_NAME,
           SEGMENT4,
XX_GET_ACCT_FLEX_SEG_DESC(4,SEGMENT4) ACCOUNT_DESC, 
XX_GET_ACCT_FLEX_SEG_DESC (5, SEGMENT5,SEGMENT4) SUB_ACCOUNT,
PARTY_ID,
           XX_OPOSITE_HEAD_FUNCTION(:P_ACCOUNT_CODE, A.AE_HEADER_ID) OPOSITE_HEAD,
     DECODE( XX_AP_DFF_FUNCTION(DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id) ,  NULL , NULL, XX_AP_DFF_FUNCTION(DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id)||'.')
    ||   DECODE(XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID) ,  NULL , NULL, XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID)||'.' )
    ||   DECODE(XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
     XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ) 
   ||   DECODE( XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
    XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ) DFF_INFO,
        NVL(SUM(ACCOUNTED_DR),0) DR_AMT,NVL(SUM(ACCOUNTED_CR),0) CR_AMT 
           FROM XLA_AE_LINES A, XLA_AE_HEADERS B, GL_CODE_COMBINATIONS C, XX_BAL_SEG_INFO D
           WHERE C.CODE_COMBINATION_ID=A.CODE_COMBINATION_ID
           AND  A.AE_HEADER_ID=B.AE_HEADER_ID
           AND SEGMENT4=:P_ACCOUNT_CODE
           AND B.LEDGER_ID=D.LEDGER_ID
           AND A.ACCOUNTING_DATE BETWEEN :P_DATE_FROM AND :P_DATE_TO
           AND A.ACCOUNTING_DATE > '31-AUG-2018'
           AND BAL_SEG=:P_BAL_SEG
           and XX_PARTY_VENDOR_NAME_FUNCTION(A.APPLICATION_ID, PARTY_ID) is not null
--           and ( DECODE(EVENT_TYPE_CODE, 'REFUND RECORDED','AP PAY','PAYMENT CREATED','AP PAY','PAYMENT CLEARED','AP PAY','PAYMENT CANCELLED','AP PAY','REFUND CANCELLED','AP PAY','PAYMENT UNCLEARED','AP PAY',
--          'PREPAYMENT APPLIED','AP INV','PREPAYMENT CANCELLED','AP INV','CREDIT MEMO VALIDATED','AP INV','INVOICE CANCELLED','AP INV',
--          'PREPAYMENT UNAPPLIED','AP INV','INVOICE VALIDATED','AP INV','PREPAYMENT VALIDATED','AP INV','CREDIT MEMO CANCELLED','AP INV',
--          'CM_CREATE','AR INV','DM_CREATE','AR INV','INV_CREATE','AR INV','CM_UPDATE','AR INV','RECP_CREATE','AR RCV',
--          'MISC_RECP_CREATE','AR RCV','MISC_RECP_REVERSE','AR RCV','RECP_REVERSE','AR RCV','RECP_UPDATE','AR RCV',NULL)
--          ||DECODE(DOC_SEQUENCE_VALUE,NULL,NULL,'-'||DOC_SEQUENCE_VALUE)
--          ||DECODE(EVENT_TYPE_CODE,'CE_BAT_CLEARED','CM'||'-'||SUBSTR(B.DESCRIPTION,62,5),NULL) ) = 'AP INV-180001808'
AND SEGMENT5=NVL(:P_SUB_ACC,SEGMENT5) -- 31557546 31532083
           GROUP BY 
           D.BAL_SEG, D.BAL_SEG_NAME,B.LEDGER_ID,A.ACCOUNTING_DATE,
            DECODE(EVENT_TYPE_CODE, 'REFUND RECORDED','AP PAY','PAYMENT CREATED','AP PAY','PAYMENT CLEARED','AP PAY','PAYMENT CANCELLED','AP PAY','REFUND CANCELLED','AP PAY',
          'PREPAYMENT APPLIED','AP INV','PREPAYMENT CANCELLED','AP INV','CREDIT MEMO VALIDATED','AP INV','INVOICE CANCELLED','AP INV',
          'PREPAYMENT UNAPPLIED','AP INV','INVOICE VALIDATED','AP INV','PREPAYMENT VALIDATED','AP INV','CREDIT MEMO CANCELLED','AP INV',
          'CM_CREATE','AR INV','DM_CREATE','AR INV','INV_CREATE','AR INV','CM_UPDATE','AR INV','RECP_CREATE','AR RCV',
          'MISC_RECP_CREATE','AR RCV','MISC_RECP_REVERSE','AR RCV','RECP_REVERSE','AR RCV','RECP_UPDATE','AR RCV')||'-'|| DOC_SEQUENCE_VALUE,DOC_SEQUENCE_VALUE,B.DESCRIPTION
           ,EVENT_TYPE_CODE,A.AE_HEADER_ID, A.APPLICATION_ID,XX_PARTY_VENDOR_NAME_FUNCTION(A.APPLICATION_ID, PARTY_ID) ,
          B.JE_CATEGORY_NAME,
           SEGMENT4,XX_GET_ACCT_FLEX_SEG_DESC(4,SEGMENT4) , PARTY_ID,
          XX_OPOSITE_HEAD_FUNCTION(:P_ACCOUNT_CODE, A.AE_HEADER_ID),
        DECODE( XX_AP_DFF_FUNCTION(DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id) ,  NULL , NULL, XX_AP_DFF_FUNCTION(DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id)||'.')
     ||   DECODE( XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID) ,  NULL , NULL, XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID)||'.' )
     ||   DECODE( XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
    XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ) 
    ||   DECODE( XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
    XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ),
    XX_GET_ACCT_FLEX_SEG_DESC (5, SEGMENT5,SEGMENT4),B.AE_HEADER_ID     
--   )
 --group by VOUCHER_NUMBER 

--==========================================

SELECT  DISTINCT SEGMENT1 
FROM PO_HEADERS_ALL PH, RCV_SHIPMENT_LINES RL
WHERE PH.PO_HEADER_ID= RL.PO_HEADER_ID
AND RL.PO_HEADER_ID= 791419  

XX_INV_PKG

MY_PACKAGE

SELECT * FROM xla_ae_headers

select GET_PO_NUMBER_FROM_PO_HDR_ID(D.BAL_SEG,F.SHIP_TO_ORG_ID, F.RECEIPT_NUM)  FROM DUAL


--=================== 23 JAN 2021====================================================== vsum value 2216969892.52    3677406164.87

SELECT  EVENT_TYPE_CODE, JE_CATEGORY_NAME , DOC_SEQUENCE_VALUE FROM XLA_AE_HEADERS where JE_CATEGORY_NAME = 'INTE'

SELECT * FROM XLA_AE_HEADERS where JE_CATEGORY_NAME = 'INTE'

select * from AP_INVOICES_ALL WHERE DOC_SEQUENCE_VALUE= 190005455 and org_id= 81

select * from GMF_XLA_EXTRACT_HEADERS a , XLA_AE_HEADERS b
where a.event_id= b.event_id and  b.JE_CATEGORY_NAME = 'INTE'



SELECT VOUCHER_NUMBER, SUM(DR_AMT), SUM(CR_AMT) FROM 
(

--====================== ACCOUNT WISE LEDGER ---MAIN=======================================================


-- ACCOUNT WISE LEDGER FOR APP ACCRUAL  2,456 data
SELECT D.BAL_SEG, D.BAL_SEG_NAME,B.LEDGER_ID,A.ACCOUNTING_DATE,
--DECODE(A.APPLICATION_ID, 200,'AP-'||DOC_SEQUENCE_VALUE, 222,'AR-'||DOC_SEQUENCE_VALUE, DOC_SEQUENCE_VALUE) VOUCHER_NUMBER
 DECODE(EVENT_TYPE_CODE, 'REFUND RECORDED','AP PAY','PAYMENT CREATED','AP PAY','PAYMENT CLEARED','AP PAY','PAYMENT CANCELLED','AP PAY','REFUND CANCELLED','AP PAY','PAYMENT UNCLEARED','AP PAY',
          'PREPAYMENT APPLIED','AP INV','PREPAYMENT CANCELLED','AP INV','CREDIT MEMO VALIDATED','AP INV','INVOICE CANCELLED','AP INV',
          'PREPAYMENT UNAPPLIED','AP INV','INVOICE VALIDATED','AP INV','PREPAYMENT VALIDATED','AP INV','CREDIT MEMO CANCELLED','AP INV',
          'CM_CREATE','AR INV','DM_CREATE','AR INV','INV_CREATE','AR INV','CM_UPDATE','AR INV','RECP_CREATE','AR RCV',
          'MISC_RECP_CREATE','AR RCV','MISC_RECP_REVERSE','AR RCV','RECP_REVERSE','AR RCV','RECP_UPDATE','AR RCV',NULL)
          ||DECODE(DOC_SEQUENCE_VALUE,NULL,NULL,'-'||DOC_SEQUENCE_VALUE)
          ||DECODE(EVENT_TYPE_CODE,'CE_BAT_CLEARED','CM'||'-'||SUBSTR(B.DESCRIPTION,62,5),NULL)  VOUCHER_NUMBER 
           ,EVENT_TYPE_CODE,A.AE_HEADER_ID, A.APPLICATION_ID,XX_PARTY_VENDOR_NAME_FUNCTION(A.APPLICATION_ID, PARTY_ID) PARTY_VENDOR_NAME,B.JE_CATEGORY_NAME,
           SEGMENT4,
XX_GET_ACCT_FLEX_SEG_DESC(4,SEGMENT4) ACCOUNT_DESC, 
XX_GET_ACCT_FLEX_SEG_DESC (5, SEGMENT5,SEGMENT4) SUB_ACCOUNT,
PARTY_ID,
           XX_OPOSITE_HEAD_FUNCTION(:P_ACCOUNT_CODE, A.AE_HEADER_ID) OPOSITE_HEAD,
     DECODE( XX_AP_DFF_FUNCTION(DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id) ,  NULL , NULL, XX_AP_DFF_FUNCTION(DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id)||'.')
    ||   DECODE(XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID) ,  NULL , NULL, XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID)||'.' )
    ||   DECODE(XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
     XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ) 
   ||   DECODE( XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
    XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ) DFF_INFO,
        NVL(SUM(ACCOUNTED_DR),0) DR_AMT,NVL(SUM(ACCOUNTED_CR),0) CR_AMT 
           FROM XLA_AE_LINES A, XLA_AE_HEADERS B, GL_CODE_COMBINATIONS C, XX_BAL_SEG_INFO D
           WHERE C.CODE_COMBINATION_ID=A.CODE_COMBINATION_ID
           AND  A.AE_HEADER_ID=B.AE_HEADER_ID
           AND SEGMENT4=:P_ACCOUNT_CODE
           AND B.LEDGER_ID=D.LEDGER_ID
           AND A.ACCOUNTING_DATE BETWEEN :P_DATE_FROM AND :P_DATE_TO
           AND A.ACCOUNTING_DATE>'31-AUG-2018'
           AND BAL_SEG=:P_BAL_SEG
       --    and XX_PARTY_VENDOR_NAME_FUNCTION(A.APPLICATION_ID, PARTY_ID) is not null
AND SEGMENT5=NVL(:P_SUB_ACC,SEGMENT5) -- 31557546 31532083
           GROUP BY 
           D.BAL_SEG, D.BAL_SEG_NAME,B.LEDGER_ID,A.ACCOUNTING_DATE,
            DECODE(EVENT_TYPE_CODE, 'REFUND RECORDED','AP PAY','PAYMENT CREATED','AP PAY','PAYMENT CLEARED','AP PAY','PAYMENT CANCELLED','AP PAY','REFUND CANCELLED','AP PAY',
          'PREPAYMENT APPLIED','AP INV','PREPAYMENT CANCELLED','AP INV','CREDIT MEMO VALIDATED','AP INV','INVOICE CANCELLED','AP INV',
          'PREPAYMENT UNAPPLIED','AP INV','INVOICE VALIDATED','AP INV','PREPAYMENT VALIDATED','AP INV','CREDIT MEMO CANCELLED','AP INV',
          'CM_CREATE','AR INV','DM_CREATE','AR INV','INV_CREATE','AR INV','CM_UPDATE','AR INV','RECP_CREATE','AR RCV',
          'MISC_RECP_CREATE','AR RCV','MISC_RECP_REVERSE','AR RCV','RECP_REVERSE','AR RCV','RECP_UPDATE','AR RCV')||'-'|| DOC_SEQUENCE_VALUE,DOC_SEQUENCE_VALUE,B.DESCRIPTION
           ,EVENT_TYPE_CODE,A.AE_HEADER_ID, A.APPLICATION_ID,XX_PARTY_VENDOR_NAME_FUNCTION(A.APPLICATION_ID, PARTY_ID) ,
          B.JE_CATEGORY_NAME,
           SEGMENT4,XX_GET_ACCT_FLEX_SEG_DESC(4,SEGMENT4) , PARTY_ID,
          XX_OPOSITE_HEAD_FUNCTION(:P_ACCOUNT_CODE, A.AE_HEADER_ID),
        DECODE( XX_AP_DFF_FUNCTION(DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id) ,  NULL , NULL, XX_AP_DFF_FUNCTION(DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID, b.event_id)||'.')
     ||   DECODE( XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID) ,  NULL , NULL, XX_FIN_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID)||'.' )
     ||   DECODE( XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
    XX_AP_INV_PAY_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ) 
    ||   DECODE( XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME) ,  NULL , NULL,
    XX_AP_INV_DESC_FUNCTION(B.APPLICATION_ID,B.DOC_SEQUENCE_VALUE, D.LEGAL_ENTITY_ID,B.JE_CATEGORY_NAME)||'.' ),
    XX_GET_ACCT_FLEX_SEG_DESC (5, SEGMENT5,SEGMENT4)       
UNION ALL
select b.bal_seg, bal_seg_name,a.ledger_id, EFFECTIVE_DATE ACCOUNTING_DATE, to_char(DOC_SEQUENCE_VALUE) VOUCHER_NUMBER,null, null, null, null, NULL JE_CATEGORY_NAME,segment4,
XX_GET_ACCT_FLEX_SEG_DESC(4,SEGMENT4) ACCOUNT_DESC, 
XX_GET_ACCT_FLEX_SEG_DESC (5, SEGMENT5,SEGMENT4) SUB_ACCOUNT,
 null, null, a.DESCRIPTION ,
NVL(ACCOUNTED_DR,0) ACCOUNTED_DR, NVL(ACCOUNTED_CR,0) ACCOUNTED_CR
  from gl_je_lines a, xx_bal_seg_info b, gl_code_combinations c, GL_JE_HEADERS d
   where a.je_header_id=d.je_header_id
and a.ledger_id=b.ledger_id
and a.JE_HEADER_ID=d.JE_HEADER_ID
and a.code_combination_id=c.code_combination_id
--and a.PERIOD_NAME='Aug-18'
AND EFFECTIVE_DATE BETWEEN :P_DATE_FROM AND :P_DATE_TO
and   SEGMENT4=:P_ACCOUNT_CODE
 AND BAL_SEG=:P_BAL_SEG
AND SEGMENT5=NVL(:P_SUB_ACC,SEGMENT5)
AND JE_SOURCE='Manual'
           ORDER BY ACCOUNTING_DATE,VOUCHER_NUMBER
           
           --================================================================

select  distinct  UNIT_SELLING_PRICE
 from OE_ORDER_LINES_ALL where INVENTORY_ITEM_ID= 319   and SCHEDULE_SHIP_DATE between '01-JUL-2019' and '31-JUL-2019'


select  distinct INVENTORY_ITEM_ID, ORG_ID, UNIT_SELLING_PRICE , ORDERED_ITEM, PRICING_QUANTITY_UOM, UNIT_SELLING_PRICE,  UNIT_LIST_PRICE,SHIP_FROM_ORG_ID , SHIP_TO_ORG_ID  
 from OE_ORDER_LINES_ALL where INVENTORY_ITEM_ID= 319   and SCHEDULE_SHIP_DATE between '01-JUL-2019' and '31-JUL-2019'
 
select * from PO_REQUISITION_HEADERS_ALL where TYPE_LOOKUP_CODE = 'INTERNAL' and AUTHORIZATION_STATUS = 'APPROVED' and org_id= 81   and segment1= 80000034

select  distinct EVENT_TYPE_CODE , JE_CATEGORY_NAME from XLA_AE_HEADERS


select * from XLA_AE_HEADERS where DOC_SEQUENCE_VALUE = 

select * from XLA_AE_HEADERS a , GMF_XLA_EXTRACT_HEADERS B
where  A.EVENT_ID=B.EVENT_ID 

select * from  RCV_SHIPMENT_HEADERS where receipt_num= 80000173 and 

--========================= INVENTORY ACCOUNTING DATE: 19-JAN-2021 ===============================

select distinct TXN_SOURCE  from GMF_XLA_EXTRACT_HEADERS WHERE EVENT_TYPE_CODE = 'RECEIVE' --SOURCE_DOCUMENT_ID =  1025259  and INVENTORY_ITEM_ID = 5879 and EVENT_CLASS_CODE = 'DELIVER'

select * from GMF_XLA_EXTRACT_HEADERS WHERE EVENT_TYPE_CODE = 'RECEIVE'

select * from mtl_material_transactions

select * from GMF_XLA_EXTRACT_HEADERS GH,RCV_SHIPMENT_HEADERS RSH, RCV_SHIPMENT_LINES RL, RCV_TRANSACTIONS RT
    WHERE 1=1 -- SOURCE_DOCUMENT_ID = RL.SHIPMENT_HEADER_ID
 and GH.SOURCE_DOCUMENT_ID (+)= RSH.SHIPMENT_HEADER_ID
 and GH.INVENTORY_ITEM_ID = RL.ITEM_ID 
 --and GH.EVENT_CLASS_CODE = 'DELIVER'
    and RSH.SHIPMENT_HEADER_ID = RL.SHIPMENT_HEADER_ID
    and RL.SHIPMENT_LINE_ID= RT.SHIPMENT_LINE_ID
    and RSH.SHIPMENT_NUM is not null
    and SHIP_TO_ORG_ID = 121
   -- and rsh.SHIPMENT_HEADER_ID = 1025259 
   and RSH.SHIPMENT_NUM= '4181010000679'    --' ISO NO 2186010000001 , IR NO 10000009
    and RT.TRANSACTION_TYPE = 'DELIVER'          

select * from RCV_TRANSACTIONS where shipment_header_id= 1025259

select * from RCV_SHIPMENT_HEADERS where  SHIPMENT_NUM= '4201010061652' 

select * from  RCV_SHIPMENT_LINES

select * from RCV_TRANSACTIONS where SHIPMENT_HEADER_ID = 1025259 
--=================================================23 - JAN- 2021=================================

SELECT 
distinct aia.org_id,
--(select TRANSACTION_VALUE from GMF_XLA_EXTRACT_HEADERS WHERE SOURCE_DOCUMENT_ID = RSH.SHIPMENT_HEADER_ID and INVENTORY_ITEM_ID = RL.ITEM_ID and EVENT_CLASS_CODE = 'DELIVER') TRANS_VALUE,
RSH.SHIPMENT_HEADER_ID, ----
RL.SHIPMENT_LINE_ID,------
RL.ITEM_ID, -----
SUBSTR(XX_GET_HR_OPERATING_UNIT (AIA.ORG_ID),5) OPERATING_UNIT,
XX_INV_PKG.XXGET_ORG_LOCATION (AIA.ORG_ID) ORG_ADDRESS,
RT.ORGANIZATION_ID INV_ORG,
RT.TRANSACTION_DATE,
INVORG_NAME_FROM_ID (RT.ORGANIZATION_ID) INV_ORG_NAME,
 APS.VENDOR_NAME,
 APS.SEGMENT1 VENDOR_NO,
 POH.SEGMENT1 PO_NUMBER,
 POH.APPROVED_DATE  PO_APPROVED_DATE,
 (
 SELECT DESCRIPTION
 FROM MTL_SYSTEM_ITEMS_B
 WHERE INVENTORY_ITEM_ID = POL.ITEM_ID
 AND ORGANIZATION_ID = PLL.SHIP_TO_ORGANIZATION_ID
 ) ITEM_DESCRIPTION,
   POL.UNIT_MEAS_LOOKUP_CODE UOM,
  RT.QUANTITY DELIVERD_QTY,
 POL.UNIT_PRICE,
 RT.QUANTITY * POL.UNIT_PRICE AMOUNT,
--  (
--  SELECT SUM ( (PLA.UNIT_PRICE * PLA.QUANTITY)) PRICE
--   FROM PO_LINES_ALL PLA, PO_HEADERS_ALL PHA
--   WHERE PLA.PO_HEADER_ID = PHA.PO_HEADER_ID
--   AND PHA.ORG_ID = AIA.ORG_ID
--   AND PHA.SEGMENT1 =POH.SEGMENT1
--         ) PO_AMOUNT,
 RSH.RECEIPT_NUM GRN_NUMBER, 
RT.CREATION_DATE GRN_DATE,
--RL.QUANTITY_RECEIVED,
--RT.QUANTITY QUANTITY_DELIVERED,
 AIA.INVOICE_NUM,
 AIA.INVOICE_DATE,
AIA.GL_DATE ,
AIA.INVOICE_AMOUNT, 
 AIA.DOC_SEQUENCE_VALUE INV_VOUCHER_NO,
 XX_GET_EMP_NAME_FROM_USER_ID (AIA.CREATED_BY) INV_CREATED_BY,
 ( SELECT CONCATENATED_SEGMENTS
 FROM GL_CODE_COMBINATIONS_KFV
 WHERE CODE_COMBINATION_ID = AIDA.DIST_CODE_COMBINATION_ID
 ) DIST_GL_CODE,
ACA.DOC_SEQUENCE_VALUE PAYMENT_VOUCHER,
ACA.CREATION_DATE PAY_CREATE_DATE
,ACA.DOC_CATEGORY_CODE PAYMENT_TYPE
,ACA.STATUS_LOOKUP_CODE PAYMENT_STATUS
,ACA.AMOUNT PAY_AMOUNT
,XX_ONT_GET_ENAME(:P_USER) PRINTED_BY 
,TRANSACTION_VALUE INV_VALUE
FROM 
GMF_XLA_EXTRACT_HEADERS GH,
AP_INVOICES_ALL AIA,
 AP_INVOICE_LINES_ALL AILA,
 AP_SUPPLIERS APS,
 AP_SUPPLIER_SITES_ALL APSS,
 AP_INVOICE_DISTRIBUTIONS_ALL AIDA,
 PO_HEADERS_ALL POH,
 PO_LINES_ALL POL,
 PO_LINE_LOCATIONS_ALL PLL,
 PO_DISTRIBUTIONS_ALL PDA,
 RCV_SHIPMENT_HEADERS RSH,
 RCV_SHIPMENT_LINES RL,
  RCV_TRANSACTIONS RT,
AP_INVOICE_PAYMENTS_ALL AIPA, 
AP_CHECKS_ALL ACA
WHERE 
 GH.SOURCE_DOCUMENT_ID = RSH.SHIPMENT_HEADER_ID
 and GH.INVENTORY_ITEM_ID = RL.ITEM_ID 
 and GH.EVENT_CLASS_CODE = 'DELIVER'
and AIA.INVOICE_ID = AILA.INVOICE_ID
AND AILA.ORG_ID = AIA.ORG_ID
AND AILA.PO_HEADER_ID = POH.PO_HEADER_ID
AND AILA.PO_LINE_ID = POL.PO_LINE_ID
AND AILA.INVOICE_ID =AIDA.INVOICE_ID
AND AIA.VENDOR_ID = APS.VENDOR_ID
AND AIA.VENDOR_SITE_ID = APSS.VENDOR_SITE_ID
AND AIA.VENDOR_ID = APSS.VENDOR_ID
AND APSS.ORG_ID = AIA.ORG_ID
AND AIDA.INVOICE_LINE_NUMBER = AILA.LINE_NUMBER
AND AIDA.ORG_ID= AILA.ORG_ID
AND POH.PO_HEADER_ID = POL.PO_HEADER_ID
AND PLL.PO_HEADER_ID = POH.PO_HEADER_ID
AND PLL.PO_LINE_ID = POL.PO_LINE_ID
AND PLL.LINE_LOCATION_ID = PDA.LINE_LOCATION_ID
AND PLL.PO_HEADER_ID = PDA.PO_HEADER_ID
AND PLL.PO_LINE_ID = PDA.PO_LINE_ID
AND POL.ORG_ID = PDA.ORG_ID
AND POH.ORG_ID = PLL.ORG_ID
AND AILA.RCV_TRANSACTION_ID = RT.TRANSACTION_ID
AND RT.SHIPMENT_HEADER_ID = RSH.SHIPMENT_HEADER_ID
AND RSH.SHIPMENT_HEADER_ID =RL.SHIPMENT_HEADER_ID 
AND RL.SHIPMENT_LINE_ID= RT.SHIPMENT_LINE_ID
AND AIA.INVOICE_ID=AIPA.INVOICE_ID(+)
AND AIPA.CHECK_ID=ACA.CHECK_ID(+)
AND PDA.GL_CANCELLED_DATE is NULL
AND (:P_OU_ID IS NULL OR AIA.ORG_ID = :P_OU_ID) --AP org id
--AND (:P_VENDOR_NO IS NULL OR aps.segment1 = :P_VENDOR_NO) --aps.segment1 for supplier/vendor name
AND (:P_GRN_FROM_DT IS NULL OR TRUNC(RT.TRANSACTION_DATE) BETWEEN :P_GRN_FROM_DT AND :P_GRN_TO_DT) 
AND (:P_PO_NO IS NULL OR poh.segment1 = :P_PO_NO) 
AND (:P_GRN_NO IS NULL OR rsh.receipt_num = :P_GRN_NO)
and RT.ORGANIZATION_ID = NVL(:P_INV_ORG, RT.ORGANIZATION_ID) 
 --and RSH.RECEIPT_NUM= 80000140
UNION ALL

SELECT 
--GET_REQUISITION_NO_FRM_ID(GH.OPERATING_UNIT , PRL.REQUISITION_HEADER_ID ) REQUISITION_NUMBER,
--GET_LIST_PRICR_FROM_ITEM(RL.ITEM_ID, NULL , :P_GRN_FROM_DT ,:P_GRN_TO_DT),
--SUM(CASE WHEN GH.TRANSACTION_TYPE_ID IN (17,18,1002,1003) THEN GH.TRANSACTION_VALUE
--WHEN GH.TRANSACTION_TYPE_ID IN (44) THEN GH.TRANSACTION_VALUE -----INV_TRANS.ACCOUNTED_DR
----WHEN GH.TRANSACTION_TYPE_ID IN (61) THEN GH.ACCOUNTED_DR
----WHEN GH.TRANSACTION_TYPE_ID IN (12) THEN GH.ACCOUNTED_DR
--WHEN NVL(GH.TRANSACTION_TYPE_ID,11111)=11111 AND GH.EVENT_TYPE_CODE = 'GLCOSTALOC' THEN GH.TRANSACTION_VALUE
--WHEN NVL(GH.TRANSACTION_TYPE_ID,2222)=2222 AND GH.EVENT_TYPE_CODE = 'LC_ADJUST_VALUATION' THEN GH.TRANSACTION_VALUE
--WHEN GH.TRANSACTION_TYPE_ID=-99 THEN GH.TRANSACTION_VALUE ELSE 0 END) RCV_VAL,
----( SELECT GH.transaction_VALUE   from rcv_msh_v rmv ,mtl_material_transactions mmt
--where rmv.SHIPMENT_NUM=mmt.SHIPMENT_NUMBER
--and GH.transaction_id= mmt.transaction_id
--and GH.event_id= AE.event_id
--and mmt.transaction_Id=GH.transaction_Id
--) TEST,
--(CASE WHEN GH.TRANSACTION_TYPE_ID IN (17,18,1002,1003) THEN GH.TRANSACTION_VALUE
--WHEN GH.TRANSACTION_TYPE_ID IN (44) THEN GH.TRANSACTION_VALUE ---- NVL(INV_TRANS.ACCOUNTED_DR,0)
--WHEN GH.TRANSACTION_TYPE_ID IN (61) THEN AL.ACCOUNTED_DR
--WHEN GH.TRANSACTION_TYPE_ID IN (12) THEN AL.ACCOUNTED_DR
--WHEN NVL(GH.TRANSACTION_TYPE_ID,11111)=11111 AND GH.EVENT_TYPE_CODE = 'GLCOSTALOC' THEN GH.TRANSACTION_VALUE
--WHEN NVL(GH.TRANSACTION_TYPE_ID,2222)=2222 AND GH.EVENT_TYPE_CODE = 'LC_ADJUST_VALUATION' THEN GH.TRANSACTION_VALUE
--WHEN NVL(GH.TRANSACTION_TYPE_ID,0)=0 AND GH.EVENT_TYPE_CODE = 'ACTCOSTADJ' THEN GH.TRANSACTION_VALUE
--WHEN GH.TRANSACTION_TYPE_ID=-99 THEN GH.TRANSACTION_VALUE ELSE 0 END) RCV_VAL,
GH.OPERATING_UNIT org_id,
                RSH.SHIPMENT_HEADER_ID,
                RL.SHIPMENT_LINE_ID,
                RL.ITEM_ID,              
                SUBSTR(XX_GET_HR_OPERATING_UNIT (GH.OPERATING_UNIT),5) OPERATING_UNIT,
                XX_INV_PKG.XXGET_ORG_LOCATION (GH.OPERATING_UNIT) ORG_ADDRESS,
                RT.ORGANIZATION_ID INV_ORG,
                RT.TRANSACTION_DATE,
               INVORG_NAME_FROM_ID (RT.ORGANIZATION_ID) INV_ORG_NAME,
               (SELECT OPERATING_UNIT_NAME FROM WBI_INV_ORG_DETAIL WHERE INV_ORGANIZATION_ID = RSH.ORGANIZATION_ID) VENDOR_NAME,
               -- XXGET_OU_NAME_FROM_ID( RSH.ORGANIZATION_ID),  --APS.VENDOR_NAME,
                NULL , -- APS.SEGMENT1 VENDOR_NO,
                NULL , --POH.SEGMENT1 PO_NUMBER,
                NULL , --POH.APPROVED_DATE  PO_APPROVED_DATE,
               (SELECT DESCRIPTION FROM MTL_SYSTEM_ITEMS_B WHERE INVENTORY_ITEM_ID = RL.ITEM_ID AND ORGANIZATION_ID = RSH.SHIP_TO_ORG_ID) ITEM_DESCRIPTION,
               PRL.UNIT_MEAS_LOOKUP_CODE UOM,
               RT.QUANTITY DELIVERD_QTY,
                (select  DISTINCT  NVL(UNIT_SELLING_PRICE,0) 
 from OE_ORDER_LINES_ALL 
 where 1=1
 --and INVENTORY_ITEM_ID=319
 and SOURCE_DOCUMENT_LINE_ID = PRL.REQUISITION_LINE_ID
 and INVENTORY_ITEM_ID = RL.ITEM_ID
  and UNIT_SELLING_PRICE <> 0
 and  SHIP_FROM_ORG_ID = RSH.ORGANIZATION_ID
 --and SHIP_FROM_ORG_ID IS NULL OR SHIP_FROM_ORG_ID = 163
 and SCHEDULE_SHIP_DATE between :P_GRN_FROM_DT and :P_GRN_TO_DT) UNIT_PRICE,
  RT.QUANTITY  * (select  DISTINCT  NVL(UNIT_SELLING_PRICE,0) 
 from OE_ORDER_LINES_ALL 
 where 1=1
 --and INVENTORY_ITEM_ID=319
 and SOURCE_DOCUMENT_LINE_ID = PRL.REQUISITION_LINE_ID
 and INVENTORY_ITEM_ID = RL.ITEM_ID
  and UNIT_SELLING_PRICE <> 0
 and  SHIP_FROM_ORG_ID = RSH.ORGANIZATION_ID
 --and SHIP_FROM_ORG_ID IS NULL OR SHIP_FROM_ORG_ID = 163
 and SCHEDULE_SHIP_DATE between :P_GRN_FROM_DT and :P_GRN_TO_DT)  AMOUNT ,  -- POL.QUANTITY* POL.UNIT_PRICE PO_AMOUNT,
                RSH.RECEIPT_NUM GRN_NUMBER, 
                RT.CREATION_DATE GRN_DATE,
               NULL , -- AIA.INVOICE_NUM,
              NULL , -- AIA.INVOICE_DATE,
                NULL , --AIA.GL_DATE ,
                NULL , ---AIA.INVOICE_AMOUNT, 
              NULL , --AIA.DOC_SEQUENCE_VALUE INV_VOUCHER_NO,
                NULL , ---XX_GET_EMP_NAME_FROM_USER_ID (AIA.CREATED_BY) INV_CREATED_BY,
                SEGMENT1||'.'||SEGMENT2||'.'||SEGMENT3||'.'||SEGMENT4||'.'||SEGMENT5 ||'.'||SEGMENT6 ||'.'||SEGMENT7 ||'.'||SEGMENT8 ||'.'||SEGMENT9 ||'.'||SEGMENT10 DIST_GL_CODE , 
                -- ( SELECT CONCATENATED_SEGMENTS FROM GL_CODE_COMBINATIONS_KFV WHERE CODE_COMBINATION_ID = AIDA.DIST_CODE_COMBINATION_ID ) DIST_GL_CODE,
                NULL , --ACA.DOC_SEQUENCE_VALUE PAYMENT_VOUCHER,
 NULL , --ACA.CREATION_DATE PAY_CREATE_DATE
 NULL , --,ACA.DOC_CATEGORY_CODE PAYMENT_TYPE
NULL , --,ACA.STATUS_LOOKUP_CODE PAYMENT_STATUS
 NULL --,ACA.AMOUNT PAY_AMOUNT
,XX_ONT_GET_ENAME(:P_USER) PRINTED_BY 
,GH.TRANSACTION_VALUE
--AE.EVENT_TYPE_CODE , AE.JE_CATEGORY_NAME,
--XX_GET_ACCT_FLEX_SEG_DESC(4,SEGMENT4) ACCOUNT_DESC,
--SEGMENT1||'.'||SEGMENT2||'.'||SEGMENT3||'.'||SEGMENT4||'.'||SEGMENT5 GL_CODE
from GMF_XLA_EXTRACT_HEADERS GH, XLA_AE_HEADERS AE, XLA_AE_LINES AL,GL_CODE_COMBINATIONS GC, RCV_SHIPMENT_HEADERS RSH, RCV_SHIPMENT_LINES RL,PO_REQUISITION_LINES_ALL PRL, RCV_TRANSACTIONS RT
WHERE 1=1 -- SOURCE_DOCUMENT_ID = RL.SHIPMENT_HEADER_ID
AND AE.EVENT_ID=GH.EVENT_ID 
and RL.REQUISITION_LINE_ID = PRL.REQUISITION_LINE_ID
AND  AE.AE_HEADER_ID=AL.AE_HEADER_ID
AND GC.CODE_COMBINATION_ID=AL.CODE_COMBINATION_ID
 and GH.SOURCE_DOCUMENT_ID (+)= RSH.SHIPMENT_HEADER_ID
 and GH.INVENTORY_ITEM_ID = RL.ITEM_ID 
 --and GH.EVENT_CLASS_CODE = 'DELIVER'
    and RSH.SHIPMENT_HEADER_ID = RL.SHIPMENT_HEADER_ID
    and RL.SHIPMENT_LINE_ID= RT.SHIPMENT_LINE_ID
    and RSH.SHIPMENT_NUM is not null
   AND (:P_OU_ID IS NULL OR GH.OPERATING_UNIT = :P_OU_ID)
    and RSH.SHIP_TO_ORG_ID = NVL(:P_INV_ORG, RSH.SHIP_TO_ORG_ID) 
    AND (:P_GRN_FROM_DT IS NULL OR TRUNC(RT.TRANSACTION_DATE) BETWEEN :P_GRN_FROM_DT AND :P_GRN_TO_DT) 
    --and rsh.SHIPMENT_HEADER_ID = 1025259 
-- and RSH.SHIPMENT_NUM= '4181010000679'    --' ISO NO 2186010000001 , IR NO 10000009
    and RT.TRANSACTION_TYPE = 'DELIVER' 
   and RSH.RECEIPT_NUM= 80000140
    and SEGMENT4= 4030107
    GROUP BY GH.TRANSACTION_TYPE_ID, GH.TRANSACTION_VALUE, AL.ACCOUNTED_DR, AL.ACCOUNTED_CR, GH.EVENT_TYPE_CODE , GH.OPERATING_UNIT ,
                RSH.SHIPMENT_HEADER_ID,
                RL.SHIPMENT_LINE_ID,
                RL.ITEM_ID,
                RT.QUANTITY ,
                       RT.ORGANIZATION_ID ,
                RT.TRANSACTION_DATE,
                RSH.ORGANIZATION_ID,
                RSH.SHIP_TO_ORG_ID,
                 RSH.RECEIPT_NUM , 
                RT.CREATION_DATE ,
                 SEGMENT1||'.'||SEGMENT2||'.'||SEGMENT3||'.'||SEGMENT4||'.'||SEGMENT5 ||'.'||SEGMENT6 ||'.'||SEGMENT7 ||'.'||SEGMENT8 ||'.'||SEGMENT9 ||'.'||SEGMENT10, PRL.REQUISITION_LINE_ID,  
                 PRL.UNIT_MEAS_LOOKUP_CODE, PRL.REQUISITION_HEADER_ID

    
     
--==========================================================================================             
SELECT 
distinct aia.org_id,
--(select TRANSACTION_VALUE from GMF_XLA_EXTRACT_HEADERS WHERE SOURCE_DOCUMENT_ID = RSH.SHIPMENT_HEADER_ID and INVENTORY_ITEM_ID = RL.ITEM_ID and EVENT_CLASS_CODE = 'DELIVER') TRANS_VALUE,
RSH.SHIPMENT_HEADER_ID, ----
RL.SHIPMENT_LINE_ID,------
RL.ITEM_ID, -----
RT.QUANTITY DELIVERD_QTY,
SUBSTR(XX_GET_HR_OPERATING_UNIT (AIA.ORG_ID),5) OPERATING_UNIT,
XX_INV_PKG.XXGET_ORG_LOCATION (AIA.ORG_ID) ORG_ADDRESS,
RT.ORGANIZATION_ID INV_ORG,
RT.TRANSACTION_DATE,
INVORG_NAME_FROM_ID (RT.ORGANIZATION_ID) INV_ORG_NAME,
 APS.VENDOR_NAME,
 APS.SEGMENT1 VENDOR_NO,
 POH.SEGMENT1 PO_NUMBER,
 POH.APPROVED_DATE  PO_APPROVED_DATE,
 (
 SELECT DESCRIPTION
 FROM MTL_SYSTEM_ITEMS_B
 WHERE INVENTORY_ITEM_ID = POL.ITEM_ID
 AND ORGANIZATION_ID = PLL.SHIP_TO_ORGANIZATION_ID
 ) ITEM_DESCRIPTION,
  POL.QUANTITY* POL.UNIT_PRICE PO_AMOUNT,
--  (
--  SELECT SUM ( (PLA.UNIT_PRICE * PLA.QUANTITY)) PRICE
--   FROM PO_LINES_ALL PLA, PO_HEADERS_ALL PHA
--   WHERE PLA.PO_HEADER_ID = PHA.PO_HEADER_ID
--   AND PHA.ORG_ID = AIA.ORG_ID
--   AND PHA.SEGMENT1 =POH.SEGMENT1
--         ) PO_AMOUNT,
 RSH.RECEIPT_NUM GRN_NUMBER, 
RT.CREATION_DATE GRN_DATE,
--RL.QUANTITY_RECEIVED,
--RT.QUANTITY QUANTITY_DELIVERED,
 AIA.INVOICE_NUM,
 AIA.INVOICE_DATE,
AIA.GL_DATE ,
AIA.INVOICE_AMOUNT, 
 AIA.DOC_SEQUENCE_VALUE INV_VOUCHER_NO,
 XX_GET_EMP_NAME_FROM_USER_ID (AIA.CREATED_BY) INV_CREATED_BY,
 ( SELECT CONCATENATED_SEGMENTS
 FROM GL_CODE_COMBINATIONS_KFV
 WHERE CODE_COMBINATION_ID = AIDA.DIST_CODE_COMBINATION_ID
 ) DIST_GL_CODE,
ACA.DOC_SEQUENCE_VALUE PAYMENT_VOUCHER,
ACA.CREATION_DATE PAY_CREATE_DATE
,ACA.DOC_CATEGORY_CODE PAYMENT_TYPE
,ACA.STATUS_LOOKUP_CODE PAYMENT_STATUS
,ACA.AMOUNT PAY_AMOUNT
,XX_ONT_GET_ENAME(:P_USER) PRINTED_BY 
,TRANSACTION_VALUE INV_VALUE
FROM 
GMF_XLA_EXTRACT_HEADERS GH,
AP_INVOICES_ALL AIA,
 AP_INVOICE_LINES_ALL AILA,
 AP_SUPPLIERS APS,
 AP_SUPPLIER_SITES_ALL APSS,
 AP_INVOICE_DISTRIBUTIONS_ALL AIDA,
 PO_HEADERS_ALL POH,
 PO_LINES_ALL POL,
 PO_LINE_LOCATIONS_ALL PLL,
 PO_DISTRIBUTIONS_ALL PDA,
 RCV_SHIPMENT_HEADERS RSH,
 RCV_SHIPMENT_LINES RL,
  RCV_TRANSACTIONS RT,
AP_INVOICE_PAYMENTS_ALL AIPA, 
AP_CHECKS_ALL ACA
WHERE 
 GH.SOURCE_DOCUMENT_ID = RSH.SHIPMENT_HEADER_ID
 and GH.INVENTORY_ITEM_ID = RL.ITEM_ID 
 and GH.EVENT_CLASS_CODE = 'DELIVER'
and AIA.INVOICE_ID = AILA.INVOICE_ID
AND AILA.ORG_ID = AIA.ORG_ID
AND AILA.PO_HEADER_ID = POH.PO_HEADER_ID
AND AILA.PO_LINE_ID = POL.PO_LINE_ID
AND AILA.INVOICE_ID =AIDA.INVOICE_ID
AND AIA.VENDOR_ID = APS.VENDOR_ID
AND AIA.VENDOR_SITE_ID = APSS.VENDOR_SITE_ID
AND AIA.VENDOR_ID = APSS.VENDOR_ID
AND APSS.ORG_ID = AIA.ORG_ID
AND AIDA.INVOICE_LINE_NUMBER = AILA.LINE_NUMBER
AND AIDA.ORG_ID= AILA.ORG_ID
AND POH.PO_HEADER_ID = POL.PO_HEADER_ID
AND PLL.PO_HEADER_ID = POH.PO_HEADER_ID
AND PLL.PO_LINE_ID = POL.PO_LINE_ID
AND PLL.LINE_LOCATION_ID = PDA.LINE_LOCATION_ID
AND PLL.PO_HEADER_ID = PDA.PO_HEADER_ID
AND PLL.PO_LINE_ID = PDA.PO_LINE_ID
AND POL.ORG_ID = PDA.ORG_ID
AND POH.ORG_ID = PLL.ORG_ID
AND AILA.RCV_TRANSACTION_ID = RT.TRANSACTION_ID
AND RT.SHIPMENT_HEADER_ID = RSH.SHIPMENT_HEADER_ID
AND RSH.SHIPMENT_HEADER_ID =RL.SHIPMENT_HEADER_ID 
AND RL.SHIPMENT_LINE_ID= RT.SHIPMENT_LINE_ID
AND AIA.INVOICE_ID=AIPA.INVOICE_ID(+)
AND AIPA.CHECK_ID=ACA.CHECK_ID(+)
AND PDA.GL_CANCELLED_DATE is NULL
AND (:P_OU_ID IS NULL OR AIA.ORG_ID = :P_OU_ID) --AP org id
--AND (:P_VENDOR_NO IS NULL OR aps.segment1 = :P_VENDOR_NO) --aps.segment1 for supplier/vendor name
AND (:P_GRN_FROM_DT IS NULL OR TRUNC(RT.TRANSACTION_DATE) BETWEEN :P_GRN_FROM_DT AND :P_GRN_TO_DT) 
AND (:P_PO_NO IS NULL OR poh.segment1 = :P_PO_NO) 
AND (:P_GRN_NO IS NULL OR rsh.receipt_num = :P_GRN_NO)
and RT.ORGANIZATION_ID = NVL(:P_INV_ORG, RT.ORGANIZATION_ID) 
 --and RSH.RECEIPT_NUM= 80000140
 
UNION ALL

select TRANSACTION_TYPE_ID from XLA_AE_LINES

select distinct * from GMF_XLA_EXTRACT_HEADERS  GH where GH.TRANSACTION_TYPE_ID IN (44,61,12)   and TRANSACTION_DATE between '01-JUL-2019' and '31-JUL-2020' and EVENT_TYPE_CODE = 'FOB_SHIP_RECIPIENT_SHIP_TP'

SELECT  --GH.transaction_Id,
SUM(CASE WHEN GH.TRANSACTION_TYPE_ID IN (17,18,1002,1003) THEN GH.TRANSACTION_VALUE
WHEN GH.TRANSACTION_TYPE_ID IN (44) THEN GH.TRANSACTION_VALUE -----INV_TRANS.ACCOUNTED_DR
--WHEN GH.TRANSACTION_TYPE_ID IN (61) THEN GH.ACCOUNTED_DR
--WHEN GH.TRANSACTION_TYPE_ID IN (12) THEN GH.ACCOUNTED_DR
WHEN NVL(GH.TRANSACTION_TYPE_ID,11111)=11111 AND GH.EVENT_TYPE_CODE = 'GLCOSTALOC' THEN GH.TRANSACTION_VALUE
WHEN NVL(GH.TRANSACTION_TYPE_ID,2222)=2222 AND GH.EVENT_TYPE_CODE = 'LC_ADJUST_VALUATION' THEN GH.TRANSACTION_VALUE
WHEN GH.TRANSACTION_TYPE_ID=-99 THEN GH.TRANSACTION_VALUE ELSE 0 END) RCV_VAL,
--( SELECT GH.transaction_VALUE   from rcv_msh_v rmv ,mtl_material_transactions mmt
--where rmv.SHIPMENT_NUM=mmt.SHIPMENT_NUMBER
--and GH.transaction_id= mmt.transaction_id
--and GH.event_id= AE.event_id
--and mmt.transaction_Id=GH.transaction_Id
--) TEST,
(CASE WHEN GH.TRANSACTION_TYPE_ID IN (17,18,1002,1003) THEN GH.TRANSACTION_VALUE
WHEN GH.TRANSACTION_TYPE_ID IN (44) THEN GH.TRANSACTION_VALUE ---- NVL(INV_TRANS.ACCOUNTED_DR,0)
WHEN GH.TRANSACTION_TYPE_ID IN (61) THEN AL.ACCOUNTED_DR
WHEN GH.TRANSACTION_TYPE_ID IN (12) THEN AL.ACCOUNTED_DR
WHEN NVL(GH.TRANSACTION_TYPE_ID,11111)=11111 AND GH.EVENT_TYPE_CODE = 'GLCOSTALOC' THEN GH.TRANSACTION_VALUE
WHEN NVL(GH.TRANSACTION_TYPE_ID,2222)=2222 AND GH.EVENT_TYPE_CODE = 'LC_ADJUST_VALUATION' THEN GH.TRANSACTION_VALUE
WHEN NVL(GH.TRANSACTION_TYPE_ID,0)=0 AND GH.EVENT_TYPE_CODE = 'ACTCOSTADJ' THEN GH.TRANSACTION_VALUE
WHEN GH.TRANSACTION_TYPE_ID=-99 THEN GH.TRANSACTION_VALUE ELSE 0 END) RCV_VAL,
GH.OPERATING_UNIT org_id,
                RSH.SHIPMENT_HEADER_ID,
                RL.SHIPMENT_LINE_ID,
                RL.ITEM_ID,
                RT.QUANTITY DELIVERD_QTY,
                SUBSTR(XX_GET_HR_OPERATING_UNIT (GH.OPERATING_UNIT),5) OPERATING_UNIT,
                XX_INV_PKG.XXGET_ORG_LOCATION (GH.OPERATING_UNIT) ORG_ADDRESS,
                RT.ORGANIZATION_ID INV_ORG,
                RT.TRANSACTION_DATE,
               INVORG_NAME_FROM_ID (RT.ORGANIZATION_ID) INV_ORG_NAME,
               (SELECT OPERATING_UNIT_NAME FROM WBI_INV_ORG_DETAIL WHERE INV_ORGANIZATION_ID = RSH.ORGANIZATION_ID) VENDOR_NAME,
               -- XXGET_OU_NAME_FROM_ID( RSH.ORGANIZATION_ID),  --APS.VENDOR_NAME,
                NULL , -- APS.SEGMENT1 VENDOR_NO,
                NULL , --POH.SEGMENT1 PO_NUMBER,
                NULL , --POH.APPROVED_DATE  PO_APPROVED_DATE,
               (SELECT DESCRIPTION FROM MTL_SYSTEM_ITEMS_B WHERE INVENTORY_ITEM_ID = RL.ITEM_ID AND ORGANIZATION_ID = RSH.SHIP_TO_ORG_ID ) ITEM_DESCRIPTION,
                NULL ,   -- POL.QUANTITY* POL.UNIT_PRICE PO_AMOUNT,
                RSH.RECEIPT_NUM GRN_NUMBER, 
                RT.CREATION_DATE GRN_DATE,
               NULL , -- AIA.INVOICE_NUM,
              NULL , -- AIA.INVOICE_DATE,
                NULL , --AIA.GL_DATE ,
                NULL , ---AIA.INVOICE_AMOUNT, 
              NULL , --AIA.DOC_SEQUENCE_VALUE INV_VOUCHER_NO,
                NULL , ---XX_GET_EMP_NAME_FROM_USER_ID (AIA.CREATED_BY) INV_CREATED_BY,
                SEGMENT1||'.'||SEGMENT2||'.'||SEGMENT3||'.'||SEGMENT4||'.'||SEGMENT5 ||'.'||SEGMENT6 ||'.'||SEGMENT7 ||'.'||SEGMENT8 ||'.'||SEGMENT9 ||'.'||SEGMENT10 DIST_GL_CODE , 
                -- ( SELECT CONCATENATED_SEGMENTS FROM GL_CODE_COMBINATIONS_KFV WHERE CODE_COMBINATION_ID = AIDA.DIST_CODE_COMBINATION_ID ) DIST_GL_CODE,
                NULL , --ACA.DOC_SEQUENCE_VALUE PAYMENT_VOUCHER,
 NULL , --ACA.CREATION_DATE PAY_CREATE_DATE
 NULL , --,ACA.DOC_CATEGORY_CODE PAYMENT_TYPE
NULL , --,ACA.STATUS_LOOKUP_CODE PAYMENT_STATUS
 NULL --,ACA.AMOUNT PAY_AMOUNT
,XX_ONT_GET_ENAME(:P_USER) PRINTED_BY 
,GH.TRANSACTION_VALUE
--AE.EVENT_TYPE_CODE , AE.JE_CATEGORY_NAME,
--XX_GET_ACCT_FLEX_SEG_DESC(4,SEGMENT4) ACCOUNT_DESC,
--SEGMENT1||'.'||SEGMENT2||'.'||SEGMENT3||'.'||SEGMENT4||'.'||SEGMENT5 GL_CODE
from GMF_XLA_EXTRACT_HEADERS GH, XLA_AE_HEADERS AE, XLA_AE_LINES AL,GL_CODE_COMBINATIONS GC, RCV_SHIPMENT_HEADERS RSH, RCV_SHIPMENT_LINES RL, RCV_TRANSACTIONS RT
WHERE 1=1 -- SOURCE_DOCUMENT_ID = RL.SHIPMENT_HEADER_ID
AND AE.EVENT_ID=GH.EVENT_ID 
AND  AE.AE_HEADER_ID=AL.AE_HEADER_ID
AND GC.CODE_COMBINATION_ID=AL.CODE_COMBINATION_ID
 and GH.SOURCE_DOCUMENT_ID (+)= RSH.SHIPMENT_HEADER_ID
 and GH.INVENTORY_ITEM_ID = RL.ITEM_ID 
 --and GH.EVENT_CLASS_CODE = 'DELIVER'
    and RSH.SHIPMENT_HEADER_ID = RL.SHIPMENT_HEADER_ID
    and RL.SHIPMENT_LINE_ID= RT.SHIPMENT_LINE_ID
    and RSH.SHIPMENT_NUM is not null
   AND (:P_OU_ID IS NULL OR GH.OPERATING_UNIT = :P_OU_ID)
    and RSH.SHIP_TO_ORG_ID = NVL(:P_INV_ORG, RSH.SHIP_TO_ORG_ID) 
    AND (:P_GRN_FROM_DT IS NULL OR TRUNC(RT.TRANSACTION_DATE) BETWEEN :P_GRN_FROM_DT AND :P_GRN_TO_DT) 
    --and rsh.SHIPMENT_HEADER_ID = 1025259 
  and RSH.SHIPMENT_NUM= '4181010000679'    --' ISO NO 2186010000001 , IR NO 10000009
    and RT.TRANSACTION_TYPE = 'DELIVER' 
  --  and RSH.RECEIPT_NUM= 80000140
    and SEGMENT4= 4030107
    GROUP BY GH.TRANSACTION_TYPE_ID, GH.TRANSACTION_VALUE, AL.ACCOUNTED_DR, AL.ACCOUNTED_CR, GH.EVENT_TYPE_CODE , GH.OPERATING_UNIT ,
                RSH.SHIPMENT_HEADER_ID,
                RL.SHIPMENT_LINE_ID,
                RL.ITEM_ID,
                RT.QUANTITY ,
                                RT.ORGANIZATION_ID ,
                RT.TRANSACTION_DATE,
                RSH.ORGANIZATION_ID,
                RSH.SHIP_TO_ORG_ID,
                 RSH.RECEIPT_NUM , 
                RT.CREATION_DATE ,
                 SEGMENT1||'.'||SEGMENT2||'.'||SEGMENT3||'.'||SEGMENT4||'.'||SEGMENT5 ||'.'||SEGMENT6 ||'.'||SEGMENT7 ||'.'||SEGMENT8 ||'.'||SEGMENT9 ||'.'||SEGMENT10

select * from XLA_AE_HEADERS where AE_HEADER_ID= 31042443 -- 31038835

select * from GMF_XLA_EXTRACT_HEADERS where HEADER_ID= 31042443

--================ 14-JAN-2021  === FOR KARIM SIR , SUGESTED BY MAMUN SIR 

--XX_INV_PKG
--
--MY_PACKAGE

 select * from    WBI_INV_RCV_TRANSACTIONS_F where  requisition_line_id in (947365,947361) and TRANSACTION_TYPE ='DELIVER' 
                        
select ORGANIZATION_ID,ORGANIZATION_NAME ,PR_NO,IOT_IR_FROM_ORG,GET_ORG_NAME_FROM_ID(IOT_IR_FROM_ORG) FROM_ORG, INVENTORY_ITEM_ID,ITEM_CODE,  ITEM_DESC,UOM,SHIPMENT_NUM, RECEIPT_NO,REF_GRN_QTY GRN_QTY,TO_CHAR(TRUNC(TRANS_DATE),'DD-MON-RRRR') TRANSACTION_DATE,
CHALLAN_NUMBER_RT,IOT_IR_FROM_ORG
 from    WBI_INV_RCV_TRANSACTIONS_F
  where  ORGANIZATION_ID = 121
   -- and ITEM_DESC like '%MS%BIL%'
     and ITEM_DESC like '%STONE%CHIP%'
-- and requisition_line_id in (947365,947361) 
  and TRANSACTION_TYPE ='DELIVER' 
  --and TRANS_DATE between '01-JUL-2019' and '31-JUL-2019'

--=====================================================================================================================


GMF_CMCOMMON.GET_CMPT_COST(GPB.INVENTORY_ITEM_ID,GPB.ORGANIZATION_ID, TRUNC(TO_DATE((TO_CHAR((TO_DATE('01-'||:P_PERIOD_CODE))-1,'MON-YY')),'MON-YY')),1000,0) 


select  *
from (SELECT  gbh.batch_no, gbh.batch_id, gbh.attribute3 shift,
       gmd.inventory_item_id,
       gmd.actual_qty
  FROM gme_batch_header gbh, gme_material_details gmd, mtl_system_items_b msi
 WHERE gbh.organization_id = gmd.organization_id
   AND msi.organization_id = gmd.organization_id
   AND gmd.inventory_item_id = msi.inventory_item_id
   AND gbh.batch_id = gmd.batch_id
   AND gbh.organization_id = :P_ORG
   AND gbh.batch_id = NVL(:P_BATCH_ID , gbh.batch_id) -- 697099
 --  AND gmd.line_type = '2'
and gmd.inventory_item_id in(333,35611,21042,21038,70,21041,21040,21029,21039))
--PIVOT ( sum(actual_qty) for (inventory_item_id) in(333 as "MS BILLET 160 MM X 160 MM",35611 as "MS BILLET 160 MM X 160 MM X",21042 as "SCRAP BAR (ROLLING SCRAP)(MT)",
--21038 as "HEAD AND TAIL CUT",70 as "KSRM 400/GRADE 60 10 MM(MT)", 21041 as "CHOPPING (ROLLING SCRAP)(MT)", 21040 as "COBBLE (ROLLING SCRAP)(MT)" , 21029 as "KSRM 400/GRADE 60 10 MM", 21039 as "MILL SCALE(KG)" ))
PIVOT ( sum(actual_qty) for (inventory_item_id) in(333 as "MS BILLET 160 MM X 160 MM",35611 as "MS BILLET 160 MM X 160 MM X",21042 as "SCRAP BAR (ROLLING SCRAP)(MT)",
21038 as "HEAD AND TAIL CUT",70 as "KSRM 400/GRADE 60 10 MM(MT)", 21041 as "CHOPPING (ROLLING SCRAP)(MT)", 21040 as "COBBLE (ROLLING SCRAP)(MT)" , 21029 as "KSRM 400/GRADE 60 10 MM", 21039 as "MILL SCALE(KG)" ))
UNION ALL
select  *
from (SELECT  gbh.batch_no, gbh.batch_id, gbh.attribute3 shift,
       gmd.inventory_item_id,
      GMD.COST_ALLOC
  FROM gme_batch_header gbh, gme_material_details gmd, mtl_system_items_b msi
 WHERE gbh.organization_id = gmd.organization_id
   AND msi.organization_id = gmd.organization_id
   AND gmd.inventory_item_id = msi.inventory_item_id
   AND gbh.batch_id = gmd.batch_id
   AND gbh.organization_id = :P_ORG
   AND gbh.batch_id = NVL(:P_BATCH_ID , gbh.batch_id) -- 697099
 --  AND gmd.line_type = '2'
and gmd.inventory_item_id in(333,35611,21042,21038,70,21041,21040,21029,21039))
--PIVOT ( sum(actual_qty) for (inventory_item_id) in(333 as "MS BILLET 160 MM X 160 MM",35611 as "MS BILLET 160 MM X 160 MM X",21042 as "SCRAP BAR (ROLLING SCRAP)(MT)",
--21038 as "HEAD AND TAIL CUT",70 as "KSRM 400/GRADE 60 10 MM(MT)", 21041 as "CHOPPING (ROLLING SCRAP)(MT)", 21040 as "COBBLE (ROLLING SCRAP)(MT)" , 21029 as "KSRM 400/GRADE 60 10 MM", 21039 as "MILL SCALE(KG)" ))
PIVOT ( sum(COST_ALLOC) for (inventory_item_id) in(333 as "MS BILLET 160 MM X 160 MM",35611 as "MS BILLET 160 MM X 160 MM X",21042 as "SCRAP BAR (ROLLING SCRAP)(MT)",
21038 as "HEAD AND TAIL CUT",70 as "KSRM 400/GRADE 60 10 MM(MT)", 21041 as "CHOPPING (ROLLING SCRAP)(MT)", 21040 as "COBBLE (ROLLING SCRAP)(MT)" , 21029 as "KSRM 400/GRADE 60 10 MM", 21039 as "MILL SCALE(KG)" ))



--AKG QUERY XXCMNTRMCONSMP
select 
TO_CHAR(TRX_DATE,'DD-MON-RR')TRX_DATE,
NVL(SPECIAL_CLN,0)SPECIAL_CLN,
NVL(SPECIAL_GYP,0)SPECIAL_GYP,
NVL(SPECIAL_LIME,0)SPECIAL_LIME,
NVL(SPECIAL_FLY,0)SPECIAL_FLY,
NVL(SPECIAL_SLAG,0)SPECIAL_SLAG,
(NVL(SPECIAL_CLN,0)+NVL(SPECIAL_GYP,0)+NVL(SPECIAL_LIME,0)+NVL(SPECIAL_FLY,0)+NVL(SPECIAL_SLAG,0)) SPECIAL_INGR_TOT,
NVL(SPECIAL_P_QTY,0)SPECIAL_P_QTY,
NVL(POPULAR_CLN,0)POPULAR_CLN,
NVL(POPULAR_GYP,0)POPULAR_GYP,
NVL(POPULAR_LIME,0)POPULAR_LIME,
NVL(POPULAR_FLY,0)POPULAR_FLY,
NVL(POPULAR_SLAG,0)POPULAR_SLAG,
(NVL(POPULAR_CLN,0)+NVL(POPULAR_GYP,0)+NVL(POPULAR_LIME,0)+NVL(POPULAR_FLY,0)+NVL(POPULAR_SLAG,0)) POPULAR_INGR_TOT,
NVL(POPULAR_P_QTY,0)POPULAR_P_QTY,
NVL(OPC_CLN,0)OPC_CLN,
NVL(OPC_GYP,0)OPC_GYP,
NVL(OPC_LIME,0)OPC_LIME,
NVL(OPC_FLY,0)OPC_FLY,
NVL(OPC_SLAG,0)OPC_SLAG,
(NVL(OPC_CLN,0)+NVL(OPC_GYP,0)+NVL(OPC_LIME,0)+NVL(OPC_FLY,0)+NVL(OPC_SLAG,0)) OPC_INGR_TOT,
NVL(OPC_P_QTY,0)OPC_P_QTY,
(NVL(SPECIAL_CLN,0)+NVL(POPULAR_CLN,0)+NVL(OPC_CLN,0)) TOT_CLNK,
(NVL(SPECIAL_GYP,0)+NVL(POPULAR_GYP,0)+NVL(OPC_GYP,0)) TOT_GYP,
(NVL(SPECIAL_LIME,0)+NVL(POPULAR_LIME,0)+NVL(OPC_LIME,0)) TOT_LIME,
(NVL(SPECIAL_FLY,0)+NVL(POPULAR_FLY,0)+NVL(OPC_FLY,0)) TOT_FLY,
(NVL(SPECIAL_SLAG,0)+NVL(POPULAR_SLAG,0)+NVL(OPC_SLAG,0)) TOT_SLAG,
(NVL(SPECIAL_P_QTY,0)+NVL(POPULAR_P_QTY,0)+NVL(OPC_P_QTY,0)) TOT_PRODUCT
 from
(SELECT trx_date,
DECODE(GMD.INVENTORY_ITEM_ID,24408,'Special',24402,'Popular',206570,'OPC') prd,
GMD.ACTUAL_QTY,
CLINKER,
GYPSUM,
LIME,
FLYASH,
SLAG 
FROM apps.GME_MATERIAL_DETAILS GMD,
(select 
trx_date,
BATCH_NO,
BATCH_ID,
SUM(NVL(CLINKER_QTY,0))CLINKER,
SUM(NVL(GYPSUM_QTY,0))GYPSUM,
SUM(NVL(LIME_QTY,0))LIME,
SUM(NVL(FLYASH_QTY,0))FLYASH,
SUM(NVL(SLAG_QTY,0))SLAG from
(SELECT 
TRUNC(TO_DATE(GBH.ATTRIBUTE4,'RRRR/MM/DD HH24:MI:SS')) trx_date,
GBH.BATCH_NO,
GMD.BATCH_ID,
GMD.INVENTORY_ITEM_ID,
(MSI.SEGMENT1||'.'||MSI.SEGMENT2||'.'||MSI.SEGMENT3)ITEM_CODE,
MSI.DESCRIPTION,
GMD.ACTUAL_QTY qty 
FROM apps.GME_BATCH_HEADER GBH,apps.GME_MATERIAL_DETAILS GMD,apps.MTL_SYSTEM_ITEMS_B MSI
WHERE GBH.ORGANIZATION_ID=GMD.ORGANIZATION_ID
AND GMD.ORGANIZATION_ID=MSI.ORGANIZATION_ID
AND GMD.INVENTORY_ITEM_ID=MSI.INVENTORY_ITEM_ID
AND GBH.BATCH_ID=GMD.BATCH_ID
AND GMD.ORGANIZATION_ID= 121
AND GMD.LINE_TYPE IN ('-1','1')
--and gbh.batch_status in ('2','3','4')
--AND upper(MSI.DESCRIPTION) IN ('CLINKER','GYPSUM','SLAG (GBFS)','LIME STONE','FLYASH')
--AND TRUNC(TO_DATE(GBH.ATTRIBUTE4,'RRRR/MM/DD HH24:MI:SS')) BETWEEN TRUNC(:PL_DATE) AND TRUNC(:PH_DATE)
)
--AND (TO_DATE(GBH.ATTRIBUTE4,'RRRR/MM/DD HH24:MI:SS')) BETWEEN (:PL_DATE) AND (:PH_DATE))
pivot(sum(qty)as qty for description in ('Clinker'as Clinker,'Gypsum'as Gypsum,'Lime Stone'as Lime,'Flyash'as Flyash,'Slag (GBFS)'as Slag))
GROUP BY trx_date,BATCH_NO,BATCH_ID
order by to_number(batch_no))X
WHERE GMD.BATCH_ID=X.BATCH_ID
AND GMD.LINE_TYPE='1')
pivot(sum(actual_qty)as p_qty,sum(clinker)as cln,sum(gypsum)as gyp,sum(lime)as lime,sum(flyash)as fly,sum(slag)as slag for prd in('Special'as Special,'Popular'as Popular, 'OPC' as OPC))
order by To_date(trx_date)


--======================


-- 6 - JAN-2021

select * from GMF_BATCH_REQUIREMENTS  where batch_id= 690108

select * from GME_BATCH_HEADER  where batch_id= 690108

select * from   gme_material_details where batch_id= 690108

select ACTUAL_QTY from   gme_material_details where batch_id= 690108 and TO_CHAR(CREATION_DATE,'MON-YY') = 'JUL-19' --PERIOD_CODE 





-- AREFIN VAI
select A. BATCH_ID , PRODUCT_ITEM_ID ,XXGET_ITEM_CODE(A.PRODUCT_ITEM_ID) PRODUCT_ITEM_CODE,A.INGREDIENT_ITEM_ID , 
XXGET_ITEM_CODE(A.INGREDIENT_ITEM_ID) INGREDIENT_ITEM_ID,  A.DERIVED_COST_ALLOC, B.ACTUAL_QTY,
(CASE WHEN XXGET_ITEM_CODE(A.PRODUCT_ITEM_ID)  LIKE '%BP%'  THEN A.DERIVED_COST_ALLOC * B.ACTUAL_QTY 
WHEN  XXGET_ITEM_CODE(A.PRODUCT_ITEM_ID)  LIKE '%CP%'  THEN A.DERIVED_COST_ALLOC * B.ACTUAL_QTY
WHEN  XXGET_ITEM_CODE(A.PRODUCT_ITEM_ID)  LIKE '%FG%'  THEN A.DERIVED_COST_ALLOC * B.ACTUAL_QTY ELSE 0 END) ALOC,
A.ORGANIZATION_ID 
FROM GMF_BATCH_REQUIREMENTS A, gme_material_details B
where 1=1
and A.batch_id = B.batch_id
and A.INGREDIENT_ITEM_ID = B.INVENTORY_ITEM_ID
and  A.batch_id= 690108
--and A.INGREDIENT_ITEM_ID <> 21039
AND A.ORGANIZATION_ID= 121

UNION ALL
select A. BATCH_ID , PRODUCT_ITEM_ID ,XXGET_ITEM_CODE(A.PRODUCT_ITEM_ID) PRODUCT_ITEM_CODE,A.INGREDIENT_ITEM_ID , 
XXGET_ITEM_CODE(A.INGREDIENT_ITEM_ID) INGREDIENT_ITEM_ID,  A.DERIVED_COST_ALLOC, B.ACTUAL_QTY,A.ORGANIZATION_ID 
FROM GMF_BATCH_REQUIREMENTS A, gme_material_details B
where 1=1
and A.batch_id = B.batch_id
and A.INGREDIENT_ITEM_ID = B.INVENTORY_ITEM_ID
and  A.batch_id= 690108
and A.INGREDIENT_ITEM_ID = 21039
AND A.ORGANIZATION_ID= 121











select * from GME_BATCH_HEADER where BATCH_ID= 668104 -- 
BATCH_NO=  1062 and ATTRIBUTE_CATEGORY = 'KSM'  and TRUNC (BATCH_CLOSE_DATE)  between '01-JUL-2019' and '31-JUL-2019' 


select * from GME_BATCH_HEADER where BATCH_NO=  1053 and ATTRIBUTE_CATEGORY = 'KSM'  and TRUNC (BATCH_CLOSE_DATE)  between '01-JUL-2019' and '31-JUL-2019' 

select  --batch_id,INVENTORY_ITEM_ID,
(CASE WHEN  XXGET_ITEM_CODE(INVENTORY_ITEM_ID) LIKE '%FG%'  THEN XXGET_ITEM_CODE(INVENTORY_ITEM_ID) ELSE NULL END) FG_ITEM,
(CASE WHEN  XXGET_ITEM_CODE(INVENTORY_ITEM_ID) LIKE '%FG%'  THEN SUM(ACTUAL_QTY) ELSE 0 END) FG_QTY, 
(CASE WHEN  XXGET_ITEM_CODE(INVENTORY_ITEM_ID) LIKE '%BP%'  THEN XXGET_ITEM_CODE(INVENTORY_ITEM_ID) ELSE NULL END) BP_ITEM,
(CASE WHEN  XXGET_ITEM_CODE(INVENTORY_ITEM_ID) LIKE '%BP%'  THEN SUM(ACTUAL_QTY) ELSE 0 END) BP_QTY, 
(CASE WHEN  XXGET_ITEM_CODE(INVENTORY_ITEM_ID) LIKE '%CP%'  THEN XXGET_ITEM_CODE(INVENTORY_ITEM_ID) ELSE NULL END) CP_ITEM,
(CASE WHEN  XXGET_ITEM_CODE(INVENTORY_ITEM_ID) LIKE '%CP%'  THEN SUM(ACTUAL_QTY) ELSE 0 END) CP_QTY,
(CASE WHEN  XXGET_ITEM_CODE(INVENTORY_ITEM_ID) LIKE '%SF%'  THEN XXGET_ITEM_CODE(INVENTORY_ITEM_ID) ELSE NULL END) SF_ITEM,
(CASE WHEN  XXGET_ITEM_CODE(INVENTORY_ITEM_ID) LIKE '%SF%'  THEN SUM(ACTUAL_QTY) ELSE 0 END) SF_QTY,
DTL_UM  
--XXGET_ITEM_CODE(INVENTORY_ITEM_ID), MY_PACKAGE.XXGET_ITEM_DESCRIPTION(INVENTORY_ITEM_ID) ITEM_DESC,SUM(ACTUAL_QTY) ACTUAL_QTY,DTL_UM  
 from gme_material_details where batch_id= 690108
GROUP BY INVENTORY_ITEM_ID,DTL_UM,batch_id
order by FG_ITEM

select * from gme_material_details where  CREATION_DATE  between '01-JUL-2019' and '31-JUL-2019'  and ORGANIZATION_ID = 121 --and batch_id= 697099

select INVENTORY_ITEM_ID,XXGET_ITEM_CODE(INVENTORY_ITEM_ID), MY_PACKAGE.XXGET_ITEM_DESCRIPTION(INVENTORY_ITEM_ID) ITEM_DESC, SUM(ACTUAL_QTY) ACTUAL_QTY,DTL_UM from gme_material_details
 where  CREATION_DATE between '01-JUL-2019' and '31-JUL-2019'   and ORGANIZATION_ID = 121 and ACTUAL_QTY <> 0  --and batch_id= 697099--and INVENTORY_ITEM_ID = 21029 --and batch_id= 697099
 GROUP BY INVENTORY_ITEM_ID ,DTL_UM


-- KSRM BATCHWISE PRODUCTION REPORT

SELECT 
----TRUNC (GBH.ACTUAL_START_DATE) ACTUAL_START_DATE, 
----TO_CHAR (GBH.ACTUAL_START_DATE,'HH24:MI') BATCH_START_TIME, 
----TO_CHAR (GBH.ACTUAL_CMPLT_DATE,'HH24:MI') BATCH_END_TIME, 
GBH.BATCH_NO,
--gbh.attribute14 batch_type,
--gbh.attribute25 shift,
--gbh.attribute26 shift_incharge,
--gbh.attribute27 engine,
--null mill_running_hr,
--null remarks,
TO_CHAR(GMD.BATCH_ID) BATCH_ID, 
WXM.ITEM_DESC||'('||UOM1||')' ITEM_DESC,GMD.INVENTORY_ITEM_ID, 
(NVL(SUM(GMD.ACTUAL_QTY),0)) ACTUAL_QTY, 
NVL(SUM(GMD.COST_ALLOC),0) COS_ALLOC,
:P_DATE_FROM,:P_DATE_TO, 0 SEQ,'INGREDIENT' SQ_DESC 
FROM GME_BATCH_HEADER GBH, GME_MATERIAL_DETAILS GMD,WBI_XXKBGITEM_MT_D WXM
WHERE GBH.BATCH_ID = GMD.BATCH_ID
AND GBH.ORGANIZATION_ID = GMD.ORGANIZATION_ID
AND GMD.INVENTORY_ITEM_ID=WXM.INVENTORY_ITEM_ID
AND GMD.ORGANIZATION_ID=WXM.ORGANIZATION_ID
----AND GBH.BATCH_STATUS IN (3,4)
AND GMD.ORGANIZATION_ID=:P_ORGANIZATION_ID AND LINE_TYPE=-1
AND TRUNC(GBH.ACTUAL_START_DATE) BETWEEN :P_DATE_FROM AND :P_DATE_TO
AND (:P_BATCH_ID is null or GBH.BATCH_ID=:P_BATCH_ID)
GROUP BY TRUNC (GBH.ACTUAL_START_DATE) , 
TO_CHAR (GBH.ACTUAL_START_DATE,'HH24:MI') , 
TO_CHAR (GBH.ACTUAL_CMPLT_DATE,'HH24:MI') , 
GBH.BATCH_NO,
TO_CHAR(GMD.BATCH_ID), 
WXM.ITEM_DESC,GMD.INVENTORY_ITEM_ID,
UOM1,
gbh.attribute14,
gbh.attribute25,
gbh.attribute26,
gbh.attribute27
UNION ALL
SELECT 
--TRUNC (GBH.ACTUAL_START_DATE) ACTUAL_START_DATE, 
--TO_CHAR (GBH.ACTUAL_START_DATE,'HH24:MI') BATCH_START_TIME, 
--TO_CHAR (GBH.ACTUAL_CMPLT_DATE,'HH24:MI') BATCH_END_TIME, 
GBH.BATCH_NO,
--gbh.attribute14 batch_type,
--gbh.attribute25 shift,
--gbh.attribute26 shift_incharge,
--gbh.attribute27 engine,
--gmd.attribute10 mill_running_hr,
--gmd.attribute11 remarks,
TO_CHAR(GMD.BATCH_ID) BATCH_ID, 
WXM.ITEM_DESC||'('||UOM1||')' ITEM_DESC,GMD.INVENTORY_ITEM_ID, 
(NVL(SUM(GMD.ACTUAL_QTY),0)) ACTUAL_QTY, 
NVL(SUM(GMD.COST_ALLOC),0) COS_ALLOC,
:P_DATE_FROM,:P_DATE_TO, 2 SEQ,'PRODUCT' SQ_DESC 
FROM GME_BATCH_HEADER GBH, GME_MATERIAL_DETAILS GMD,WBI_XXKBGITEM_MT_D WXM
WHERE GBH.BATCH_ID = GMD.BATCH_ID
AND GBH.ORGANIZATION_ID = GMD.ORGANIZATION_ID
AND GMD.INVENTORY_ITEM_ID=WXM.INVENTORY_ITEM_ID
AND GMD.ORGANIZATION_ID=WXM.ORGANIZATION_ID
----AND GBH.BATCH_STATUS IN (3,4)
AND GMD.ORGANIZATION_ID=:P_ORGANIZATION_ID  AND LINE_TYPE=1
AND TRUNC(GBH.ACTUAL_START_DATE) BETWEEN :P_DATE_FROM AND :P_DATE_TO
AND (:P_BATCH_ID is null or GBH.BATCH_ID=:P_BATCH_ID)
GROUP BY TRUNC (GBH.ACTUAL_START_DATE) , 
TO_CHAR (GBH.ACTUAL_START_DATE,'HH24:MI') , 
TO_CHAR (GBH.ACTUAL_CMPLT_DATE,'HH24:MI') , 
GBH.BATCH_NO,
TO_CHAR(GMD.BATCH_ID), 
WXM.ITEM_DESC,GMD.INVENTORY_ITEM_ID,
UOM1,
gbh.attribute14,
gbh.attribute25,
gbh.attribute26,
gbh.attribute27,
gmd.attribute10,
gmd.attribute11
UNION ALL
SELECT 
--TRUNC (GBH.ACTUAL_START_DATE) ACTUAL_START_DATE, 
--TO_CHAR (GBH.ACTUAL_START_DATE,'HH24:MI') BATCH_START_TIME, 
--TO_CHAR (GBH.ACTUAL_CMPLT_DATE,'HH24:MI') BATCH_END_TIME, 
GBH.BATCH_NO,
--gbh.attribute14 batch_type,
--gbh.attribute25 shift,
--gbh.attribute26 shift_incharge,
--gbh.attribute27 engine,
--null mill_running_hr,
--null remarks,
TO_CHAR(GMD.BATCH_ID) BATCH_ID, 
WXM.ITEM_DESC||'('||UOM1||')' ITEM_DESC,GMD.INVENTORY_ITEM_ID, 
(NVL(SUM(GMD.ACTUAL_QTY),0)) ACTUAL_QTY, 
NVL(SUM(GMD.COST_ALLOC),0) COS_ALLOC,
:P_DATE_FROM,:P_DATE_TO, 3 SEQ,'BY PRODUCT' SQ_DESC 
FROM GME_BATCH_HEADER GBH, GME_MATERIAL_DETAILS GMD,WBI_XXKBGITEM_MT_D WXM
WHERE GBH.BATCH_ID = GMD.BATCH_ID
AND GBH.ORGANIZATION_ID = GMD.ORGANIZATION_ID
AND GMD.INVENTORY_ITEM_ID=WXM.INVENTORY_ITEM_ID
AND GMD.ORGANIZATION_ID=WXM.ORGANIZATION_ID
-----AND GBH.BATCH_STATUS IN (3,4)
AND GMD.ORGANIZATION_ID=:P_ORGANIZATION_ID AND LINE_TYPE=2
AND (:P_BATCH_ID is null or GBH.BATCH_ID=:P_BATCH_ID)
AND TRUNC(GBH.ACTUAL_START_DATE) BETWEEN :P_DATE_FROM AND :P_DATE_TO
GROUP BY TRUNC (GBH.ACTUAL_START_DATE) , 
TO_CHAR (GBH.ACTUAL_START_DATE,'HH24:MI') , 
TO_CHAR (GBH.ACTUAL_CMPLT_DATE,'HH24:MI') , 
GBH.BATCH_NO,
TO_CHAR(GMD.BATCH_ID), 
WXM.ITEM_DESC,GMD.INVENTORY_ITEM_ID,
UOM1,
gbh.attribute14,
gbh.attribute25,
gbh.attribute26,
gbh.attribute27
--order by 17,1,4



-- 5 DEC- 2021
-- EBS Factory Overhead Report
SELECT GCC.SEGMENT1 LEGAL_ENTITY,GCC.SEGMENT2 OU, GAM.LEGAL_ENTITY_ID, GAM.ALLOC_CODE , GCC.SEGMENT1||'.'||GCC.SEGMENT2||'.'||GCC.SEGMENT3||'.'||GCC.SEGMENT4||'.'||GCC.SEGMENT5||'.'||GCC.SEGMENT6||'.'||GCC.SEGMENT7 CODE_COMBINATIONS , GCC.SEGMENT4 GL_CODE, 
XX_GET_ACCT_FLEX_SEG_DESC (1, GCC.SEGMENT1) LEGAL_ENTITY_NAME,
XX_GET_ACCT_FLEX_SEG_DESC(4,GCC.SEGMENT4) ACCOUNT_DESC, 
 :P_PERIOD_CODE,
 --(SELECT  NAME FROM GL_LEDGERS WHERE CHART_OF_ACCOUNTS_ID = GCC.SEGMENT1 ) OU,
 SUM(GAI.AMOUNT) AP_AMOUNT  
 FROM GL_ALOC_MST GAM, GL_CODE_COMBINATIONS  GCC, GL_ALOC_INP GAI, GL_ALOC_EXP GAE
WHERE 1=1
--AND GL.CHART_OF_ACCOUNTS_ID = GCC.SEGMENT1 
--AND GAI.CALENDAR_CODE = '19-20'
 AND  TO_CHAR(TO_DATE(GAI.PERIOD_CODE ,'MON-YY'),'MON-YY') = NVL(:P_PERIOD_CODE,  TO_CHAR(TO_DATE(GAI.PERIOD_CODE ,'MON-YY'),'MON-YY') )
--AND GAI.PERIOD_CODE = 'JUL-19'
AND GAM.ALLOC_ID = GAE.ALLOC_ID
AND  GAE.ALLOC_ID = GAI.ALLOC_ID
AND GAE.LINE_NO= GAI.LINE_NO
--AND GAM.LEGAL_ENTITY_ID= 23273  -- KSRM Steel Plant Ltd (KSPL)
AND GAI.ACCOUNT_ID=GCC.CODE_COMBINATION_ID   ---
--AND GCC.SEGMENT1 = :P_LEGAL_ENTITY
  AND GCC.SEGMENT1 = NVL(:P_LEGAL_ENTITY, GCC.SEGMENT1) --101
  AND GCC.SEGMENT2 = NVL(:P_OPERATING_UNIT, GCC.SEGMENT2) 
--and gai.AMOUNT <> 0
--and gam.alloc_code= 'GAS CONSUMED' -- like ()
GROUP BY GCC.SEGMENT1,GCC.SEGMENT2 ,GAM.LEGAL_ENTITY_ID, GAM.ALLOC_CODE,GCC.SEGMENT4,  GCC.SEGMENT1||'.'||GCC.SEGMENT2||'.'||GCC.SEGMENT3||'.'||GCC.SEGMENT4||'.'||GCC.SEGMENT5||'.'||GCC.SEGMENT6||'.'||GCC.SEGMENT7
ORDER  BY GAM.ALLOC_CODE



select
--JE_CATEGORY,
XXGET_ITEM_CODE(INVENTORY_ITEM_ID) ITEM_CODE,MY_PACKAGE.XXGET_ITEM_DESCRIPTION(INVENTORY_ITEM_ID) ITEM_DESCRIPTION,TRANSACTION_UOM,
--SUM(ACCOUNTED_DR),SUM(ACCOUNTED_CR),
(CASE WHEN TRANSACTION_UOM = 'KG' THEN SUM(TRANSACTION_QUANTITY) / 1000 ELSE SUM(TRANSACTION_QUANTITY) END ) CONVERT_QTY_MT,
SUM(TRANSACTION_QUANTITY) QUANTITY, SUM(TRANSACTION_VALUE) / (CASE WHEN TRANSACTION_UOM = 'KG' THEN SUM(TRANSACTION_QUANTITY) / 1000 ELSE SUM(TRANSACTION_QUANTITY) END ) RATE,
--SUM(TRANSACTION_VALUE) / nullif(GET_PERCENTAGE_FROM_ITEM_ID(:P_ORGANIZATION_ID , INVENTORY_ITEM_ID),0) OVERHEAD_COST_PER_TON,
GET_PERCENTAGE_FROM_ITEM_ID(:P_ORGANIZATION_ID , INVENTORY_ITEM_ID) Percentage,
SUM(TRANSACTION_VALUE) AMOUNT
from EAM_OP_GDET_VW where PERIOD_NAME = 'Jul-19' and EVENT_TYPE_CODE IN ('CERT','RELE','RMA','RVAL', 'GLCOSTALOC')
and ORG_ID = 81
-- and CONCAT_ITEM_CODE = 'RM|BLTI|500|000018'
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
--and EVENT_CLASS_CODE = 'BATCH_MATERIAL'
GROUP BY MY_PACKAGE.XXGET_ITEM_DESCRIPTION(INVENTORY_ITEM_ID) , XXGET_ITEM_CODE(INVENTORY_ITEM_ID),
--JE_CATEGORY,
INVENTORY_ITEM_ID ,TRANSACTION_UOM


--2-JAN-2021

SELECT INVENTORY_ITEM_ID, ITEM_CODE,ITEM_DESC, SUM(TRANSACTION_QUANTITY) TRANSACTION_QUANTITY, SUM(TRANSACTION_VALUE) TRANSACTION_VALUE, SUM(ACCOUNTED_DR) ACCOUNTED_DR , SUM(ACCOUNTED_CR) ACCOUNTED_CR FROM
(
SELECT TO_CHAR(TRANSACTION_DATE,'MON-YY') PERIOD_CODE, A.LEDGER_ID, (SELECT DISTINCT BAL_SEG_NAME FROM XX_INV_ORG_VW WHERE LEDGER_ID=A.LEDGER_ID) COMPANY_NAME,
C.ORGANIZATION_CODE,A.ORGANIZATION_ID,
XX_GET_ACCT_FLEX_SEG_DESC (1, F.SEGMENT1) COMPANY,
XX_GET_ACCT_FLEX_SEG_DESC (2, F.SEGMENT2) OPERATING_UNIT,
XX_GET_ACCT_FLEX_SEG_DESC (3, F.SEGMENT3) COST_CENTER,
--(SELECT DISTINCT XX_GET_ACCT_FLEX_SEG_DESC (3, SEGMENT3) COST_CENTER FROM GL_CODE_COMBINATIONS_KFV WHERE CODE_COMBINATION_ID=E.CODE_COMBINATION_ID) COST_CENTER,
A.INVENTORY_ITEM_ID,B.SEGMENT1||'|'||B.SEGMENT2||'|'||B.SEGMENT3||'|'||B.SEGMENT4 ITEM_CODE,
(SELECT DESCRIPTION FROM MTL_SYSTEM_ITEMS_B WHERE INVENTORY_ITEM_ID=A.INVENTORY_ITEM_ID AND ORGANIZATION_ID=A.ORGANIZATION_ID) ITEM_DESC,
(SELECT PRIMARY_UOM_CODE FROM MTL_SYSTEM_ITEMS_B WHERE INVENTORY_ITEM_ID=A.INVENTORY_ITEM_ID AND ORGANIZATION_ID=A.ORGANIZATION_ID) UOM,
A.EVENT_CLASS_CODE,A.EVENT_TYPE_CODE, --a.transaction_id, 
(SELECT DISTINCT GMD.BATCH_NO FROM GME_BATCH_HEADER GMD, MTL_MATERIAL_TRANSACTIONS MMT
WHERE MMT.TRANSACTION_ID=A.TRANSACTION_ID AND GMD.BATCH_ID=MMT.TRANSACTION_SOURCE_ID) REF_NO,
G.TRANSACTION_TYPE_ID,G.TRANSACTION_TYPE_NAME,
D.JE_CATEGORY_NAME,E.ACCOUNTING_CLASS_CODE,D.AE_HEADER_ID,XX_AP_PKG.GET_ACCOUNT_DESC_FROM_CCID (E.CODE_COMBINATION_ID) ACCOUNT_NAME,
XX_AP_PKG.GET_SUB_ACCOUNT_DESC_FROM_CCID(TO_NUMBER(E.CODE_COMBINATION_ID)) SUB_ACCOUNT,
TRANSACTION_QUANTITY,TRANSACTION_VALUE,E.ACCOUNTED_DR,E.ACCOUNTED_CR,F.CONCATENATED_SEGMENTS ACCOUNTING_CODE
FROM GMF_XLA_EXTRACT_HEADERS A,MTL_SYSTEM_ITEMS_B B,ORG_ORGANIZATION_DEFINITIONS C,XLA_AE_HEADERS D,XLA_AE_LINES E,GL_CODE_COMBINATIONS_KFV F,MTL_TRANSACTION_TYPES G
WHERE A.INVENTORY_ITEM_ID=B.INVENTORY_ITEM_ID(+) AND A.ORGANIZATION_ID=B.ORGANIZATION_ID(+) AND A.ORGANIZATION_ID=C.ORGANIZATION_ID AND A.TRANSACTION_TYPE_ID=G.TRANSACTION_TYPE_ID(+)
AND A.EVENT_ID=D.EVENT_ID AND D.AE_HEADER_ID=E.AE_HEADER_ID AND E.CODE_COMBINATION_ID=F.CODE_COMBINATION_ID
AND TO_CHAR(TRANSACTION_DATE,'MON-YY')=:P_PERIOD_CODE
AND A.LEDGER_ID=:P_LEDGER_ID AND A.ORGANIZATION_ID=NVL(:P_ORGANIZATION_ID,A.ORGANIZATION_ID) AND A.INVENTORY_ITEM_ID=NVL(:P_INVENTORY_ITEM_ID,A.INVENTORY_ITEM_ID)
and JE_CATEGORY_NAME  = 'RELE'
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
and B.SEGMENT1 IN ('SF','RM')
)
GROUP BY  INVENTORY_ITEM_ID, ITEM_CODE,ITEM_DESC





select distinct BATCH_ID  from GME_BATCH_HEADER  where ACTUAL_CMPLT_DATE between '01-JUL-2019' and '31-JUL-2019'   order by BATCH_ID



SELECT * FROM GMF_XLA_EXTRACT_LINES


select * from ORG_ACCT_PERIODS_V


SELECT * FROM GME_BATCH_HEADER GMD, MTL_MATERIAL_TRANSACTIONS MMT,  GMF_XLA_EXTRACT_HEADERS A
WHERE MMT.TRANSACTION_ID=A.TRANSACTION_ID AND GMD.BATCH_ID=MMT.TRANSACTION_SOURCE_ID
and A.INVENTORY_ITEM_ID =319
and EVENT_TYPE_CODE = 'RELE'
and ACTUAL_CMPLT_DATE between '01-JUL-2019' and '31-JUL-2019'

select * from gme_material_details  where INVENTORY_ITEM_ID =71 -- 319

select * from CM_PRODCOST_DETAILS


select * from GL_ALOC_BAS where INVENTORY_ITEM_ID =71

select * from GMF_XLA_EXTRACT_HEADERS  where INVENTORY_ITEM_ID =71 and TRANSACTION_DATE between '01-JUL-2019' and '31-JUL-2019' and OPERATING_UNIT = 81 and ORGANIZATION_ID = 121


SELECT DISTINCT period_code FROM gmf_period_statuses

select * from GL_LEDGERS WHERE ledger_category_code='PRIMARY' 
ORDER BY LEDGER_ID

select ORGANIZATION_ID  from XX_OPERATING_UNITS

select * from GMF_XLA_EXTRACT_HEADERS


select * from GMF_XLA_EXTRACT_HEADERS where  EVENT_TYPE_CODE ='PO_RECEIPT' AND TO_CHAR(TRANSACTION_DATE,'MON-YY')=:P_PERIOD_CODE
and SOURCE_DOCUMENT_ID IN (select RSL.SHIPMENT_HEADER_ID from RCV_SHIPMENT_LINES RSL, PO_HEADERS_ALL poh
  where POH.PO_HEADER_ID= RSL.PO_HEADER_ID
 -- and  RSL.SHIPMENT_HEADER_ID = 917740
  and POH.ATTRIBUTE1 = 'L')
  
  select RSL.SHIPMENT_HEADER_ID from RCV_SHIPMENT_LINES RSL, PO_HEADERS_ALL poh
  where POH.PO_HEADER_ID= RSL.PO_HEADER_ID
  and  RSL.SHIPMENT_HEADER_ID = 917740
  and POH.ATTRIBUTE1 = 'L'
  
    select POH.SEGMENT1 PO_NUMBER  from RCV_SHIPMENT_LINES RSL, PO_HEADERS_ALL poh
  where POH.PO_HEADER_ID= RSL.PO_HEADER_ID
  and  RSL.SHIPMENT_HEADER_ID = 917740
  and POH.ATTRIBUTE1 = 'L' 


    select RSL.QUANTITY_SHIPPED from RCV_SHIPMENT_LINES RSL, PO_HEADERS_ALL poh
  where POH.PO_HEADER_ID= RSL.PO_HEADER_ID
  and  RSL.SHIPMENT_HEADER_ID = 938703
  --and POH.ATTRIBUTE1 = 'L' 




select * from PO_HEADERS_ALL poh where PO_HEADER_ID = 917740

select * from RCV_TRANSACTIONS where TRANSACTION_ID = 917740

select * from RCV_SHIPMENT_HEADERS where SHIPMENT_HEADER_ID = 917740

SELECT 


select * from RCV_SHIPMENT_LINES RSL, PO_HEADERS_ALL poh
  where POH.PO_HEADER_ID= RSL.PO_HEADER_ID
  and  RSL.SHIPMENT_HEADER_ID = 917740
  and POH.ATTRIBUTE1 = 'L'


2045  --  104-Khawja Ajmeer Steel Industries Limited

select * from CM_ACST_LED 

-- 22-DEC-2020
--======================================================== 736 , 742

-- XXKSRM PURCHASE LOCAL
SELECT X.PERIOD_CODE,X.PO_NUMBER,X.SOURCE_DOCUMENT_ID, X.LEDGER_ID, X.COMPANY_NAME, X.COMPANY_CODE, X.OPERATING_UNIT, X.COST_CENTER,
X.ORGANIZATION_CODE,X.MEJOR_FIN_CAT,X.FIN_CAT,X.ORGANIZATION_ID,--X.TRANSACTION_ID,
X.INVENTORY_ITEM_ID,X.ITEM_CODE,X.ITEM_DESC, X.UOM, X.EVENT_TYPE_CODE,X.TRANSACTION_TYPE_ID,
X.TRANSACTION_TYPE_NAME,X.ACCOUNT_NAME,X.SUB_ACCOUNT,X.OP_QTY, X.OP_VAL,
SUM(X.RCV_QTY) RCV_QTY, SUM(X.RCV_VAL) RCV_VAL, SUM(X.ISSUE_QTY) ISSUE_QTY, SUM(X.ISSUE_VAL) ISSUE_VAL, SUM(X.TRANS_QTY) TRANS_QTY, SUM(X.TRANS_VAL)TRANS_VAL,
X.JE_CATEGORY_NAME,X.ACCOUNTING_CLASS_CODE, SUM(X.DR) DR, SUM(X.CR) CR ,X.ACCOUNTING_CODE,X.SOURCE_DOCUMENT_ID REF_NO
FROM
(SELECT INV_TRANS.PERIOD_CODE,INV_TRANS.LEDGER_ID, INV_TRANS.COMPANY_NAME, INV_TRANS.COMPANY_CODE, INV_TRANS.OPERATING_UNIT, INV_TRANS.COST_CENTER,
INV_TRANS.ORGANIZATION_CODE,FIN_CAT.MEJOR_FIN_CAT,FIN_CAT.FIN_CAT,INV_TRANS.ORGANIZATION_ID,--INV_TRANS.TRANSACTION_ID,
INV_TRANS.INVENTORY_ITEM_ID,INV_TRANS.ITEM_CODE,INV_TRANS.ITEM_DESC, INV_TRANS.UOM, INV_TRANS.EVENT_TYPE_CODE,INV_TRANS.TRANSACTION_TYPE_ID,
CASE WHEN INV_TRANS.TRANSACTION_TYPE_ID=-99 THEN INV_TRANS.EVENT_TYPE_CODE ELSE INV_TRANS.TRANSACTION_TYPE_NAME END TRANSACTION_TYPE_NAME,
INV_TRANS.ACCOUNT_NAME,INV_TRANS.SUB_ACCOUNT,
0 OP_QTY, 0 OP_VAL,
SUM(CASE WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (17,12,44,18,61,1002,1003) THEN INV_TRANS.TRANSACTION_QUANTITY ELSE 0 END) RCV_QTY,
SUM(CASE WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (17,18,1002,1003) THEN INV_TRANS.TRANSACTION_VALUE
WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (44) THEN INV_TRANS.TRANSACTION_VALUE -----INV_TRANS.ACCOUNTED_DR
WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (61) THEN INV_TRANS.ACCOUNTED_DR
WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (12) THEN INV_TRANS.ACCOUNTED_DR
WHEN NVL(INV_TRANS.TRANSACTION_TYPE_ID,11111)=11111 AND EVENT_TYPE_CODE = 'GLCOSTALOC' THEN INV_TRANS.TRANSACTION_VALUE
WHEN NVL(INV_TRANS.TRANSACTION_TYPE_ID,2222)=2222 AND EVENT_TYPE_CODE = 'LC_ADJUST_VALUATION' THEN INV_TRANS.TRANSACTION_VALUE
WHEN INV_TRANS.TRANSACTION_TYPE_ID=-99 THEN INV_TRANS.TRANSACTION_VALUE ELSE 0 END) RCV_VAL,
SUM(CASE WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (32,33,35,36,42,43,15,21,63,62,101,103,104,107,111,120,10008,140,71,200,260,261,52) THEN INV_TRANS.TRANSACTION_QUANTITY ELSE 0 END) ISSUE_QTY,
SUM(CASE WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (32,33,35,36,42,43,21,63,62,101,103,104,107,111,120,10008,140,71,200,260,261,52) THEN INV_TRANS.TRANSACTION_VALUE
WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (15) THEN INV_TRANS.ACCOUNTED_DR ELSE 0 END) ISSUE_VAL,
SUM(NVL(INV_TRANS.TRANSACTION_QUANTITY,0)) TRANS_QTY,
SUM(NVL(INV_TRANS.TRANSACTION_VALUE,0)) TRANS_VAL,
INV_TRANS.JE_CATEGORY_NAME,INV_TRANS.ACCOUNTING_CLASS_CODE,
SUM(INV_TRANS.ACCOUNTED_DR) DR,SUM(INV_TRANS.ACCOUNTED_CR) CR ,INV_TRANS.ACCOUNTING_CODE,INV_TRANS.SOURCE_DOCUMENT_ID,PUR.PO_NUMBER REF_NO, PUR.PO_NUMBER
FROM
(SELECT TO_CHAR(TRANSACTION_DATE,'MON-YY') PERIOD_CODE, A.LEDGER_ID, (SELECT DISTINCT BAL_SEG FROM XX_INV_ORG_VW WHERE LEDGER_ID=A.LEDGER_ID) COMPANY_CODE,
C.ORGANIZATION_CODE,A.ORGANIZATION_ID,A.SOURCE_DOCUMENT_ID,
XX_GET_ACCT_FLEX_SEG_DESC (1, F.SEGMENT1) COMPANY_NAME,
XX_GET_ACCT_FLEX_SEG_DESC (2, F.SEGMENT2) OPERATING_UNIT,
XX_GET_ACCT_FLEX_SEG_DESC (3, F.SEGMENT3) COST_CENTER,
--(SELECT DISTINCT XX_GET_ACCT_FLEX_SEG_DESC (3, SEGMENT3) COST_CENTER FROM GL_CODE_COMBINATIONS_KFV WHERE CODE_COMBINATION_ID=E.CODE_COMBINATION_ID) COST_CENTER,
A.INVENTORY_ITEM_ID, B.SEGMENT1||'|'||B.SEGMENT2||'|'||B.SEGMENT3||'|'||B.SEGMENT4 ITEM_CODE,
(SELECT DESCRIPTION FROM MTL_SYSTEM_ITEMS_B WHERE INVENTORY_ITEM_ID=A.INVENTORY_ITEM_ID AND ORGANIZATION_ID=A.ORGANIZATION_ID) ITEM_DESC,
(SELECT PRIMARY_UOM_CODE FROM MTL_SYSTEM_ITEMS_B WHERE INVENTORY_ITEM_ID=A.INVENTORY_ITEM_ID AND ORGANIZATION_ID=A.ORGANIZATION_ID) UOM,
A.EVENT_CLASS_CODE,A.EVENT_TYPE_CODE, --a.transaction_id,
G.TRANSACTION_TYPE_ID,G.TRANSACTION_TYPE_NAME,
D.JE_CATEGORY_NAME,E.ACCOUNTING_CLASS_CODE,D.AE_HEADER_ID,XX_AP_PKG.GET_ACCOUNT_DESC_FROM_CCID (E.CODE_COMBINATION_ID) ACCOUNT_NAME,
XX_AP_PKG.GET_SUB_ACCOUNT_DESC_FROM_CCID(TO_NUMBER(E.CODE_COMBINATION_ID)) SUB_ACCOUNT,
TRANSACTION_QUANTITY,TRANSACTION_VALUE,E.ACCOUNTED_DR,E.ACCOUNTED_CR,F.CONCATENATED_SEGMENTS ACCOUNTING_CODE
FROM GMF_XLA_EXTRACT_HEADERS A, MTL_SYSTEM_ITEMS_B B,ORG_ORGANIZATION_DEFINITIONS C,XLA_AE_HEADERS D,XLA_AE_LINES E,GL_CODE_COMBINATIONS_KFV F,MTL_TRANSACTION_TYPES G
WHERE A.INVENTORY_ITEM_ID=B.INVENTORY_ITEM_ID(+) AND A.ORGANIZATION_ID=B.ORGANIZATION_ID(+) AND A.ORGANIZATION_ID=C.ORGANIZATION_ID AND A.TRANSACTION_TYPE_ID=G.TRANSACTION_TYPE_ID(+)
AND A.EVENT_ID=D.EVENT_ID AND D.AE_HEADER_ID=E.AE_HEADER_ID AND E.CODE_COMBINATION_ID=F.CODE_COMBINATION_ID
AND TO_CHAR(TRANSACTION_DATE,'MON-YY')=:P_PERIOD_CODE
--AND A.LEDGER_ID=:P_LEDGER_ID
AND A.ORGANIZATION_ID=NVL(:P_ORGANIZATION_ID,A.ORGANIZATION_ID) AND A.INVENTORY_ITEM_ID=NVL(:P_INVENTORY_ITEM_ID,A.INVENTORY_ITEM_ID)) INV_TRANS
LEFT OUTER JOIN (SELECT MIC.INVENTORY_ITEM_ID,MIC.ORGANIZATION_ID,MC.SEGMENT1 MEJOR_FIN_CAT,MC.SEGMENT1||'|'||MC.SEGMENT2 FIN_CAT
FROM MTL_ITEM_CATEGORIES MIC,MTL_CATEGORIES MC WHERE MIC.CATEGORY_ID=MC.CATEGORY_ID AND STRUCTURE_ID=50408) FIN_CAT
ON FIN_CAT.INVENTORY_ITEM_ID=INV_TRANS.INVENTORY_ITEM_ID AND FIN_CAT.ORGANIZATION_ID=INV_TRANS.ORGANIZATION_ID AND FIN_CAT.MEJOR_FIN_CAT= NVL(:P_MEJOR_FIN_CAT,FIN_CAT.MEJOR_FIN_CAT)
LEFT OUTER JOIN  (SELECT  RSL.SHIPMENT_HEADER_ID,POH.PO_HEADER_ID,POH.SEGMENT1 PO_NUMBER,POH.ATTRIBUTE1 LOCAL_IMPORT 
from RCV_SHIPMENT_LINES RSL, PO_HEADERS_ALL poh where POH.PO_HEADER_ID= RSL.PO_HEADER_ID and POH.ATTRIBUTE1 IN ('SIS','L' , 'LFA')) PUR ON PUR.SHIPMENT_HEADER_ID= SOURCE_DOCUMENT_ID WHERE ACCOUNTING_CLASS_CODE='INVENTORY_VALUATION' AND EVENT_TYPE_CODE='PO_RECEIPT' AND PUR.LOCAL_IMPORT IN ('SIS','L' , 'LFA')
GROUP BY PERIOD_CODE,FIN_CAT.MEJOR_FIN_CAT,FIN_CAT.FIN_CAT,INV_TRANS.LEDGER_ID, INV_TRANS.COMPANY_NAME,INV_TRANS.ORGANIZATION_CODE,INV_TRANS.ORGANIZATION_ID,--INV_TRANS.TRANSACTION_ID,
INV_TRANS.INVENTORY_ITEM_ID,INV_TRANS.ITEM_CODE,INV_TRANS.ITEM_DESC, INV_TRANS.UOM,
INV_TRANS.EVENT_TYPE_CODE,INV_TRANS.TRANSACTION_TYPE_NAME,INV_TRANS.ACCOUNT_NAME,INV_TRANS.SUB_ACCOUNT,INV_TRANS.ACCOUNTING_CODE,PUR.PO_NUMBER,
INV_TRANS.TRANSACTION_TYPE_ID,INV_TRANS.JE_CATEGORY_NAME,INV_TRANS.ACCOUNTING_CLASS_CODE, COMPANY_CODE, OPERATING_UNIT, COST_CENTER,INV_TRANS.SOURCE_DOCUMENT_ID
--ORDER BY ORGANIZATION_ID,INVENTORY_ITEM_ID
) X
WHERE X.COST_CENTER = NVL(:P_COST_CENTER, X.COST_CENTER)
--AND X.COMPANY_CODE=NVL(:P_COMPANY_CODE, X.COMPANY_CODE)
AND X.LEDGER_ID=:P_COMPANY_CODE
GROUP BY X.PERIOD_CODE,X.PO_NUMBER,X.SOURCE_DOCUMENT_ID, X.LEDGER_ID, X.COMPANY_NAME, X.COMPANY_CODE, X.OPERATING_UNIT, X.COST_CENTER,
X.ORGANIZATION_CODE,X.MEJOR_FIN_CAT,X.FIN_CAT,X.ORGANIZATION_ID,--X.TRANSACTION_ID,
X.INVENTORY_ITEM_ID,X.ITEM_CODE,X.ITEM_DESC, X.UOM, X.EVENT_TYPE_CODE,X.TRANSACTION_TYPE_ID,
X.TRANSACTION_TYPE_NAME,X.ACCOUNT_NAME,X.SUB_ACCOUNT,X.OP_QTY, X.OP_VAL,X.JE_CATEGORY_NAME,X.ACCOUNTING_CLASS_CODE,X.ACCOUNTING_CODE
ORDER BY X.ORGANIZATION_CODE,X.MEJOR_FIN_CAT,X.ITEM_CODE

--==================================================

-- XXKSRM PURCHASE IMPORT
SELECT X.PERIOD_CODE,X.PO_NUMBER, GET_LC_NUMBER_FROM_PONO(X.PO_NUMBER) LC_NUMBER,  X.SOURCE_DOCUMENT_ID, X.LEDGER_ID, X.COMPANY_NAME, X.COMPANY_CODE, X.OPERATING_UNIT, X.COST_CENTER,
X.ORGANIZATION_CODE,X.MEJOR_FIN_CAT,X.FIN_CAT,X.ORGANIZATION_ID,--X.TRANSACTION_ID,
X.INVENTORY_ITEM_ID,X.ITEM_CODE,X.ITEM_DESC, X.UOM, X.EVENT_TYPE_CODE,X.TRANSACTION_TYPE_ID,
X.TRANSACTION_TYPE_NAME,X.ACCOUNT_NAME,X.SUB_ACCOUNT,X.OP_QTY, X.OP_VAL,
SUM(X.RCV_QTY) RCV_QTY, SUM(X.RCV_VAL) RCV_VAL, SUM(X.ISSUE_QTY) ISSUE_QTY, SUM(X.ISSUE_VAL) ISSUE_VAL, SUM(X.TRANS_QTY) TRANS_QTY, SUM(X.TRANS_VAL)TRANS_VAL,
X.JE_CATEGORY_NAME,X.ACCOUNTING_CLASS_CODE, SUM(X.DR) DR, SUM(X.CR) CR ,X.ACCOUNTING_CODE,X.SOURCE_DOCUMENT_ID REF_NO
FROM
(SELECT INV_TRANS.PERIOD_CODE,INV_TRANS.LEDGER_ID, INV_TRANS.COMPANY_NAME, INV_TRANS.COMPANY_CODE, INV_TRANS.OPERATING_UNIT, INV_TRANS.COST_CENTER,
INV_TRANS.ORGANIZATION_CODE,FIN_CAT.MEJOR_FIN_CAT,FIN_CAT.FIN_CAT,INV_TRANS.ORGANIZATION_ID,--INV_TRANS.TRANSACTION_ID,
INV_TRANS.INVENTORY_ITEM_ID,INV_TRANS.ITEM_CODE,INV_TRANS.ITEM_DESC, INV_TRANS.UOM, INV_TRANS.EVENT_TYPE_CODE,INV_TRANS.TRANSACTION_TYPE_ID,
CASE WHEN INV_TRANS.TRANSACTION_TYPE_ID=-99 THEN INV_TRANS.EVENT_TYPE_CODE ELSE INV_TRANS.TRANSACTION_TYPE_NAME END TRANSACTION_TYPE_NAME,
INV_TRANS.ACCOUNT_NAME,INV_TRANS.SUB_ACCOUNT,
0 OP_QTY, 0 OP_VAL,
SUM(CASE WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (17,12,44,18,61,1002,1003) THEN INV_TRANS.TRANSACTION_QUANTITY ELSE 0 END) RCV_QTY,
SUM(CASE WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (17,18,1002,1003) THEN INV_TRANS.TRANSACTION_VALUE
WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (44) THEN INV_TRANS.TRANSACTION_VALUE -----INV_TRANS.ACCOUNTED_DR
WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (61) THEN INV_TRANS.ACCOUNTED_DR
WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (12) THEN INV_TRANS.ACCOUNTED_DR
WHEN NVL(INV_TRANS.TRANSACTION_TYPE_ID,11111)=11111 AND EVENT_TYPE_CODE = 'GLCOSTALOC' THEN INV_TRANS.TRANSACTION_VALUE
WHEN NVL(INV_TRANS.TRANSACTION_TYPE_ID,2222)=2222 AND EVENT_TYPE_CODE = 'LC_ADJUST_VALUATION' THEN INV_TRANS.TRANSACTION_VALUE
WHEN INV_TRANS.TRANSACTION_TYPE_ID=-99 THEN INV_TRANS.TRANSACTION_VALUE ELSE 0 END) RCV_VAL,
SUM(CASE WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (32,33,35,36,42,43,15,21,63,62,101,103,104,107,111,120,10008,140,71,200,260,261,52) THEN INV_TRANS.TRANSACTION_QUANTITY ELSE 0 END) ISSUE_QTY,
SUM(CASE WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (32,33,35,36,42,43,21,63,62,101,103,104,107,111,120,10008,140,71,200,260,261,52) THEN INV_TRANS.TRANSACTION_VALUE
WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (15) THEN INV_TRANS.ACCOUNTED_DR ELSE 0 END) ISSUE_VAL,
SUM(NVL(INV_TRANS.TRANSACTION_QUANTITY,0)) TRANS_QTY,
SUM(NVL(INV_TRANS.TRANSACTION_VALUE,0)) TRANS_VAL,
INV_TRANS.JE_CATEGORY_NAME,INV_TRANS.ACCOUNTING_CLASS_CODE,
SUM(INV_TRANS.ACCOUNTED_DR) DR,SUM(INV_TRANS.ACCOUNTED_CR) CR ,INV_TRANS.ACCOUNTING_CODE,INV_TRANS.SOURCE_DOCUMENT_ID,PUR.PO_NUMBER REF_NO, PUR.PO_NUMBER
FROM
(SELECT TO_CHAR(TRANSACTION_DATE,'MON-YY') PERIOD_CODE, A.LEDGER_ID, (SELECT DISTINCT BAL_SEG FROM XX_INV_ORG_VW WHERE LEDGER_ID=A.LEDGER_ID) COMPANY_CODE,
C.ORGANIZATION_CODE,A.ORGANIZATION_ID,A.SOURCE_DOCUMENT_ID,
XX_GET_ACCT_FLEX_SEG_DESC (1, F.SEGMENT1) COMPANY_NAME,
XX_GET_ACCT_FLEX_SEG_DESC (2, F.SEGMENT2) OPERATING_UNIT,
XX_GET_ACCT_FLEX_SEG_DESC (3, F.SEGMENT3) COST_CENTER,
--(SELECT DISTINCT XX_GET_ACCT_FLEX_SEG_DESC (3, SEGMENT3) COST_CENTER FROM GL_CODE_COMBINATIONS_KFV WHERE CODE_COMBINATION_ID=E.CODE_COMBINATION_ID) COST_CENTER,
A.INVENTORY_ITEM_ID, B.SEGMENT1||'|'||B.SEGMENT2||'|'||B.SEGMENT3||'|'||B.SEGMENT4 ITEM_CODE,
(SELECT DESCRIPTION FROM MTL_SYSTEM_ITEMS_B WHERE INVENTORY_ITEM_ID=A.INVENTORY_ITEM_ID AND ORGANIZATION_ID=A.ORGANIZATION_ID) ITEM_DESC,
(SELECT PRIMARY_UOM_CODE FROM MTL_SYSTEM_ITEMS_B WHERE INVENTORY_ITEM_ID=A.INVENTORY_ITEM_ID AND ORGANIZATION_ID=A.ORGANIZATION_ID) UOM,
A.EVENT_CLASS_CODE,A.EVENT_TYPE_CODE, --a.transaction_id,
G.TRANSACTION_TYPE_ID,G.TRANSACTION_TYPE_NAME,
D.JE_CATEGORY_NAME,E.ACCOUNTING_CLASS_CODE,D.AE_HEADER_ID,XX_AP_PKG.GET_ACCOUNT_DESC_FROM_CCID (E.CODE_COMBINATION_ID) ACCOUNT_NAME,
XX_AP_PKG.GET_SUB_ACCOUNT_DESC_FROM_CCID(TO_NUMBER(E.CODE_COMBINATION_ID)) SUB_ACCOUNT, 
TRANSACTION_QUANTITY,TRANSACTION_VALUE,E.ACCOUNTED_DR,E.ACCOUNTED_CR,F.CONCATENATED_SEGMENTS ACCOUNTING_CODE
FROM GMF_XLA_EXTRACT_HEADERS A, MTL_SYSTEM_ITEMS_B B,ORG_ORGANIZATION_DEFINITIONS C,XLA_AE_HEADERS D,XLA_AE_LINES E,GL_CODE_COMBINATIONS_KFV F,MTL_TRANSACTION_TYPES G
WHERE A.INVENTORY_ITEM_ID=B.INVENTORY_ITEM_ID(+) AND A.ORGANIZATION_ID=B.ORGANIZATION_ID(+) AND A.ORGANIZATION_ID=C.ORGANIZATION_ID AND A.TRANSACTION_TYPE_ID=G.TRANSACTION_TYPE_ID(+)
AND A.EVENT_ID=D.EVENT_ID AND D.AE_HEADER_ID=E.AE_HEADER_ID AND E.CODE_COMBINATION_ID=F.CODE_COMBINATION_ID
AND TO_CHAR(TRANSACTION_DATE,'MON-YY')=NVL(:P_PERIOD_CODE, TO_CHAR(TRANSACTION_DATE,'MON-YY'))
--AND A.LEDGER_ID=:P_LEDGER_ID
AND A.ORGANIZATION_ID=NVL(:P_ORGANIZATION_ID,A.ORGANIZATION_ID) AND A.INVENTORY_ITEM_ID=NVL(:P_INVENTORY_ITEM_ID,A.INVENTORY_ITEM_ID)) INV_TRANS
LEFT OUTER JOIN (SELECT MIC.INVENTORY_ITEM_ID,MIC.ORGANIZATION_ID,MC.SEGMENT1 MEJOR_FIN_CAT,MC.SEGMENT1||'|'||MC.SEGMENT2 FIN_CAT
FROM MTL_ITEM_CATEGORIES MIC,MTL_CATEGORIES MC WHERE MIC.CATEGORY_ID=MC.CATEGORY_ID AND STRUCTURE_ID=50408) FIN_CAT
ON FIN_CAT.INVENTORY_ITEM_ID=INV_TRANS.INVENTORY_ITEM_ID AND FIN_CAT.ORGANIZATION_ID=INV_TRANS.ORGANIZATION_ID AND FIN_CAT.MEJOR_FIN_CAT= NVL(:P_MEJOR_FIN_CAT,FIN_CAT.MEJOR_FIN_CAT)
LEFT OUTER JOIN  (SELECT  RSL.SHIPMENT_HEADER_ID,POH.PO_HEADER_ID,POH.SEGMENT1 PO_NUMBER,POH.ATTRIBUTE1 LOCAL_IMPORT 
from RCV_SHIPMENT_LINES RSL, PO_HEADERS_ALL poh where POH.PO_HEADER_ID= RSL.PO_HEADER_ID and POH.ATTRIBUTE1 IN ('IL' ,'INL','IFA')) PUR ON PUR.SHIPMENT_HEADER_ID= SOURCE_DOCUMENT_ID WHERE ACCOUNTING_CLASS_CODE='INVENTORY_VALUATION' AND EVENT_TYPE_CODE='PO_RECEIPT' AND PUR.LOCAL_IMPORT IN ('IL' ,'INL','IFA')
GROUP BY PERIOD_CODE,FIN_CAT.MEJOR_FIN_CAT,FIN_CAT.FIN_CAT,INV_TRANS.LEDGER_ID, INV_TRANS.COMPANY_NAME,INV_TRANS.ORGANIZATION_CODE,INV_TRANS.ORGANIZATION_ID,--INV_TRANS.TRANSACTION_ID,
INV_TRANS.INVENTORY_ITEM_ID,INV_TRANS.ITEM_CODE,INV_TRANS.ITEM_DESC, INV_TRANS.UOM,
INV_TRANS.EVENT_TYPE_CODE,INV_TRANS.TRANSACTION_TYPE_NAME,INV_TRANS.ACCOUNT_NAME,INV_TRANS.SUB_ACCOUNT,INV_TRANS.ACCOUNTING_CODE,PUR.PO_NUMBER,
INV_TRANS.TRANSACTION_TYPE_ID,INV_TRANS.JE_CATEGORY_NAME,INV_TRANS.ACCOUNTING_CLASS_CODE, COMPANY_CODE, OPERATING_UNIT, COST_CENTER,INV_TRANS.SOURCE_DOCUMENT_ID
--ORDER BY ORGANIZATION_ID,INVENTORY_ITEM_ID
) X
WHERE X.COST_CENTER = NVL(:P_COST_CENTER, X.COST_CENTER)
--AND X.COMPANY_CODE=NVL(:P_COMPANY_CODE, X.COMPANY_CODE)
AND X.LEDGER_ID=NVL(:P_COMPANY_CODE, X.LEDGER_ID)
GROUP BY X.PERIOD_CODE,X.PO_NUMBER,X.SOURCE_DOCUMENT_ID, X.LEDGER_ID, X.COMPANY_NAME, X.COMPANY_CODE, X.OPERATING_UNIT, X.COST_CENTER,
X.ORGANIZATION_CODE,X.MEJOR_FIN_CAT,X.FIN_CAT,X.ORGANIZATION_ID,--X.TRANSACTION_ID,
X.INVENTORY_ITEM_ID,X.ITEM_CODE,X.ITEM_DESC, X.UOM, X.EVENT_TYPE_CODE,X.TRANSACTION_TYPE_ID,
X.TRANSACTION_TYPE_NAME,X.ACCOUNT_NAME,X.SUB_ACCOUNT,X.OP_QTY, X.OP_VAL,X.JE_CATEGORY_NAME,X.ACCOUNTING_CLASS_CODE,X.ACCOUNTING_CODE
ORDER BY X.ORGANIZATION_CODE,X.MEJOR_FIN_CAT,X.ITEM_CODE


-- TASK 
1.  




select * from GL_CODE_COMBINATIONS

--OVERHEAD PURPOSE

 SELECT * FROM CM_CMPT_MST_VL  
 
select * from GL_ALOC_BAS 

select * from  GL_ALOC_EXP

select * from GL_ALOC_INP

select * from GL_ALOC_MST

select * from GL_CODE_COMBINATIONS

--28-DEC-2020    72557184.47
--===================

-- EBS Factory Overhead Report
SELECT GCC.SEGMENT1 LEGAL_ENTITY,GCC.SEGMENT2 OU, GAM.LEGAL_ENTITY_ID, GAM.ALLOC_CODE , GCC.SEGMENT1||'.'||GCC.SEGMENT2||'.'||GCC.SEGMENT3||'.'||GCC.SEGMENT4||'.'||GCC.SEGMENT5||'.'||GCC.SEGMENT6||'.'||GCC.SEGMENT7 CODE_COMBINATIONS , GCC.SEGMENT4 GL_CODE, 
XX_GET_ACCT_FLEX_SEG_DESC (1, GCC.SEGMENT1) LEGAL_ENTITY_NAME,
XX_GET_ACCT_FLEX_SEG_DESC(4,GCC.SEGMENT4) ACCOUNT_DESC, 
 :P_PERIOD_CODE,
 --(SELECT  NAME FROM GL_LEDGERS WHERE CHART_OF_ACCOUNTS_ID = GCC.SEGMENT1 ) OU,
 SUM(GAI.AMOUNT) AP_AMOUNT  
 FROM GL_ALOC_MST GAM, GL_CODE_COMBINATIONS  GCC, GL_ALOC_INP GAI, GL_ALOC_EXP GAE
WHERE 1=1
--AND GL.CHART_OF_ACCOUNTS_ID = GCC.SEGMENT1 
--AND GAI.CALENDAR_CODE = '19-20'
 AND  TO_CHAR(TO_DATE(GAI.PERIOD_CODE ,'MON-YY'),'MON-YY') = NVL(:P_PERIOD_CODE,  TO_CHAR(TO_DATE(GAI.PERIOD_CODE ,'MON-YY'),'MON-YY') )
--AND GAI.PERIOD_CODE = 'JUL-19'
AND GAM.ALLOC_ID = GAE.ALLOC_ID
AND  GAE.ALLOC_ID = GAI.ALLOC_ID
AND GAE.LINE_NO= GAI.LINE_NO
--AND GAM.LEGAL_ENTITY_ID= 23273  -- KSRM Steel Plant Ltd (KSPL)
AND GAI.ACCOUNT_ID=GCC.CODE_COMBINATION_ID   ---
--AND GCC.SEGMENT1 = :P_LEGAL_ENTITY
  AND GCC.SEGMENT1 = NVL(:P_LEGAL_ENTITY, GCC.SEGMENT1) --101
  AND GCC.SEGMENT2 = NVL(:P_OPERATING_UNIT, GCC.SEGMENT2) 
--and gai.AMOUNT <> 0
--and gam.alloc_code= 'GAS CONSUMED' -- like ()
GROUP BY GCC.SEGMENT1,GCC.SEGMENT2 ,GAM.LEGAL_ENTITY_ID, GAM.ALLOC_CODE,GCC.SEGMENT4,  GCC.SEGMENT1||'.'||GCC.SEGMENT2||'.'||GCC.SEGMENT3||'.'||GCC.SEGMENT4||'.'||GCC.SEGMENT5||'.'||GCC.SEGMENT6||'.'||GCC.SEGMENT7
ORDER  BY GAM.ALLOC_CODE








--EBS FINANCIAL POSITION 
--EBS INCOMESTATEMENT 




--22-DEC-2020    72557184.47
--=========
SELECT SUM(AP_amount)
FROM
(
select gai.PERIOD_CODE ,GAM.LEGAL_ENTITY_ID, gam.alloc_code , gcc.segment1||'.'||gcc.segment2||'.'||gcc.segment3||'.'||gcc.segment4||'.'||gcc.segment5||'.'||gcc.segment6||'.'||gcc.segment7 Code_Combinations , gcc.segment4 GL_CODE, 
 SUM(gai.AMOUNT) AP_amount  from GL_ALOC_MST GAM, GL_CODE_COMBINATIONS  gcc, GL_ALOC_INP gai, GL_ALOC_EXP gae
WHERE 1=1
--and gai.CALENDAR_CODE = '18-19'
and gai.PERIOD_CODE = 'JUL-19'
and GAM.ALLOC_ID = GAE.ALLOC_ID
and  GAE.ALLOC_ID = GAI.ALLOC_ID
and GAE.LINE_NO= GAI.LINE_NO
and GAM.LEGAL_ENTITY_ID= 23273  -- KSRM Steel Plant Ltd (KSPL)
AND GAI.ACCOUNT_ID=gcc.code_combination_id
--and gai.AMOUNT <> 0
--and gam.alloc_code= 'GAS CONSUMED' -- like ()
GROUP BY GAM.LEGAL_ENTITY_ID, gam.alloc_code,gcc.segment4,  gcc.segment1||'.'||gcc.segment2||'.'||gcc.segment3||'.'||gcc.segment4||'.'||gcc.segment5||'.'||gcc.segment6||'.'||gcc.segment7, gai.PERIOD_CODE 
order  by gam.alloc_code 
)


select GAM.LEGAL_ENTITY_ID, gam.alloc_code , gcc.segment1||'.'||gcc.segment2||'.'||gcc.segment3||'.'||gcc.segment4||'.'||gcc.segment5||'.'||gcc.segment6||'.'||gcc.segment7 Code_Combinations , gcc.segment4 GL_CODE, 
 SUM(gai.AMOUNT) AP_amount  from GL_ALOC_MST GAM, GL_CODE_COMBINATIONS  gcc, GL_ALOC_INP gai, GL_ALOC_EXP gae
WHERE gai.CALENDAR_CODE = '19-20'
and gai.PERIOD_CODE = 'JUL-19'
and GAM.ALLOC_ID = GAE.ALLOC_ID
and  GAE.ALLOC_ID = GAI.ALLOC_ID
and GAE.LINE_NO= GAI.LINE_NO
and GAM.LEGAL_ENTITY_ID= 23273  -- KSRM Steel Plant Ltd (KSPL)
AND GAI.ACCOUNT_ID=gcc.code_combination_id
--and gai.AMOUNT <> 0
--and gam.alloc_code= 'GAS CONSUMED' -- like ()
GROUP BY GAM.LEGAL_ENTITY_ID, gam.alloc_code,gcc.segment4,  gcc.segment1||'.'||gcc.segment2||'.'||gcc.segment3||'.'||gcc.segment4||'.'||gcc.segment5||'.'||gcc.segment6||'.'||gcc.segment7
order  by gam.alloc_code



--ROKAN MAMA

select gam.alloc_code , gcc.segment1||'.'||gcc.segment2||'.'||gcc.segment3||'.'||gcc.segment4||'.'||gcc.segment5||'.'||gcc.segment6||'.'||gcc.segment7 Code_Combinations , SUM(gai.AMOUNT) alock_amount  from GL_ALOC_MST GAM, GL_CODE_COMBINATIONS  gcc, GL_ALOC_INP gai, GL_ALOC_EXP gae
WHERE gai.CALENDAR_CODE = '19-20'
and gai.PERIOD_CODE = 'JUL-19'
and GAM.ALLOC_ID = GAE.ALLOC_ID
and  GAE.ALLOC_ID = GAI.ALLOC_ID
and GAE.LINE_NO= GAI.LINE_NO
--and GAM.LEGAL_ENTITY_ID= :
AND GAI.ACCOUNT_ID=gcc.code_combination_id
--and gam.alloc_code= 'GAS CONSUMED' -- like ()
GROUP BY gam.alloc_code, gcc.segment1||'.'||gcc.segment2||'.'||gcc.segment3||'.'||gcc.segment4||'.'||gcc.segment5||'.'||gcc.segment6||'.'||gcc.segment7


 

select * from GL_CODE_COMBINATIONS

select * from GL_ALOC_INP 

select * from WIP_LPN_COMPLETIONS 

SELECT * FROM ALL_OBJECTS WHERE OBJECT_NAME LIKE 'GL_ALOC%'   and OBJECT_TYPE  in ('TABLE', 'VIEW')   --AND OWNER='AP'

select * from GL_ALOC_INP_V where PERIOD_CODE = 'JUL-19' and LEGAL_ENTITY_NAME = 'KSRM Steel Plant Ltd (KSPL)'




select * from GL_ALOC_INP_V where PERIOD_CODE = 'JUL-19' and LEGAL_ENTITY_NAME = 'KSRM Steel Plant Ltd (KSPL)' and ACCOUNT_KEY_TYPE <> 0

select * from GL_ALOC_DTL

select * FROM  GL_ALOC_MST_V 

SELECT * FROM GL_ALOC_MST_V 





select distinct  gxel.JOURNAL_LINE_TYPE, COST_ANALYSIS_CODE,gxeh.TRANSACTION_TYPE_ID, gxeh.EVENT_CLASS_CODE,TRANSACTION_SOURCE_TYPE_ID , gxeh.ENTITY_CODE from gmf_xla_extract_headers gxeh, gmf_xla_extract_lines gxel
 where gxeh.INVENTORY_ITEM_ID = 21040
 and gxeh.header_id= gxel.header_id
 and gxeh.ORGANIZATION_ID = 121
 and gxel.LEDGER_ID=2021
 
 SELECT * FROM EAM_OP_GDET_VW  where VOUCHER_DATE between '01-jul-19' and '31-jul-19'  and organization_id=121 and CONCAT_ITEM_CODE='BP|SCRP|ROLL|000003' 
and je_category = 'OPM Cost Revaluation'
 and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'  
 
 SELECT * FROM gmf_xla_extract_headers gxeh
 
 select  XXGET_ITEM_CODE(INVENTORY_ITEM_ID) ITEM_CODE,MY_PACKAGE.XXGET_ITEM_DESCRIPTION(INVENTORY_ITEM_ID) ITEM_DESCRIPTION, SUM(TRANSACTION_QUANTITY), SUM(TRANSACTION_VALUE)
  from EAM_OP_GDET_VW where PERIOD_NAME = 'Jul-19'  and EVENT_TYPE_CODE= 'RELE' and ORG_ID = 81 
 -- and CONCAT_ITEM_CODE = 'RM|BLTI|500|000018'  
 and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'  
 GROUP BY MY_PACKAGE.XXGET_ITEM_DESCRIPTION(INVENTORY_ITEM_ID) , XXGET_ITEM_CODE(INVENTORY_ITEM_ID)  







SELECT XXGET_ITEM_CODE(INVENTORY_ITEM_ID) ITEM_CODE ,MY_PACKAGE.XXGET_ITEM_DESCRIPTION(INVENTORY_ITEM_ID) ITEM_DESCRIPTION ,SUM(TRANSACTION_QUANTITY), SUM(TRANSACTION_VALUE)
FROM
(
select  
EVENT_CLASS_CODE , EVENT_TYPE_CODE, INVENTORY_ITEM_ID,
MY_PACKAGE.XXGET_ITEM_DESCRIPTION(INVENTORY_ITEM_ID) ITEM_DESCRIPTION,  TRANSACTION_QUANTITY ,TRANSACTION_UOM,TRANSACTION_VALUE
  from gmf_xla_extract_headers gxeh where 
 TRANSACTION_DATE between '01-JUL-19' and '31-JUL-19' and EVENT_TYPE_CODE ='RELE' and OPERATING_UNIT = 81
)
GROUP BY INVENTORY_ITEM_ID


gmf_xla_extract_headers


select  SUM(TRANSACTION_QUANTITY), SUM(TRANSACTION_VALUE) FROM 




select * from gmf_xla_extract_lines

               ,gmf_period_statuses mst
               
               select * from cm_cmpt_mst ccmv order by COST_CMPNTCLS_ID 

select * from XLA_AE_HEADERS WHERE AE_HEADER_ID= 31389182

select *  from XLA_AE_LINES  WHERE  AE_HEADER_ID= 31389182

--==========================================
-- EBS COGS STATEMENT  FINAL 
--==========================================

--SELECT SUM(TRANS_VAL) FROM (
SELECT X.PERIOD_CODE,X.LEDGER_ID, X.COMPANY_NAME, X.COMPANY, X.OPERATING_UNIT, X.COST_CENTER,
X.ORGANIZATION_CODE,X.MEJOR_FIN_CAT,X.FIN_CAT,X.ORGANIZATION_ID,--X.TRANSACTION_ID,
X.INVENTORY_ITEM_ID,X.ITEM_CODE,X.ITEM_DESC, X.UOM, X.EVENT_TYPE_CODE,X.TRANSACTION_TYPE_ID,
X.TRANSACTION_TYPE_NAME,X.ACCOUNT_NAME,X.SUB_ACCOUNT,X.OP_QTY, X.OP_VAL,
SUM(X.RCV_QTY) RCV_QTY, SUM(X.RCV_VAL) RCV_VAL, ABS(SUM(X.ISSUE_QTY)) ISSUE_QTY, ABS(SUM(X.ISSUE_VAL)) ISSUE_VAL, ABS(SUM(X.TRANS_QTY)) TRANS_QTY, ABS(SUM(X.TRANS_VAL))TRANS_VAL,
X.JE_CATEGORY_NAME,X.ACCOUNTING_CLASS_CODE, SUM(X.DR) DR, SUM(X.CR) CR ,X.ACCOUNTING_CODE
FROM
(SELECT INV_TRANS.PERIOD_CODE,INV_TRANS.LEDGER_ID, INV_TRANS.COMPANY_NAME, INV_TRANS.COMPANY, INV_TRANS.OPERATING_UNIT, INV_TRANS.COST_CENTER, 
INV_TRANS.ORGANIZATION_CODE,FIN_CAT.MEJOR_FIN_CAT,FIN_CAT.FIN_CAT,INV_TRANS.ORGANIZATION_ID,--INV_TRANS.TRANSACTION_ID,
INV_TRANS.INVENTORY_ITEM_ID,INV_TRANS.ITEM_CODE,INV_TRANS.ITEM_DESC, INV_TRANS.UOM, INV_TRANS.EVENT_TYPE_CODE,INV_TRANS.TRANSACTION_TYPE_ID,
CASE WHEN INV_TRANS.TRANSACTION_TYPE_ID=-99 THEN INV_TRANS.EVENT_TYPE_CODE ELSE INV_TRANS.TRANSACTION_TYPE_NAME END TRANSACTION_TYPE_NAME,
INV_TRANS.ACCOUNT_NAME,INV_TRANS.SUB_ACCOUNT,
0 OP_QTY, 0 OP_VAL,
SUM(CASE WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (17,12,44,18,61,1002,1003) THEN INV_TRANS.TRANSACTION_QUANTITY ELSE 0 END) RCV_QTY,
SUM(CASE WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (17,18,1002,1003) THEN INV_TRANS.TRANSACTION_VALUE
WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (44) THEN INV_TRANS.TRANSACTION_VALUE -----INV_TRANS.ACCOUNTED_DR
WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (61) THEN INV_TRANS.ACCOUNTED_DR
WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (12) THEN INV_TRANS.ACCOUNTED_DR
WHEN NVL(INV_TRANS.TRANSACTION_TYPE_ID,11111)=11111 AND EVENT_TYPE_CODE = 'GLCOSTALOC' THEN INV_TRANS.TRANSACTION_VALUE
WHEN NVL(INV_TRANS.TRANSACTION_TYPE_ID,2222)=2222 AND EVENT_TYPE_CODE = 'LC_ADJUST_VALUATION' THEN INV_TRANS.TRANSACTION_VALUE
WHEN INV_TRANS.TRANSACTION_TYPE_ID=-99 THEN INV_TRANS.TRANSACTION_VALUE ELSE 0 END) RCV_VAL,
SUM(CASE WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (32,33,35,36,42,43,15,21,63,62,101,103,104,107,111,120,10008,140,71,200,260,261,52) THEN INV_TRANS.TRANSACTION_QUANTITY ELSE 0 END) ISSUE_QTY,
SUM(CASE WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (32,33,35,36,42,43,21,63,62,101,103,104,107,111,120,10008,140,71,200,260,261,52) THEN INV_TRANS.TRANSACTION_VALUE
WHEN INV_TRANS.TRANSACTION_TYPE_ID IN (15) THEN INV_TRANS.ACCOUNTED_DR ELSE 0 END) ISSUE_VAL,
SUM(NVL(INV_TRANS.TRANSACTION_QUANTITY,0)) TRANS_QTY,
SUM(NVL(INV_TRANS.TRANSACTION_VALUE,0)) TRANS_VAL,
INV_TRANS.JE_CATEGORY_NAME,INV_TRANS.ACCOUNTING_CLASS_CODE,
SUM(INV_TRANS.ACCOUNTED_DR) DR,SUM(INV_TRANS.ACCOUNTED_CR) CR ,INV_TRANS.ACCOUNTING_CODE
FROM
(SELECT TO_CHAR(TRANSACTION_DATE,'MON-YY') PERIOD_CODE, A.LEDGER_ID, (SELECT DISTINCT BAL_SEG_NAME FROM XX_INV_ORG_VW WHERE LEDGER_ID=A.LEDGER_ID) COMPANY_NAME,
C.ORGANIZATION_CODE,A.ORGANIZATION_ID,
XX_GET_ACCT_FLEX_SEG_DESC (1, F.SEGMENT1) COMPANY,
XX_GET_ACCT_FLEX_SEG_DESC (2, F.SEGMENT2) OPERATING_UNIT,
XX_GET_ACCT_FLEX_SEG_DESC (3, F.SEGMENT3) COST_CENTER,
--(SELECT DISTINCT XX_GET_ACCT_FLEX_SEG_DESC (3, SEGMENT3) COST_CENTER FROM GL_CODE_COMBINATIONS_KFV WHERE CODE_COMBINATION_ID=E.CODE_COMBINATION_ID) COST_CENTER,
A.INVENTORY_ITEM_ID,B.SEGMENT1||'|'||B.SEGMENT2||'|'||B.SEGMENT3||'|'||B.SEGMENT4 ITEM_CODE,
(SELECT DESCRIPTION FROM MTL_SYSTEM_ITEMS_B WHERE INVENTORY_ITEM_ID=A.INVENTORY_ITEM_ID AND ORGANIZATION_ID=A.ORGANIZATION_ID) ITEM_DESC,
(SELECT PRIMARY_UOM_CODE FROM MTL_SYSTEM_ITEMS_B WHERE INVENTORY_ITEM_ID=A.INVENTORY_ITEM_ID AND ORGANIZATION_ID=A.ORGANIZATION_ID) UOM,
A.EVENT_CLASS_CODE,A.EVENT_TYPE_CODE, --a.transaction_id,
G.TRANSACTION_TYPE_ID,G.TRANSACTION_TYPE_NAME,
D.JE_CATEGORY_NAME,E.ACCOUNTING_CLASS_CODE,D.AE_HEADER_ID,XX_AP_PKG.GET_ACCOUNT_DESC_FROM_CCID (E.CODE_COMBINATION_ID) ACCOUNT_NAME,
XX_AP_PKG.GET_SUB_ACCOUNT_DESC_FROM_CCID(TO_NUMBER(E.CODE_COMBINATION_ID)) SUB_ACCOUNT,
TRANSACTION_QUANTITY,TRANSACTION_VALUE,E.ACCOUNTED_DR,E.ACCOUNTED_CR,F.CONCATENATED_SEGMENTS ACCOUNTING_CODE
FROM GMF_XLA_EXTRACT_HEADERS A,MTL_SYSTEM_ITEMS_B B,ORG_ORGANIZATION_DEFINITIONS C,XLA_AE_HEADERS D,XLA_AE_LINES E,GL_CODE_COMBINATIONS_KFV F,MTL_TRANSACTION_TYPES G
WHERE A.INVENTORY_ITEM_ID=B.INVENTORY_ITEM_ID(+) AND A.ORGANIZATION_ID=B.ORGANIZATION_ID(+) AND A.ORGANIZATION_ID=C.ORGANIZATION_ID AND A.TRANSACTION_TYPE_ID=G.TRANSACTION_TYPE_ID(+)
AND A.EVENT_ID=D.EVENT_ID AND D.AE_HEADER_ID=E.AE_HEADER_ID AND E.CODE_COMBINATION_ID=F.CODE_COMBINATION_ID
AND TO_CHAR(TRANSACTION_DATE,'MON-YY')=:P_PERIOD_CODE
AND A.LEDGER_ID=:P_LEDGER_ID AND A.ORGANIZATION_ID=NVL(:P_ORGANIZATION_ID,A.ORGANIZATION_ID) AND A.INVENTORY_ITEM_ID=NVL(:P_INVENTORY_ITEM_ID,A.INVENTORY_ITEM_ID)) INV_TRANS
LEFT OUTER JOIN (SELECT MIC.INVENTORY_ITEM_ID,MIC.ORGANIZATION_ID,MC.SEGMENT1 MEJOR_FIN_CAT,MC.SEGMENT1||'|'||MC.SEGMENT2 FIN_CAT
FROM MTL_ITEM_CATEGORIES MIC,MTL_CATEGORIES MC WHERE MIC.CATEGORY_ID=MC.CATEGORY_ID AND STRUCTURE_ID=50408) FIN_CAT
ON FIN_CAT.INVENTORY_ITEM_ID=INV_TRANS.INVENTORY_ITEM_ID AND FIN_CAT.ORGANIZATION_ID=INV_TRANS.ORGANIZATION_ID AND FIN_CAT.MEJOR_FIN_CAT= NVL(:P_MEJOR_FIN_CAT,FIN_CAT.MEJOR_FIN_CAT)
GROUP BY PERIOD_CODE,FIN_CAT.MEJOR_FIN_CAT,FIN_CAT.FIN_CAT,INV_TRANS.LEDGER_ID, INV_TRANS.COMPANY_NAME,INV_TRANS.ORGANIZATION_CODE,INV_TRANS.ORGANIZATION_ID,--INV_TRANS.TRANSACTION_ID,
INV_TRANS.INVENTORY_ITEM_ID,INV_TRANS.ITEM_CODE,INV_TRANS.ITEM_DESC, INV_TRANS.UOM,
INV_TRANS.EVENT_TYPE_CODE,INV_TRANS.TRANSACTION_TYPE_NAME,INV_TRANS.ACCOUNT_NAME,INV_TRANS.SUB_ACCOUNT,INV_TRANS.ACCOUNTING_CODE,
INV_TRANS.TRANSACTION_TYPE_ID,INV_TRANS.JE_CATEGORY_NAME,INV_TRANS.ACCOUNTING_CLASS_CODE, COMPANY, OPERATING_UNIT, COST_CENTER
ORDER BY ORGANIZATION_ID,INVENTORY_ITEM_ID--,CASE WHEN TRANSACTION_TYPE_NAME = 'OPENING VALUE' THEN 1 ELSE 2 END ---,ae_header_id
) X
WHERE (ACCOUNT_NAME IN ('Finished Goods','Raw Materials')
OR ACCOUNT_NAME LIKE ('Stores%Spares')
OR ACCOUNT_NAME LIKE ('Fuel%Lubricants')
OR ACCOUNT_NAME LIKE ('Bi Product%Wastage'))
AND ACCOUNTING_CLASS_CODE  IN 'INVENTORY_VALUATION'
AND EVENT_TYPE_CODE='FOB_SHIP_SENDER_SHIP_TP'
--AND EVENT_TYPE_CODE IN('SO_ISSUE','FOB_SHIP_SENDER_SHIP_TP')
and TRANSACTION_TYPE_ID = 21
AND X.COST_CENTER = NVL(:P_COST_CENTER, X.COST_CENTER)
--AND to_date('01-'||period_code) BETWEEN '01-SEP-18' AND '30-SEP-18'
--and to_char(INV_TRANS.transaction_date,'MON-YY')=:P_PERIOD_CODE
GROUP BY X.PERIOD_CODE,X.LEDGER_ID, X.COMPANY_NAME, X.ORGANIZATION_CODE,X.MEJOR_FIN_CAT,X.FIN_CAT,X.ORGANIZATION_ID,--X.TRANSACTION_ID,
X.INVENTORY_ITEM_ID,X.ITEM_CODE,X.ITEM_DESC, X.UOM, X.EVENT_TYPE_CODE,X.TRANSACTION_TYPE_ID,
X.TRANSACTION_TYPE_NAME,X.ACCOUNT_NAME,X.SUB_ACCOUNT,X.OP_QTY, X.OP_VAL,
X.JE_CATEGORY_NAME,X.ACCOUNTING_CLASS_CODE, X.ACCOUNTING_CODE,X.COMPANY, X.OPERATING_UNIT, X.COST_CENTER

--)

--============================================================================
--EBS Production Cost Summary Report V8
-- Date 24-MAY-2021 -- Find out WIP_BY_PRODUCT_QTY

SELECT SUM(WIP_BY_PRO_COM_QTY) , TRANSACTION_VALUE,GL_LE LEGAL_ENTITY, GL_UNIT OU ,OU_NAME,ORGANIZATION_ID,CONCAT_ITEM_CODE, 
MY_PACKAGE.XXGET_ITEM_DESCRIPTION(INVENTORY_ITEM_ID) ITEM_DESCRIPTION,
:P_PERIOD_CODE P_PERIOD_CODE,
TRANSACTION_UOM UOM,
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) PRIOR_PERIOD_QTY,
APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)  PRESENT_PERIOD_QTY,
APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) PRODUCTION_QUANTITY,
SUM(COST) TOTAL_MATERIAL_COST  ,SUM(OVERHEAD) TOTAL_FACT_OVERHEAD,
SUM(COST)  + SUM(OVERHEAD) TOTAL_MANUFECTURING_COST,
CASE WHEN (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)   - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) = 0 THEN NULL ELSE  SUM(COST) / (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)   - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) END MATERIAL_COST_PER_MT,
CASE WHEN (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID))  = 0 THEN NULL ELSE SUM(OVERHEAD) /  (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) END FACTORY_OVERHEAD_PER_MT
--------------------
--SUM(COST) / (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
--XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID))  
--SUM(OVERHEAD) / (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
--XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) END MANUFECTURING_COST_MT
FROM
(
 SELECT SUM(TRANSACTION_VALUE) TRANSACTION_VALUE ,GL_LE,GL_UNIT,OU_NAME,CONCAT_ITEM_CODE,INVENTORY_ITEM_ID,
  (DECODE ( TRANSACTION_UOM,'KG','MT',TRANSACTION_UOM)) TRANSACTION_UOM,
 ORGANIZATION_ID,  NVL(SUM(ACCOUNTED_DR),0) ,NVL(SUM(ACCOUNTED_CR),0),
 --CASE WHEN TRANSACTION_TYPE_NAME = 'WIP Byproduct Complition' then SUM(ACCOUNTED_DR) - SUM(ACCOUNTED_CR) 
 (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Completion','WIP Byproduct Completion')
 AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
 THEN SUM(ACCOUNTED_DR)   ELSE 0 END )  DEBIT ,
  (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Completion Return','WIP Byproduct Return')
  AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
  THEN SUM(ACCOUNTED_CR)   ELSE 0 END )  CREDIT ,
     (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Byproduct Completion')
 --AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
 THEN SUM(TRANSACTION_QUANTITY)   ELSE 0 END ) +    
 (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Byproduct Return')
-- AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
 THEN SUM(TRANSACTION_QUANTITY)   ELSE 0 END ) WIP_BY_PRO_COM_QTY ,
   (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Completion','WIP Byproduct Completion')
    AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
     THEN SUM(ACCOUNTED_DR)   ELSE 0 END ) -
     (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Completion Return','WIP Byproduct Return')
      AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
     -- AND EVENT_TYPE_CODE = 'GLCOSTALOC'  
      THEN SUM(ACCOUNTED_CR)   ELSE 0 END ) COST,
     (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  
     AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
     AND EVENT_TYPE_CODE = 'GLCOSTALOC' THEN SUM(ACCOUNTED_DR)   ELSE 0 END )  OVER_HEAD_DEBIT,
          (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  
          AND ACCOUNTING_CLASS_CODE =  'INVENTORY_VALUATION' 
          AND EVENT_TYPE_CODE = 'GLCOSTALOC'  THEN SUM(ACCOUNTED_CR) ELSE 0 END )  OVER_HEAD_CRETIT,
               (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation' 
                AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
                AND EVENT_TYPE_CODE ='GLCOSTALOC' 
                 THEN NVL(SUM(ACCOUNTED_DR),0)   ELSE 0 END ) -
               (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation' 
                AND ACCOUNTING_CLASS_CODE =  'INVENTORY_VALUATION' 
                AND EVENT_TYPE_CODE ='GLCOSTALOC'  THEN NVL(SUM(ACCOUNTED_CR),0)   ELSE 0 END ) OVERHEAD
  FROM EAM_OP_GDET_VW 
  WHERE 1=1
  AND GL_LE = NVL(:P_LEGAL_ENTITY, GL_LE) --101
  AND GL_UNIT = NVL(:P_OPERATING_UNIT, GL_UNIT) --01
  AND ORGANIZATION_ID= NVL(:P_ORGANIZATION_ID, ORGANIZATION_ID)
   AND  TO_CHAR(TO_DATE(PERIOD_NAME,'MON-YY'),'MON-YY') = NVL(:P_PERIOD_CODE,  TO_CHAR(TO_DATE(PERIOD_NAME,'MON-YY'),'MON-YY') )
AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
AND EVENT_TYPE_CODE IN ('CERT', 'GLCOSTALOC') 
--and TRANSACTION_UOM = 'MT'
--AND ACCOUNTED_DR IS NOT NULL
--and CONCAT_ITEM_CODE = 'BP|SCRP|MSCL|000002'
GROUP BY GL_LE,GL_UNIT,OU_NAME,CONCAT_ITEM_CODE,TRANSACTION_TYPE_NAME,ACCOUNTING_CLASS_CODE,JE_CATEGORY,EVENT_TYPE_CODE,ORGANIZATION_ID,INVENTORY_ITEM_ID,TRANSACTION_UOM --, TRANSACTION_TYPE_NAME--,TRANSACTION_TYPE_NAME,EVENT_TYPE_CODE
ORDER BY CONCAT_ITEM_CODE
)
GROUP BY GL_LE,GL_UNIT,CONCAT_ITEM_CODE,ORGANIZATION_ID,INVENTORY_ITEM_ID,TRANSACTION_UOM,OU_NAME




--==================
--EBS Production Cost Summary Report V8
-- Date 27-APR-2021 -- Find out WIP_BY_PRODUCT_QTY and  work with of peak item

SELECT SUM(WIP_BY_PRO_COM_QTY) , TRANSACTION_VALUE,GL_LE LEGAL_ENTITY, GL_UNIT OU ,OU_NAME,ORGANIZATION_ID,CONCAT_ITEM_CODE, 
MY_PACKAGE.XXGET_ITEM_DESCRIPTION(INVENTORY_ITEM_ID) ITEM_DESCRIPTION,
:P_PERIOD_CODE P_PERIOD_CODE,
TRANSACTION_UOM UOM,
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) PRIOR_PERIOD_QTY,
APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)  PRESENT_PERIOD_QTY,
APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
NVL(XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID),0) -
GET_OFPICK_PROD_QTY( :P_ORGANIZATION_ID  , INVENTORY_ITEM_ID ,:P_PERIOD_CODE  )    PRODUCTION_QUANTITY,
SUM(COST) TOTAL_MATERIAL_COST  ,SUM(OVERHEAD) TOTAL_FACT_OVERHEAD,
SUM(COST)  + SUM(OVERHEAD) TOTAL_MANUFECTURING_COST,
CASE WHEN (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)   - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) = 0 THEN NULL ELSE  SUM(COST) / (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)   - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) END MATERIAL_COST_PER_MT,
CASE WHEN (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID))  = 0 THEN NULL ELSE SUM(OVERHEAD) /  (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) END FACTORY_OVERHEAD_PER_MT
------------
--SUM(COST) / (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
--XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID))  +
--SUM(OVERHEAD) / (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
--XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) END MANUFECTURING_COST_MT
----------
FROM
(
 SELECT SUM(TRANSACTION_VALUE) TRANSACTION_VALUE ,GL_LE,GL_UNIT,OU_NAME,CONCAT_ITEM_CODE,INVENTORY_ITEM_ID,
  (DECODE ( TRANSACTION_UOM,'KG','MT',TRANSACTION_UOM)) TRANSACTION_UOM,
 ORGANIZATION_ID,  NVL(SUM(ACCOUNTED_DR),0) ,NVL(SUM(ACCOUNTED_CR),0),
 --CASE WHEN TRANSACTION_TYPE_NAME = 'WIP Byproduct Complition' then SUM(ACCOUNTED_DR) - SUM(ACCOUNTED_CR) 
 (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Completion','WIP Byproduct Completion')
 AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
 THEN SUM(ACCOUNTED_DR)   ELSE 0 END )  DEBIT ,
  (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Completion Return','WIP Byproduct Return')
  AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
  THEN SUM(ACCOUNTED_CR)   ELSE 0 END )  CREDIT ,
     (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Byproduct Completion')
 --AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
 THEN SUM(TRANSACTION_QUANTITY)   ELSE 0 END ) +    
 (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Byproduct Return')
-- AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
 THEN SUM(TRANSACTION_QUANTITY)   ELSE 0 END ) WIP_BY_PRO_COM_QTY ,
   (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Completion','WIP Byproduct Completion')
    AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
     THEN SUM(ACCOUNTED_DR)   ELSE 0 END ) -
     (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Completion Return','WIP Byproduct Return')
      AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
     -- AND EVENT_TYPE_CODE = 'GLCOSTALOC'  
      THEN SUM(ACCOUNTED_CR)   ELSE 0 END ) COST,
     (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  
     AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
     AND EVENT_TYPE_CODE = 'GLCOSTALOC' THEN SUM(ACCOUNTED_DR)   ELSE 0 END )  OVER_HEAD_DEBIT,
          (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  
          AND ACCOUNTING_CLASS_CODE =  'INVENTORY_VALUATION' 
          AND EVENT_TYPE_CODE = 'GLCOSTALOC'  THEN SUM(ACCOUNTED_CR) ELSE 0 END )  OVER_HEAD_CRETIT,
               (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation' 
                AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
                AND EVENT_TYPE_CODE ='GLCOSTALOC' 
                 THEN NVL(SUM(ACCOUNTED_DR),0)   ELSE 0 END ) -
               (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation' 
                AND ACCOUNTING_CLASS_CODE =  'INVENTORY_VALUATION' 
                AND EVENT_TYPE_CODE ='GLCOSTALOC'  THEN NVL(SUM(ACCOUNTED_CR),0)   ELSE 0 END ) OVERHEAD
  FROM EAM_OP_GDET_VW 
  WHERE 1=1
  AND GL_LE = NVL(:P_LEGAL_ENTITY, GL_LE) --101
  AND GL_UNIT = NVL(:P_OPERATING_UNIT, GL_UNIT) --01
  AND ORGANIZATION_ID= NVL(:P_ORGANIZATION_ID, ORGANIZATION_ID)
   AND  TO_CHAR(TO_DATE(PERIOD_NAME,'MON-YY'),'MON-YY') = NVL(:P_PERIOD_CODE,  TO_CHAR(TO_DATE(PERIOD_NAME,'MON-YY'),'MON-YY') )
AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
AND EVENT_TYPE_CODE IN ('CERT', 'GLCOSTALOC') 
--and TRANSACTION_UOM = 'MT'
--AND ACCOUNTED_DR IS NOT NULL
--and CONCAT_ITEM_CODE = 'BP|SCRP|MSCL|000002'
GROUP BY GL_LE,GL_UNIT,OU_NAME,CONCAT_ITEM_CODE,TRANSACTION_TYPE_NAME,ACCOUNTING_CLASS_CODE,JE_CATEGORY,EVENT_TYPE_CODE,ORGANIZATION_ID,INVENTORY_ITEM_ID,TRANSACTION_UOM --, TRANSACTION_TYPE_NAME--,TRANSACTION_TYPE_NAME,EVENT_TYPE_CODE
ORDER BY CONCAT_ITEM_CODE
)
GROUP BY GL_LE,GL_UNIT,CONCAT_ITEM_CODE,ORGANIZATION_ID,INVENTORY_ITEM_ID,TRANSACTION_UOM,OU_NAME

--==============================================================================================================


--==============================================================================================================
--EBS Production Cost Summary Report V7 
-- Date 16-FEB-2021 -- Find out WIP_BY_PRODUCT_QTY

SELECT SUM(WIP_BY_PRO_COM_QTY) , TRANSACTION_VALUE,GL_LE LEGAL_ENTITY, GL_UNIT OU ,OU_NAME,ORGANIZATION_ID,CONCAT_ITEM_CODE, 
MY_PACKAGE.XXGET_ITEM_DESCRIPTION(INVENTORY_ITEM_ID) ITEM_DESCRIPTION,
:P_PERIOD_CODE P_PERIOD_CODE,
TRANSACTION_UOM UOM,
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) PRIOR_PERIOD_QTY,
APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)  PRESENT_PERIOD_QTY,
DECODE(APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID),0,1,APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID))  PRODUCTION_QUANTITY,
DECODE(SUM(COST) , 0,1,SUM(COST) ) TOTAL_MATERIAL_COST  ,DECODE(SUM(OVERHEAD) ,0,1,SUM(OVERHEAD) )TOTAL_FACT_OVERHEAD,
DECODE(SUM(COST),0,1,SUM(COST))  + DECODE(SUM(OVERHEAD) ,0,1,SUM(OVERHEAD) ) TOTAL_MANUFECTURING_COST
SUM(COST) / (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) MATERIAL_COST_PER_MT,
--SUM(OVERHEAD) /  (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
--XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) FACTORY_OVERHEAD_PER_MT,
--SUM(COST) / (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
--XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID))  +
--SUM(OVERHEAD) /  (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
--XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) MANUFECTURING_COST_MT
FROM
(
 SELECT SUM(TRANSACTION_VALUE) TRANSACTION_VALUE ,GL_LE,GL_UNIT,OU_NAME,CONCAT_ITEM_CODE,INVENTORY_ITEM_ID,
  (DECODE ( TRANSACTION_UOM,'KG','MT',TRANSACTION_UOM)) TRANSACTION_UOM,
 ORGANIZATION_ID,  NVL(SUM(ACCOUNTED_DR),0) ,NVL(SUM(ACCOUNTED_CR),0),
 --CASE WHEN TRANSACTION_TYPE_NAME = 'WIP Byproduct Complition' then SUM(ACCOUNTED_DR) - SUM(ACCOUNTED_CR) 
 (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Completion','WIP Byproduct Completion')
 AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
 THEN SUM(ACCOUNTED_DR)   ELSE 0 END )  DEBIT ,
  (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Completion Return','WIP Byproduct Return')
  AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
  THEN SUM(ACCOUNTED_CR)   ELSE 0 END )  CREDIT ,
     (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Byproduct Completion')
 --AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
 THEN SUM(TRANSACTION_QUANTITY)   ELSE 0 END ) +    
 (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Byproduct Return')
-- AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
 THEN SUM(TRANSACTION_QUANTITY)   ELSE 0 END ) WIP_BY_PRO_COM_QTY ,
   (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Completion','WIP Byproduct Completion')
    AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
     THEN SUM(ACCOUNTED_DR)   ELSE 0 END ) -
     (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Completion Return','WIP Byproduct Return')
      AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
     -- AND EVENT_TYPE_CODE = 'GLCOSTALOC'  
      THEN SUM(ACCOUNTED_CR)   ELSE 0 END ) COST,
     (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  
     AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
     AND EVENT_TYPE_CODE = 'GLCOSTALOC' THEN SUM(ACCOUNTED_DR)   ELSE 0 END )  OVER_HEAD_DEBIT,
          (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  
          AND ACCOUNTING_CLASS_CODE =  'INVENTORY_VALUATION' 
          AND EVENT_TYPE_CODE = 'GLCOSTALOC'  THEN SUM(ACCOUNTED_CR) ELSE 0 END )  OVER_HEAD_CRETIT,
               (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation' 
                AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
                AND EVENT_TYPE_CODE ='GLCOSTALOC' 
                 THEN NVL(SUM(ACCOUNTED_DR),0)   ELSE 0 END ) -
               (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation' 
                AND ACCOUNTING_CLASS_CODE =  'INVENTORY_VALUATION' 
                AND EVENT_TYPE_CODE ='GLCOSTALOC'  THEN NVL(SUM(ACCOUNTED_CR),0)   ELSE 0 END ) OVERHEAD
  FROM EAM_OP_GDET_VW 
  WHERE 1=1
  AND GL_LE = NVL(:P_LEGAL_ENTITY, GL_LE) --101
  AND GL_UNIT = NVL(:P_OPERATING_UNIT, GL_UNIT) --01
  AND ORGANIZATION_ID= NVL(:P_ORGANIZATION_ID, ORGANIZATION_ID)
   AND  TO_CHAR(TO_DATE(PERIOD_NAME,'MON-YY'),'MON-YY') = NVL(:P_PERIOD_CODE,  TO_CHAR(TO_DATE(PERIOD_NAME,'MON-YY'),'MON-YY') )
AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
AND EVENT_TYPE_CODE IN ('CERT', 'GLCOSTALOC') 
--and TRANSACTION_UOM = 'MT'
--AND ACCOUNTED_DR IS NOT NULL
--and CONCAT_ITEM_CODE = 'BP|SCRP|MSCL|000002'
GROUP BY GL_LE,GL_UNIT,OU_NAME,CONCAT_ITEM_CODE,TRANSACTION_TYPE_NAME,ACCOUNTING_CLASS_CODE,JE_CATEGORY,EVENT_TYPE_CODE,ORGANIZATION_ID,INVENTORY_ITEM_ID,TRANSACTION_UOM --, TRANSACTION_TYPE_NAME--,TRANSACTION_TYPE_NAME,EVENT_TYPE_CODE
ORDER BY CONCAT_ITEM_CODE
)
GROUP BY GL_LE,GL_UNIT,CONCAT_ITEM_CODE,ORGANIZATION_ID,INVENTORY_ITEM_ID,TRANSACTION_UOM,OU_NAME


/*
--EBS Production Cost Summary Report v5

SELECT GL_LE LEGAL_ENTITY, GL_UNIT OU ,OU_NAME,ORGANIZATION_ID,CONCAT_ITEM_CODE, 
MY_PACKAGE.XXGET_ITEM_DESCRIPTION(INVENTORY_ITEM_ID) ITEM_DESCRIPTION,
:P_PERIOD_CODE P_PERIOD_CODE,
TRANSACTION_UOM UOM,
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) PRIOR_PERIOD_QTY,
APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)  PRESENT_PERIOD_QTY,
APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) PRODUCTION_QUANTITY,
SUM(COST) TOTAL_MATERIAL_COST  ,SUM(OVERHEAD) TOTAL_FACT_OVERHEAD,
SUM(COST)  + SUM(OVERHEAD) TOTAL_MANUFECTURING_COST,
SUM(COST) / (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) MATERIAL_COST_PER_MT,
SUM(OVERHEAD) /  (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) FACTORY_OVERHEAD_PER_MT,
SUM(COST) / (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID))  +
SUM(OVERHEAD) /  (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) MANUFECTURING_COST_MT
FROM
(
 SELECT GL_LE,GL_UNIT,OU_NAME,CONCAT_ITEM_CODE,INVENTORY_ITEM_ID,
 --TRANSACTION_UOM,
  (DECODE ( TRANSACTION_UOM,'KG','MT',TRANSACTION_UOM)) TRANSACTION_UOM,
 ORGANIZATION_ID,  NVL(SUM(ACCOUNTED_DR),0) ,NVL(SUM(ACCOUNTED_CR),0),
 --CASE WHEN TRANSACTION_TYPE_NAME = 'WIP Byproduct Complition' then SUM(ACCOUNTED_DR) - SUM(ACCOUNTED_CR) 
 (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Completion','WIP Byproduct Completion')
 AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
 THEN SUM(ACCOUNTED_DR)   ELSE 0 END )  DEBIT ,
  (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Completion Return','WIP Byproduct Return')
  AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
  THEN SUM(ACCOUNTED_CR)   ELSE 0 END )  CREDIT ,
   (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Completion','WIP Byproduct Completion')
    AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
     THEN SUM(ACCOUNTED_DR)   ELSE 0 END ) -
     (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Completion Return','WIP Byproduct Return')
      AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
      AND EVENT_TYPE_CODE = 'GLCOSTALOC'  
      THEN SUM(ACCOUNTED_CR)   ELSE 0 END ) COST,
     (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  
     AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
     AND EVENT_TYPE_CODE = 'GLCOSTALOC' THEN SUM(ACCOUNTED_DR)   ELSE 0 END )  OVER_HEAD_DEBIT,
          (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  
          AND ACCOUNTING_CLASS_CODE =  'INVENTORY_VALUATION' 
          AND EVENT_TYPE_CODE = 'GLCOSTALOC'  THEN SUM(ACCOUNTED_CR) ELSE 0 END )  OVER_HEAD_CRETIT,
               (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation' 
                AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
                AND EVENT_TYPE_CODE ='GLCOSTALOC' 
                 THEN NVL(SUM(ACCOUNTED_DR),0)   ELSE 0 END ) -
               (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation' 
                AND ACCOUNTING_CLASS_CODE =  'INVENTORY_VALUATION' 
                AND EVENT_TYPE_CODE ='GLCOSTALOC'  THEN NVL(SUM(ACCOUNTED_CR),0)   ELSE 0 END ) OVERHEAD
  FROM EAM_OP_GDET_VW 
  WHERE 1=1
  AND GL_LE = NVL(:P_LEGAL_ENTITY, GL_LE) --101
  AND GL_UNIT = NVL(:P_OPERATING_UNIT, GL_UNIT) --01
  AND ORGANIZATION_ID= NVL(:P_ORGANIZATION_ID, ORGANIZATION_ID)
   AND  TO_CHAR(TO_DATE(PERIOD_NAME,'MON-YY'),'MON-YY') = NVL(:P_PERIOD_CODE,  TO_CHAR(TO_DATE(PERIOD_NAME,'MON-YY'),'MON-YY') )
AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
AND EVENT_TYPE_CODE IN ('CERT', 'GLCOSTALOC') 
--and TRANSACTION_UOM = 'MT'
AND ACCOUNTED_DR IS NOT NULL
GROUP BY GL_LE,GL_UNIT,OU_NAME,CONCAT_ITEM_CODE,TRANSACTION_TYPE_NAME,ACCOUNTING_CLASS_CODE,JE_CATEGORY,EVENT_TYPE_CODE,ORGANIZATION_ID,INVENTORY_ITEM_ID,TRANSACTION_UOM --, TRANSACTION_TYPE_NAME--,TRANSACTION_TYPE_NAME,EVENT_TYPE_CODE
ORDER BY CONCAT_ITEM_CODE
)
GROUP BY GL_LE,GL_UNIT,CONCAT_ITEM_CODE,ORGANIZATION_ID,INVENTORY_ITEM_ID,TRANSACTION_UOM,OU_NAME
--==============================================================================================================
--EBS Production Cost Summary Report V6 
-- Date 11-FEB-2021 -- Find out WIP_BY_PRODUCT_QTY

SELECT SUM(WIP_BY_PRO_COM_QTY) , TRANSACTION_VALUE,GL_LE LEGAL_ENTITY, GL_UNIT OU ,OU_NAME,ORGANIZATION_ID,CONCAT_ITEM_CODE, 
MY_PACKAGE.XXGET_ITEM_DESCRIPTION(INVENTORY_ITEM_ID) ITEM_DESCRIPTION,
:P_PERIOD_CODE P_PERIOD_CODE,
TRANSACTION_UOM UOM,
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) PRIOR_PERIOD_QTY,
APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)  PRESENT_PERIOD_QTY,
APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) PRODUCTION_QUANTITY,
SUM(COST) TOTAL_MATERIAL_COST  ,SUM(OVERHEAD) TOTAL_FACT_OVERHEAD,
SUM(COST)  + SUM(OVERHEAD) TOTAL_MANUFECTURING_COST,
SUM(COST) / (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) MATERIAL_COST_PER_MT,
SUM(OVERHEAD) /  (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) FACTORY_OVERHEAD_PER_MT,
SUM(COST) / (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID))  +
SUM(OVERHEAD) /  (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) MANUFECTURING_COST_MT
FROM
(
 SELECT SUM(TRANSACTION_VALUE) TRANSACTION_VALUE ,GL_LE,GL_UNIT,OU_NAME,CONCAT_ITEM_CODE,INVENTORY_ITEM_ID,
  (DECODE ( TRANSACTION_UOM,'KG','MT',TRANSACTION_UOM)) TRANSACTION_UOM,
 ORGANIZATION_ID,  NVL(SUM(ACCOUNTED_DR),0) ,NVL(SUM(ACCOUNTED_CR),0),
 --CASE WHEN TRANSACTION_TYPE_NAME = 'WIP Byproduct Complition' then SUM(ACCOUNTED_DR) - SUM(ACCOUNTED_CR) 
 (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Completion','WIP Byproduct Completion')
 AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
 THEN SUM(ACCOUNTED_DR)   ELSE 0 END )  DEBIT ,
  (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Completion Return','WIP Byproduct Return')
  AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
  THEN SUM(ACCOUNTED_CR)   ELSE 0 END )  CREDIT ,
     (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Byproduct Completion')
 --AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
 THEN SUM(TRANSACTION_QUANTITY)   ELSE 0 END ) +    
 (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Byproduct Return')
-- AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
 THEN SUM(TRANSACTION_QUANTITY)   ELSE 0 END ) WIP_BY_PRO_COM_QTY ,
   (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Completion','WIP Byproduct Completion')
    AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
     THEN SUM(ACCOUNTED_DR)   ELSE 0 END ) -
     (CASE WHEN TRANSACTION_TYPE_NAME  in  ('WIP Completion Return','WIP Byproduct Return')
      AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
     -- AND EVENT_TYPE_CODE = 'GLCOSTALOC'  
      THEN SUM(ACCOUNTED_CR)   ELSE 0 END ) COST,
     (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  
     AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
     AND EVENT_TYPE_CODE = 'GLCOSTALOC' THEN SUM(ACCOUNTED_DR)   ELSE 0 END )  OVER_HEAD_DEBIT,
          (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  
          AND ACCOUNTING_CLASS_CODE =  'INVENTORY_VALUATION' 
          AND EVENT_TYPE_CODE = 'GLCOSTALOC'  THEN SUM(ACCOUNTED_CR) ELSE 0 END )  OVER_HEAD_CRETIT,
               (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation' 
                AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
                AND EVENT_TYPE_CODE ='GLCOSTALOC' 
                 THEN NVL(SUM(ACCOUNTED_DR),0)   ELSE 0 END ) -
               (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation' 
                AND ACCOUNTING_CLASS_CODE =  'INVENTORY_VALUATION' 
                AND EVENT_TYPE_CODE ='GLCOSTALOC'  THEN NVL(SUM(ACCOUNTED_CR),0)   ELSE 0 END ) OVERHEAD
  FROM EAM_OP_GDET_VW 
  WHERE 1=1
  AND GL_LE = NVL(:P_LEGAL_ENTITY, GL_LE) --101
  AND GL_UNIT = NVL(:P_OPERATING_UNIT, GL_UNIT) --01
  AND ORGANIZATION_ID= NVL(:P_ORGANIZATION_ID, ORGANIZATION_ID)
   AND  TO_CHAR(TO_DATE(PERIOD_NAME,'MON-YY'),'MON-YY') = NVL(:P_PERIOD_CODE,  TO_CHAR(TO_DATE(PERIOD_NAME,'MON-YY'),'MON-YY') )
AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
AND EVENT_TYPE_CODE IN ('CERT', 'GLCOSTALOC') 
--and TRANSACTION_UOM = 'MT'
--AND ACCOUNTED_DR IS NOT NULL
--and CONCAT_ITEM_CODE = 'BP|SCRP|MSCL|000002'
GROUP BY GL_LE,GL_UNIT,OU_NAME,CONCAT_ITEM_CODE,TRANSACTION_TYPE_NAME,ACCOUNTING_CLASS_CODE,JE_CATEGORY,EVENT_TYPE_CODE,ORGANIZATION_ID,INVENTORY_ITEM_ID,TRANSACTION_UOM --, TRANSACTION_TYPE_NAME--,TRANSACTION_TYPE_NAME,EVENT_TYPE_CODE
ORDER BY CONCAT_ITEM_CODE
)
GROUP BY GL_LE,GL_UNIT,CONCAT_ITEM_CODE,ORGANIZATION_ID,INVENTORY_ITEM_ID,TRANSACTION_UOM,OU_NAME


--================ 11-FEB-2021=========FINAL V5==== Added By Product =========================================

--EBS Production Cost Summary Report v5
SELECT SUM(TOTAL_MATERIAL_COST) FROM (


SELECT TRANSACTION_TYPE_NAME, TRANSACTION_TYPE_ID,GL_LE LEGAL_ENTITY, GL_UNIT OU ,OU_NAME,ORGANIZATION_ID,CONCAT_ITEM_CODE, 
MY_PACKAGE.XXGET_ITEM_DESCRIPTION(INVENTORY_ITEM_ID) ITEM_DESCRIPTION,
:P_PERIOD_CODE P_PERIOD_CODE,
TRANSACTION_UOM UOM,
--(DECODE ( TRANSACTION_UOM,'KG','MT',TRANSACTION_UOM)) UOM,
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) PRIOR_PERIOD_QTY,
APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)  PRESENT_PERIOD_QTY,
APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) PRODUCTION_QUANTITY,
SUM(COST) TOTAL_MATERIAL_COST  ,SUM(OVERHEAD) TOTAL_FACT_OVERHEAD,
NVL(SUM(COST)  + SUM(OVERHEAD),0) TOTAL_MANUFECTURING_COST,
SUM(COST) / (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) MATERIAL_COST_PER_MT,
SUM(OVERHEAD) /  (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) FACTORY_OVERHEAD_PER_MT,
SUM(COST) / (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID))  +
SUM(OVERHEAD) /  (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) MANUFECTURING_COST_MT
FROM
(
 SELECT TRANSACTION_TYPE_NAME, TRANSACTION_TYPE_ID,GL_LE,GL_UNIT,OU_NAME,CONCAT_ITEM_CODE,INVENTORY_ITEM_ID,
-- TRANSACTION_UOM,
 (DECODE ( TRANSACTION_UOM,'KG','MT',TRANSACTION_UOM)) TRANSACTION_UOM,
 ORGANIZATION_ID, 
  -- NVL(SUM(ACCOUNTED_DR),0),
 ( DECODE(TRANSACTION_UOM , 'KG',NVL(SUM(ACCOUNTED_DR),0)/1000, NVL(SUM(ACCOUNTED_DR),0))) ACCOUNTED_DR ,    --    321350.63
 --TO_CHAR(DECODE ( X.UOM,'KG',ABS(SUM(X.TRANS_QTY))/1000,ABS(SUM(X.TRANS_QTY)) ),'99999990D99') T_QTY
 -- NVL(SUM(ACCOUNTED_CR),0),
   (DECODE(TRANSACTION_UOM , 'KG',NVL(SUM(ACCOUNTED_CR),0)/1000, NVL(SUM(ACCOUNTED_CR),0))) ACCOUNTED_CR , 
 --CASE WHEN TRANSACTION_TYPE_NAME = 'WIP Byproduct Complition' then SUM(ACCOUNTED_DR) - SUM(ACCOUNTED_CR) 
 (CASE WHEN TRANSACTION_TYPE_NAME in  ('WIP Completion','WIP Byproduct Completion')
 AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
 THEN ( DECODE(TRANSACTION_UOM , 'KG',NVL(SUM(ACCOUNTED_DR),0)/1000, NVL(SUM(ACCOUNTED_DR),0)))   ELSE 0 END )  DEBIT ,
  (CASE WHEN TRANSACTION_TYPE_NAME in  ('WIP Completion Return','WIP Byproduct Return')
  AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
  THEN  (DECODE(TRANSACTION_UOM , 'KG',NVL(SUM(ACCOUNTED_CR),0)/1000, NVL(SUM(ACCOUNTED_CR),0)))   ELSE 0 END )  CREDIT ,  
     (CASE WHEN TRANSACTION_TYPE_NAME in  ('WIP Completion','WIP Byproduct Completion')
    AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
     THEN SUM(ACCOUNTED_DR)   ELSE 0 END ) -
     (CASE WHEN TRANSACTION_TYPE_NAME in  ('WIP Completion Return','WIP Byproduct Return')
      AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
--      AND EVENT_TYPE_CODE = 'GLCOSTALOC'  
      THEN SUM(ACCOUNTED_CR)   ELSE 0 END ) COST,
--   (CASE WHEN TRANSACTION_TYPE_NAME in  ('WIP Completion','WIP Byproduct Completion')
--    AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
--     THEN ( DECODE(TRANSACTION_UOM , 'KG',NVL(SUM(ACCOUNTED_DR),0)/1000, NVL(SUM(ACCOUNTED_DR),0)))    ELSE 0 END ) -
--     (CASE WHEN TRANSACTION_TYPE_NAME in  ('WIP Completion Return','WIP Byproduct Return')
--      AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
--    --  AND EVENT_TYPE_CODE = 'GLCOSTALOC'  
--      THEN (DECODE(TRANSACTION_UOM , 'KG',NVL(SUM(ACCOUNTED_CR),0)/1000, NVL(SUM(ACCOUNTED_CR),0)))   ELSE 0 END ) COST,
     (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  
     AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
     AND EVENT_TYPE_CODE = 'GLCOSTALOC' THEN ( DECODE(TRANSACTION_UOM , 'KG',NVL(SUM(ACCOUNTED_DR),0)/1000, NVL(SUM(ACCOUNTED_DR),0)))   ELSE 0 END )  OVER_HEAD_DEBIT,
          (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  
          AND ACCOUNTING_CLASS_CODE =  'INVENTORY_VALUATION' 
          AND EVENT_TYPE_CODE = 'GLCOSTALOC'  THEN ( DECODE(TRANSACTION_UOM , 'KG',NVL(SUM(ACCOUNTED_CR),0)/1000, NVL(SUM(ACCOUNTED_CR),0))) ELSE 0 END )  OVER_HEAD_CRETIT,
               (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation' 
                AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
                AND EVENT_TYPE_CODE ='GLCOSTALOC' 
                 THEN ( DECODE(TRANSACTION_UOM , 'KG',NVL(SUM(ACCOUNTED_DR),0)/1000, NVL(SUM(ACCOUNTED_DR),0)))   ELSE 0 END ) -
               (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation' 
                AND ACCOUNTING_CLASS_CODE =  'INVENTORY_VALUATION' 
                AND EVENT_TYPE_CODE ='GLCOSTALOC'  THEN ( DECODE(TRANSACTION_UOM , 'KG',NVL(SUM(ACCOUNTED_DR),0)/1000, NVL(SUM(ACCOUNTED_DR),0)))   ELSE 0 END ) OVERHEAD
  FROM EAM_OP_GDET_VW 
  WHERE 1=1
  AND GL_LE = NVL(:P_LEGAL_ENTITY, GL_LE) --101
  AND GL_UNIT = NVL(:P_OPERATING_UNIT, GL_UNIT) --01
  AND ORGANIZATION_ID= NVL(:P_ORGANIZATION_ID, ORGANIZATION_ID)
   AND  TO_CHAR(TO_DATE(PERIOD_NAME,'MON-YY'),'MON-YY') = NVL(:P_PERIOD_CODE,  TO_CHAR(TO_DATE(PERIOD_NAME,'MON-YY'),'MON-YY') )
AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
AND EVENT_TYPE_CODE IN ('CERT', 'GLCOSTALOC') 
--and TRANSACTION_UOM = 'MT'
--AND ACCOUNTED_DR IS NOT NULL
GROUP BY TRANSACTION_TYPE_NAME, TRANSACTION_TYPE_ID,GL_LE,GL_UNIT,OU_NAME,CONCAT_ITEM_CODE,TRANSACTION_TYPE_NAME,ACCOUNTING_CLASS_CODE,JE_CATEGORY,EVENT_TYPE_CODE,ORGANIZATION_ID,INVENTORY_ITEM_ID,TRANSACTION_UOM --, TRANSACTION_TYPE_NAME--,TRANSACTION_TYPE_NAME,EVENT_TYPE_CODE
ORDER BY CONCAT_ITEM_CODE
)
GROUP BY TRANSACTION_UOM,TRANSACTION_TYPE_NAME, TRANSACTION_TYPE_ID,GL_LE,GL_UNIT,CONCAT_ITEM_CODE,ORGANIZATION_ID,INVENTORY_ITEM_ID,OU_NAME


)



-- 12-DEC-2020 === FINAL V4=======added prior item qty and cost=======================================================

--EBS Production Cost Summary Report v4

SELECT GL_LE LEGAL_ENTITY, GL_UNIT OU ,GL_CC,GL_ACC, GL_SL,
GL_LE||'.'||GL_UNIT||'.'||GL_CC||'.'||GL_ACC||'.'||GL_SL CODE_COMBINATIONS,
ORGANIZATION_ID,CONCAT_ITEM_CODE,
GET_PERCENTAGE_FROM_ITEM_ID(:P_ORGANIZATION_ID , INVENTORY_ITEM_ID) Percentage,
MY_PACKAGE.XXGET_ITEM_DESCRIPTION(INVENTORY_ITEM_ID) ITEM_DESCRIPTION,
TRANSACTION_UOM UOM,
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) PRIOR_PERIOD_QTY,
APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)  PRESENT_PERIOD_QTY,  
APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) PRODUCTION_QUANTITY,
SUM(COST) TOTAL_MATERIAL_COST  ,SUM(OVERHEAD) TOTAL_FACT_OVERHEAD,
SUM(COST)  + SUM(OVERHEAD) TOTAL_MANUFECTURING_COST, 
SUM(COST) / (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) COST_PER_MT,
SUM(OVERHEAD) /  (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) FACTORY_OVERHEAD_MT,
SUM(COST) / (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID))  +
SUM(OVERHEAD) /  (APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)) MANUFECTURING_COST_MT
FROM
(
 SELECT GL_LE,GL_UNIT,GL_CC,GL_ACC, GL_SL,CONCAT_ITEM_CODE,INVENTORY_ITEM_ID,TRANSACTION_UOM,ORGANIZATION_ID,  NVL(SUM(ACCOUNTED_DR),0) ,NVL(SUM(ACCOUNTED_CR),0),
 --CASE WHEN TRANSACTION_TYPE_NAME = 'WIP Byproduct Complition' then SUM(ACCOUNTED_DR) - SUM(ACCOUNTED_CR) 
 (CASE WHEN TRANSACTION_TYPE_NAME =  'WIP Completion'  
 AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
 THEN SUM(ACCOUNTED_DR)   ELSE 0 END )  DEBIT ,
  (CASE WHEN TRANSACTION_TYPE_NAME =  'WIP Completion Return'  
  AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
  THEN SUM(ACCOUNTED_CR)   ELSE 0 END )  CREDIT ,
   (CASE WHEN TRANSACTION_TYPE_NAME =  'WIP Completion' 
    AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
     THEN SUM(ACCOUNTED_DR)   ELSE 0 END ) -
     (CASE WHEN TRANSACTION_TYPE_NAME =  'WIP Completion Return' 
      AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
      AND EVENT_TYPE_CODE = 'GLCOSTALOC'  
      THEN SUM(ACCOUNTED_CR)   ELSE 0 END ) COST,
     (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  
     AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
     AND EVENT_TYPE_CODE = 'GLCOSTALOC' THEN SUM(ACCOUNTED_DR)   ELSE 0 END )  OVER_HEAD_DEBIT,
          (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  
          AND ACCOUNTING_CLASS_CODE =  'INVENTORY_VALUATION' 
          AND EVENT_TYPE_CODE = 'GLCOSTALOC'  THEN SUM(ACCOUNTED_CR) ELSE 0 END )  OVER_HEAD_CRETIT,
               (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation' 
                AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
                AND EVENT_TYPE_CODE ='GLCOSTALOC' 
                 THEN NVL(SUM(ACCOUNTED_DR),0)   ELSE 0 END ) -
               (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation' 
                AND ACCOUNTING_CLASS_CODE =  'INVENTORY_VALUATION' 
                AND EVENT_TYPE_CODE ='GLCOSTALOC'  THEN NVL(SUM(ACCOUNTED_CR),0)   ELSE 0 END ) OVERHEAD
  FROM EAM_OP_GDET_VW 
  WHERE 1=1
  AND GL_LE = NVL(:P_LEGAL_ENTITY, GL_LE) --101
  AND GL_UNIT = NVL(:P_OPERATING_UNIT, GL_UNIT) --01
  AND ORGANIZATION_ID= NVL(:P_ORGANIZATION_ID, ORGANIZATION_ID)
   AND  TO_CHAR(TO_DATE(PERIOD_NAME,'MON-YY'),'MON-YY') = NVL(:P_PERIOD_CODE,  TO_CHAR(TO_DATE(PERIOD_NAME,'MON-YY'),'MON-YY') )
AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
AND EVENT_TYPE_CODE IN ('CERT', 'GLCOSTALOC') 
and TRANSACTION_UOM = 'MT'
AND ACCOUNTED_DR IS NOT NULL
GROUP BY GL_LE,GL_UNIT,GL_CC,GL_ACC, GL_SL,CONCAT_ITEM_CODE,TRANSACTION_TYPE_NAME,ACCOUNTING_CLASS_CODE,JE_CATEGORY,EVENT_TYPE_CODE,ORGANIZATION_ID,INVENTORY_ITEM_ID,TRANSACTION_UOM --, TRANSACTION_TYPE_NAME--,TRANSACTION_TYPE_NAME,EVENT_TYPE_CODE
ORDER BY CONCAT_ITEM_CODE
)
GROUP BY GL_LE,GL_UNIT,GL_CC,GL_ACC, GL_SL,CONCAT_ITEM_CODE,ORGANIZATION_ID,INVENTORY_ITEM_ID,TRANSACTION_UOM


--====================DRAFT DATA FOR ARFIN VAI ===================

SELECT * FROM EAM_OP_GDET_VW  where VOUCHER_DATE between '01-jul-19' and '31-jul-19'  and organization_id=121 
and EVENT_TYPE_CODE = 'RELE'


 SELECT distinct AI.INVOICE_ID, 
  GET_OU_NAME_FROM_ID(AI.ORG_ID),
   XEH.PERIOD_NAME,
 AI.INVOICE_NUM,
 AL.PO_HEADER_ID,
LC.PO_NUMBER PO_NUMBER,
 LC.LC_NUMBER, 
  XX_GET_RECEIPT_NUMBER_FROM_INV (AI.INVOICE_ID) GRN_NUMBER,
  NULL TRANSACTION_ID,
  NULL CHARGE_LINE_TYPE_CODE,
  NULL COMPONENT_NAME,
  NULL TRANSACTION_ID,
  NULL EVENT_ID,
   XEH.AE_HEADER_ID,
   XEL.AE_LINE_NUM,
  XEL.CODE_COMBINATION_ID,
  (GET_GL_CODE_DESC_FROM_CCID (XEL.CODE_COMBINATION_ID)) CODE_COMBINATION,
  XEH.DESCRIPTION,
  ENTERED_DR,ENTERED_CR,ACCOUNTED_DR,ACCOUNTED_CR, XEH.EVENT_TYPE_CODE 
  FROM XLA_AE_LINES XEL ,
  AP_INVOICE_LINES_ALL AL,
  XLA_AE_HEADERS XEH ,
  AP_INVOICES_ALL AI ,
  GL_CODE_COMBINATIONS COM,
--  AP_INVOICE_DISTRIBUTIONS_ALL AD,
  XLA_EVENTS XE ,
  XX_LC_DETAILS LC,
  XLA.XLA_TRANSACTION_ENTITIES XTE
WHERE XTE.APPLICATION_ID        =200
AND XEL.APPLICATION_ID          =200
AND XEH.APPLICATION_ID          =200
AND XE.APPLICATION_ID           =200
AND XEL.CODE_COMBINATION_ID= COM.CODE_COMBINATION_ID
--AND AI.INVOICE_ID               =450736
AND XE.ENTITY_ID                =XTE.ENTITY_ID
AND XE.EVENT_ID                 =XEH.EVENT_ID
AND XEL.AE_HEADER_ID            =XEH.AE_HEADER_ID
AND  AI.INVOICE_ID  = AL.INVOICE_ID  
AND XTE.ENTITY_CODE      ='AP_INVOICES'
AND NVL(XTE.SOURCE_ID_INT_1,-99)=AI.INVOICE_ID
AND XTE.ENTITY_ID   =XEH.ENTITY_ID
AND XTE.LEDGER_ID   =AI.SET_OF_BOOKS_ID
and XEH.PERIOD_NAME =:P_PERIOD_NAME -- 'Nov-18' 
and XEH.LEDGER_ID= 2043                                                         -- 2021 = KSPL  , 2043 = KBIL
and com.segment4=2010201
and LC.PO_HEADER_ID = AL.PO_HEADER_ID
and al.PO_HEADER_ID is not  null
 AND NVL(XTE.SOURCE_ID_INT_1,-99)=AI.INVOICE_ID
--AND AD.ATTRIBUTE1= '10078'
--order by XEL.AE_HEADER_ID 

SELECT SEGMENT1|| '.' || SEGMENT2|| '.' || SEGMENT3|| '.' || SEGMENT4|| '.' || SEGMENT5|| '.' || SEGMENT6|| '.' || SEGMENT7|| '.' || SEGMENT8 FROM GL_CODE_COMBINATIONS --WHERE CODE_COMBINATION_ID=MTRL.TO_ACCOUNT_ID) ACCOUNT_COMBINATION


SELECT LEDGER_ID,XEL.CODE_COMBINATION_ID,
  (GET_GL_CODE_DESC_FROM_CCID (XEL.CODE_COMBINATION_ID)) CODE_COMBINATION,
CC.SEGMENT1|| '.' || CC.SEGMENT2|| '.' || CC.SEGMENT3|| '.' || CC.SEGMENT4|| '.' || CC.SEGMENT5|| '.' || CC.SEGMENT6|| '.' || CC.SEGMENT7|| '.' || CC.SEGMENT8 ACCOUNT_COMBINATION,
ACCOUNTED_DR,ACCOUNTED_CR,XEL.DESCRIPTION,
XEL.CODE_COMBINATION_ID,ACCOUNTING_DATE 
 FROM XLA_AE_LINES XEL , GL_CODE_COMBINATIONS  CC
WHERE XEL.CODE_COMBINATION_ID = CC.CODE_COMBINATION_ID
and ACCOUNTING_DATE between '01-JUL-2019' and '31-JUL-2019'
and CC.SEGMENT4 LIKE '60%'
AND LEDGER_ID =2021
--and XEL.CODE_COMBINATION_ID <> 4034


SELECT * FROM XLA_AE_LINES 
WHERE ACCOUNTING_DATE between '01-JUL-2019' and '31-JUL-2019'

--=============================12-DEC-2020===============================


-- EBS Production Cost Summary Report
--============================V3 =======added prior item qty and cost=======================================================

SELECT * FROM EAM_OP_GDET_VW  where PERIOD_NAME = 'Jul-19' -- VOUCHER_DATE between '01-jul-19' and '31-jul-19'  and organization_id=121 

SELECT organization_id,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE,SUM(COST) MATERIAL_COST  ,SUM(OVERHEAD) OVERHEAD,
SUM(COST) + SUM(OVERHEAD) CORRENT_MONTH_COST,
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) PRIOR_PERIOD_QTY,
APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)  PRESENT_PERIOD_QTY,
GET_PRIOR_ITEM_COST(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) PRIOR_ITEM_COST,
GET_PRESENT_ITEM_COST(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) PRSENT_ITEM_COST
--GMF_CMCOMMON.GET_CMPT_COST(INVENTORY_ITEM_ID,:P_ORGANIZATION_ID,:P_PERIOD_CODE )
 --GMF_CMCOMMON.GET_CMPT_COST(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) 
FROM
(
 SELECT INVENTORY_ITEM_ID,CONCAT_ITEM_CODE,organization_id,  NVL(SUM(ACCOUNTED_DR),0) ,NVL(SUM(ACCOUNTED_CR),0),
 --CASE WHEN TRANSACTION_TYPE_NAME = 'WIP Byproduct Complition' then SUM(ACCOUNTED_DR) - SUM(ACCOUNTED_CR) 
 (CASE WHEN TRANSACTION_TYPE_NAME =  'WIP Completion'  AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' THEN SUM(ACCOUNTED_DR)   else 0 end )  DEBIT ,
  (CASE WHEN TRANSACTION_TYPE_NAME =  'WIP Completion Return'  AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' THEN SUM(ACCOUNTED_CR)   else 0 end )  CREDIT ,
   (CASE WHEN TRANSACTION_TYPE_NAME =  'WIP Completion'  AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' THEN SUM(ACCOUNTED_DR)   else 0 end ) -
     (CASE WHEN TRANSACTION_TYPE_NAME =  'WIP Completion Return'  AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' and EVENT_TYPE_CODE = 'GLCOSTALOC'  THEN NVL(SUM(ACCOUNTED_CR),0)   else 0 end ) COST,
     (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' and EVENT_TYPE_CODE = 'GLCOSTALOC' THEN NVL(SUM(ACCOUNTED_DR),0)   else 0 end )  OVER_HEAD_DEBIT,
          (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  AND ACCOUNTING_CLASS_CODE =  'INVENTORY_VALUATION' and EVENT_TYPE_CODE = 'GLCOSTALOC'  THEN nvl(SUM(ACCOUNTED_CR),0) else 0 end )  OVER_HEAD_CRETIT,
               (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' and EVENT_TYPE_CODE ='GLCOSTALOC'  THEN NVL(SUM(ACCOUNTED_DR),0)   else 0 end ) -
               (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  AND ACCOUNTING_CLASS_CODE =  'INVENTORY_VALUATION' and EVENT_TYPE_CODE ='GLCOSTALOC'  THEN NVL(SUM(ACCOUNTED_CR),0)   else 0 end ) OVERHEAD
--DECODE (TRANSACTION_TYPE_NAME , 'WIP Completion' ,SUM(ACCOUNTED_DR), 0) - DECODE (TRANSACTION_TYPE_NAME , 'WIP Completion Return' ,SUM(ACCOUNTED_CR), 0) COST 
--DECODE (TRANSACTION_TYPE_NAME , 'WIP Completion Return' ,SUM(ACCOUNTED_CR), 0)
  FROM EAM_OP_GDET_VW
   WHERE 1=1
   and  TO_CHAR(TO_DATE(PERIOD_NAME,'MON-YY'),'MON-YY') = NVL(:P_PERIOD_CODE,  TO_CHAR(TO_DATE(PERIOD_NAME,'MON-YY'),'MON-YY') )
--and  VOUCHER_DATE between '01-JUL-19' and '31-JUL-19'
-- and ORG_ID= 81
and organization_id= NVL(:P_organization_id, organization_id)
--and FIN_CAT1 IN ('FINISHED GOODS')
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
and EVENT_TYPE_CODE IN ('CERT', 'GLCOSTALOC') 
--and ACCOUNTED_DR <> 0
GROUP BY CONCAT_ITEM_CODE,TRANSACTION_TYPE_NAME,ACCOUNTING_CLASS_CODE,JE_CATEGORY,EVENT_TYPE_CODE,organization_id,INVENTORY_ITEM_ID  --, TRANSACTION_TYPE_NAME--,TRANSACTION_TYPE_NAME,EVENT_TYPE_CODE
ORDER BY CONCAT_ITEM_CODE
)
GROUP by CONCAT_ITEM_CODE,organization_id,INVENTORY_ITEM_ID




--===============================10-DEC-2020============================
--========================================
--JUL2019
--MATERIAL TOTAL COST: 2725232642.6   
--OVERHEAD TOTAL : 56768016.75

--TASK:
0 take ommit korte hobe


SELECT  SUM(TOTAL_MATERIAL_COST)
FROM
(
SELECT organization_id,CONCAT_ITEM_CODE,
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) PRIOR_PERIOD_QTY,
APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID)  PRESENT_PERIOD_QTY,
APPS.XX_GET_PRESENT_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) - 
XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) PRODUCTION_QUANTITY,
SUM(COST) TOTAL_MATERIAL_COST  ,SUM(OVERHEAD) TOTAL_FACT_OVERHEAD,
SUM(COST)  + SUM(OVERHEAD) TOTAL_MANUFECTURING_COST
--((XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) / SUM(COST))*100)   --  SUM(COST)
-- (SUM(COST) / XX_GET_PRIOR_ITEM_QTY(:P_PERIOD_CODE , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID) *100)
FROM
(
 SELECT CONCAT_ITEM_CODE,INVENTORY_ITEM_ID,organization_id,  NVL(SUM(ACCOUNTED_DR),0) ,NVL(SUM(ACCOUNTED_CR),0),
 --CASE WHEN TRANSACTION_TYPE_NAME = 'WIP Byproduct Complition' then SUM(ACCOUNTED_DR) - SUM(ACCOUNTED_CR) 
 (CASE WHEN TRANSACTION_TYPE_NAME =  'WIP Completion'  AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' THEN SUM(ACCOUNTED_DR)   else 0 end )  DEBIT ,
  (CASE WHEN TRANSACTION_TYPE_NAME =  'WIP Completion Return'  AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' THEN SUM(ACCOUNTED_CR)   else 0 end )  CREDIT ,
   (CASE WHEN TRANSACTION_TYPE_NAME =  'WIP Completion'  AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' THEN SUM(ACCOUNTED_DR)   else 0 end ) -
     (CASE WHEN TRANSACTION_TYPE_NAME =  'WIP Completion Return'  AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' and EVENT_TYPE_CODE = 'GLCOSTALOC'  THEN SUM(ACCOUNTED_CR)   else 0 end ) COST,
     (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' and EVENT_TYPE_CODE = 'GLCOSTALOC' THEN SUM(ACCOUNTED_DR)   else 0 end )  OVER_HEAD_DEBIT,
          (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  AND ACCOUNTING_CLASS_CODE =  'INVENTORY_VALUATION' and EVENT_TYPE_CODE = 'GLCOSTALOC'  THEN SUM(ACCOUNTED_CR) else 0 end )  OVER_HEAD_CRETIT,
               (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' and EVENT_TYPE_CODE ='GLCOSTALOC'  THEN NVL(SUM(ACCOUNTED_DR),0)   else 0 end ) -
               (CASE WHEN JE_CATEGORY = 'OPM Cost Revaluation'  AND ACCOUNTING_CLASS_CODE =  'INVENTORY_VALUATION' and EVENT_TYPE_CODE ='GLCOSTALOC'  THEN NVL(SUM(ACCOUNTED_CR),0)   else 0 end ) OVERHEAD
--DECODE (TRANSACTION_TYPE_NAME , 'WIP Completion' ,SUM(ACCOUNTED_DR), 0) - DECODE (TRANSACTION_TYPE_NAME , 'WIP Completion Return' ,SUM(ACCOUNTED_CR), 0) COST 
--DECODE (TRANSACTION_TYPE_NAME , 'WIP Completion Return' ,SUM(ACCOUNTED_CR), 0)
  FROM EAM_OP_GDET_VW WHERE 
 VOUCHER_DATE between '01-JUL-19' and '31-JUL-19'
 and ORG_ID= 81
and organization_id=121 
--and FIN_CAT1 IN ('FINISHED GOODS')
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
and EVENT_TYPE_CODE IN ('CERT', 'GLCOSTALOC') 
and ACCOUNTED_DR is not null
GROUP BY CONCAT_ITEM_CODE,TRANSACTION_TYPE_NAME,ACCOUNTING_CLASS_CODE,JE_CATEGORY,EVENT_TYPE_CODE,organization_id,INVENTORY_ITEM_ID --, TRANSACTION_TYPE_NAME--,TRANSACTION_TYPE_NAME,EVENT_TYPE_CODE
ORDER BY CONCAT_ITEM_CODE
)
GROUP by CONCAT_ITEM_CODE,organization_id,INVENTORY_ITEM_ID
)










--and TRANSACTION_TYPE_NAME = 'WIP Complition'

-- EBS Production Cost Summary Report
--============================V2 FAHIM VAI QUERY=======================================================

SELECT period_code, INVENTORY_ITEM_ID,ITEM_CODE,NVL(SUM(CMPNT_COST),0) CPMT,NVL(TOTAL_QTY,0) TOTAL_QTY,
XX_GET_PRIOR_ITEM_QTY(:p_period_code , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID ) PRIOR_ITEM_QUANTITY,
NVL(TOTAL_QTY,0) - XX_GET_PRIOR_ITEM_QTY(:p_period_code , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID ) ACTUAL_ITEM_QUANTITY,
NVL(SUM(CMPNT_COST),0) * NVL(TOTAL_QTY,0) - XX_GET_PRIOR_ITEM_QTY(:p_period_code , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID ) ACTUAL_ITEM_COST,
--(select PRIMARY_QUANTITY from GMF_PERIOD_BALANCES a where a.INVENTORY_ITEM_ID =INVENTORY_ITEM_ID and a.ORGANIZATION_ID = ORGANIZATION_ID and a.ACCT_PERIOD_ID =  40001) PRIOR_COST ,
NVL(SUM(MATERIAL_VALUE),0) MATERIAL_VALUE, NVL(SUM(MATERIAL_VALUE_V1),0) MATERIAL_VALUE_V1, NVL(SUM(OH_VALUE),0) OH_VALUE,
ORGANIZATION_ID,PERIOD_CODE,ORGANIZATION_CODE,ORGANIZATION_NAME,START_DATE,END_DATE,ITEM_DESC
FROM 
(SELECT UPPER(CCMV.COST_CMPNTCLS_DESC) COST_CMPNTCLS_DESC,CCD.COST_ANALYSIS_CODE,CCD.CMPNT_COST,CCD.TOTAL_QTY,CCD.cost_cmpntcls_id,wxm.INVENTORY_ITEM_ID,
                      (SELECT  NVL(SUM(CCD2.CMPNT_COST*CCD2.TOTAL_QTY),0) GTOTAL_VALUE 
      FROM cm_cmpt_dtl   ccd2
               ,gmf_period_statuses mst2
               ,cm_cmpt_mst_vl ccmv2
      WHERE ccd2.period_id          = mst2.period_id
        AND CCMV2.COST_CMPNTCLS_ID=ccd2.COST_CMPNTCLS_ID
        and wxm.organization_id=ccd2.organization_id
        AND ccd2.delete_mark        = 0
        AND ccd.period_id          = mst.period_id
        AND CCD.COST_CMPNTCLS_ID=ccd2.COST_CMPNTCLS_ID
        GROUP BY  CCD2.ORGANIZATION_ID,MST2.PERIOD_CODE,CCMV2.COST_CMPNTCLS_DESC,CCD2.COST_ANALYSIS_CODE) GTOTAL, 
     CASE WHEN CCMV.COST_CMPNTCLS_DESC='Material' THEN CCD.CMPNT_COST*CCD.TOTAL_QTY ELSE 0 END MATERIAL_VALUE,
     CASE WHEN CCMV.COST_CMPNTCLS_DESC='Material' THEN CCD.TOTAL_QTY  ELSE 0 END MATERIAL_VALUE_V1,
     CASE WHEN CCMV.COST_CMPNTCLS_DESC<>'Material' THEN CCD.CMPNT_COST*CCD.TOTAL_QTY ELSE 0 END OH_VALUE,
     CCD.CMPNT_COST*CCD.TOTAL_QTY TOTAL_COGS,
     ratio_to_report (CCD.CMPNT_COST*CCD.TOTAL_QTY) OVER () *100 PER_ON_TOTAL_COST,
     CCD.ORGANIZATION_ID,MST.PERIOD_CODE,WXM.ITEM_CODE,WXM.ORGANIZATION_CODE,WXM.ORGANIZATION_NAME,mst.start_date start_date,trunc(mst.end_date) end_date,wxm.uom1,wxm.uom2,wxm.item_desc
      FROM cm_cmpt_dtl   ccd
               ,gmf_period_statuses mst
               ,cm_cmpt_mst_vl ccmv
               ,wbi_xxkbgitem_mt_d wxm
      WHERE ccd.period_id          = mst.period_id
        AND CCMV.COST_CMPNTCLS_ID=ccd.COST_CMPNTCLS_ID
        AND wxm.inventory_item_id=ccd.inventory_item_id
        ---AND wxm.item_code=:p_item_code
        and wxm.organization_id=ccd.organization_id
        and mst.period_code =:p_period_code
         and CCD.PERIOD_TRANS_QTY <>0
      --  and  to_char( mst.creation_date,'MON-YY') = :P_PERIOD_CODE
       -- AND wxm.organization_code   =NVL(:p_organization_code,wxm.organization_code)
        and   wxm.organization_ID   =NVL(:P_ORGANIZATION_ID,wxm.organization_ID)
        AND wxm.finance_category LIKE 'FINISHED GOODS|FINISHED GOODS'
        --and ITEM_CODE= 'RM|SCRP|ROLL|000005'
       AND wxm.item_code = NVL(:p_item_code, wxm.item_code)
       -- and ccd.PERIOD_TRANS_QTY is not null
      --- AND upper(cost_cmpntcls_desc)='MATERIAL'
        AND ccd.delete_mark        = 0)
        GROUP BY ITEM_CODE,TOTAL_QTY,ORGANIZATION_ID,PERIOD_CODE,ORGANIZATION_CODE,ORGANIZATION_NAME,START_DATE,END_DATE,ITEM_DESC,INVENTORY_ITEM_ID
        ORDER BY ITEM_CODE 
        

-- EBS Production Cost Summary Report
--============================V1 FAHIM VAI QUERY=======================================================



SELECT period_code, INVENTORY_ITEM_ID,ITEM_CODE,NVL(SUM(CMPNT_COST),0) CPMT,NVL(TOTAL_QTY,0) TOTAL_QTY,
XX_GET_PRIOR_ITEM_QTY(:p_period_code , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID ) PRIOR_ITEM_QUANTITY,
NVL(TOTAL_QTY,0) - XX_GET_PRIOR_ITEM_QTY(:p_period_code , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID ) ACTUAL_ITEM_QUANTITY,
NVL(SUM(CMPNT_COST),0) * NVL(TOTAL_QTY,0) - XX_GET_PRIOR_ITEM_QTY(:p_period_code , :P_ORGANIZATION_ID ,INVENTORY_ITEM_ID ) ACTUAL_ITEM_COST,
--(select PRIMARY_QUANTITY from GMF_PERIOD_BALANCES a where a.INVENTORY_ITEM_ID =INVENTORY_ITEM_ID and a.ORGANIZATION_ID = ORGANIZATION_ID and a.ACCT_PERIOD_ID =  40001) PRIOR_COST ,
NVL(SUM(MATERIAL_VALUE),0) MATERIAL_VALUE, NVL(SUM(MATERIAL_VALUE_V1),0) MATERIAL_VALUE_V1, NVL(SUM(OH_VALUE),0) OH_VALUE,
ORGANIZATION_ID,PERIOD_CODE,ORGANIZATION_CODE,ORGANIZATION_NAME,START_DATE,END_DATE,ITEM_DESC
FROM 
(SELECT UPPER(CCMV.COST_CMPNTCLS_DESC) COST_CMPNTCLS_DESC,CCD.COST_ANALYSIS_CODE,CCD.CMPNT_COST,CCD.TOTAL_QTY,CCD.cost_cmpntcls_id,wxm.INVENTORY_ITEM_ID,
                      (SELECT  NVL(SUM(CCD2.CMPNT_COST*CCD2.TOTAL_QTY),0) GTOTAL_VALUE 
      FROM cm_cmpt_dtl   ccd2
               ,gmf_period_statuses mst2
               ,cm_cmpt_mst_vl ccmv2
      WHERE ccd2.period_id          = mst2.period_id
        AND CCMV2.COST_CMPNTCLS_ID=ccd2.COST_CMPNTCLS_ID
        and wxm.organization_id=ccd2.organization_id
        AND ccd2.delete_mark        = 0
        AND ccd.period_id          = mst.period_id
        AND CCD.COST_CMPNTCLS_ID=ccd2.COST_CMPNTCLS_ID
        GROUP BY  CCD2.ORGANIZATION_ID,MST2.PERIOD_CODE,CCMV2.COST_CMPNTCLS_DESC,CCD2.COST_ANALYSIS_CODE) GTOTAL, 
     CASE WHEN CCMV.COST_CMPNTCLS_DESC='Material' THEN CCD.CMPNT_COST*CCD.TOTAL_QTY ELSE 0 END MATERIAL_VALUE,
     CASE WHEN CCMV.COST_CMPNTCLS_DESC='Material' THEN CCD.TOTAL_QTY  ELSE 0 END MATERIAL_VALUE_V1,
     CASE WHEN CCMV.COST_CMPNTCLS_DESC<>'Material' THEN CCD.CMPNT_COST*CCD.TOTAL_QTY ELSE 0 END OH_VALUE,
     CCD.CMPNT_COST*CCD.TOTAL_QTY TOTAL_COGS,
     ratio_to_report (CCD.CMPNT_COST*CCD.TOTAL_QTY) OVER () *100 PER_ON_TOTAL_COST,
     CCD.ORGANIZATION_ID,MST.PERIOD_CODE,WXM.ITEM_CODE,WXM.ORGANIZATION_CODE,WXM.ORGANIZATION_NAME,mst.start_date start_date,trunc(mst.end_date) end_date,wxm.uom1,wxm.uom2,wxm.item_desc
      FROM cm_cmpt_dtl   ccd
               ,gmf_period_statuses mst
               ,cm_cmpt_mst_vl ccmv
               ,wbi_xxkbgitem_mt_d wxm
      WHERE ccd.period_id          = mst.period_id
        AND CCMV.COST_CMPNTCLS_ID=ccd.COST_CMPNTCLS_ID
        AND wxm.inventory_item_id=ccd.inventory_item_id
        ---AND wxm.item_code=:p_item_code
        and wxm.organization_id=ccd.organization_id
        and mst.period_code =:p_period_code
         and CCD.PERIOD_TRANS_QTY <>0
      --  and  to_char( mst.creation_date,'MON-YY') = :P_PERIOD_CODE
       -- AND wxm.organization_code   =NVL(:p_organization_code,wxm.organization_code)
        and   wxm.organization_ID   =NVL(:P_ORGANIZATION_ID,wxm.organization_ID)
        AND wxm.finance_category LIKE 'FINISHED GOODS|FINISHED GOODS'
        --and ITEM_CODE= 'RM|SCRP|ROLL|000005'
       AND wxm.item_code = NVL(:p_item_code, wxm.item_code)
       -- and ccd.PERIOD_TRANS_QTY is not null
      --- AND upper(cost_cmpntcls_desc)='MATERIAL'
        AND ccd.delete_mark        = 0)
        GROUP BY ITEM_CODE,TOTAL_QTY,ORGANIZATION_ID,PERIOD_CODE,ORGANIZATION_CODE,ORGANIZATION_NAME,START_DATE,END_DATE,ITEM_DESC,INVENTORY_ITEM_ID
        ORDER BY ITEM_CODE 
        

--========================== 10-DEC-2020==================================
XX_inv_pkg.xxget_particular_name: varchar2

SELECT (CASE WHEN MMT.SOURCE_CODE='RCV' THEN (SELECT DECODE (RVT.SOURCE_DOC_CODE, 'INVENTORY', RVT.SUPPLIER, 'PO', RVT.VENDOR_NAME,'REQ', RVT.SUPPLIER, 'RMA', RVT.CUSTOMER, NULL)
                  FROM RCV_VRC_TXS_V RVT WHERE RVT.TRANSACTION_ID = MMT.RCV_TRANSACTION_ID)
                  
SELECT supplier_id,
CASE
  WHEN supplier_name = 'IBM' and supplier_type = 'Hardware' THEN 'North office'
  WHEN supplier_name = 'IBM' and supplier_type = 'Software' THEN 'South office'
END
FROM suppliers;

---================== LOGIC ARFIN VAI============

-- ITEM_CODE CP|500W|10MM|000002

SELECT * FROM EAM_OP_GDET_VW  where VOUCHER_DATE between '01-jul-19' and '31-jul-19'  and organization_id=121 

select TRANSACTION_TYPE_NAME,ACCOUNTING_CLASS_CODE,CONCAT_ITEM_CODE,organization_id ,--CONCAT_ITEM_CODE,  SUM(ACCOUNTED_DR) ACCOUNTED_DR ,SUM(ACCOUNTED_CR) ACCOUNTED_CR, SUM(ACCOUNTED_DR) - SUM(ACCOUNTED_CR)  OVERHEAD  ,
 (CASE WHEN TRANSACTION_TYPE_NAME =  'WIP Completion'  AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
 and CONCAT_ITEM_CODE =  :P_CONCAT_ITEM_CODE and  organization_id= :P_ORG  THEN SUM(ACCOUNTED_DR)   else 0 end )  DEBIT 
 -- (CASE WHEN TRANSACTION_TYPE_NAME =  'WIP Completion'  AND ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' THEN SUM(ACCOUNTED_DR)   else 0 end )  CREDIT 
 FROM EAM_OP_GDET_VW 
 WHERE 1=1
 and VOUCHER_DATE between :p_date_from AND :p_date_to
 and CONCAT_ITEM_CODE =  :P_CONCAT_ITEM_CODE 
 and organization_id= :P_ORG
 --and ACCOUNTING_CLASS_CODE = 'CERT' 
 group by TRANSACTION_TYPE_NAME,ACCOUNTING_CLASS_CODE,CONCAT_ITEM_CODE,organization_id

 group by CONCAT_ITEM_CODE, ORGANIZATION_ID,TRANSACTION_TYPE_NAME,ACCOUNTING_CLASS_CODE,VOUCHER_DATE
 
where 1=1
-- JE_CATEGORY = 'OPM Cost Revaluation'  AND ACCOUNTING_CLASS_CODE =  'INVENTORY_VALUATION' and EVENT_TYPE_CODE ='GLCOSTALOC'  
and VOUCHER_DATE between '01-jul-19' and '31-jul-19'
and CONCAT_ITEM_CODE = :P_CONCAT_ITEM_CODE -- 'CP|500W|10MM|000002'
and organization_id= :P_ORG
group by CONCAT_ITEM_CODE, ORGANIZATION_ID,TRANSACTION_TYPE_NAME,ACCOUNTING_CLASS_CODE,VOUCHER_DATE




TRANSACTION_TYPE_NAME 

select sum(ACCOUNTED_DR), sum(ACCOUNTED_CR) from EAM_OP_GDET_VW
where  org_id=81
and organization_id= :p_org --121
--and CONCAT_ITEM_CODE='CP|500W|10MM|000002' --'SF|BILT|G-80|000030'     -- 
and VOUCHER_DATE between :p_date_from AND :p_date_to 

SELECT distinct JE_CATEGORY, ACCOUNTED_DR, ACCOUNTED_CR FROM EAM_OP_GDET_VW 
where VOUCHER_DATE between '01-jul-19' and '31-jul-19'  and organization_id=121 and JE_CATEGORY =  'OPM Cost Revaluation' 
and ACCOUNTING_CLASS_CODE = 'ALC' 
and FIN_CAT1 IN ('FINISHED GOODS')
--and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
--and EVENT_TYPE_CODE ='CERT' 
and ACCOUNTED_DR <> 0
----------------------------------------------------



--=======================

SELECT --v4
ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM(DISTINCT TRANSACTION_QUANTITY) Quantity , SUM(ACCOUNTED_DR) COST ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
 FROM EAM_OP_GDET_VW  where VOUCHER_DATE between '01-jul-19' and '31-jul-19'
 and CONCAT_ITEM_CODE LIKE ('%SF|BILT|G-80|000030%')
----'SF|BILT|500|000001',
----'SF|BILT|500|000011',
----'SF|BILT|G-80|000030'
and organization_id=121 
and ACCTDESC = 'WIP-Material Account'  -- 'Material In Transit'
--and ACCOUNTING_CLASS_CODE = 'INTRANSIT_VALUATION'
group by ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC



--and EVENT_TYPE_CODE = 'FOB_SHIP_SENDER_SHIP_NO_TP'
--==================================== MONTH WISE PRODUCTION COST SUMMARY   =================================================

SELECT SUM( Quantity) MATERIAL_QUANTITY  , SUM(ACCOUNTED_DR) ACCOUNTED_DR, SUM(ACCOUNTED_CR) 
FROM (
--SELECT  --v4
--ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM(DISTINCT TRANSACTION_QUANTITY) Quantity , SUM(ACCOUNTED_DR) ACCOUNTED_DR ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
-- FROM EAM_OP_GDET_VW  where VOUCHER_DATE between :p_date_from AND :p_date_to 
-- --and CONCAT_ITEM_CODE LIKE ('%SF|BILT|G-80|000030%')
------'SF|BILT|500|000001',
------'SF|BILT|500|000011',
------'SF|BILT|G-80|000030'
-- and ORGANIZATION_ID= NVL(:P_ORG, ORGANIZATION_ID)
--and CONCAT_ITEM_CODE = NVL(:P_ITEM_CODE,CONCAT_ITEM_CODE)
--and ACCTDESC = 'WIP-Material Account'  -- 'Material In Transit'
----and ACCOUNTING_CLASS_CODE = 'INTRANSIT_VALUATION'
--group by ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC
--UNION ALL
SELECT  --- V3
ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM(DISTINCT TRANSACTION_QUANTITY) Quantity , SUM(ACCOUNTED_DR) ACCOUNTED_DR ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to 
 and ORGANIZATION_ID= NVL(:P_ORG, ORGANIZATION_ID)
and CONCAT_ITEM_CODE = NVL(:P_ITEM_CODE,CONCAT_ITEM_CODE)
and  CONCAT_ITEM_CODE LIKE 'BP%'
and ACCTDESC = 'Material / Store related Adjustment' 
 group by ORG_ID, OU_NAME,ORGANIZATION_CODE, INVENTORY_ITEM_ID,CONCAT_ITEM_CODE,ACCTDESC
 UNION ALL
SELECT --V2  
ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM(DISTINCT TRANSACTION_QUANTITY) Quantity , SUM(ACCOUNTED_DR) COST ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to --and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' 
 and ORGANIZATION_ID= NVL(:P_ORG, ORGANIZATION_ID)
and EVENT_TYPE_CODE = 'CERT'
and CONCAT_ITEM_CODE = NVL(:P_ITEM_CODE,CONCAT_ITEM_CODE)
 and CONCAT_ITEM_CODE LIKE 'FG%'
and ACCTDESC = 'Finished Goods'
 group by ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC
UNION ALL
SELECT -- V1
ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM(DISTINCT TRANSACTION_QUANTITY) Quantity , SUM(ACCOUNTED_DR) COST ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to --and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' 
 and ORGANIZATION_ID= NVL(:P_ORG, ORGANIZATION_ID)
and EVENT_CLASS_CODE in('GLCOSTALOC')
and CONCAT_ITEM_CODE = NVL(:P_ITEM_CODE,CONCAT_ITEM_CODE)
and CONCAT_ITEM_CODE LIKE 'CP%'
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
 group by ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC
)

--==================================================================

--==================================== MONTH WISE PRODUCTION COST SUMMARY  V1=================================================
SELECT SUM(ACCOUNTED_DR) , SUM(ACCOUNTED_CR), SUM(ACCOUNTED_DR) - SUM(ACCOUNTED_CR) COST
FROM
(
SELECT  --- V3
ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM(DISTINCT TRANSACTION_QUANTITY) Quantity , SUM(ACCOUNTED_DR) ACCOUNTED_DR ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to 
 and ORGANIZATION_ID= NVL(:P_ORG, ORGANIZATION_ID)
and CONCAT_ITEM_CODE = NVL(:P_ITEM_CODE,CONCAT_ITEM_CODE)
and  CONCAT_ITEM_CODE LIKE 'BP%'
and ACCTDESC = 'Material / Store related Adjustment' 
 group by ORG_ID, OU_NAME,ORGANIZATION_CODE, INVENTORY_ITEM_ID,CONCAT_ITEM_CODE,ACCTDESC
 UNION ALL
SELECT --V2  
ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM(DISTINCT TRANSACTION_QUANTITY) Quantity , SUM(ACCOUNTED_DR) ACCOUNTED_DR ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to --and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' 
 and ORGANIZATION_ID= NVL(:P_ORG, ORGANIZATION_ID)
and EVENT_TYPE_CODE IN ( 'CERT', 'RELE')
and CONCAT_ITEM_CODE = NVL(:P_ITEM_CODE,CONCAT_ITEM_CODE)
 and CONCAT_ITEM_CODE LIKE 'FG%'
and ACCTDESC = 'Finished Goods'
 group by ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC
UNION ALL
SELECT -- V1
ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM(DISTINCT TRANSACTION_QUANTITY) Quantity , SUM(ACCOUNTED_DR) ACCOUNTED_DR ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to --and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' 
 and ORGANIZATION_ID= NVL(:P_ORG, ORGANIZATION_ID)
and EVENT_CLASS_CODE in('GLCOSTALOC')
and CONCAT_ITEM_CODE = NVL(:P_ITEM_CODE,CONCAT_ITEM_CODE)
and CONCAT_ITEM_CODE LIKE 'CP%'
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
 group by ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC
 )
 
--=========================================================MONTH WISE PRODUCTION COST DEAIL  V2 =================================================

SELECT  --- V3
ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM(DISTINCT TRANSACTION_QUANTITY) Quantity , SUM(ACCOUNTED_DR) ACCOUNTED_DR  ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
,NVL(SUM(ACCOUNTED_DR),0) - NVL(SUM(ACCOUNTED_CR),0) COST 
FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to 
 and ORGANIZATION_ID= NVL(:P_ORG, ORGANIZATION_ID)
and CONCAT_ITEM_CODE = NVL(:P_ITEM_CODE,CONCAT_ITEM_CODE)
and  CONCAT_ITEM_CODE LIKE 'BP%'
and ACCTDESC = 'Material / Store related Adjustment' 
 group by ORG_ID, OU_NAME,ORGANIZATION_CODE, INVENTORY_ITEM_ID,CONCAT_ITEM_CODE,ACCTDESC 
 UNION ALL
SELECT --V2  
ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM(DISTINCT TRANSACTION_QUANTITY) Quantity , SUM(ACCOUNTED_DR) ACCOUNTED_DR ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
,NVL(SUM(ACCOUNTED_DR),0) - NVL(SUM(ACCOUNTED_CR),0) COST 
FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to --and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' 
 and ORGANIZATION_ID= NVL(:P_ORG, ORGANIZATION_ID)
and EVENT_TYPE_CODE IN ( 'CERT', 'RELE')
and CONCAT_ITEM_CODE = NVL(:P_ITEM_CODE,CONCAT_ITEM_CODE)
 and CONCAT_ITEM_CODE LIKE 'FG%'
and ACCTDESC = 'Finished Goods'
 group by ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC
UNION ALL
SELECT -- V1
ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM(DISTINCT TRANSACTION_QUANTITY) Quantity , SUM(ACCOUNTED_DR) ACCOUNTED_DR ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
,NVL(SUM(ACCOUNTED_DR),0) - NVL(SUM(ACCOUNTED_CR),0) COST 
FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to --and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' 
 and ORGANIZATION_ID= NVL(:P_ORG, ORGANIZATION_ID)
and EVENT_CLASS_CODE in('GLCOSTALOC')
and CONCAT_ITEM_CODE = NVL(:P_ITEM_CODE,CONCAT_ITEM_CODE)
and CONCAT_ITEM_CODE LIKE 'CP%'
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
 group by ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC
 

--==================================== MONTH WISE PRODUCTION COST DEAIL  V1 =================================================
SELECT --v4
ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM(DISTINCT TRANSACTION_QUANTITY) Quantity , SUM(ACCOUNTED_DR) COST ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
 FROM EAM_OP_GDET_VW  
 where  VOUCHER_DATE between :p_date_from AND :p_date_to 
 and ORGANIZATION_ID= NVL(:P_ORG, ORGANIZATION_ID)
and CONCAT_ITEM_CODE = NVL(:P_ITEM_CODE,CONCAT_ITEM_CODE)
and  CONCAT_ITEM_CODE LIKE 'SF%' 
and ACCOUNTING_CLASS_CODE = 'INTRANSIT_VALUATION'
group by ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC
UNION ALL 
SELECT  --- V3
ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM(DISTINCT TRANSACTION_QUANTITY) Quantity , ABS(SUM(ACCOUNTED_DR)-SUM(ACCOUNTED_CR)) COST ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to 
 and ORGANIZATION_ID= NVL(:P_ORG, ORGANIZATION_ID)
and CONCAT_ITEM_CODE = NVL(:P_ITEM_CODE,CONCAT_ITEM_CODE)
and  CONCAT_ITEM_CODE LIKE 'BP%'
and ACCTDESC = 'Material / Store related Adjustment' 
 group by ORG_ID, OU_NAME,ORGANIZATION_CODE, INVENTORY_ITEM_ID,CONCAT_ITEM_CODE,ACCTDESC
 UNION ALL
SELECT --V2  
ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM(DISTINCT TRANSACTION_QUANTITY) Quantity , SUM(ACCOUNTED_DR) COST ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to --and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' 
 and ORGANIZATION_ID= NVL(:P_ORG, ORGANIZATION_ID)
and EVENT_TYPE_CODE = 'CERT'
and CONCAT_ITEM_CODE = NVL(:P_ITEM_CODE,CONCAT_ITEM_CODE)
 and CONCAT_ITEM_CODE LIKE 'FG%'
and ACCTDESC = 'Finished Goods'
 group by ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC
UNION ALL
SELECT -- V1
ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM(DISTINCT TRANSACTION_QUANTITY) Quantity , SUM(ACCOUNTED_DR) COST ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to --and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' 
 and ORGANIZATION_ID= NVL(:P_ORG, ORGANIZATION_ID)
and EVENT_CLASS_CODE in('GLCOSTALOC')
and CONCAT_ITEM_CODE = NVL(:P_ITEM_CODE,CONCAT_ITEM_CODE)
and CONCAT_ITEM_CODE LIKE 'CP%'
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION' 
 group by ORG_ID, OU_NAME,ORGANIZATION_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC


--======================== 8-DEC-2020================================================================================
-- MATERIAL AND OVER HEAD DETAILS V3   FOR 
--==================================================================================================

SELECT  * FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to --and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' 
 and ORGANIZATION_ID=121
 
 SELECT DISTINCT JE_CATEGORY FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to --and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' 
 and ORGANIZATION_ID=121

SELECT 
--(SUM(ACCOUNTED_DR) from EAM_OP_GDET_VW a where a.CONCAT_ITEM_CODE = CONCAT_ITEM_CODE and a.ORGANIZATION_ID= ORGANIZATION_ID ) MATERIAL_COST,
ORG_ID, OU_NAME,ORGANIZATION_CODE,-- EVENT_CLASS_CODE,EVENT_TYPE_CODE,
INVENTORY_ITEM_ID,CONCAT_ITEM_CODE,SUM(DISTINCT TRANSACTION_QUANTITY) Quantity , SUM(ACCOUNTED_DR) ACCOUNTED_DR,  SUM(ACCOUNTED_CR) ACCOUNTED_CR
--(lSELECT SUM(ACCOUNTED_DR) ,CONCAT_ITEM_CODE  FROM EAM_OP_GDET_VW WHERE  CONCAT_ITEM_CODE = a.CONCAT_ITEM_CODE and VOUCHER_DATE=a.VOUCHER_DATE and VOUCHER_DATE between '01-jul-19' and '31-jul-19' and CONCAT_ITEM_CODE= a.CONCAT_ITEM_CODE and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' and  EVENT_CLASS_CODE = a.EVENT_CLASS_CODE and EVENT_CLASS_CODE = 'GLCOSTALOC') OVERHEAD
FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to --and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' 
 and ORGANIZATION_ID=121
 --==========OVERHEAD===============
--and EVENT_CLASS_CODE in('GLCOSTALOC')
--and CONCAT_ITEM_CODE =  'CP|G400|10MM|000023' --'BP|SCRP|ROLL|000005'
--and ACCTDESC = 'Material / Store related Adjustment' 
--and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
 --==========MATERIA===============
 group by ORG_ID, OU_NAME,ORGANIZATION_CODE, INVENTORY_ITEM_ID,CONCAT_ITEM_CODE --,ACCTDESC



--=========================================================
-- FINAL OVER HEAD   56768016.82
--=============================================================

select JE_CATEGORY,  SUM(OVERHEAD) OVER_HEAD --,CONCAT_ITEM_CODE --OU_NAME, ORG_ID, ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME, ACCOUNTING_CLASS_CODE, sum(TRANSACTION_QUANTITY), sum(TRANSACTION_VALUE), sum(ACCOUNTED_DR)
--(select EVENT_CLASS_CODE from EAM_OP_GDET_VW where org_id=81 and organization_id=121 and CONCAT_ITEM_CODE='CP|500W|10MM|000002' and VOUCHER_DATE between '01-jul-19' and '31-jul-19' and EVENT_CLASS_CODE in('BATCH_MATERIAL')) EVENT_CLASS_CODE
from ( 
select JE_CATEGORY,  SUM(TRANSACTION_VALUE)  OVERHEAD --OU_NAME,ORG_ID, JE_CATEGORY,ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME, ACCOUNTING_CLASS_CODE,EVENT_CLASS_CODE,TRANSACTION_QUANTITY, TRANSACTION_VALUE,ACCOUNTED_DR 
from EAM_OP_GDET_VW
where org_id=81
and organization_id=121
--and CONCAT_ITEM_CODE='CP|500W|10MM|000002'
and VOUCHER_DATE between '01-jul-19' and '31-jul-19'
and EVENT_CLASS_CODE in('GLCOSTALOC')
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
GROUP BY JE_CATEGORY
--GROUP BY TRANSACTION_TYPE_NAME
 --and FIN_CAT1 like '%BY PRODUCT%WASTAGE%'
)
GROUP BY JE_CATEGORY

SELECT  *  FROM EAM_OP_GDET_VW  where VOUCHER_DATE between '01-jul-19' and '31-jul-19'  and organization_id=121 


select * from gmf_xla_extract_headers

select * from XLA_AE_LINES XAL

--======================== 8-DEC-2020================================================================================
-- MATERIAL AND OVER HEAD DETAILS V2   FOR FG ITEM 
--==================================================================================================

SELECT 
--(SUM(ACCOUNTED_DR) from EAM_OP_GDET_VW a where a.CONCAT_ITEM_CODE = CONCAT_ITEM_CODE and a.ORGANIZATION_ID= ORGANIZATION_ID ) MATERIAL_COST,
ORG_ID, OU_NAME,ORGANIZATION_CODE,ACCOUNTING_CLASS_CODE ,EVENT_CLASS_CODE,-- EVENT_CLASS_CODE,EVENT_TYPE_CODE,
INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM( TRANSACTION_QUANTITY) Quantity , SUM(ACCOUNTED_DR) COST ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
--(lSELECT SUM(ACCOUNTED_DR) ,CONCAT_ITEM_CODE  FROM EAM_OP_GDET_VW WHERE  CONCAT_ITEM_CODE = a.CONCAT_ITEM_CODE and VOUCHER_DATE=a.VOUCHER_DATE and VOUCHER_DATE between '01-jul-19' and '31-jul-19' and CONCAT_ITEM_CODE= a.CONCAT_ITEM_CODE and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' and  EVENT_CLASS_CODE = a.EVENT_CLASS_CODE and EVENT_CLASS_CODE = 'GLCOSTALOC') OVERHEAD
FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to --and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' 
 and ORGANIZATION_ID=121
 --==========OVERHEAD===============
--and EVENT_CLASS_CODE in('GLCOSTALOC')
and EVENT_TYPE_CODE = 'CERT'
and CONCAT_ITEM_CODE ='FG|G400|12MM|000024'
and ACCTDESC = 'Finished Goods'
--and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
 --==========MATERIA===============
 group by ORG_ID, OU_NAME,ORGANIZATION_CODE, INVENTORY_ITEM_ID,CONCAT_ITEM_CODE,ACCTDESC,EVENT_CLASS_CODE,ACCOUNTING_CLASS_CODE ,EVENT_CLASS_CODE

--======================== 8-DEC-2020================================================================================
-- MATERIAL AND OVER HEAD DETAILS V1   FOR CP 
--==================================================================================================

SELECT 
--(SUM(ACCOUNTED_DR) from EAM_OP_GDET_VW a where a.CONCAT_ITEM_CODE = CONCAT_ITEM_CODE and a.ORGANIZATION_ID= ORGANIZATION_ID ) MATERIAL_COST,
ORG_ID, OU_NAME,ORGANIZATION_CODE,-- EVENT_CLASS_CODE,EVENT_TYPE_CODE,
INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM(DISTINCT TRANSACTION_QUANTITY) Quantity , SUM(ACCOUNTED_DR)-SUM(ACCOUNTED_CR) COST ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
--(lSELECT SUM(ACCOUNTED_DR) ,CONCAT_ITEM_CODE  FROM EAM_OP_GDET_VW WHERE  CONCAT_ITEM_CODE = a.CONCAT_ITEM_CODE and VOUCHER_DATE=a.VOUCHER_DATE and VOUCHER_DATE between '01-jul-19' and '31-jul-19' and CONCAT_ITEM_CODE= a.CONCAT_ITEM_CODE and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' and  EVENT_CLASS_CODE = a.EVENT_CLASS_CODE and EVENT_CLASS_CODE = 'GLCOSTALOC') OVERHEAD
FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to --and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' 
 and ORGANIZATION_ID=121
 --==========OVERHEAD===============
and EVENT_CLASS_CODE in('GLCOSTALOC')
and CONCAT_ITEM_CODE ='CP|500W|10MM|000002'
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
 --==========MATERIA===============
 group by ORG_ID, OU_NAME,ORGANIZATION_CODE, INVENTORY_ITEM_ID,CONCAT_ITEM_CODE,ACCTDESC


--======================== 8-DEC-2020================================================================================
-- MATERIAL AND OVER HEAD DETAILS 
--==================================================================================================
(SUM(ACCOUNTED_DR) from EAM_OP_GDET_VW a where a.CONCAT_ITEM_CODE = CONCAT_ITEM_CODE and a.ORGANIZATION_ID= ORGANIZATION_ID ) MATERIAL_COST

SELECT 
--(SUM(ACCOUNTED_DR) from EAM_OP_GDET_VW a where a.CONCAT_ITEM_CODE = CONCAT_ITEM_CODE and a.ORGANIZATION_ID= ORGANIZATION_ID ) MATERIAL_COST,
ORG_ID, OU_NAME,ORGANIZATION_CODE, JE_CATEGORY, EVENT_CLASS_CODE,EVENT_TYPE_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM(DISTINCT TRANSACTION_QUANTITY) MATERIAL_QUANTITY, SUM(ACCOUNTED_DR)-SUM(ACCOUNTED_CR) OVER_HEAD  ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
--(lSELECT SUM(ACCOUNTED_DR) ,CONCAT_ITEM_CODE  FROM EAM_OP_GDET_VW WHERE  CONCAT_ITEM_CODE = a.CONCAT_ITEM_CODE and VOUCHER_DATE=a.VOUCHER_DATE and VOUCHER_DATE between '01-jul-19' and '31-jul-19' and CONCAT_ITEM_CODE= a.CONCAT_ITEM_CODE and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' and  EVENT_CLASS_CODE = a.EVENT_CLASS_CODE and EVENT_CLASS_CODE = 'GLCOSTALOC') OVERHEAD
FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to --and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' 
 and ORGANIZATION_ID=121
 --==========OVERHEAD===============
and EVENT_CLASS_CODE in('GLCOSTALOC')
--and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002'
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
 --==========MATERIA===============
 group by ORG_ID, OU_NAME,ORGANIZATION_CODE, JE_CATEGORY, EVENT_CLASS_CODE,EVENT_TYPE_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE,ACCTDESC

--======================== 8-DEC-2020================================================================================
-- MATERIAL AND SUMMARY 
--==================================================================================================
select distinct CONCAT_ITEM_CODE ,ACCTDESC ,EVENT_TYPE_CODE, JE_CATEGORY,COUNT(distinct CONCAT_ITEM_CODE),sum(ACCOUNTED_DR) MATERIAL_COST,
(select  SUM(TRANSACTION_VALUE) --OU_NAME, ORG_ID, ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME, ACCOUNTING_CLASS_CODE, sum(TRANSACTION_QUANTITY), sum(TRANSACTION_VALUE), sum(ACCOUNTED_DR)
--(select EVENT_CLASS_CODE from EAM_OP_GDET_VW where org_id=81 and organization_id=121 and CONCAT_ITEM_CODE='CP|500W|10MM|000002' and VOUCHER_DATE between '01-jul-19' and '31-jul-19' and EVENT_CLASS_CODE in('BATCH_MATERIAL')) EVENT_CLASS_CODE
from (
select OU_NAME,ORG_ID, ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME, ACCOUNTING_CLASS_CODE,EVENT_CLASS_CODE,TRANSACTION_QUANTITY, TRANSACTION_VALUE,ACCOUNTED_DR from EAM_OP_GDET_VW
where org_id=81
and organization_id=121
--and CONCAT_ITEM_CODE='CP|500W|10MM|000002'
and VOUCHER_DATE between '01-jul-19' and '31-jul-19'
and EVENT_CLASS_CODE in('GLCOSTALOC')
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
 --and FIN_CAT1 like '%BY PRODUCT%WASTAGE%'
)) OVER_HEAD
FROM EAM_OP_GDET_VW  
WHERE  1=1
AND org_id=81
and organization_id= :p_org --121
and VOUCHER_DATE between :p_date_from AND :p_date_to 
--and CONCAT_ITEM_CODE='CP|500W|10MM|000002'
and JE_CATEGORY= 'OPM Batch Release' 
--and ACCTDESC = 'WIP-Material Account'  
and EVENT_TYPE_CODE IN  ('RELE') 
GROUP BY ACCTDESC,EVENT_TYPE_CODE,JE_CATEGORY,CONCAT_ITEM_CODE  
--and TRANSACTION_TYPE_NAME in ('WIP Byproduct Completion','WIP Byproduct Return', 'WIP Completion', 'WIP Completion Return')

--=========================================================================================



select * from cm_cmpt_dtl   ccd where INVENTORY_ITEM_ID=35611  and  PERIOD_ID = 7  --and CREATION_DATE between '01-JUL-2019' and  '31-JUL-2019' 

         select * from gmf_period_statuses  where  PERIOD_CODE = 'JUL-19'
         
         select * from cm_cmpt_mst_vl ccmv 
          
         select *from   wbi_xxkbgitem_mt_d  wxm 
         
         select * from  CM_ACST_LED where INVENTORY_ITEM_ID=21011 and ORGANIZATION_ID =121 and TRANS_DATE between '01-JUL-2019' and  '31-JUL-2019' 
               
             
          select * from CM_CMPT_DTL_VW
          
            select * from cm_cmpt_dtl
            
            select *from gmf_period_statuses
            
            select * from cm_cmpt_mst_vl
            
            select * from GMF_PERIOD_BALANCE  where INVENTORY_ITEM_ID =21011 and ACCT_PERIOD_ID =  40001 and ORGANIZATION_ID = 121 --group by ACCT_PERIOD_ID
          
          select * from cm_cmpt_dtl a, CM_CMPT_DTL_VW b
          where a. CMPNTCOST_ID = b.CMPNTCOST_ID
          
          select * from GL_item_cst 
          
          select * from gl_item_cst where START_DATE = 
          
          select
          
          gl_item_cst 
          
          select sum(ACCTG_COST) from GL_item_cst where ORGANIZATION_ID = 121 and INVENTORY_ITEM_ID =21011 and creation_date between '01-JUL-2019' and '31-JUL-2019'--:P_DATE BETWEEN START_DATE and END_DATE

--==============================================
select * from wbi_xxkbgitem_mt_d

select * from cm_cmpt_dtl

        
        select * from cm_cmpt_mst_vl
        
        

SELECT * FROM eam_op_gdet_vw

-- Keep by arefin vai , sugested by MAMUN BOS
inv vs accounting 
valuation report 

select * from GL_ITEM_CST where  INVENTORY_ITEM_ID=35611 and PERIOD_ID = 7

select * from CM_ACST_LED

select * from CM_ACST_LED 
where 1=1
and  INVENTORY_ITEM_ID=35611
and CREATION_DATE between  :p_date_from AND :p_date_to  
and ORGANIZATION_ID =121
and PERIOD_ID =7

select * from CM_ALPR_CTL

select * from EAM_OP_GDET_VW

-- FOR OVERHEAD 
SELECT TRANSACTION_VALUE, JE_CATEGORY, ACCOUNTING_CLASS_CODE,  EVENT_TYPE_CODE  FROM eam_op_gdet_vw
WHERE 1=1
--and accounting_class_code= 'ALC'
--and JE_CATEGORY= 'OPM Cost Revaluation'
and EVENT_TYPE_CODE= 'GLCOSTALOC'   -- 'RELE' -- 'GLCOSTALOC'  
and VOUCHER_DATE between  :p_date_from AND :p_date_to  -----
and ORGANIZATION_ID =121  ----- 



-- FOR OVERHEAD 
SELECT TRANSACTION_VALUE, JE_CATEGORY, ACCOUNTING_CLASS_CODE,  EVENT_TYPE_CODE  FROM eam_op_gdet_vw
WHERE 1=1
--and accounting_class_code= 'ALC'
--and JE_CATEGORY= 'OPM Cost Revaluation'
and EVENT_TYPE_CODE= 'GLCOSTALOC'   -- 'RELE' -- 'GLCOSTALOC'  
and VOUCHER_DATE between  :p_date_from AND :p_date_to  -----
and ORGANIZATION_ID =121  ----- 


--FOR MATERIAL 
SELECT TRANSACTION_TYPE_NAME,JE_CATEGORY, ACCOUNTING_CLASS_CODE,  EVENT_TYPE_CODE  FROM eam_op_gdet_vw
WHERE 1=1
--accounting_class_code= 'WIP_VALUATION'
and JE_CATEGORY= 'OPM Batch Release'
and EVENT_TYPE_CODE= 'CERT'
and TRANSACTION_TYPE_NAME in ('WIP Byproduct Completion','WIP Byproduct Return', 'WIP Completion', 'WIP Completion Return')

JE_CATEGORY, ACCOUNTING_CLASS_CODE,  EVENT_TYPE_CODE



-- for over head
draft accounting = inventory accounting 

ACCOUNTING CLASS CODE = ALC 

event TYPE CODE = gl cost alc

je category name = rval




-- material logic
RELE TE input
crt = OUTPUT

acc_class_code        eVENT TYPE CODE        je category name
WIP---                CERT                       RELE


and VOUCHER_DATE between :p_date_from AND :p_date_to   --'01-jul-19' and '31-jul-19'
--================================================


--GROUP BY CONCAT_ITEM_CODE





---=================================================
select 
OU_NAME, ORG_ID, ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME, ACCOUNTING_CLASS_CODE, 
(select  sum(TRANSACTION_QUANTITY) MATERIAL_QUntity FROM EAM_OP_GDET_VW  
WHERE  1=1
AND org_id=81 
and organization_id= :p_org --121
and VOUCHER_DATE between :p_date_from AND :p_date_to 
and CONCAT_ITEM_CODE='SF|BILT|G-80|000030'   
--and JE_CATEGORY= 'OPM Batch Release'
and ACCTDESC = 'Raw Materials' 
and EVENT_TYPE_CODE= 'FOB_SHIP_RECIPIENT_RCPT'
--and TRANSACTION_TYPE_NAME in ('WIP Byproduct Completion','WIP Byproduct Return', 'WIP Completion', 'WIP Completion Return')
) MATERIAL_QTY, 
(select  SUM(TRANSACTION_VALUE) 
from (
select OU_NAME,ORG_ID, ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME, ACCOUNTING_CLASS_CODE,EVENT_CLASS_CODE,TRANSACTION_QUANTITY, TRANSACTION_VALUE,ACCOUNTED_DR from EAM_OP_GDET_VW
where 1=1
AND org_id=81
and organization_id= :p_org --121
--and CONCAT_ITEM_CODE='CP|500W|10MM|000002' --'SF|BILT|G-80|000030'     -- 
and VOUCHER_DATE between :p_date_from AND :p_date_to   --'01-jul-19' and '31-jul-19'
and accounting_class_code= 'ALC'
and JE_CATEGORY= 'OPM Cost Revaluation' 
and EVENT_TYPE_CODE= 'GLCOSTALOC' 
--and EVENT_CLASS_CODE in('GLCOSTALOC')
--and ACCOUNTING_CLASS_CODE = 'WIP_VALUATION' -- 'INVENTORY_VALUATION'
--and FIN_CAT1 like '%BY PRODUCT%WASTAGE%'
)) OVER_HEAD, 
sum(TRANSACTION_VALUE), sum(ACCOUNTED_DR)
from (
select OU_NAME,ORG_ID, ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME, ACCOUNTING_CLASS_CODE,EVENT_CLASS_CODE,TRANSACTION_QUANTITY, TRANSACTION_VALUE,ACCOUNTED_DR from EAM_OP_GDET_VW
where 1=1
AND org_id=81
and organization_id= :p_org  --121
--and CONCAT_ITEM_CODE='CP|500W|10MM|000002' --'SF|BILT|G-80|000030'     -- 
and VOUCHER_DATE between :p_date_from AND :p_date_to   --'01-jul-19' and '31-jul-19'
and EVENT_CLASS_CODE in('BATCH_MATERIAL')
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
--and FIN_CAT1 like '%BY PRODUCT%WASTAGE%'
)
group by OU_NAME,ORG_ID, ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME, ACCOUNTING_CLASS_CODE





--===============================================

select  SUM( TRANSACTION_QUANTITY) SROM
FROM
(
select OU_NAME,ORG_ID, ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME,TRANSACTION_ID, ACCOUNTING_CLASS_CODE,EVENT_CLASS_CODE,TRANSACTION_QUANTITY,TRANSACTION_VALUE,PROD_BATCH_NO,ACCOUNTED_DR from EAM_OP_GDET_VW
where org_id=81
and organization_id=121
and CONCAT_ITEM_CODE='CP|500W|10MM|000002'
and VOUCHER_DATE between '01-jul-19' and '31-jul-19'
and EVENT_CLASS_CODE in('BATCH_MATERIAL'
)
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION')


select OU_NAME,ORG_ID, ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME,TRANSACTION_ID, ACCOUNTING_CLASS_CODE,EVENT_CLASS_CODE,TRANSACTION_QUANTITY,TRANSACTION_VALUE,PROD_BATCH_NO,ACCOUNTED_DR from EAM_OP_GDET_VW
where org_id=81
and organization_id=121
and CONCAT_ITEM_CODE='CP|500W|10MM|000002'
and VOUCHER_DATE between '01-jul-19' and '31-jul-19'
and EVENT_CLASS_CODE in('BATCH_MATERIAL','GLCOSTALOC')
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'

--===========================================


select distinct COST_CMPNTCLS_DESC from cm_cmpt_mst_vl ccmv
where CCMV.COST_CMPNTCLS_DESC='Material'


select * from CM_ACST_LED 
--==============================================================================================================
-- EBS Production Cost Summary Report
--==============================================================================================================

SELECT period_code, ITEM_CODE,NVL(SUM(CMPNT_COST),0) CPMT,NVL(TOTAL_QTY,0) TOTAL_QTY,NVL(SUM(MATERIAL_VALUE),0) MATERIAL_VALUE, NVL(SUM(MATERIAL_VALUE_V1),0) MATERIAL_VALUE_V1, NVL(SUM(OH_VALUE),0) OH_VALUE,
ORGANIZATION_ID,PERIOD_CODE,ORGANIZATION_CODE,ORGANIZATION_NAME,START_DATE,END_DATE,ITEM_DESC
 FROM 
(SELECT UPPER(CCMV.COST_CMPNTCLS_DESC) COST_CMPNTCLS_DESC,CCD.COST_ANALYSIS_CODE,CCD.CMPNT_COST,CCD.TOTAL_QTY,CCD.cost_cmpntcls_id,
                      (SELECT  NVL(SUM(CCD2.CMPNT_COST*CCD2.TOTAL_QTY),0) GTOTAL_VALUE 
      FROM cm_cmpt_dtl   ccd2
               ,gmf_period_statuses mst2
               ,cm_cmpt_mst_vl ccmv2
      WHERE ccd2.period_id          = mst2.period_id
        AND CCMV2.COST_CMPNTCLS_ID=ccd2.COST_CMPNTCLS_ID
        and wxm.organization_id=ccd2.organization_id
        AND ccd2.delete_mark        = 0
        AND ccd.period_id          = mst.period_id
        AND CCD.COST_CMPNTCLS_ID=ccd2.COST_CMPNTCLS_ID
        GROUP BY  CCD2.ORGANIZATION_ID,MST2.PERIOD_CODE,CCMV2.COST_CMPNTCLS_DESC,CCD2.COST_ANALYSIS_CODE) GTOTAL, 
     CASE WHEN CCMV.COST_CMPNTCLS_DESC='Material' THEN CCD.CMPNT_COST*CCD.TOTAL_QTY ELSE 0 END MATERIAL_VALUE,
     CASE WHEN CCMV.COST_CMPNTCLS_DESC='Material' THEN CCD.TOTAL_QTY  ELSE 0 END MATERIAL_VALUE_V1,
     CASE WHEN CCMV.COST_CMPNTCLS_DESC<>'Material' THEN CCD.CMPNT_COST*CCD.TOTAL_QTY ELSE 0 END OH_VALUE,
     CCD.CMPNT_COST*CCD.TOTAL_QTY TOTAL_COGS,
     ratio_to_report (CCD.CMPNT_COST*CCD.TOTAL_QTY) OVER () *100 PER_ON_TOTAL_COST,
     CCD.ORGANIZATION_ID,MST.PERIOD_CODE,WXM.ITEM_CODE,WXM.ORGANIZATION_CODE,WXM.ORGANIZATION_NAME,mst.start_date start_date,trunc(mst.end_date) end_date,wxm.uom1,wxm.uom2,wxm.item_desc
      FROM cm_cmpt_dtl   ccd
               ,gmf_period_statuses mst
               ,cm_cmpt_mst_vl ccmv
               ,wbi_xxkbgitem_mt_d wxm
      WHERE ccd.period_id          = mst.period_id
        AND CCMV.COST_CMPNTCLS_ID=ccd.COST_CMPNTCLS_ID
        AND wxm.inventory_item_id=ccd.inventory_item_id
        AND wxm.item_code= NVL(:p_item_code,  wxm.item_code)
        and wxm.organization_id=ccd.organization_id
        and mst.period_code =:p_period_code
         and CCD.PERIOD_TRANS_QTY <>0
      --  and  to_char( mst.creation_date,'MON-YY') = :P_PERIOD_CODE
        AND wxm.organization_code   =NVL(:p_organization_code,wxm.organization_code)
      --  AND wxm.finance_category LIKE 'FINISHED GOODS|FINISHED GOODS'
        --and ITEM_CODE= 'RM|SCRP|ROLL|000005'
     --   AND wxm.item_code =:p_item_code
       -- and ccd.PERIOD_TRANS_QTY is not null
      --- AND upper(cost_cmpntcls_desc)='MATERIAL'
        AND ccd.delete_mark        = 0)
        GROUP BY ITEM_CODE,TOTAL_QTY,ORGANIZATION_ID,PERIOD_CODE,ORGANIZATION_CODE,ORGANIZATION_NAME,START_DATE,END_DATE,ITEM_DESC
        ORDER BY ITEM_CODE 

--===============================================================
select   sum(distinct TRANSACTION_QUANTITY) COST
FROM(
SELECT * --ORG_ID,CONCAT_ITEM_CODE, EVENT_CLASS_CODE,TRANSACTION_QUANTITY, TRANSACTION_VALUE/TRANSACTION_QUANTITY COST, TRANSACTION_VALUE, ENTERED_DR,ENTERED_CR, ACCOUNTED_DR , ACCOUNTED_CR
 FROM EAM_OP_GDET_VW  where EVENT_CLASS_CODE in('GLCOSTALOC','BATCH_MATERIAL') 
and ORG_ID =81 and organization_id=121
and VOUCHER_DATE between '01-JUL-19' and '31-JUL-19'
and CONCAT_ITEM_CODE='CP|500W|10MM|000002' 
and  EVENT_CLASS_CODE in('GLCOSTALOC') 
)

--================================================

select OU_NAME,ORG_ID, ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME,TRANSACTION_ID, ACCOUNTING_CLASS_CODE,EVENT_CLASS_CODE,TRANSACTION_QUANTITY,TRANSACTION_VALUE,PROD_BATCH_NO,ACCOUNTED_DR from EAM_OP_GDET_VW
where org_id=81
and organization_id=121
and CONCAT_ITEM_CODE='CP|500W|10MM|000002'
and VOUCHER_DATE between '01-jul-19' and '31-jul-19'
and EVENT_CLASS_CODE in('BATCH_MATERIAL','GLCOSTALOC')
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'

--===========================================

select   sum(distinct TRANSACTION_QUANTITY) COST FROM EAM_OP_GDET_VW  where EVENT_CLASS_CODE in('GLCOSTALOC','BATCH_MATERIAL') and ORG_ID =81 and organization_id=121
and VOUCHER_DATE between '01-JUL-19' and '31-JUL-19'
and CONCAT_ITEM_CODE='CP|500W|10MM|000002' 
and  EVENT_CLASS_CODE in('GLCOSTALOC') 




SELECT * FROM EAM_OP_GDET_VW  where EVENT_CLASS_CODE in('GLCOSTALOC','BATCH_MATERIAL') 
and ORG_ID =81 and organization_id=121
and VOUCHER_DATE between '01-JUL-19' and '31-JUL-19'
and CONCAT_ITEM_CODE='CP|500W|10MM|000002'


SELECT  TRANSACTION_VALUE/TRANSACTION_QUANTITY COST,CONCAT_ITEM_CODE, EVENT_CLASS_CODE,TRANSACTION_QUANTITY,TRANSACTION_VALUE, ENTERED_DR,ENTERED_CR, ACCOUNTED_DR , ACCOUNTED_CR FROM EAM_OP_GDET_VW  where EVENT_CLASS_CODE in('GLCOSTALOC','BATCH_MATERIAL') 
and ORG_ID =81 and organization_id=121
and VOUCHER_DATE between '01-JUL-19' and '31-JUL-19'
and CONCAT_ITEM_CODE='CP|500W|10MM|000002'
and  EVENT_CLASS_CODE = 'BATCH_MATERIAL' 


--==================NEW RESPONSIBILITY FOR RECONCILLIATION PURPOSE =========== 6-DEC-2020===================

KSRM Reconcilliation Resp


NAME : KSRM Reconcilliation Responsibility 









--=======================================================










select * from EAM_OP_GDET_VW
where org_id=81
and organization_id=121
and CONCAT_ITEM_CODE='FG|500W|12MM|000003'
and VOUCHER_DATE between '01-nov-18' and '30-nov-18'



CREATE OR REPLACE FORCE VIEW EAM_OP_GDET_VW
(
   UNION_PART,
   ORG_ID,
   OU_NAME,
   LEGAL_ENTITY_ID,
   ACCOUNTING_ENTRY_STATUS_CODE,
   GL_TRANSFER_STATUS_CODE,
   APPLICATION_ID,
   JE_SOURCE,
   JE_CATEGORY,
   GL_LE,
   ACCOUNTING_CLASS_CODE,
   EVENT_CLASS_CODE,
   ENTITY_CODE,
   EVENT_TYPE_CODE,
   GL_UNIT,
   GL_CC,
   GL_ACC,
   GL_SL,
   GL_SL_DESC,
   GL_PROJECT,
   GL_IC,
   ACCTDESC,
   VOUCHER_NUMBER,
   GL_VOUCHER_NUMBER,
   AE_HEADER_ID,
   GL_JE_LINE_NUM,
   VOUCHER_DATE,
   PARTICULARS,
   ENTERED_DR,
   ENTERED_CR,
   ACCOUNTED_DR,
   ACCOUNTED_CR,
   CHEQUE_NUMBER,
   CHEQUE_DATE,
   PARTY_CODE,
   PARTY_NAME,
   CHART_OF_ACCOUNTS_ID,
   LEDGER_ID,
   DFF_CONTEXT,
   PO_NUM,
   PO_HEADER_ID,
   INTER_ORG_SHIPMENT_NUM,
   ATTRIBUTE3,
   ATTRIBUTE4,
   ATTRIBUTE5,
   ORGANIZATION_ID,
   ORGANIZATION_CODE,
   ORGANIZATION_NAME,
   INVENTORY_ITEM_ID,
   ITEM_CODE_SEGMENT1,
   ITEM_CODE_SEGMENT2,
   ITEM_CODE_SEGMENT3,
   ITEM_CODE_SEGMENT4,
   ITEM_CODE_SEGMENT5,
   ITEM_CODE_SEGMENT6,
   CONCAT_ITEM_CODE,
   INVENTORY_ITEM_NAME,
   ITEM_CATEGORY_SEGMENT1,
   ITEM_CATEGORY_SEGMENT2,
   ITEM_CATEGORY_SEGMENT3,
   FIN_CAT1,
   FIN_CAT2,
   GOODS_RECEIPT_NUM,
   REFERENCE_NO,
   EVENT_ID,
   TRANSACTION_ID,
   TRANSACTION_TYPE_ID,
   TRANSACTION_UOM,
   TXN_SOURCE,
   LOT_NUMBER,
   TRANSACTION_CURRENCY,
   CURRENCY_CONVERSION_RATE,
   TRANSACTION_QUANTITY,
   TRANSACTION_VALUE,
   SOURCE_DOCUMENT_ID,
   SOURCE_LINE_ID,
   FA_ASSET_ID,
   SHIPMENT_HEADER_ID,
   SHIPMENT_LINE_ID,
   RCV_TRANSACTION_ID,
   PO_LINE_ID,
   PO_LINE_LOCATION_ID,
   LC_ID,
   LC_NUM,
   BL_NUM,
   BL_DATE,
   PROD_BATCH_NO,
   LCM_ADJ_NUM,
   GMF_HEADER_ID,
   TRANSACTION_TYPE_NAME,
   TRANSACTION_ACTION_ID
)
AS
   SELECT 1 UNION_PART,
          ORG.OPERATING_UNIT ORG_ID,
          OU.NAME OU_NAME,
          gxeh.LEGAL_ENTITY_ID,
          XAH.ACCOUNTING_ENTRY_STATUS_CODE,
          XAH.GL_TRANSFER_STATUS_CODE,
          XAH.APPLICATION_ID,
          'INV' JE_SOURCE,
          CAT.NAME JE_CATEGORY,
          CC.SEGMENT1 GL_LE,
          XAL.ACCOUNTING_CLASS_CODE,
          gxeh.EVENT_CLASS_CODE,
          gxeh.ENTITY_CODE,
          XAH.EVENT_TYPE_CODE,
          CC.SEGMENT2 GL_UNIT,
          CC.SEGMENT3 GL_CC,
          CC.SEGMENT4 GL_ACC,
          CC.SEGMENT5 GL_SL,
          EAM_FLEX_SL_DESC (CC.SEGMENT4, CC.SEGMENT5) GL_SL_DESC,
          CC.SEGMENT6 GL_PROJECT,
          CC.SEGMENT7 GL_IC,
          FLEX.DESCRIPTION ACCTDESC,
          gxeh.source_line_ID VOUCHER_NUMBER,
          NULL GL_VOUCHER_NUMBER,
          XAH.AE_HEADER_ID,
          XAL.AE_LINE_NUM GL_JE_LINE_NUM,
          XAL.ACCOUNTING_DATE VOUCHER_DATE,
          NULL PARTICULARS,
          XAL.ENTERED_DR,
          XAL.ENTERED_CR,
          XAL.ACCOUNTED_DR,
          XAL.ACCOUNTED_CR,
          NULL CHEQUE_NUMBER,
          TRUNC (SYSDATE) CHEQUE_DATE,
          APS.SEGMENT1 PARTY_CODE,
          APS.VENDOR_NAME PARTY_NAME,
          --ENTITY_CODE TRANSACTION_TYPE,
          CC.CHART_OF_ACCOUNTS_ID,
          xah.LEDGER_ID,
          NULL DFF_CONTEXT,
          DECODE (GXEH.ENTITY_CODE, 'PURCHASING', PO.SEGMENT1, NULL) PO_NUM,
          PO.PO_HEADER_ID PO_HEADER_ID,
          (SELECT shipment_number
             FROM mtl_material_transactions
            WHERE transaction_id = gxeh.transaction_id
                  AND transaction_type_id IN (3, 12, 21))
             INTER_ORG_SHIPMENT_NUM,
          NULL ATTRIBUTE3,
          NULL ATTRIBUTE4,
          NULL ATTRIBUTE5,
          ORG.ORGANIZATION_ID,
          ORG.ORGANIZATION_CODE,
          ORG.ORGANIZATION_NAME,
          MST.INVENTORY_ITEM_ID,
          MST.SEGMENT1 ITEM_CODE_SEGMENT1,
          MST.SEGMENT2 ITEM_CODE_SEGMENT2,
          MST.SEGMENT3 ITEM_CODE_SEGMENT3,
          MST.SEGMENT4 ITEM_CODE_SEGMENT4,
          MST.SEGMENT5 ITEM_CODE_SEGMENT5,
          MST.SEGMENT6 ITEM_CODE_SEGMENT6,
          MST.CONCATENATED_SEGMENTS CONCAT_ITEM_CODE,
          MST.DESCRIPTION INVENTORY_ITEM_NAME,
          (SELECT MCB.SEGMENT1
             FROM MTL_ITEM_CATEGORIES MIC, MTL_CATEGORIES_B MCB
            WHERE     MIC.CATEGORY_ID = MCB.CATEGORY_ID
                  AND MCB.STRUCTURE_ID = 101
                  AND MIC.CATEGORY_SET_ID = 1
                  AND MIC.INVENTORY_ITEM_ID = MST.INVENTORY_ITEM_ID
                  AND MIC.ORGANIZATION_ID = MST.ORGANIZATION_ID)
             ITEM_CATEGORY_SEGMENT1,
          (SELECT MCB.SEGMENT2
             FROM MTL_ITEM_CATEGORIES MIC, MTL_CATEGORIES_B MCB
            WHERE     MIC.CATEGORY_ID = MCB.CATEGORY_ID
                  AND MCB.STRUCTURE_ID = 101
                  AND MIC.CATEGORY_SET_ID = 1
                  AND MIC.INVENTORY_ITEM_ID = MST.INVENTORY_ITEM_ID
                  AND MIC.ORGANIZATION_ID = MST.ORGANIZATION_ID)
             ITEM_CATEGORY_SEGMENT2,
          (SELECT MCB.SEGMENT3
             FROM MTL_ITEM_CATEGORIES MIC, MTL_CATEGORIES_B MCB
            WHERE     MIC.CATEGORY_ID = MCB.CATEGORY_ID
                  AND MCB.STRUCTURE_ID = 101
                  AND MIC.CATEGORY_SET_ID = 1
                  AND MIC.INVENTORY_ITEM_ID = MST.INVENTORY_ITEM_ID
                  AND MIC.ORGANIZATION_ID = MST.ORGANIZATION_ID)
             ITEM_CATEGORY_SEGMENT3,
          (SELECT MCB.SEGMENT1
             FROM MTL_ITEM_CATEGORIES MIC, MTL_CATEGORIES_B MCB
            WHERE     MIC.CATEGORY_ID = MCB.CATEGORY_ID
                  AND MCB.STRUCTURE_ID = 50408
                  AND MIC.CATEGORY_SET_ID = 1100000041
                  AND MIC.INVENTORY_ITEM_ID = MST.INVENTORY_ITEM_ID
                  AND MIC.ORGANIZATION_ID = MST.ORGANIZATION_ID)
             FIN_CAT1,
          (SELECT MCB.SEGMENT2
             FROM MTL_ITEM_CATEGORIES MIC, MTL_CATEGORIES_B MCB
            WHERE     MIC.CATEGORY_ID = MCB.CATEGORY_ID
                  AND MCB.STRUCTURE_ID = 50408
                  AND MIC.CATEGORY_SET_ID = 1100000041
                  AND MIC.INVENTORY_ITEM_ID = MST.INVENTORY_ITEM_ID
                  AND MIC.ORGANIZATION_ID = MST.ORGANIZATION_ID)
             FIN_CAT2,
          RCVH.RECEIPT_NUM GOODS_RECEIPT_NUM,
          gxeh.REFERENCE_NO,
          gxeh.EVENT_ID,
          gxeh.TRANSACTION_ID,
          gxeh.TRANSACTION_TYPE_ID,
          gxeh.TRANSACTION_UOM,
          gxeh.TXN_SOURCE,
          gxeh.LOT_NUMBER,
          gxeh.TRANSACTION_CURRENCY,
          gxeh.CURRENCY_CONVERSION_RATE,
          gxeh.TRANSACTION_QUANTITY,
          gxeh.TRANSACTION_VALUE,
          gxeh.SOURCE_DOCUMENT_ID,
          gxeh.SOURCE_LINE_ID,
          0 FA_ASSET_ID,
          RCVT.SHIPMENT_HEADER_ID,
          RCVT.SHIPMENT_LINE_ID,
          RCVT.TRANSACTION_ID RCV_TRANSACTION_ID,
          RCVT.PO_LINE_ID,
          RCVT.PO_LINE_LOCATION_ID,
          (SELECT DISTINCT LC_ID           --, LC_NUMBER, ORG_ID, PO_HEADER_ID
             FROM XX_LC_DETAILS
            WHERE po_header_id = RCVT.PO_HEADER_ID)
             LC_ID,
          (SELECT DISTINCT LC_NUMBER                   -- ORG_ID, PO_HEADER_ID
             FROM XX_LC_DETAILS
            WHERE po_header_id = RCVT.PO_HEADER_ID)
             LC_NUM,
          (SELECT DISTINCT BILL_OF_ENTRY_NO        --, BILL_OF_ENTRY_DATE, A.*
             FROM XX_LC_DETAILS_DT
            WHERE SHIPMENT_HEADER_ID = RCVH.SHIPMENT_HEADER_ID)
             BL_NUM,
          (SELECT DISTINCT BILL_OF_ENTRY_DATE
             FROM XX_LC_DETAILS_DT
            WHERE SHIPMENT_HEADER_ID = RCVH.SHIPMENT_HEADER_ID)
             BL_DATE,
          CASE
             WHEN gxeh.EVENT_TYPE_CODE = 'STEP'
             THEN
                gxeh.SOURCE_DOCUMENT_ID
             ELSE
                DECODE (gxeh.TRANSACTION_TYPE_ID,
                        44, gxeh.SOURCE_DOCUMENT_ID,
                        17, gxeh.SOURCE_DOCUMENT_ID,
                        1002, gxeh.SOURCE_DOCUMENT_ID,
                        35, gxeh.SOURCE_DOCUMENT_ID,
                        1003, gxeh.SOURCE_DOCUMENT_ID,
                        43, gxeh.SOURCE_DOCUMENT_ID,
                        NULL)
          END
             PROD_BATCH_NO,
          gxeh.SOURCE_DOCUMENT_ID LCM_ADJ_NUM,
          gxeh.HEADER_ID GMF_HEADER_ID,
          (SELECT TRANSACTION_TYPE_NAME
             FROM MTL_TRANSACTION_TYPES
            WHERE TRANSACTION_TYPE_ID = gxeh.TRANSACTION_TYPE_ID)
             AS TRANSACTION_TYPE_NAME,
          gxeh.TRANSACTION_ACTION_ID
     FROM AP_SUPPLIERS APS,
          RCV_SHIPMENT_HEADERS RCVH,
          RCV_TRANSACTIONS RCVT,
          gmf_xla_extract_headers gxeh,
          XLA_AE_LINES XAL,
          XLA_AE_HEADERS XAH,
          GL_LEDGERS LED,
          FND_DOC_SEQUENCE_CATEGORIES CAT,
          gl_code_combinations cc,
          FND_FLEX_VALUES_VL FLEX,
          MTL_SYSTEM_ITEMS_B_KFV MST,
          ORG_ORGANIZATION_DEFINITIONS ORG,
          --  MTL_ITEM_CATEGORIES MIC,
          -- MTL_CATEGORIES_B MCB,
          PO_HEADERS_ALL PO,
          HR_OPERATING_UNITS OU
    WHERE     APS.VENDOR_ID(+) = RCVH.VENDOR_ID
          AND RCVH.SHIPMENT_HEADER_ID(+) = RCVT.SHIPMENT_HEADER_ID
          AND ORG.OPERATING_UNIT = OU.ORGANIZATION_ID
          AND LED.LEDGER_ID = XAH.LEDGER_ID
          AND LED.LEDGER_CATEGORY_CODE = 'PRIMARY'
          AND NVL (RCVT.PO_HEADER_ID, 1) = NVL (PO.PO_HEADER_ID(+), 1)
          AND gxeh.source_line_ID = RCVT.TRANSACTION_ID(+)
          AND gxeh.organization_id = rcvt.organization_id(+)
          AND XAH.event_id = gxeh.event_id
          AND XAH.LEDGER_ID = gxeh.LEDGER_ID
          AND XAL.AE_HEADER_ID = XAH.AE_HEADER_ID
          AND xal.code_combination_id = cc.code_combination_id
          AND XAH.JE_CATEGORY_NAME = CAT.CODE
          AND CAT.APPLICATION_ID = 101
          --AND XAH.ledger_id = 2043
          AND CC.SEGMENT4 = FLEX.FLEX_VALUE_MEANING
          AND GXEH.ORGANIZATION_ID = MST.ORGANIZATION_ID
          AND GXEH.INVENTORY_ITEM_ID = MST.INVENTORY_ITEM_ID
          AND GXEH.ORGANIZATION_ID = ORG.ORGANIZATION_ID
          -- AND MIC.INVENTORY_ITEM_ID = MST.INVENTORY_ITEM_ID
          --AND MCB.STRUCTURE_ID = 101
          AND XAH.APPLICATION_ID = 555
          --AND ORG.OPERATING_UNIT IN (526,527)
          --AND MCB.CATEGORY_ID = MIC.CATEGORY_ID
          --AND (NVL (XAL.ACCOUNTED_DR, 0) <> 0
          --   OR NVL (XAL.ACCOUNTED_CR, 0) <> 0)
          AND FLEX.FLEX_VALUE_SET_ID = 1016490
   UNION ALL
   SELECT 2 UNION_PART,
          ORG.OPERATING_UNIT ORG_ID,
          OU.NAME OU_NAME,
          gxeh.LEGAL_ENTITY_ID,
          XAH.ACCOUNTING_ENTRY_STATUS_CODE,
          XAH.GL_TRANSFER_STATUS_CODE,
          XAH.APPLICATION_ID,
          'INV' JE_SOURCE,
          CAT.NAME JE_CATEGORY,
          CC.SEGMENT1 GL_LE,
          XAL.ACCOUNTING_CLASS_CODE,
          gxeh.EVENT_CLASS_CODE,
          gxeh.ENTITY_CODE,
          XAH.EVENT_TYPE_CODE,
          CC.SEGMENT2 GL_UNIT,
          CC.SEGMENT3 GL_CC,
          CC.SEGMENT4 GL_ACC,
          CC.SEGMENT5 GL_SL,
          EAM_FLEX_SL_DESC (CC.SEGMENT4, CC.SEGMENT5) GL_SL_DESC,
          CC.SEGMENT6 GL_PROJECT,
          CC.SEGMENT7 GL_IC,
          FLEX.DESCRIPTION ACCTDESC,
          gxeh.source_line_ID VOUCHER_NUMBER,
          NULL GL_VOUCHER_NUMBER,
          XAH.AE_HEADER_ID,
          XAL.AE_LINE_NUM GL_JE_LINE_NUM,
          XAL.ACCOUNTING_DATE VOUCHER_DATE,
          NULL PARTICULARS,
          XAL.ENTERED_DR,
          XAL.ENTERED_CR,
          XAL.ACCOUNTED_DR,
          XAL.ACCOUNTED_CR,
          NULL CHEQUE_NUMBER,
          TRUNC (SYSDATE) CHEQUE_DATE,
          TO_CHAR (NULL) PARTY_CODE,
          TO_CHAR (NULL) PARTY_NAME,
          --ENTITY_CODE TRANSACTION_TYPE,
          CC.CHART_OF_ACCOUNTS_ID,
          xah.LEDGER_ID,
          NULL DFF_CONTEXT,
          TO_CHAR (NULL) PO_NUM,
          TO_NUMBER (0) PO_HEADER_ID,                            --PO.SEGMENT1
          NULL INTER_ORG_SHIPMENT_NUM,
          NULL ATTRIBUTE3,
          NULL ATTRIBUTE4,
          NULL ATTRIBUTE5,
          ORG.ORGANIZATION_ID,
          ORG.ORGANIZATION_CODE,
          ORG.ORGANIZATION_NAME,
          TO_NUMBER (0) INVENTORY_ITEM_ID,
          TO_CHAR (NULL) ITEM_CODE_SEGMENT1,
          TO_CHAR (NULL) ITEM_CODE_SEGMENT2,
          TO_CHAR (NULL) ITEM_CODE_SEGMENT3,
          TO_CHAR (NULL) ITEM_CODE_SEGMENT4,
          TO_CHAR (NULL) ITEM_CODE_SEGMENT5,
          TO_CHAR (NULL) ITEM_CODE_SEGMENT6,
          TO_CHAR (NULL) CONCAT_ITEM_CODE,
          TO_CHAR (NULL) INVENTORY_ITEM_NAME,
          TO_CHAR (NULL) ITEM_CATEGORY_SEGMENT1,
          TO_CHAR (NULL) ITEM_CATEGORY_SEGMENT2,
          TO_CHAR (NULL) ITEM_CATEGORY_SEGMENT3,
          TO_CHAR (NULL) FIN_CAT1,
          TO_CHAR (NULL) FIN_CAT2,
          TO_CHAR (NULL) GOODS_RECEIPT_NUM,
          gxeh.REFERENCE_NO,
          gxeh.EVENT_ID,
          gxeh.TRANSACTION_ID,
          gxeh.TRANSACTION_TYPE_ID,
          gxeh.TRANSACTION_UOM,
          gxeh.TXN_SOURCE,
          gxeh.LOT_NUMBER,
          gxeh.TRANSACTION_CURRENCY,
          gxeh.CURRENCY_CONVERSION_RATE,
          gxeh.TRANSACTION_QUANTITY,
          gxeh.TRANSACTION_VALUE,
          gxeh.SOURCE_DOCUMENT_ID,
          gxeh.SOURCE_LINE_ID,
          0 FA_ASSET_ID,
          0 SHIPMENT_HEADER_ID,
          0 SHIPMENT_LINE_ID,
          0 RCV_TRANSACTION_ID,
          0 PO_LINE_ID,
          0 PO_LINE_LOCATION_ID,
          0 LC_ID,
          TO_CHAR (NULL) LC_NUM,
          TO_CHAR (NULL) BL_NUM,
          TO_DATE (NULL) BL_DATE,
          gxeh.SOURCE_DOCUMENT_ID PROD_BATCH_NO,
          TO_NUMBER (NULL) LCM_ADJ_NUM,
          TO_NUMBER (NULL) GMF_HEADER_ID,
          (SELECT TRANSACTION_TYPE_NAME
             FROM MTL_TRANSACTION_TYPES
            WHERE TRANSACTION_TYPE_ID = gxeh.TRANSACTION_TYPE_ID)
             AS TRANSACTION_TYPE_NAME,
          gxeh.TRANSACTION_ACTION_ID
     FROM gmf_xla_extract_headers gxeh,
          XLA_AE_LINES XAL,
          XLA_AE_HEADERS XAH,
          GL_LEDGERS LED,
          FND_DOC_SEQUENCE_CATEGORIES CAT,
          gl_code_combinations cc,
          FND_FLEX_VALUES_VL FLEX,
          ORG_ORGANIZATION_DEFINITIONS ORG,
          HR_OPERATING_UNITS OU
    WHERE     XAH.event_id = gxeh.event_id
          --AND xah.ledger_id = 2043
          AND ORG.OPERATING_UNIT = OU.ORGANIZATION_ID
          AND EVENT_CLASS_CODE = 'BATCH_CLOSE'
          AND LED.LEDGER_ID = XAH.LEDGER_ID
          AND LED.LEDGER_CATEGORY_CODE = 'PRIMARY'
          AND XAH.LEDGER_ID = gxeh.LEDGER_ID
          AND XAL.AE_HEADER_ID = XAH.AE_HEADER_ID
          AND ORG.ORGANIZATION_ID = gxeh.ORGANIZATION_ID
          AND xal.code_combination_id = cc.code_combination_id
          AND XAH.JE_CATEGORY_NAME = CAT.CODE
          AND CAT.APPLICATION_ID = 101
          AND CC.SEGMENT4 = FLEX.FLEX_VALUE_MEANING
          AND XAH.APPLICATION_ID = 555
          --AND ORG.OPERATING_UNIT IN (526,527)
          --AND MCB.CATEGORY_ID = MIC.CATEGORY_ID
          --          AND (NVL (XAL.ACCOUNTED_DR, 0) <> 0
          --             OR NVL (XAL.ACCOUNTED_CR, 0) <> 0)
          AND FLEX.FLEX_VALUE_SET_ID = 1016490;


==========================================================================================================================================
--========================================================================================================================================
--and EVENT_TYPE_CODE = 'FOB_SHIP_SENDER_SHIP_NO_TP'

--======================== 8-DEC-2020================
-- MATERIAL AND OVER HEAD DETAILS V3   FOR 
--===============================================

SELECT 
--(SUM(ACCOUNTED_DR) from EAM_OP_GDET_VW a where a.CONCAT_ITEM_CODE = CONCAT_ITEM_CODE and a.ORGANIZATION_ID= ORGANIZATION_ID ) MATERIAL_COST,
ORG_ID, OU_NAME,ORGANIZATION_CODE,-- EVENT_CLASS_CODE,EVENT_TYPE_CODE,
INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM(DISTINCT TRANSACTION_QUANTITY) Quantity , ABS(SUM(ACCOUNTED_DR)-SUM(ACCOUNTED_CR)) COST ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
--(lSELECT SUM(ACCOUNTED_DR) ,CONCAT_ITEM_CODE  FROM EAM_OP_GDET_VW WHERE  CONCAT_ITEM_CODE = a.CONCAT_ITEM_CODE and VOUCHER_DATE=a.VOUCHER_DATE and VOUCHER_DATE between '01-jul-19' and '31-jul-19' and CONCAT_ITEM_CODE= a.CONCAT_ITEM_CODE and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' and  EVENT_CLASS_CODE = a.EVENT_CLASS_CODE and EVENT_CLASS_CODE = 'GLCOSTALOC') OVERHEAD
FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to --and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' 
 and ORGANIZATION_ID=121
 --==========OVERHEAD===============
--and EVENT_CLASS_CODE in('GLCOSTALOC')
and CONCAT_ITEM_CODE ='BP|SCRP|ROLL|000005'
and ACCTDESC = 'Material / Store related Adjustment' 
--and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
 --==========MATERIA===============
 group by ORG_ID, OU_NAME,ORGANIZATION_CODE, INVENTORY_ITEM_ID,CONCAT_ITEM_CODE,ACCTDESC



--=========================================================
-- FINAL OVER HEAD   56768016.82
--=============================================================
select  SUM(TRANSACTION_VALUE) OVER_HEAD --,CONCAT_ITEM_CODE --OU_NAME, ORG_ID, ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME, ACCOUNTING_CLASS_CODE, sum(TRANSACTION_QUANTITY), sum(TRANSACTION_VALUE), sum(ACCOUNTED_DR)
--(select EVENT_CLASS_CODE from EAM_OP_GDET_VW where org_id=81 and organization_id=121 and CONCAT_ITEM_CODE='CP|500W|10MM|000002' and VOUCHER_DATE between '01-jul-19' and '31-jul-19' and EVENT_CLASS_CODE in('BATCH_MATERIAL')) EVENT_CLASS_CODE
from (
select OU_NAME,ORG_ID, ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME, ACCOUNTING_CLASS_CODE,EVENT_CLASS_CODE,TRANSACTION_QUANTITY, TRANSACTION_VALUE,ACCOUNTED_DR 
from EAM_OP_GDET_VW
where org_id=81
and organization_id=121
--and CONCAT_ITEM_CODE='CP|500W|10MM|000002'
and VOUCHER_DATE between '01-jul-19' and '31-jul-19'
and EVENT_CLASS_CODE in('GLCOSTALOC')
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
 --and FIN_CAT1 like '%BY PRODUCT%WASTAGE%'
)

--======================== 8-DEC-2020================================================================================
-- MATERIAL AND OVER HEAD DETAILS V2   FOR FG ITEM 
--==================================================================================================

SELECT 
--(SUM(ACCOUNTED_DR) from EAM_OP_GDET_VW a where a.CONCAT_ITEM_CODE = CONCAT_ITEM_CODE and a.ORGANIZATION_ID= ORGANIZATION_ID ) MATERIAL_COST,
ORG_ID, OU_NAME,ORGANIZATION_CODE,ACCOUNTING_CLASS_CODE ,EVENT_CLASS_CODE,-- EVENT_CLASS_CODE,EVENT_TYPE_CODE,
INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM( TRANSACTION_QUANTITY) Quantity , SUM(ACCOUNTED_DR) COST ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
--(lSELECT SUM(ACCOUNTED_DR) ,CONCAT_ITEM_CODE  FROM EAM_OP_GDET_VW WHERE  CONCAT_ITEM_CODE = a.CONCAT_ITEM_CODE and VOUCHER_DATE=a.VOUCHER_DATE and VOUCHER_DATE between '01-jul-19' and '31-jul-19' and CONCAT_ITEM_CODE= a.CONCAT_ITEM_CODE and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' and  EVENT_CLASS_CODE = a.EVENT_CLASS_CODE and EVENT_CLASS_CODE = 'GLCOSTALOC') OVERHEAD
FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to --and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' 
 and ORGANIZATION_ID=121
 --==========OVERHEAD===============
--and EVENT_CLASS_CODE in('GLCOSTALOC')
and EVENT_TYPE_CODE = 'CERT'
and CONCAT_ITEM_CODE ='FG|G400|12MM|000024'
and ACCTDESC = 'Finished Goods'
--and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
 --==========MATERIA===============
 group by ORG_ID, OU_NAME,ORGANIZATION_CODE, INVENTORY_ITEM_ID,CONCAT_ITEM_CODE,ACCTDESC,EVENT_CLASS_CODE,ACCOUNTING_CLASS_CODE ,EVENT_CLASS_CODE

--======================== 8-DEC-2020================================================================================
-- MATERIAL AND OVER HEAD DETAILS V1   FOR CP 
--==================================================================================================

SELECT 
--(SUM(ACCOUNTED_DR) from EAM_OP_GDET_VW a where a.CONCAT_ITEM_CODE = CONCAT_ITEM_CODE and a.ORGANIZATION_ID= ORGANIZATION_ID ) MATERIAL_COST,
ORG_ID, OU_NAME,ORGANIZATION_CODE,-- EVENT_CLASS_CODE,EVENT_TYPE_CODE,
INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM(DISTINCT TRANSACTION_QUANTITY) Quantity , SUM(ACCOUNTED_DR)-SUM(ACCOUNTED_CR) COST ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
--(lSELECT SUM(ACCOUNTED_DR) ,CONCAT_ITEM_CODE  FROM EAM_OP_GDET_VW WHERE  CONCAT_ITEM_CODE = a.CONCAT_ITEM_CODE and VOUCHER_DATE=a.VOUCHER_DATE and VOUCHER_DATE between '01-jul-19' and '31-jul-19' and CONCAT_ITEM_CODE= a.CONCAT_ITEM_CODE and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' and  EVENT_CLASS_CODE = a.EVENT_CLASS_CODE and EVENT_CLASS_CODE = 'GLCOSTALOC') OVERHEAD
FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to --and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' 
 and ORGANIZATION_ID=121
 --==========OVERHEAD===============
and EVENT_CLASS_CODE in('GLCOSTALOC')
and CONCAT_ITEM_CODE ='CP|500W|10MM|000002'
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
 --==========MATERIA===============
 group by ORG_ID, OU_NAME,ORGANIZATION_CODE, INVENTORY_ITEM_ID,CONCAT_ITEM_CODE,ACCTDESC


--======================== 8-DEC-2020================================================================================
-- MATERIAL AND OVER HEAD DETAILS 
--==================================================================================================
(SUM(ACCOUNTED_DR) from EAM_OP_GDET_VW a where a.CONCAT_ITEM_CODE = CONCAT_ITEM_CODE and a.ORGANIZATION_ID= ORGANIZATION_ID ) MATERIAL_COST

SELECT 
--(SUM(ACCOUNTED_DR) from EAM_OP_GDET_VW a where a.CONCAT_ITEM_CODE = CONCAT_ITEM_CODE and a.ORGANIZATION_ID= ORGANIZATION_ID ) MATERIAL_COST,
ORG_ID, OU_NAME,ORGANIZATION_CODE, JE_CATEGORY, EVENT_CLASS_CODE,EVENT_TYPE_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE, ACCTDESC,SUM(DISTINCT TRANSACTION_QUANTITY) MATERIAL_QUANTITY, SUM(ACCOUNTED_DR)-SUM(ACCOUNTED_CR) OVER_HEAD  ,SUM(ACCOUNTED_CR) ACCOUNTED_CR
--(lSELECT SUM(ACCOUNTED_DR) ,CONCAT_ITEM_CODE  FROM EAM_OP_GDET_VW WHERE  CONCAT_ITEM_CODE = a.CONCAT_ITEM_CODE and VOUCHER_DATE=a.VOUCHER_DATE and VOUCHER_DATE between '01-jul-19' and '31-jul-19' and CONCAT_ITEM_CODE= a.CONCAT_ITEM_CODE and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' and  EVENT_CLASS_CODE = a.EVENT_CLASS_CODE and EVENT_CLASS_CODE = 'GLCOSTALOC') OVERHEAD
FROM EAM_OP_GDET_VW 
where  VOUCHER_DATE between :p_date_from AND :p_date_to --and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002' 
 and ORGANIZATION_ID=121
 --==========OVERHEAD===============
and EVENT_CLASS_CODE in('GLCOSTALOC')
--and CONCAT_ITEM_CODE = 'CP|500W|10MM|000002'
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
 --==========MATERIA===============
 group by ORG_ID, OU_NAME,ORGANIZATION_CODE, JE_CATEGORY, EVENT_CLASS_CODE,EVENT_TYPE_CODE,INVENTORY_ITEM_ID,CONCAT_ITEM_CODE,ACCTDESC

--======================== 8-DEC-2020================================================================================
-- MATERIAL AND SUMMARY 
--==================================================================================================
select ACCTDESC ,EVENT_TYPE_CODE, JE_CATEGORY,sum(ACCOUNTED_DR) MATERIAL_COST,
(select  SUM(TRANSACTION_VALUE) --OU_NAME, ORG_ID, ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME, ACCOUNTING_CLASS_CODE, sum(TRANSACTION_QUANTITY), sum(TRANSACTION_VALUE), sum(ACCOUNTED_DR)
--(select EVENT_CLASS_CODE from EAM_OP_GDET_VW where org_id=81 and organization_id=121 and CONCAT_ITEM_CODE='CP|500W|10MM|000002' and VOUCHER_DATE between '01-jul-19' and '31-jul-19' and EVENT_CLASS_CODE in('BATCH_MATERIAL')) EVENT_CLASS_CODE
from (
select OU_NAME,ORG_ID, ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME, ACCOUNTING_CLASS_CODE,EVENT_CLASS_CODE,TRANSACTION_QUANTITY, TRANSACTION_VALUE,ACCOUNTED_DR from EAM_OP_GDET_VW
where org_id=81
and organization_id=121
--and CONCAT_ITEM_CODE='CP|500W|10MM|000002'
and VOUCHER_DATE between '01-jul-19' and '31-jul-19'
and EVENT_CLASS_CODE in('GLCOSTALOC')
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
 --and FIN_CAT1 like '%BY PRODUCT%WASTAGE%'
)) OVER_HEAD
FROM EAM_OP_GDET_VW  
WHERE  1=1
AND org_id=81
and organization_id= :p_org --121
and VOUCHER_DATE between :p_date_from AND :p_date_to 
--and CONCAT_ITEM_CODE='CP|500W|10MM|000002'
and JE_CATEGORY= 'OPM Batch Release' 
--and ACCTDESC = 'WIP-Material Account'  
and EVENT_TYPE_CODE IN  ('RELE', 'CERT') 
GROUP BY ACCTDESC,EVENT_TYPE_CODE,JE_CATEGORY  
--and TRANSACTION_TYPE_NAME in ('WIP Byproduct Completion','WIP Byproduct Return', 'WIP Completion', 'WIP Completion Return')

--=========================================================================================



select * from cm_cmpt_dtl   ccd where INVENTORY_ITEM_ID=35611  and  PERIOD_ID = 7  --and CREATION_DATE between '01-JUL-2019' and  '31-JUL-2019' 

         select * from gmf_period_statuses  where  PERIOD_CODE = 'JUL-19'
         
         select * from cm_cmpt_mst_vl ccmv 
          
         select *from   wbi_xxkbgitem_mt_d  wxm 
         
         select * from  CM_ACST_LED where INVENTORY_ITEM_ID=21011 and ORGANIZATION_ID =121 and TRANS_DATE between '01-JUL-2019' and  '31-JUL-2019' 
               
             
               ,wbi_xxkbgitem_mt_d wxm

--==============================================
-- EBS Production Cost Summary Report

SELECT period_code, ITEM_CODE,NVL(SUM(CMPNT_COST),0) CPMT,NVL(TOTAL_QTY,0) TOTAL_QTY,NVL(SUM(MATERIAL_VALUE),0) MATERIAL_VALUE, NVL(SUM(MATERIAL_VALUE_V1),0) MATERIAL_VALUE_V1, NVL(SUM(OH_VALUE),0) OH_VALUE,
ORGANIZATION_ID,PERIOD_CODE,ORGANIZATION_CODE,ORGANIZATION_NAME,START_DATE,END_DATE,ITEM_DESC
 FROM 
(SELECT UPPER(CCMV.COST_CMPNTCLS_DESC) COST_CMPNTCLS_DESC,CCD.COST_ANALYSIS_CODE,CCD.CMPNT_COST,CCD.TOTAL_QTY,CCD.cost_cmpntcls_id,
                      (SELECT  NVL(SUM(CCD2.CMPNT_COST*CCD2.TOTAL_QTY),0) GTOTAL_VALUE 
      FROM cm_cmpt_dtl   ccd2
               ,gmf_period_statuses mst2
               ,cm_cmpt_mst_vl ccmv2
      WHERE ccd2.period_id          = mst2.period_id
        AND CCMV2.COST_CMPNTCLS_ID=ccd2.COST_CMPNTCLS_ID
        and wxm.organization_id=ccd2.organization_id
        AND ccd2.delete_mark        = 0
        AND ccd.period_id          = mst.period_id
        AND CCD.COST_CMPNTCLS_ID=ccd2.COST_CMPNTCLS_ID
        GROUP BY  CCD2.ORGANIZATION_ID,MST2.PERIOD_CODE,CCMV2.COST_CMPNTCLS_DESC,CCD2.COST_ANALYSIS_CODE) GTOTAL, 
     CASE WHEN CCMV.COST_CMPNTCLS_DESC='Material' THEN CCD.CMPNT_COST*CCD.TOTAL_QTY ELSE 0 END MATERIAL_VALUE,
     CASE WHEN CCMV.COST_CMPNTCLS_DESC='Material' THEN CCD.TOTAL_QTY  ELSE 0 END MATERIAL_VALUE_V1,
     CASE WHEN CCMV.COST_CMPNTCLS_DESC<>'Material' THEN CCD.CMPNT_COST*CCD.TOTAL_QTY ELSE 0 END OH_VALUE,
     CCD.CMPNT_COST*CCD.TOTAL_QTY TOTAL_COGS,
     ratio_to_report (CCD.CMPNT_COST*CCD.TOTAL_QTY) OVER () *100 PER_ON_TOTAL_COST,
     CCD.ORGANIZATION_ID,MST.PERIOD_CODE,WXM.ITEM_CODE,WXM.ORGANIZATION_CODE,WXM.ORGANIZATION_NAME,mst.start_date start_date,trunc(mst.end_date) end_date,wxm.uom1,wxm.uom2,wxm.item_desc
      FROM cm_cmpt_dtl   ccd
               ,gmf_period_statuses mst
               ,cm_cmpt_mst_vl ccmv
               ,wbi_xxkbgitem_mt_d wxm
      WHERE ccd.period_id          = mst.period_id
        AND CCMV.COST_CMPNTCLS_ID=ccd.COST_CMPNTCLS_ID
        AND wxm.inventory_item_id=ccd.inventory_item_id
        ---AND wxm.item_code=:p_item_code
        and wxm.organization_id=ccd.organization_id
        and mst.period_code =:p_period_code
         and CCD.PERIOD_TRANS_QTY <>0
      --  and  to_char( mst.creation_date,'MON-YY') = :P_PERIOD_CODE
        AND wxm.organization_code   =NVL(:p_organization_code,wxm.organization_code)
        AND wxm.finance_category LIKE 'FINISHED GOODS|FINISHED GOODS'
        --and ITEM_CODE= 'RM|SCRP|ROLL|000005'
       AND wxm.item_code = NVL(:p_item_code, wxm.item_code)
       -- and ccd.PERIOD_TRANS_QTY is not null
      --- AND upper(cost_cmpntcls_desc)='MATERIAL'
        AND ccd.delete_mark        = 0)
        GROUP BY ITEM_CODE,TOTAL_QTY,ORGANIZATION_ID,PERIOD_CODE,ORGANIZATION_CODE,ORGANIZATION_NAME,START_DATE,END_DATE,ITEM_DESC
        ORDER BY ITEM_CODE 
        
        
        

SELECT * FROM eam_op_gdet_vw

-- Keep by arefin vai , sugested by MAMUN BOS
inv vs accounting 
valuation report 

select * from GL_ITEM_CST where  INVENTORY_ITEM_ID=35611 and PERIOD_ID = 7

select * from CM_ACST_LED

select * from CM_ACST_LED 
where 1=1
and  INVENTORY_ITEM_ID=35611
and CREATION_DATE between  :p_date_from AND :p_date_to  
and ORGANIZATION_ID =121
and PERIOD_ID =7

select * from CM_ALPR_CTL

select * from EAM_OP_GDET_VW

-- FOR OVERHEAD 
SELECT TRANSACTION_VALUE, JE_CATEGORY, ACCOUNTING_CLASS_CODE,  EVENT_TYPE_CODE  FROM eam_op_gdet_vw
WHERE 1=1
--and accounting_class_code= 'ALC'
--and JE_CATEGORY= 'OPM Cost Revaluation'
and EVENT_TYPE_CODE= 'GLCOSTALOC'   -- 'RELE' -- 'GLCOSTALOC'  
and VOUCHER_DATE between  :p_date_from AND :p_date_to  -----
and ORGANIZATION_ID =121  ----- 



-- FOR OVERHEAD 
SELECT TRANSACTION_VALUE, JE_CATEGORY, ACCOUNTING_CLASS_CODE,  EVENT_TYPE_CODE  FROM eam_op_gdet_vw
WHERE 1=1
--and accounting_class_code= 'ALC'
--and JE_CATEGORY= 'OPM Cost Revaluation'
and EVENT_TYPE_CODE= 'GLCOSTALOC'   -- 'RELE' -- 'GLCOSTALOC'  
and VOUCHER_DATE between  :p_date_from AND :p_date_to  -----
and ORGANIZATION_ID =121  ----- 


--FOR MATERIAL 
SELECT TRANSACTION_TYPE_NAME,JE_CATEGORY, ACCOUNTING_CLASS_CODE,  EVENT_TYPE_CODE  FROM eam_op_gdet_vw
WHERE 1=1
--accounting_class_code= 'WIP_VALUATION'
and JE_CATEGORY= 'OPM Batch Release'
and EVENT_TYPE_CODE= 'CERT'
and TRANSACTION_TYPE_NAME in ('WIP Byproduct Completion','WIP Byproduct Return', 'WIP Completion', 'WIP Completion Return')

JE_CATEGORY, ACCOUNTING_CLASS_CODE,  EVENT_TYPE_CODE



-- for over head
draft accounting = inventory accounting 

ACCOUNTING CLASS CODE = ALC 

event TYPE CODE = gl cost alc

je category name = rval




-- material logic
RELE TE input
crt = OUTPUT

acc_class_code        eVENT TYPE CODE        je category name
WIP---                CERT                       RELE


and VOUCHER_DATE between :p_date_from AND :p_date_to   --'01-jul-19' and '31-jul-19'
--================================================


--GROUP BY CONCAT_ITEM_CODE





---=================================================
select 
OU_NAME, ORG_ID, ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME, ACCOUNTING_CLASS_CODE, 
(select  sum(TRANSACTION_QUANTITY) MATERIAL_QUntity FROM EAM_OP_GDET_VW  
WHERE  1=1
AND org_id=81
and organization_id= :p_org --121
and VOUCHER_DATE between :p_date_from AND :p_date_to 
and CONCAT_ITEM_CODE='SF|BILT|G-80|000030'   
--and JE_CATEGORY= 'OPM Batch Release'
and ACCTDESC = 'Raw Materials' 
and EVENT_TYPE_CODE= 'FOB_SHIP_RECIPIENT_RCPT'
--and TRANSACTION_TYPE_NAME in ('WIP Byproduct Completion','WIP Byproduct Return', 'WIP Completion', 'WIP Completion Return')
) MATERIAL_QTY, 
(select  SUM(TRANSACTION_VALUE) 
from (
select OU_NAME,ORG_ID, ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME, ACCOUNTING_CLASS_CODE,EVENT_CLASS_CODE,TRANSACTION_QUANTITY, TRANSACTION_VALUE,ACCOUNTED_DR from EAM_OP_GDET_VW
where 1=1
AND org_id=81
and organization_id= :p_org --121
--and CONCAT_ITEM_CODE='CP|500W|10MM|000002' --'SF|BILT|G-80|000030'     -- 
and VOUCHER_DATE between :p_date_from AND :p_date_to   --'01-jul-19' and '31-jul-19'
and accounting_class_code= 'ALC'
and JE_CATEGORY= 'OPM Cost Revaluation' 
and EVENT_TYPE_CODE= 'GLCOSTALOC' 
--and EVENT_CLASS_CODE in('GLCOSTALOC')
--and ACCOUNTING_CLASS_CODE = 'WIP_VALUATION' -- 'INVENTORY_VALUATION'
--and FIN_CAT1 like '%BY PRODUCT%WASTAGE%'
)) OVER_HEAD, 
sum(TRANSACTION_VALUE), sum(ACCOUNTED_DR)
from (
select OU_NAME,ORG_ID, ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME, ACCOUNTING_CLASS_CODE,EVENT_CLASS_CODE,TRANSACTION_QUANTITY, TRANSACTION_VALUE,ACCOUNTED_DR from EAM_OP_GDET_VW
where 1=1
AND org_id=81
and organization_id= :p_org  --121
--and CONCAT_ITEM_CODE='CP|500W|10MM|000002' --'SF|BILT|G-80|000030'     -- 
and VOUCHER_DATE between :p_date_from AND :p_date_to   --'01-jul-19' and '31-jul-19'
and EVENT_CLASS_CODE in('BATCH_MATERIAL')
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'
--and FIN_CAT1 like '%BY PRODUCT%WASTAGE%'
)
group by OU_NAME,ORG_ID, ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME, ACCOUNTING_CLASS_CODE





--===============================================

select  SUM( TRANSACTION_QUANTITY) SROM
FROM
(
select OU_NAME,ORG_ID, ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME,TRANSACTION_ID, ACCOUNTING_CLASS_CODE,EVENT_CLASS_CODE,TRANSACTION_QUANTITY,TRANSACTION_VALUE,PROD_BATCH_NO,ACCOUNTED_DR from EAM_OP_GDET_VW
where org_id=81
and organization_id=121
and CONCAT_ITEM_CODE='CP|500W|10MM|000002'
and VOUCHER_DATE between '01-jul-19' and '31-jul-19'
and EVENT_CLASS_CODE in('BATCH_MATERIAL'
)
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION')


select OU_NAME,ORG_ID, ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME,TRANSACTION_ID, ACCOUNTING_CLASS_CODE,EVENT_CLASS_CODE,TRANSACTION_QUANTITY,TRANSACTION_VALUE,PROD_BATCH_NO,ACCOUNTED_DR from EAM_OP_GDET_VW
where org_id=81
and organization_id=121
and CONCAT_ITEM_CODE='CP|500W|10MM|000002'
and VOUCHER_DATE between '01-jul-19' and '31-jul-19'
and EVENT_CLASS_CODE in('BATCH_MATERIAL','GLCOSTALOC')
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'

--===========================================


select distinct COST_CMPNTCLS_DESC from cm_cmpt_mst_vl ccmv
where CCMV.COST_CMPNTCLS_DESC='Material'


select * from CM_ACST_LED 
--==============================================================================================================
-- EBS Production Cost Summary Report
--==============================================================================================================

SELECT period_code, ITEM_CODE,NVL(SUM(CMPNT_COST),0) CPMT,NVL(TOTAL_QTY,0) TOTAL_QTY,NVL(SUM(MATERIAL_VALUE),0) MATERIAL_VALUE, NVL(SUM(MATERIAL_VALUE_V1),0) MATERIAL_VALUE_V1, NVL(SUM(OH_VALUE),0) OH_VALUE,
ORGANIZATION_ID,PERIOD_CODE,ORGANIZATION_CODE,ORGANIZATION_NAME,START_DATE,END_DATE,ITEM_DESC
 FROM 
(SELECT UPPER(CCMV.COST_CMPNTCLS_DESC) COST_CMPNTCLS_DESC,CCD.COST_ANALYSIS_CODE,CCD.CMPNT_COST,CCD.TOTAL_QTY,CCD.cost_cmpntcls_id,
                      (SELECT  NVL(SUM(CCD2.CMPNT_COST*CCD2.TOTAL_QTY),0) GTOTAL_VALUE 
      FROM cm_cmpt_dtl   ccd2
               ,gmf_period_statuses mst2
               ,cm_cmpt_mst_vl ccmv2
      WHERE ccd2.period_id          = mst2.period_id
        AND CCMV2.COST_CMPNTCLS_ID=ccd2.COST_CMPNTCLS_ID
        and wxm.organization_id=ccd2.organization_id
        AND ccd2.delete_mark        = 0
        AND ccd.period_id          = mst.period_id
        AND CCD.COST_CMPNTCLS_ID=ccd2.COST_CMPNTCLS_ID
        GROUP BY  CCD2.ORGANIZATION_ID,MST2.PERIOD_CODE,CCMV2.COST_CMPNTCLS_DESC,CCD2.COST_ANALYSIS_CODE) GTOTAL, 
     CASE WHEN CCMV.COST_CMPNTCLS_DESC='Material' THEN CCD.CMPNT_COST*CCD.TOTAL_QTY ELSE 0 END MATERIAL_VALUE,
     CASE WHEN CCMV.COST_CMPNTCLS_DESC='Material' THEN CCD.TOTAL_QTY  ELSE 0 END MATERIAL_VALUE_V1,
     CASE WHEN CCMV.COST_CMPNTCLS_DESC<>'Material' THEN CCD.CMPNT_COST*CCD.TOTAL_QTY ELSE 0 END OH_VALUE,
     CCD.CMPNT_COST*CCD.TOTAL_QTY TOTAL_COGS,
     ratio_to_report (CCD.CMPNT_COST*CCD.TOTAL_QTY) OVER () *100 PER_ON_TOTAL_COST,
     CCD.ORGANIZATION_ID,MST.PERIOD_CODE,WXM.ITEM_CODE,WXM.ORGANIZATION_CODE,WXM.ORGANIZATION_NAME,mst.start_date start_date,trunc(mst.end_date) end_date,wxm.uom1,wxm.uom2,wxm.item_desc
      FROM cm_cmpt_dtl   ccd
               ,gmf_period_statuses mst
               ,cm_cmpt_mst_vl ccmv
               ,wbi_xxkbgitem_mt_d wxm
      WHERE ccd.period_id          = mst.period_id
        AND CCMV.COST_CMPNTCLS_ID=ccd.COST_CMPNTCLS_ID
        AND wxm.inventory_item_id=ccd.inventory_item_id
        AND wxm.item_code= NVL(:p_item_code,  wxm.item_code)
        and wxm.organization_id=ccd.organization_id
        and mst.period_code =:p_period_code
         and CCD.PERIOD_TRANS_QTY <>0
      --  and  to_char( mst.creation_date,'MON-YY') = :P_PERIOD_CODE
        AND wxm.organization_code   =NVL(:p_organization_code,wxm.organization_code)
      --  AND wxm.finance_category LIKE 'FINISHED GOODS|FINISHED GOODS'
        --and ITEM_CODE= 'RM|SCRP|ROLL|000005'
     --   AND wxm.item_code =:p_item_code
       -- and ccd.PERIOD_TRANS_QTY is not null
      --- AND upper(cost_cmpntcls_desc)='MATERIAL'
        AND ccd.delete_mark        = 0)
        GROUP BY ITEM_CODE,TOTAL_QTY,ORGANIZATION_ID,PERIOD_CODE,ORGANIZATION_CODE,ORGANIZATION_NAME,START_DATE,END_DATE,ITEM_DESC
        ORDER BY ITEM_CODE 

--===============================================================
select   sum(distinct TRANSACTION_QUANTITY) COST
FROM(
SELECT * --ORG_ID,CONCAT_ITEM_CODE, EVENT_CLASS_CODE,TRANSACTION_QUANTITY, TRANSACTION_VALUE/TRANSACTION_QUANTITY COST, TRANSACTION_VALUE, ENTERED_DR,ENTERED_CR, ACCOUNTED_DR , ACCOUNTED_CR
 FROM EAM_OP_GDET_VW  where EVENT_CLASS_CODE in('GLCOSTALOC','BATCH_MATERIAL') 
and ORG_ID =81 and organization_id=121
and VOUCHER_DATE between '01-JUL-19' and '31-JUL-19'
and CONCAT_ITEM_CODE='CP|500W|10MM|000002' 
and  EVENT_CLASS_CODE in('GLCOSTALOC') 
)

--================================================

select OU_NAME,ORG_ID, ORGANIZATION_CODE,ORGANIZATION_ID, CONCAT_ITEM_CODE,INVENTORY_ITEM_NAME,TRANSACTION_ID, ACCOUNTING_CLASS_CODE,EVENT_CLASS_CODE,TRANSACTION_QUANTITY,TRANSACTION_VALUE,PROD_BATCH_NO,ACCOUNTED_DR from EAM_OP_GDET_VW
where org_id=81
and organization_id=121
and CONCAT_ITEM_CODE='CP|500W|10MM|000002'
and VOUCHER_DATE between '01-jul-19' and '31-jul-19'
and EVENT_CLASS_CODE in('BATCH_MATERIAL','GLCOSTALOC')
and ACCOUNTING_CLASS_CODE = 'INVENTORY_VALUATION'

--===========================================

select   sum(distinct TRANSACTION_QUANTITY) COST FROM EAM_OP_GDET_VW  where EVENT_CLASS_CODE in('GLCOSTALOC','BATCH_MATERIAL') and ORG_ID =81 and organization_id=121
and VOUCHER_DATE between '01-JUL-19' and '31-JUL-19'
and CONCAT_ITEM_CODE='CP|500W|10MM|000002' 
and  EVENT_CLASS_CODE in('GLCOSTALOC') 




SELECT * FROM EAM_OP_GDET_VW  where EVENT_CLASS_CODE in('GLCOSTALOC','BATCH_MATERIAL') 
and ORG_ID =81 and organization_id=121
and VOUCHER_DATE between '01-JUL-19' and '31-JUL-19'
and CONCAT_ITEM_CODE='CP|500W|10MM|000002'


SELECT  TRANSACTION_VALUE/TRANSACTION_QUANTITY COST,CONCAT_ITEM_CODE, EVENT_CLASS_CODE,TRANSACTION_QUANTITY,TRANSACTION_VALUE, ENTERED_DR,ENTERED_CR, ACCOUNTED_DR , ACCOUNTED_CR FROM EAM_OP_GDET_VW  where EVENT_CLASS_CODE in('GLCOSTALOC','BATCH_MATERIAL') 
and ORG_ID =81 and organization_id=121
and VOUCHER_DATE between '01-JUL-19' and '31-JUL-19'
and CONCAT_ITEM_CODE='CP|500W|10MM|000002'
and  EVENT_CLASS_CODE = 'BATCH_MATERIAL' 


--==================NEW RESPONSIBILITY FOR RECONCILLIATION PURPOSE =========== 6-DEC-2020===================

KSRM Reconcilliation Resp


NAME : KSRM Reconcilliation Responsibility 









--=======================================================










select * from EAM_OP_GDET_VW
where org_id=81
and organization_id=121
and CONCAT_ITEM_CODE='FG|500W|12MM|000003'
and VOUCHER_DATE between '01-nov-18' and '30-nov-18'



CREATE OR REPLACE FORCE VIEW EAM_OP_GDET_VW
(
   UNION_PART,
   ORG_ID,
   OU_NAME,
   LEGAL_ENTITY_ID,
   ACCOUNTING_ENTRY_STATUS_CODE,
   GL_TRANSFER_STATUS_CODE,
   APPLICATION_ID,
   JE_SOURCE,
   JE_CATEGORY,
   GL_LE,
   ACCOUNTING_CLASS_CODE,
   EVENT_CLASS_CODE,
   ENTITY_CODE,
   EVENT_TYPE_CODE,
   GL_UNIT,
   GL_CC,
   GL_ACC,
   GL_SL,
   GL_SL_DESC,
   GL_PROJECT,
   GL_IC,
   ACCTDESC,
   VOUCHER_NUMBER,
   GL_VOUCHER_NUMBER,
   AE_HEADER_ID,
   GL_JE_LINE_NUM,
   VOUCHER_DATE,
   PARTICULARS,
   ENTERED_DR,
   ENTERED_CR,
   ACCOUNTED_DR,
   ACCOUNTED_CR,
   CHEQUE_NUMBER,
   CHEQUE_DATE,
   PARTY_CODE,
   PARTY_NAME,
   CHART_OF_ACCOUNTS_ID,
   LEDGER_ID,
   DFF_CONTEXT,
   PO_NUM,
   PO_HEADER_ID,
   INTER_ORG_SHIPMENT_NUM,
   ATTRIBUTE3,
   ATTRIBUTE4,
   ATTRIBUTE5,
   ORGANIZATION_ID,
   ORGANIZATION_CODE,
   ORGANIZATION_NAME,
   INVENTORY_ITEM_ID,
   ITEM_CODE_SEGMENT1,
   ITEM_CODE_SEGMENT2,
   ITEM_CODE_SEGMENT3,
   ITEM_CODE_SEGMENT4,
   ITEM_CODE_SEGMENT5,
   ITEM_CODE_SEGMENT6,
   CONCAT_ITEM_CODE,
   INVENTORY_ITEM_NAME,
   ITEM_CATEGORY_SEGMENT1,
   ITEM_CATEGORY_SEGMENT2,
   ITEM_CATEGORY_SEGMENT3,
   FIN_CAT1,
   FIN_CAT2,
   GOODS_RECEIPT_NUM,
   REFERENCE_NO,
   EVENT_ID,
   TRANSACTION_ID,
   TRANSACTION_TYPE_ID,
   TRANSACTION_UOM,
   TXN_SOURCE,
   LOT_NUMBER,
   TRANSACTION_CURRENCY,
   CURRENCY_CONVERSION_RATE,
   TRANSACTION_QUANTITY,
   TRANSACTION_VALUE,
   SOURCE_DOCUMENT_ID,
   SOURCE_LINE_ID,
   FA_ASSET_ID,
   SHIPMENT_HEADER_ID,
   SHIPMENT_LINE_ID,
   RCV_TRANSACTION_ID,
   PO_LINE_ID,
   PO_LINE_LOCATION_ID,
   LC_ID,
   LC_NUM,
   BL_NUM,
   BL_DATE,
   PROD_BATCH_NO,
   LCM_ADJ_NUM,
   GMF_HEADER_ID,
   TRANSACTION_TYPE_NAME,
   TRANSACTION_ACTION_ID
)
AS
   SELECT 1 UNION_PART,
          ORG.OPERATING_UNIT ORG_ID,
          OU.NAME OU_NAME,
          gxeh.LEGAL_ENTITY_ID,
          XAH.ACCOUNTING_ENTRY_STATUS_CODE,
          XAH.GL_TRANSFER_STATUS_CODE,
          XAH.APPLICATION_ID,
          'INV' JE_SOURCE,
          CAT.NAME JE_CATEGORY,
          CC.SEGMENT1 GL_LE,
          XAL.ACCOUNTING_CLASS_CODE,
          gxeh.EVENT_CLASS_CODE,
          gxeh.ENTITY_CODE,
          XAH.EVENT_TYPE_CODE,
          CC.SEGMENT2 GL_UNIT,
          CC.SEGMENT3 GL_CC,
          CC.SEGMENT4 GL_ACC,
          CC.SEGMENT5 GL_SL,
          EAM_FLEX_SL_DESC (CC.SEGMENT4, CC.SEGMENT5) GL_SL_DESC,
          CC.SEGMENT6 GL_PROJECT,
          CC.SEGMENT7 GL_IC,
          FLEX.DESCRIPTION ACCTDESC,
          gxeh.source_line_ID VOUCHER_NUMBER,
          NULL GL_VOUCHER_NUMBER,
          XAH.AE_HEADER_ID,
          XAL.AE_LINE_NUM GL_JE_LINE_NUM,
          XAL.ACCOUNTING_DATE VOUCHER_DATE,
          NULL PARTICULARS,
          XAL.ENTERED_DR,
          XAL.ENTERED_CR,
          XAL.ACCOUNTED_DR,
          XAL.ACCOUNTED_CR,
          NULL CHEQUE_NUMBER,
          TRUNC (SYSDATE) CHEQUE_DATE,
          APS.SEGMENT1 PARTY_CODE,
          APS.VENDOR_NAME PARTY_NAME,
          --ENTITY_CODE TRANSACTION_TYPE,
          CC.CHART_OF_ACCOUNTS_ID,
          xah.LEDGER_ID,
          NULL DFF_CONTEXT,
          DECODE (GXEH.ENTITY_CODE, 'PURCHASING', PO.SEGMENT1, NULL) PO_NUM,
          PO.PO_HEADER_ID PO_HEADER_ID,
          (SELECT shipment_number
             FROM mtl_material_transactions
            WHERE transaction_id = gxeh.transaction_id
                  AND transaction_type_id IN (3, 12, 21))
             INTER_ORG_SHIPMENT_NUM,
          NULL ATTRIBUTE3,
          NULL ATTRIBUTE4,
          NULL ATTRIBUTE5,
          ORG.ORGANIZATION_ID,
          ORG.ORGANIZATION_CODE,
          ORG.ORGANIZATION_NAME,
          MST.INVENTORY_ITEM_ID,
          MST.SEGMENT1 ITEM_CODE_SEGMENT1,
          MST.SEGMENT2 ITEM_CODE_SEGMENT2,
          MST.SEGMENT3 ITEM_CODE_SEGMENT3,
          MST.SEGMENT4 ITEM_CODE_SEGMENT4,
          MST.SEGMENT5 ITEM_CODE_SEGMENT5,
          MST.SEGMENT6 ITEM_CODE_SEGMENT6,
          MST.CONCATENATED_SEGMENTS CONCAT_ITEM_CODE,
          MST.DESCRIPTION INVENTORY_ITEM_NAME,
          (SELECT MCB.SEGMENT1
             FROM MTL_ITEM_CATEGORIES MIC, MTL_CATEGORIES_B MCB
            WHERE     MIC.CATEGORY_ID = MCB.CATEGORY_ID
                  AND MCB.STRUCTURE_ID = 101
                  AND MIC.CATEGORY_SET_ID = 1
                  AND MIC.INVENTORY_ITEM_ID = MST.INVENTORY_ITEM_ID
                  AND MIC.ORGANIZATION_ID = MST.ORGANIZATION_ID)
             ITEM_CATEGORY_SEGMENT1,
          (SELECT MCB.SEGMENT2
             FROM MTL_ITEM_CATEGORIES MIC, MTL_CATEGORIES_B MCB
            WHERE     MIC.CATEGORY_ID = MCB.CATEGORY_ID
                  AND MCB.STRUCTURE_ID = 101
                  AND MIC.CATEGORY_SET_ID = 1
                  AND MIC.INVENTORY_ITEM_ID = MST.INVENTORY_ITEM_ID
                  AND MIC.ORGANIZATION_ID = MST.ORGANIZATION_ID)
             ITEM_CATEGORY_SEGMENT2,
          (SELECT MCB.SEGMENT3
             FROM MTL_ITEM_CATEGORIES MIC, MTL_CATEGORIES_B MCB
            WHERE     MIC.CATEGORY_ID = MCB.CATEGORY_ID
                  AND MCB.STRUCTURE_ID = 101
                  AND MIC.CATEGORY_SET_ID = 1
                  AND MIC.INVENTORY_ITEM_ID = MST.INVENTORY_ITEM_ID
                  AND MIC.ORGANIZATION_ID = MST.ORGANIZATION_ID)
             ITEM_CATEGORY_SEGMENT3,
          (SELECT MCB.SEGMENT1
             FROM MTL_ITEM_CATEGORIES MIC, MTL_CATEGORIES_B MCB
            WHERE     MIC.CATEGORY_ID = MCB.CATEGORY_ID
                  AND MCB.STRUCTURE_ID = 50408
                  AND MIC.CATEGORY_SET_ID = 1100000041
                  AND MIC.INVENTORY_ITEM_ID = MST.INVENTORY_ITEM_ID
                  AND MIC.ORGANIZATION_ID = MST.ORGANIZATION_ID)
             FIN_CAT1,
          (SELECT MCB.SEGMENT2
             FROM MTL_ITEM_CATEGORIES MIC, MTL_CATEGORIES_B MCB
            WHERE     MIC.CATEGORY_ID = MCB.CATEGORY_ID
                  AND MCB.STRUCTURE_ID = 50408
                  AND MIC.CATEGORY_SET_ID = 1100000041
                  AND MIC.INVENTORY_ITEM_ID = MST.INVENTORY_ITEM_ID
                  AND MIC.ORGANIZATION_ID = MST.ORGANIZATION_ID)
             FIN_CAT2,
          RCVH.RECEIPT_NUM GOODS_RECEIPT_NUM,
          gxeh.REFERENCE_NO,
          gxeh.EVENT_ID,
          gxeh.TRANSACTION_ID,
          gxeh.TRANSACTION_TYPE_ID,
          gxeh.TRANSACTION_UOM,
          gxeh.TXN_SOURCE,
          gxeh.LOT_NUMBER,
          gxeh.TRANSACTION_CURRENCY,
          gxeh.CURRENCY_CONVERSION_RATE,
          gxeh.TRANSACTION_QUANTITY,
          gxeh.TRANSACTION_VALUE,
          gxeh.SOURCE_DOCUMENT_ID,
          gxeh.SOURCE_LINE_ID,
          0 FA_ASSET_ID,
          RCVT.SHIPMENT_HEADER_ID,
          RCVT.SHIPMENT_LINE_ID,
          RCVT.TRANSACTION_ID RCV_TRANSACTION_ID,
          RCVT.PO_LINE_ID,
          RCVT.PO_LINE_LOCATION_ID,
          (SELECT DISTINCT LC_ID           --, LC_NUMBER, ORG_ID, PO_HEADER_ID
             FROM XX_LC_DETAILS
            WHERE po_header_id = RCVT.PO_HEADER_ID)
             LC_ID,
          (SELECT DISTINCT LC_NUMBER                   -- ORG_ID, PO_HEADER_ID
             FROM XX_LC_DETAILS
            WHERE po_header_id = RCVT.PO_HEADER_ID)
             LC_NUM,
          (SELECT DISTINCT BILL_OF_ENTRY_NO        --, BILL_OF_ENTRY_DATE, A.*
             FROM XX_LC_DETAILS_DT
            WHERE SHIPMENT_HEADER_ID = RCVH.SHIPMENT_HEADER_ID)
             BL_NUM,
          (SELECT DISTINCT BILL_OF_ENTRY_DATE
             FROM XX_LC_DETAILS_DT
            WHERE SHIPMENT_HEADER_ID = RCVH.SHIPMENT_HEADER_ID)
             BL_DATE,
          CASE
             WHEN gxeh.EVENT_TYPE_CODE = 'STEP'
             THEN
                gxeh.SOURCE_DOCUMENT_ID
             ELSE
                DECODE (gxeh.TRANSACTION_TYPE_ID,
                        44, gxeh.SOURCE_DOCUMENT_ID,
                        17, gxeh.SOURCE_DOCUMENT_ID,
                        1002, gxeh.SOURCE_DOCUMENT_ID,
                        35, gxeh.SOURCE_DOCUMENT_ID,
                        1003, gxeh.SOURCE_DOCUMENT_ID,
                        43, gxeh.SOURCE_DOCUMENT_ID,
                        NULL)
          END
             PROD_BATCH_NO,
          gxeh.SOURCE_DOCUMENT_ID LCM_ADJ_NUM,
          gxeh.HEADER_ID GMF_HEADER_ID,
          (SELECT TRANSACTION_TYPE_NAME
             FROM MTL_TRANSACTION_TYPES
            WHERE TRANSACTION_TYPE_ID = gxeh.TRANSACTION_TYPE_ID)
             AS TRANSACTION_TYPE_NAME,
          gxeh.TRANSACTION_ACTION_ID
     FROM AP_SUPPLIERS APS,
          RCV_SHIPMENT_HEADERS RCVH,
          RCV_TRANSACTIONS RCVT,
          gmf_xla_extract_headers gxeh,
          XLA_AE_LINES XAL,
          XLA_AE_HEADERS XAH,
          GL_LEDGERS LED,
          FND_DOC_SEQUENCE_CATEGORIES CAT,
          gl_code_combinations cc,
          FND_FLEX_VALUES_VL FLEX,
          MTL_SYSTEM_ITEMS_B_KFV MST,
          ORG_ORGANIZATION_DEFINITIONS ORG,
          --  MTL_ITEM_CATEGORIES MIC,
          -- MTL_CATEGORIES_B MCB,
          PO_HEADERS_ALL PO,
          HR_OPERATING_UNITS OU
    WHERE     APS.VENDOR_ID(+) = RCVH.VENDOR_ID
          AND RCVH.SHIPMENT_HEADER_ID(+) = RCVT.SHIPMENT_HEADER_ID
          AND ORG.OPERATING_UNIT = OU.ORGANIZATION_ID
          AND LED.LEDGER_ID = XAH.LEDGER_ID
          AND LED.LEDGER_CATEGORY_CODE = 'PRIMARY'
          AND NVL (RCVT.PO_HEADER_ID, 1) = NVL (PO.PO_HEADER_ID(+), 1)
          AND gxeh.source_line_ID = RCVT.TRANSACTION_ID(+)
          AND gxeh.organization_id = rcvt.organization_id(+)
          AND XAH.event_id = gxeh.event_id
          AND XAH.LEDGER_ID = gxeh.LEDGER_ID
          AND XAL.AE_HEADER_ID = XAH.AE_HEADER_ID
          AND xal.code_combination_id = cc.code_combination_id
          AND XAH.JE_CATEGORY_NAME = CAT.CODE
          AND CAT.APPLICATION_ID = 101
          --AND XAH.ledger_id = 2043
          AND CC.SEGMENT4 = FLEX.FLEX_VALUE_MEANING
          AND GXEH.ORGANIZATION_ID = MST.ORGANIZATION_ID
          AND GXEH.INVENTORY_ITEM_ID = MST.INVENTORY_ITEM_ID
          AND GXEH.ORGANIZATION_ID = ORG.ORGANIZATION_ID
          -- AND MIC.INVENTORY_ITEM_ID = MST.INVENTORY_ITEM_ID
          --AND MCB.STRUCTURE_ID = 101
          AND XAH.APPLICATION_ID = 555
          --AND ORG.OPERATING_UNIT IN (526,527)
          --AND MCB.CATEGORY_ID = MIC.CATEGORY_ID
          --AND (NVL (XAL.ACCOUNTED_DR, 0) <> 0
          --   OR NVL (XAL.ACCOUNTED_CR, 0) <> 0)
          AND FLEX.FLEX_VALUE_SET_ID = 1016490
   UNION ALL
   SELECT 2 UNION_PART,
          ORG.OPERATING_UNIT ORG_ID,
          OU.NAME OU_NAME,
          gxeh.LEGAL_ENTITY_ID,
          XAH.ACCOUNTING_ENTRY_STATUS_CODE,
          XAH.GL_TRANSFER_STATUS_CODE,
          XAH.APPLICATION_ID,
          'INV' JE_SOURCE,
          CAT.NAME JE_CATEGORY,
          CC.SEGMENT1 GL_LE,
          XAL.ACCOUNTING_CLASS_CODE,
          gxeh.EVENT_CLASS_CODE,
          gxeh.ENTITY_CODE,
          XAH.EVENT_TYPE_CODE,
          CC.SEGMENT2 GL_UNIT,
          CC.SEGMENT3 GL_CC,
          CC.SEGMENT4 GL_ACC,
          CC.SEGMENT5 GL_SL,
          EAM_FLEX_SL_DESC (CC.SEGMENT4, CC.SEGMENT5) GL_SL_DESC,
          CC.SEGMENT6 GL_PROJECT,
          CC.SEGMENT7 GL_IC,
          FLEX.DESCRIPTION ACCTDESC,
          gxeh.source_line_ID VOUCHER_NUMBER,
          NULL GL_VOUCHER_NUMBER,
          XAH.AE_HEADER_ID,
          XAL.AE_LINE_NUM GL_JE_LINE_NUM,
          XAL.ACCOUNTING_DATE VOUCHER_DATE,
          NULL PARTICULARS,
          XAL.ENTERED_DR,
          XAL.ENTERED_CR,
          XAL.ACCOUNTED_DR,
          XAL.ACCOUNTED_CR,
          NULL CHEQUE_NUMBER,
          TRUNC (SYSDATE) CHEQUE_DATE,
          TO_CHAR (NULL) PARTY_CODE,
          TO_CHAR (NULL) PARTY_NAME,
          --ENTITY_CODE TRANSACTION_TYPE,
          CC.CHART_OF_ACCOUNTS_ID,
          xah.LEDGER_ID,
          NULL DFF_CONTEXT,
          TO_CHAR (NULL) PO_NUM,
          TO_NUMBER (0) PO_HEADER_ID,                            --PO.SEGMENT1
          NULL INTER_ORG_SHIPMENT_NUM,
          NULL ATTRIBUTE3,
          NULL ATTRIBUTE4,
          NULL ATTRIBUTE5,
          ORG.ORGANIZATION_ID,
          ORG.ORGANIZATION_CODE,
          ORG.ORGANIZATION_NAME,
          TO_NUMBER (0) INVENTORY_ITEM_ID,
          TO_CHAR (NULL) ITEM_CODE_SEGMENT1,
          TO_CHAR (NULL) ITEM_CODE_SEGMENT2,
          TO_CHAR (NULL) ITEM_CODE_SEGMENT3,
          TO_CHAR (NULL) ITEM_CODE_SEGMENT4,
          TO_CHAR (NULL) ITEM_CODE_SEGMENT5,
          TO_CHAR (NULL) ITEM_CODE_SEGMENT6,
          TO_CHAR (NULL) CONCAT_ITEM_CODE,
          TO_CHAR (NULL) INVENTORY_ITEM_NAME,
          TO_CHAR (NULL) ITEM_CATEGORY_SEGMENT1,
          TO_CHAR (NULL) ITEM_CATEGORY_SEGMENT2,
          TO_CHAR (NULL) ITEM_CATEGORY_SEGMENT3,
          TO_CHAR (NULL) FIN_CAT1,
          TO_CHAR (NULL) FIN_CAT2,
          TO_CHAR (NULL) GOODS_RECEIPT_NUM,
          gxeh.REFERENCE_NO,
          gxeh.EVENT_ID,
          gxeh.TRANSACTION_ID,
          gxeh.TRANSACTION_TYPE_ID,
          gxeh.TRANSACTION_UOM,
          gxeh.TXN_SOURCE,
          gxeh.LOT_NUMBER,
          gxeh.TRANSACTION_CURRENCY,
          gxeh.CURRENCY_CONVERSION_RATE,
          gxeh.TRANSACTION_QUANTITY,
          gxeh.TRANSACTION_VALUE,
          gxeh.SOURCE_DOCUMENT_ID,
          gxeh.SOURCE_LINE_ID,
          0 FA_ASSET_ID,
          0 SHIPMENT_HEADER_ID,
          0 SHIPMENT_LINE_ID,
          0 RCV_TRANSACTION_ID,
          0 PO_LINE_ID,
          0 PO_LINE_LOCATION_ID,
          0 LC_ID,
          TO_CHAR (NULL) LC_NUM,
          TO_CHAR (NULL) BL_NUM,
          TO_DATE (NULL) BL_DATE,
          gxeh.SOURCE_DOCUMENT_ID PROD_BATCH_NO,
          TO_NUMBER (NULL) LCM_ADJ_NUM,
          TO_NUMBER (NULL) GMF_HEADER_ID,
          (SELECT TRANSACTION_TYPE_NAME
             FROM MTL_TRANSACTION_TYPES
            WHERE TRANSACTION_TYPE_ID = gxeh.TRANSACTION_TYPE_ID)
             AS TRANSACTION_TYPE_NAME,
          gxeh.TRANSACTION_ACTION_ID
     FROM gmf_xla_extract_headers gxeh,
          XLA_AE_LINES XAL,
          XLA_AE_HEADERS XAH,
          GL_LEDGERS LED,
          FND_DOC_SEQUENCE_CATEGORIES CAT,
          gl_code_combinations cc,
          FND_FLEX_VALUES_VL FLEX,
          ORG_ORGANIZATION_DEFINITIONS ORG,
          HR_OPERATING_UNITS OU
    WHERE     XAH.event_id = gxeh.event_id
          --AND xah.ledger_id = 2043
          AND ORG.OPERATING_UNIT = OU.ORGANIZATION_ID
          AND EVENT_CLASS_CODE = 'BATCH_CLOSE'
          AND LED.LEDGER_ID = XAH.LEDGER_ID
          AND LED.LEDGER_CATEGORY_CODE = 'PRIMARY'
          AND XAH.LEDGER_ID = gxeh.LEDGER_ID
          AND XAL.AE_HEADER_ID = XAH.AE_HEADER_ID
          AND ORG.ORGANIZATION_ID = gxeh.ORGANIZATION_ID
          AND xal.code_combination_id = cc.code_combination_id
          AND XAH.JE_CATEGORY_NAME = CAT.CODE
          AND CAT.APPLICATION_ID = 101
          AND CC.SEGMENT4 = FLEX.FLEX_VALUE_MEANING
          AND XAH.APPLICATION_ID = 555
          --AND ORG.OPERATING_UNIT IN (526,527)
          --AND MCB.CATEGORY_ID = MIC.CATEGORY_ID
          --          AND (NVL (XAL.ACCOUNTED_DR, 0) <> 0
          --             OR NVL (XAL.ACCOUNTED_CR, 0) <> 0)
          AND FLEX.FLEX_VALUE_SET_ID = 1016490;
